<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.12">
<meta name="author" content="Mark A. Yoder">
<title>PRU Cookbook</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:50%;border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<h1>PRU Cookbook</h1>
<div class="details">
<span id="author" class="author">Mark A. Yoder</span><br>
<span id="email" class="email"><a href="mailto:Mark.A.Yoder@Rose-Hulman.edu">Mark.A.Yoder@Rose-Hulman.edu</a></span><br>
<span id="revnumber">version 2.0 beta</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#basics">Basics</a>
<ul class="sectlevel2">
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_picking_your_beagle">Picking Your Beagle</a></li>
<li><a href="#basics_out_of_the_box">Getting Started, Out of the Box</a></li>
<li><a href="#basics_latest_os">Verifying You Have the Latest Version of the OS on Your Bone</a></li>
<li><a href="#_running_the_bonescript_api_tutorials">Running the BoneScript API Tutorials</a></li>
<li><a href="#basics_wire_breadboard">Wiring a Breadboard</a></li>
<li><a href="#basics_cloud9">Editing Code Using the Cloud9 IDE</a></li>
<li><a href="#basics_cloud9_IDE">Running JavaScript Applications from the Cloud9 IDE</a></li>
<li><a href="#basics_autorun">Running Applications Automatically</a></li>
<li><a href="#_finding_the_latest_version_of_the_os_for_your_bone">Finding the Latest Version of the OS for Your Bone</a></li>
<li><a href="#basics_install_os">Running the Latest Version of the OS on Your Bone</a></li>
<li><a href="#_updating_the_os_on_your_bone">Updating the OS on Your Bone</a></li>
<li><a href="#_backing_up_the_onboard_flash">Backing Up the Onboard Flash</a></li>
<li><a href="#basics_onboard_flash">Updating the Onboard Flash</a></li>
</ul>
</li>
<li><a href="#sensors">Sensors</a>
<ul class="sectlevel2">
<li><a href="#_introduction_2">Introduction</a></li>
<li><a href="#_choosing_a_method_to_connect_your_sensor">Choosing a Method to Connect Your Sensor</a></li>
<li><a href="#sensors_getting_started">Input and Run a JavaScript Application for Talking to Sensors</a></li>
<li><a href="#sensors_pushbutton">Reading the Status of a Pushbutton or Magnetic Switch (Passive On/Off Sensor)</a></li>
<li><a href="#_reading_a_position_light_or_force_sensor_variable_resistance_sensor">Reading a Position, Light, or Force Sensor (Variable Resistance Sensor)</a></li>
<li><a href="#_reading_a_distance_sensor_analog_or_variable_voltage_sensor">Reading a Distance Sensor (Analog or Variable Voltage Sensor)</a></li>
<li><a href="#sensors_hc-sr04">Reading a Distance Sensor (Variable Pulse Width Sensor)</a></li>
<li><a href="#_accurately_reading_the_position_of_a_motor_or_dial">Accurately Reading the Position of a Motor or Dial</a></li>
<li><a href="#sensors_GPS">Acquiring Data by Using a Smart Sensor over a Serial Connection</a></li>
<li><a href="#sensors_i2c_temp">Measuring a Temperature</a></li>
<li><a href="#_reading_temperature_via_a_dallas_1_wire_device">Reading Temperature via a Dallas 1-Wire Device</a></li>
<li><a href="#sensors_sensortag">Sensing All Sorts of Things with SensorTag via Bluetooth v4.0</a></li>
<li><a href="#sensors_audio">Playing and Recording Audio</a></li>
</ul>
</li>
<li><a href="#displays">Displays and Other Outputs</a>
<ul class="sectlevel2">
<li><a href="#_introduction_3">Introduction</a></li>
<li><a href="#displays_onboardLED">Toggling an Onboard LED</a></li>
<li><a href="#displays_externalLED">Toggling an External LED</a></li>
<li><a href="#displays_powerSwitch">Toggling a High-Voltage External Device</a></li>
<li><a href="#displays_PWMdiscussion">Fading an External LED</a></li>
<li><a href="#_writing_to_an_led_matrix">Writing to an LED Matrix</a></li>
<li><a href="#displays_drive5V">Driving a 5 V Device</a></li>
<li><a href="#_writing_to_a_neopixel_led_string">Writing to a NeoPixel LED String</a></li>
<li><a href="#_using_a_nokia_5510_lcd_display">Using a Nokia 5510 LCD Display</a></li>
<li><a href="#_making_your_bone_speak">Making Your Bone Speak</a></li>
</ul>
</li>
<li><a href="#motors">Motors</a>
<ul class="sectlevel2">
<li><a href="#_introduction_4">Introduction</a></li>
<li><a href="#motors_servo">Controlling a Servo Motor</a></li>
<li><a href="#motors_dcSpeed">Controlling the Speed of a DC Motor</a></li>
<li><a href="#motors_dcDirection">Controlling the Speed and Direction of a DC Motor</a></li>
<li><a href="#_driving_a_bipolar_stepper_motor">Driving a Bipolar Stepper Motor</a></li>
<li><a href="#_driving_a_unipolar_stepper_motor">Driving a Unipolar Stepper Motor</a></li>
</ul>
</li>
<li><a href="#tips">Beyond the Basics</a>
<ul class="sectlevel2">
<li><a href="#_introduction_5">Introduction</a></li>
<li><a href="#tips_hdmi">Running Your Bone Standalone</a></li>
<li><a href="#tips_pick_os">Selecting an OS for Your Development Host Computer</a></li>
<li><a href="#tips_shell">Getting to the Command Shell via SSH</a></li>
<li><a href="#tips_serial">Getting to the Command Shell via the Virtual Serial Port</a></li>
<li><a href="#tips_FTDI">Viewing and Debugging the Kernel and u-boot Messages at Boot Time</a></li>
<li><a href="#_verifying_you_have_the_latest_version_of_the_os_on_your_bone_from_the_shell">Verifying You Have the Latest Version of the OS on Your Bone from the Shell</a></li>
<li><a href="#_controlling_the_bone_remotely_with_vnc">Controlling the Bone Remotely with VNC</a></li>
<li><a href="#_learning_typical_gnulinux_commands">Learning Typical GNU/Linux Commands</a></li>
<li><a href="#tips_editing_files">Editing a Text File from the GNU/Linux Command Shell</a></li>
<li><a href="#_using_a_graphical_editor">Using a Graphical Editor</a></li>
<li><a href="#networking_wired">Establishing an Ethernet-Based Internet Connection</a></li>
<li><a href="#networking_wireless">Establishing a WiFi-Based Internet Connection</a></li>
<li><a href="#networking_usb">Sharing the Host&#8217;s Internet Connection over USB</a></li>
<li><a href="#tips_firewall">Setting Up a Firewall</a></li>
<li><a href="#tips_apt-get">Installing Additional Packages from the Debian Package Feed</a></li>
<li><a href="#tips_apt-get_remove">Removing Packages Installed with apt-get</a></li>
<li><a href="#_copying_files_between_the_onboard_flash_and_the_microsd_card">Copying Files Between the Onboard Flash and the MicroSD Card</a></li>
<li><a href="#_freeing_space_on_the_onboard_flash_or_microsd_card">Freeing Space on the Onboard Flash or MicroSD Card</a></li>
<li><a href="#_installing_additional_node_js_packages">Installing Additional Node.js Packages</a></li>
<li><a href="#using_python">Using Python to Interact with the Physical World</a></li>
<li><a href="#misc_libsoc">Using C to Interact with the Physical World</a></li>
</ul>
</li>
<li><a href="#networking">Internet of Things</a>
<ul class="sectlevel2">
<li><a href="#_introduction_6">Introduction</a></li>
<li><a href="#_accessing_your_host_computers_files_on_the_bone">Accessing Your Host Computer&#8217;s Files on the Bone</a></li>
<li><a href="#networking_builtin_server">Serving Web Pages from the Bone</a></li>
<li><a href="#networking_nodejs">Interacting with the Bone via a Web Browser</a></li>
<li><a href="#_displaying_gpio_status_in_a_web_browser">Displaying GPIO Status in a Web Browser</a></li>
<li><a href="#networking_jsfiddle">Continuously Displaying the GPIO Value via jsfiddle</a></li>
<li><a href="#networking_jQuery_local">Continuously Displaying the GPIO Value</a></li>
<li><a href="#_plotting_data">Plotting Data</a></li>
<li><a href="#_sending_an_email">Sending an Email</a></li>
<li><a href="#_sending_an_sms_message">Sending an SMS Message</a></li>
<li><a href="#_displaying_the_current_weather_conditions">Displaying the Current Weather Conditions</a></li>
<li><a href="#_sending_and_receiving_tweets">Sending and Receiving Tweets</a></li>
<li><a href="#networking_node_red">Wiring the IoT with Node-RED</a></li>
<li><a href="#networking_apache">Serving Web Pages from the Bone by Using Apache</a></li>
<li><a href="#_communicating_over_a_serial_connection_to_an_arduino_or_launchpad">Communicating over a Serial Connection to an Arduino or LaunchPad</a></li>
</ul>
</li>
<li><a href="#kernel">The Kernel</a>
<ul class="sectlevel2">
<li><a href="#_introduction_7">Introduction</a></li>
<li><a href="#_updating_the_kernel">Updating the Kernel</a></li>
<li><a href="#kernel_building_modules">Building and Installing Kernel Modules</a></li>
<li><a href="#kernel_LEDs">Controlling LEDs by Using SYSFS Entries</a></li>
<li><a href="#kernel_gpio_sysfs">Controlling GPIOs by Using SYSFS Entries</a></li>
<li><a href="#kernel_compiling">Compiling the Kernel</a></li>
<li><a href="#kernel_using_cross_compiler">Using the Installed Cross Compiler</a></li>
<li><a href="#kernel_patches">Applying Patches</a></li>
<li><a href="#kernel_create_patch">Creating Your Own Patch File</a></li>
</ul>
</li>
<li><a href="#realtime">Real-Time I/O</a>
<ul class="sectlevel2">
<li><a href="#_introduction_8">Introduction</a></li>
<li><a href="#realtime_BoneScript">I/O with BoneScript</a></li>
<li><a href="#realtime_libsoc">I/O with C and libsoc</a></li>
<li><a href="#realtime_devmem2">I/O with devmem2</a></li>
<li><a href="#realtime_mmap">I/O with C and mmap()</a></li>
<li><a href="#realtime_xenomai">Modifying the Linux Kernel to Use Xenomai</a></li>
<li><a href="#realtime_PRUSpeak">I/O with PRU Speak</a></li>
</ul>
</li>
<li><a href="#capes">Capes</a>
<ul class="sectlevel2">
<li><a href="#_introduction_9">Introduction</a></li>
<li><a href="#capes_7inLCD">Using a Seven-Inch LCD Cape</a></li>
<li><a href="#capes_miniDisplay">Using a 128 x 128-Pixel LCD Cape</a></li>
<li><a href="#_connecting_multiple_capes">Connecting Multiple Capes</a></li>
<li><a href="#capes_soldering">Moving from a Breadboard to a Protoboard</a></li>
<li><a href="#capes_creating_prototype_schematic">Creating a Prototype Schematic</a></li>
<li><a href="#capes_verify">Verifying Your Cape Design</a></li>
<li><a href="#capes_layout">Laying Out Your Cape PCB</a></li>
<li><a href="#capes_schematic_migration">Migrating a Fritzing Schematic to Another Tool</a></li>
<li><a href="#capes_prototype">Producing a Prototype</a></li>
<li><a href="#_creating_contents_for_your_cape_configuration_eeprom">Creating Contents for Your Cape Configuration EEPROM</a></li>
<li><a href="#capes_production">Putting Your Cape Design into Production</a></li>
</ul>
</li>
<li><a href="#partsSuppliers">Appendix A: Parts and Suppliers</a>
<ul class="sectlevel2">
<li><a href="#_parts">Parts</a></li>
<li><a href="#app_proto">Prototyping Equipment</a></li>
<li><a href="#app_resistor">Resistors</a></li>
<li><a href="#app_transistor">Transistors and Diodes</a></li>
<li><a href="#app_ic">Integrated Circuits</a></li>
<li><a href="#app_opto">Opto-Electronics</a></li>
<li><a href="#app_capes">Capes</a></li>
<li><a href="#app_misc">Miscellaneous</a></li>
</ul>
</li>
<li><a href="#_index">Index</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1 pagenumrestart">
<h2 id="basics">Basics</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction">Introduction</h3>
<div class="paragraph">
<p>When you buy BeagleBone Black, pretty much everything you need to get going comes with it. You can just plug it into the USB of a host computer, and it works. The goal of this chapter is to show what you can do with your Bone, right out of the box. It has enough information to carry through the next three chapters on sensors (<a href="#sensors">Sensors</a>), displays (<a href="#displays">Displays and Other Outputs</a>), and motors (<a href="#motors">Motors</a>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_picking_your_beagle">Picking Your Beagle</h3>
<div class="sect3">
<h4 id="_problem">Problem</h4>
<div class="paragraph">
<p>There are five different BeagleBoards. How do you pick which one to use?</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution">Solution</h4>
<div class="paragraph">
<p>For someone new to the BeagleBoard.org boards, the BeagleBone Black is the obvious choice.  It’s the newest and cheapest (~$55 USD) of the inexpensive Bones, and there are nearly a quarter-million units out there. Many of the recipes in this book will work on the other Beagles, too, but the Black is where to begin. If you already have BeagleBone Black, you can move on to the next recipe. If you have another Beagle, your mileage may vary.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="basics_out_of_the_box">Getting Started, Out of the Box</h3>
<div class="sect3">
<h4 id="_problem_2">Problem</h4>
<div class="paragraph">
<p>You just got your Bone, and you want to know what to do with it.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_2">Solution</h4>
<div class="paragraph">
<p>Fortunately, you have all you need to get running: your Bone and a USB cable.
Plug the USB cable into your host computer (Mac, Windows, or Linux) and plug the mini-USB connector side into the USB connector near the Ethernet connector on the Bone, as shown in <a href="#basics_pluggingIn_fig">Plugging BeagleBone Black into a USB port</a>.</p>
</div>
<div id="basics_pluggingIn_fig" class="imageblock">
<div class="content">
<img src="./01basics/figures/pluggingIn.jpg" alt="Plugging In">
</div>
<div class="title">Figure 1. Plugging BeagleBone Black into a USB port</div>
</div>
<div class="paragraph">
<p>The four blue USER LEDs will begin to blink, and in 10 or 15 seconds, you&#8217;ll see a new USB drive appear on your host computer. <a href="#basics_01gettingStarted_fig">The Bone appears as a USB drive</a> shows how it will appear on a Windows host, and Linux and Mac hosts will look similar. The Bone acting like a USB drive and the files you see are located on the Bone.</p>
</div>
<div id="basics_01gettingStarted_fig" class="imageblock">
<div class="content">
<img src="./01basics/figures/01GettingStarted.png" alt="A new USB drive">
</div>
<div class="title">Figure 2. The Bone appears as a USB drive</div>
</div>
<div class="paragraph">
<p>Open the drive and open <em>START.htm</em> using <a href="http://www.google.com/chrome/">Google Chrome</a> or <a href="https://www.mozilla.org/en-US/firefox/new/">Firefox</a> (<a href="#basics_02gettingStarted_fig">Open START.htm</a>).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Some users have reported problems when using Internet Explorer with the web pages served up by the Bone, so make sure to use Chrome or Firefox.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="basics_02gettingStarted_fig" class="imageblock">
<div class="content">
<img src="./01basics/figures/02GettingStarted.png" alt="Open START.htm">
</div>
<div class="title">Figure 3. Open START.htm</div>
</div>
<div class="paragraph">
<p>Follow the instructions (<a href="#basics_03gettingStarted_fig">Install the USB drivers</a>) for installing the USB drivers for your host computer&#8217;s operating system (OS).</p>
</div>
<div id="basics_03gettingStarted_fig" class="imageblock">
<div class="content">
<img src="./01basics/figures/03GettingStarted.png" alt="Install USB drivers">
</div>
<div class="title">Figure 4. Install the USB drivers</div>
</div>
<div class="paragraph">
<p>On your host, browse to <a href="http://192.168.7.2" class="bare">http://192.168.7.2</a> (<a href="#basics_04gettingStarted_fig">Open http://192.168.7.2 on your host computer</a>).</p>
</div>
<div id="basics_04gettingStarted_fig" class="imageblock">
<div class="content">
<img src="./01basics/figures/04GettingStarted.png" alt="Open START.htm">
</div>
<div class="title">Figure 5. Open <a href="http://192.168.7.2" class="bare">http://192.168.7.2</a> on your host computer</div>
</div>
<div class="paragraph">
<p>You are now ready to explore your Bone. Look around. There&#8217;s lots of information on the page.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>The green banner at the top of the page means the browser is talking to the Bone, and code on the page can be edited and run on the Bone. Try scrolling down to the code in "BoneScript interactive guide" and running it. Then try editing the code and running it again. Take five minutes and try it! Watch out, though, because you can&#8217;t save your edits. You need Cloud9 for that, as discussed next.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="basics_openCloud9" class="paragraph">
<p>Also be sure to browse to <a href="http://192.168.7.2:3000" class="bare">http://192.168.7.2:3000</a> from your host computer (<a href="#basics_05gettingStarted_fig">Cloud9</a>).</p>
</div>
<div id="basics_05gettingStarted_fig" class="imageblock">
<div class="content">
<img src="./01basics/figures/05GettingStarted.png" alt="Cloud9">
</div>
<div class="title">Figure 6. Cloud9</div>
</div>
<div class="paragraph">
<p>Here, you&#8217;ll find <em>Cloud9</em>, a web-based integrated development environment (IDE) that lets you edit and run code on your Bone!  See <a href="#basics_cloud9">Editing Code Using the Cloud9 IDE</a> for more details.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Cloud9 can have different themes.  If you see a white background, you can match the cookbook’s figures by clicking on the <em>Main Theme</em> drop-down menu and selecting <em>Cloud9 Classic Dark Theme</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Make sure you turn off your Bone properly. It&#8217;s best to run the halt command:</p>
</div>
<pre data-type="programlisting">
bone# <strong>halt</strong>
The system is going down for system halt NOW! (pts/0)
</pre>
<div class="paragraph">
<p>This will ensure that the Bone shuts down correctly. If you just pull the power, it&#8217;s possible that open files won&#8217;t close properly and might become corrupt.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_2">Discussion</h4>
<div class="paragraph">
<p>The rest of this book goes into the details behind this quick out-of-the-box demo.  Explore your Bone and then start exploring the book.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="basics_latest_os">Verifying You Have the Latest Version of the OS on Your Bone</h3>
<div class="sect3">
<h4 id="_problem_3">Problem</h4>
<div class="paragraph">
<p>You just got BeagleBone Black, and you want to know which version of the operating system it&#8217;s running.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_3">Solution</h4>
<div class="paragraph">
<p>This book uses <a href="https://www.debian.org">Debian</a>, the Linux distribution that currently ships on the Bone. However this book is based on a newer version (2014-11-11 image) than what is shipping at the time of this writing. You can see which version your Bone is running by following the instructions in <a href="#basics_out_of_the_box">Getting Started, Out of the Box</a> to open the USB drive that comes from the Bone, as shown in <a href="#basics_02gettingStarted_fig">Open START.htm</a>. But instead of opening <em>START.html</em>, open <em>ID.txt</em> (shown with the dashed arrow in <a href="#basics_02gettingStarted_fig">Open START.htm</a>). You&#8217;ll see something like <a href="#basics_ID">Contents of ID.txt</a>, in which 2014-11-11 is the date of the image.</p>
</div>
<div id="basics_ID" class="imageblock">
<div class="content">
<img src="./01basics/figures/ID.txt.png" alt="Contents of ID.txt">
</div>
<div class="title">Figure 7. Contents of ID.txt</div>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_3">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="_running_the_bonescript_api_tutorials">Running the BoneScript API Tutorials</h3>
<div class="sect3">
<h4 id="_problem_4">Problem</h4>
<div class="paragraph">
<p>You&#8217;d like to learn JavaScript and the BoneScript API to perform physical computing tasks without first learning Linux.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_4">Solution</h4>
<div class="paragraph">
<p>Plug your board into the USB of your host computer and browse to <a href="http://192.168.7.2/Support/bone101/" class="bare">http://192.168.7.2/Support/bone101/</a> using Google Chrome or Firefox (as shown in <a href="#basics_out_of_the_box">Getting Started, Out of the Box</a>). In the left column, click the BoneScript title, which will take you to <a href="http://192.168.7.2/Support/BoneScript/" class="bare">http://192.168.7.2/Support/BoneScript/</a> (<a href="#basics_bonescript">The BoneScript API examples page</a>).</p>
</div>
<div id="basics_bonescript" class="imageblock">
<div class="content">
<img src="./01basics/figures/bonescript-examples.png" alt="The BoneScript examples page">
</div>
<div class="title">Figure 8. The BoneScript API examples page</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Explore the various demonstrations of the BoneScript API. The <a href="http://192.168.7.2/Support/BoneScript">BoneScript examples page</a> lists several places to learn more about JavaScript and BoneScript (<a href="#basics_bonescript">The BoneScript API examples page</a>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the banner is green, the examples are live. Clicking the "run" button will make them run on your Bone.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Here&#8217;s yet another place to explore. In the left column of <a href="#basics_bonescript">The BoneScript API examples page</a>, click the function names. Take five minutes and see what you can find.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can edit the JavaScript on the BoneScript API examples page, but you can&#8217;t save it for later. If you want to edit and save it for later, fire up Cloud9 (<a href="#basics_cloud9">Editing Code Using the Cloud9 IDE</a>) and look in the <em>examples</em> folder.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_4">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="basics_wire_breadboard">Wiring a Breadboard</h3>
<div class="sect3">
<h4 id="_problem_5">Problem</h4>
<div class="paragraph">
<p>You would like to use a breadboard to wire things to the Bone.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_5">Solution</h4>
<div class="paragraph">
<p>Many of the projects in this book involve interfacing things to the Bone. Some plug in directly, like the USB port.  Others need to be wired. If it&#8217;s simple, you might be able to plug the wires directly into the P8 or P9 headers. Nevertheless, many require a breadboard for the fastest and simplest wiring.</p>
</div>
<div class="paragraph">
<p>To make this recipe, you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Breadboard and jumper wires (see <a href="#app_proto">Prototyping Equipment</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#basics_breadboard_template">Breadboard wired to BeagleBone Black</a> shows a breadboard wired to the Bone. All the diagrams in this book assume that the ground pin (P9_1 on the Bone) is wired to the negative rail and 3.3 V (P9_3) is wired to the positive rail.</p>
</div>
<div id="basics_breadboard_template" class="imageblock">
<div class="content">
<img src="./01basics/figures/template_bb.png" alt="Breadboad">
</div>
<div class="title">Figure 9. Breadboard wired to BeagleBone Black</div>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_5">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="basics_cloud9">Editing Code Using the Cloud9 IDE</h3>
<div class="sect3">
<h4 id="_problem_6">Problem</h4>
<div class="paragraph">
<p>You want to edit and debug files on the Bone.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_6">Solution</h4>
<div class="paragraph">
<p>Plug your Bone into a host computer via the USB cable. Open a browser (either Google Chrome or FireFox will work) on your host computer (as shown in <a href="#basics_out_of_the_box">Getting Started, Out of the Box</a>). After the Bone has booted up, browse to <a href="http://192.168.7.2:3000" class="bare">http://192.168.7.2:3000</a> on your host. You will see something like <a href="#basics_05gettingStarted_fig">Cloud9</a>.</p>
</div>
<div class="paragraph">
<p>Click the <em>examples</em> folder on the left and then double-click <em>blinkled.js</em>.
You can now edit the file. If you would like to edit files in your home directory, on the left of the Cloud9 screen, go to the Preferences wheel in the Workspace browser and
select Add Home to Favorites (<a href="#basics_addHome_fig">Making your home folder appear in Cloud9</a>). Now, your home directory will show up in the Workspace file tree.</p>
</div>
<div id="basics_addHome_fig" class="imageblock">
<div class="content">
<img src="./01basics/figures/addHome.png" alt="add home">
</div>
<div class="title">Figure 10. Making your home folder appear in Cloud9</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you edit line 13 of the <em>blinkled.js</em> file (setInterval(toggle, 1000);), changing 1000 to 500, you must save the file before running it for the change to take effect. The blue LED next to the Ethernet port on your Bone will flash roughly twice as fast.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="#basics_addHome_fig">Making your home folder appear in Cloud9</a> shows <em>/root</em> has been added under <em>FAVORITES</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <em>cloud9</em> folder that appears under <em>FILE SYSTEM</em> is located in <em>/var/lib/cloud9</em> on your Bone.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_6">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="basics_cloud9_IDE">Running JavaScript Applications from the Cloud9 IDE</h3>
<div class="sect3">
<h4 id="_problem_7">Problem</h4>
<div class="paragraph">
<p>You have a file edited in Cloud9, and you want to run it.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_7">Solution</h4>
<div class="paragraph">
<p>Cloud9 has a bash command window built in at the bottom of the window. You can run your code from this window. To do so, add #!/usr/bin/env node at the top of the file that you want to run and save.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you are running Python, replace the word node in the line with python.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>At the bottom of the Cloud9 window are a series of tabs (<a href="#basics_cloud9Bash_fig">Cloud9 debugger</a>).
Click the bash tab (it should be the leftmost tab). Here, you have a command prompt. In my case, it&#8217;s root@yoder-debian-bone:/var/lib/cloud9#. Yours will be slighly different, but it should end with a #.</p>
</div>
<div id="basics_cloud9Bash_fig" class="imageblock">
<div class="content">
<img src="./01basics/figures/cloud9Bash.png" alt="cloud9 bash">
</div>
<div class="title">Figure 11. Cloud9 debugger</div>
</div>
<div class="paragraph">
<p>Change to the directory that contains your file, make it executable, and then run it:</p>
</div>
<pre data-type="programlisting">
root@bone:/var/lib/cloud9# <strong>cd examples</strong>
root@bone:/var/lib/cloud9/examples# <strong>chmod +x blinkled.js</strong>
root@bone:/var/lib/cloud9/examples# <strong>./blinkled.js</strong>
</pre>
<div class="paragraph">
<p>The cd is the change directory command. After you cd, you are in a new directory, and the prompt reflects that change. The chmod command changes the mode of the file. The +x indicates that you want to add execute permission.
You need to use the chmod +x command only once. Finally, ./blinkled.js instructs the JavaScript to run. You will need to press ^C (Ctrl-C) to stop your program.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_7">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="basics_autorun">Running Applications Automatically</h3>
<div class="sect3">
<h4 id="_problem_8">Problem</h4>
<div class="paragraph">
<p>You have a BoneScript application that you would like to run every time the Bone starts.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_8">Solution</h4>
<div class="paragraph">
<p>This is an easy one.  In Cloud9, notice the folder called <em>autorun</em> (<a href="#basics_autoRun_fig">Making applications autorun at boot-up time</a>). Place any BoneScript files you want to run at boot time in this folder. The script will begin execution immediately and will stop execution when you remove the file from this folder.</p>
</div>
<div id="basics_autoRun_fig" class="imageblock">
<div class="content">
<img src="./01basics/figures/autoRun.png" alt="autorun">
</div>
<div class="title">Figure 12. Making applications autorun at boot-up time</div>
</div>
<div class="paragraph">
<p>You can drag and drop the script into the <em>autorun</em> folder using the Cloud9 IDE workspace view, or you can move it using the bash prompt:</p>
</div>
<pre data-type="programlisting">
bone# <strong>mv myApp.js autorun</strong>
</pre>
</div>
<div class="sect3">
<h4 id="_discussion_8">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="_finding_the_latest_version_of_the_os_for_your_bone">Finding the Latest Version of the OS for Your Bone</h3>
<div class="sect3">
<h4 id="_problem_9">Problem</h4>
<div class="paragraph">
<p>You want to find out the latest version of Debian that is available for your Bone.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_9">Solution</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>At the time they were written, these instructions were up-to-date.  Go to <a href="http://beagleboard.org/latest-images" class="bare">http://beagleboard.org/latest-images</a> for the latest instructions.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>On your host computer, open a browser and go to <a href="http://rcn-ee.net/deb/testing/" class="bare">http://rcn-ee.net/deb/testing/</a>.  This shows you a list of dates of the most recent Debian images (<a href="#basics_deb1">Latest Debian images</a>).</p>
</div>
<div id="basics_deb1" class="imageblock">
<div class="content">
<img src="./01basics/figures/deb1.png" alt="Latest Debian images">
</div>
<div class="title">Figure 13. Latest Debian images</div>
</div>
<div class="paragraph">
<p>Clicking a date will show you several variations for that particular date. <a href="#basics_deb2">Latest Debian images for a given date</a> shows the results of clicking <em>2014-11-11</em>.</p>
</div>
<div id="basics_deb2" class="imageblock">
<div class="content">
<img src="./01basics/figures/deb2.png" alt="Latest Debian images for given date">
</div>
<div class="title">Figure 14. Latest Debian images for a given date</div>
</div>
<div class="paragraph">
<p>Clicking <em>lxde-4gb/</em> shows a list of 4 GB images (<a href="#basics_deb3">Latest 4 GB Debian images for a given date</a>).</p>
</div>
<div id="basics_deb3" class="imageblock">
<div class="content">
<img src="./01basics/figures/deb3.png" alt="Latest 4 GB Debian images for given date">
</div>
<div class="title">Figure 15. Latest 4 GB Debian images for a given date</div>
</div>
<div class="paragraph">
<p>These are the images you want to use if you are flashing a Rev C BeagleBone Black onboard flash, or flashing a 4 GB or bigger miscroSD card. The image beginning with <em>bone-debian-7.7-lxde</em> is used for programming the microSD card. The one beginning with <em>BBB-eMMC-flasher-deb</em> is for programming the onboard flash memory.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The onboard flash is often called the <em>eMMC</em> memory. We just call it <em>onboard flash</em>, but you&#8217;ll often see <em>eMMC</em> appearing in filenames of images used to update the onboard flash.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_9">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="basics_install_os">Running the Latest Version of the OS on Your Bone</h3>
<div class="sect3">
<h4 id="_problem_10">Problem</h4>
<div class="paragraph">
<p>You want to run the latest version of the operating system on your Bone without changing the onboard flash.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_10">Solution</h4>
<div class="paragraph">
<p>This solution is to flash an external microSD card and run the Bone from it. If you boot the Bone with a microSD card inserted with a valid boot image, it will boot from the microSD card. If you boot without the microSD card installed, it will boot from the onboard flash.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you want to reflash the onboard flash memory, see <a href="#basics_onboard_flash">Updating the Onboard Flash</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>I instruct my students to use the microSD for booting. I suggest they keep an extra microSD flashed with the current OS. If they mess up the one on the Bone, it takes only a moment to swap in the extra microSD, boot up, and continue running. If they are running off the onboard flash, it will take much longer to reflash and boot from it.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_windows">Windows</h5>
<div class="paragraph">
<p>If you are using a host computer running Windows, go to <a href="http://rcn-ee.net/deb/testing/2014-11-11/lxde-4gb/" class="bare">http://rcn-ee.net/deb/testing/2014-11-11/lxde-4gb/</a>, and download <em>bone-debian-7.7-lxde-4gb-armhf-2014-11-11-4gb.img.xz</em>. It&#8217;s more than 500 MB, so be sure to have a fast Internet connection. Then go to <a href="http://beagleboard.org/getting-started#update" class="bare">http://beagleboard.org/getting-started#update</a> and
follow the instructions there to install the image you downloaded.</p>
</div>
</div>
<div class="sect4">
<h5 id="_linux">Linux</h5>
<div class="paragraph">
<p>If you are running a Linux host, plug a 4 GB byte or bigger microSD card into a reader on your host and run Disks.</p>
</div>
<div class="paragraph">
<p>Select the microSD Drive and unmount (<a href="#basics_disks_fig">Unmounting the microSD card via the Disks application</a>) any partitions that have mounted. Note the path to the device (shown with an arrow in <a href="#basics_disks_fig">Unmounting the microSD card via the Disks application</a>) at the top of the Disks window. In my case, it&#8217;s <em>/dev/sdb</em>.  We&#8217;ll use this path in a moment.</p>
</div>
<div id="basics_disks_fig" class="imageblock">
<div class="content">
<img src="./01basics/figures/disks.png" alt="Disks">
</div>
<div class="title">Figure 16. Unmounting the microSD card via the Disks application</div>
</div>
<div class="paragraph">
<p>Run the following command to download the 2014-11-11 image (be sure that you have a fast Internet connection; it&#8217;s more than 500 MB in size):</p>
</div>
<pre data-type="programlisting">
host$ <strong>wget http://rcn-ee.net/deb/testing/2014-11-11/lxde-4gb/\
bone-debian-7.7-lxde-4gb-armhf-2014-11-11-4gb.img.xz</strong>
</pre>
<div class="paragraph">
<p>This will copy the disk image to the current directory the command was run from to your host computer. This will take a couple minutes on a fast connection.</p>
</div>
<div class="paragraph">
<p>The downloaded file is compressed. Uncompress it by using the following command:</p>
</div>
<pre data-type="programlisting">
host$ <strong>unxz bone-debian-7.7-lxde-4gb-armhf-2014-11-11-4gb.img.xz</strong>
</pre>
<div class="paragraph">
<p>After a minute or so, the compressed <em>.imgxz</em> file will be replaced by the uncompressed <em>.img</em> file. Then write it to the microSD card by using the following command, substituting your device path noted earlier (/dev/sdb, in my case) for the device path given in the dd command:</p>
</div>
<pre data-type="programlisting">
host$ <strong>sudo dd if=bone-debian-7.7-lxde-4gb-armhf-2014-11-11-4gb.img \
            of=/dev/sdb bs=8M</strong>
</pre>
<div class="paragraph">
<p>The dd command takes 5 to 10 minutes.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>This operation will wipe out everything on the microSD card. It might be worth plugging in your card, noting the path,  removing the card, noting it has disappeared, and then plugging it in again and checking the path. You can really mess up your host if you have selected the wrong disk and used the wrong path. Be careful.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>When formatting SD cards, you often need to be sure to have a <em>bootable partition</em>. Because you are completly rewriting the card, it doesn&#8217;t matter how the card is configured before writing. The dd command writes everything the way it needs to be.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you have your microSD card flashed, put it in the Bone and power it up. The USB drive and other devices should appear as before. Open Cloud9 (<a href="#basics_cloud9">Editing Code Using the Cloud9 IDE</a>) and, in the bash tab, enter:</p>
</div>
<pre data-type="programlisting">
root@beaglebone:/var/lib/cloud9# <strong>df -h</strong>
Filesystem      Size  Used Avail Use% Mounted on
rootfs          3.2G  2.0G  1.0G  29% /
udev             10M     0   10M   0% /dev
tmpfs           100M  676K   99M   1% /run
/dev/mmcblk0p2  7.2G  2.0G  5.0G  29% /
tmpfs           249M     0  249M   0% /dev/shm
tmpfs           249M     0  249M   0% /sys/fs/cgroup
tmpfs           5.0M     0  5.0M   0% /run/lock
tmpfs           100M     0  100M   0% /run/user
/dev/mmcblk0p1   96M   62M   35M  65% /media/BEAGLEBONE
/dev/mmcblk1p2  1.8G  290M  1.4G  18% /media/rootfs
/dev/mmcblk1p1   16M  520K   16M   4% /media/BEAGLEBONE_
</pre>
<div class="paragraph">
<p>This prints out how much of the disk is free.  The first line is the one we&#8217;re interested in. If the Size is much smaller than the size of your microSD card, you&#8217;ll need to resize your partition.  Just enter the following:</p>
</div>
<pre data-type="programlisting">
root@beaglebone:/var/lib/cloud9# <strong>cd /opt/scripts/tools/</strong>
root@beaglebone:/opt/scripts/tools# <strong>./grow_partition.sh</strong>
root@beaglebone:/opt/scripts/tools# <strong>reboot</strong>
root@beaglebone:/var/lib/cloud9# <strong>df -h</strong>
Filesystem      Size  Used Avail Use% Mounted on
rootfs          7.2G  2.0G  5.0G  29% /
udev             10M     0   10M   0% /dev
tmpfs           100M  676K   99M   1% /run
/dev/mmcblk0p2  7.2G  2.0G  5.0G  29% /
tmpfs           249M     0  249M   0% /dev/shm
tmpfs           249M     0  249M   0% /sys/fs/cgroup
tmpfs           5.0M     0  5.0M   0% /run/lock
tmpfs           100M     0  100M   0% /run/user
/dev/mmcblk0p1   96M   62M   35M  65% /media/BEAGLEBONE
/dev/mmcblk1p2  1.8G  290M  1.4G  18% /media/rootfs
/dev/mmcblk1p1   16M  520K   16M   4% /media/BEAGLEBONE_</pre>
<div class="paragraph">
<p>This clever script will figure out how big the partition can be and grow it to that size. A reboot is necessary.</p>
</div>
<div class="paragraph">
<p>Here, I started by putting a 4 GB image on an 8 GB microSD card. Initially, only <span class="keep-together">3.2 GB</span> were usable. After growing the partition, most of the card (7.2 GB) is available.</p>
</div>
</div>
<div class="sect4">
<h5 id="_mac">Mac</h5>
<div class="paragraph">
<p>If you are running from a Mac host, the steps are fairly similar to running on a Linux host, except that you won&#8217;t be able to view the Linux partition on the created microSD card.</p>
</div>
<div class="paragraph">
<p>Begin by plugging a 4 GB or bigger microSD card into a reader on your host and then run Disk Utility. Select the disk and click Info. In <a href="#basics_diskutility_fig">Examining the microSD card via the Disk Utility application</a>, you can see the Disk Identifier is disk1s1.</p>
</div>
<div id="basics_diskutility_fig" class="imageblock">
<div class="content">
<img src="./01basics/figures/diskutility.png" alt="Disk Utility">
</div>
<div class="title">Figure 17. Examining the microSD card via the Disk Utility application</div>
</div>
<div class="paragraph">
<p>The important part of the Disk Identifier is the number immediately following disk (a 1 in <a href="#basics_diskutility_fig">Examining the microSD card via the Disk Utility application</a>). We&#8217;ll use this identifier to overwrite the microSD contents.</p>
</div>
<div class="paragraph">
<p>From your Mac&#8217;s Terminal, run the following command to download the <em>2014-11-11</em> image (again, be sure that you have a fast Internet connection, because it&#8217;s more than 500 MB):</p>
</div>
<pre data-type="programlisting">
mac$ <strong>curl -O http://rcn-ee.net/deb/testing/2014-11-11/lxde-4gb/\
bone-debian-7.7-lxde-4gb-armhf-2014-11-11-4gb.img.xz</strong>
</pre>
<div class="paragraph">
<p>You&#8217;ll need to have the xz utility installed (download from The Tukaani Project [<a href="http://tukaani.org/xz/" class="bare">http://tukaani.org/xz/</a>]). Uncompress the image by using the following command (this will take a minute or so):</p>
</div>
<pre data-type="programlisting">
mac$ <strong>unxz bone-debian-7.7-lxde-4gb-armhf-2014-11-11-4gb.img.xz</strong>
</pre>
<div class="paragraph">
<p>Then write it to the microSD card, substituting your device path noted earlier (/dev/rdisk1, in my case) for the device path given in the dd command:</p>
</div>
<pre data-type="programlisting">
mac$ <strong>sudo dd if=bone-debian-7.7-lxde-4gb-armhf-2014-11-11-4gb.img of=/dev/rdisk1</strong>
</pre>
<div class="paragraph">
<p>You&#8217;ll need to type in your password. The dd command takes 5 to 10 minutes.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>This operation will wipe out everything on the microSD card. It might be worth plugging in your card, noting the path,  removing the card, noting it has disappeared, and then plugging it in again and checking the path. You can really mess up your host if you have selected the wrong disk and used the wrong path. Be careful.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Note that I used rdisk1 rather than disk1. According to <a href="http://bit.ly/1BqOxwW">the eLinux wiki</a>, doing so will speed up writing quite a bit.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_10">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="_updating_the_os_on_your_bone">Updating the OS on Your Bone</h3>
<div class="sect3">
<h4 id="_problem_11">Problem</h4>
<div class="paragraph">
<p>You&#8217;ve installed the latest version of Debian on your Bone (<a href="#basics_install_os">Running the Latest Version of the OS on Your Bone</a>), and you want to be sure it&#8217;s up-to-date.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_11">Solution</h4>
<div class="paragraph">
<p>Ensure that your Bone is on the network and then run the following command on the Bone:</p>
</div>
<pre data-type="programlisting">
bone# <strong>apt-get update</strong>
bone# <strong>apt-get upgrade</strong>
</pre>
<div class="paragraph">
<p>If there are any new updates, they will be installed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you get the error The following signatures were invalid: KEYEXPIRED 1418840246, see <a href="http://bit.ly/1EXocb6">eLinux support page</a> for advice on how to fix it.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_11">Discussion</h4>
<div class="paragraph">
<p>After you have a current image running on the Bone, it&#8217;s not at all difficult to keep it upgraded.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_backing_up_the_onboard_flash">Backing Up the Onboard Flash</h3>
<div class="sect3">
<h4 id="_problem_12">Problem</h4>
<div class="paragraph">
<p>You&#8217;ve modified the state of your Bone in a way that you&#8217;d like to preserve or share.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_12">Solution</h4>
<div class="paragraph">
<p>The <a href="http://elinux.org/">eLinux</a> page on <a href="http://bit.ly/1C57I0a">BeagleBone Black Extracting eMMC contents</a> provides some simple steps for copying the contents of the onboard flash to a file on a microSD card:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Get a 4 GB or larger microSD card that is FAT formatted.</p>
</li>
<li>
<p>If you create a FAT-formatted microSD card, you must edit the partition and ensure that it is a bootable partition.</p>
</li>
<li>
<p>Download <a href="http://bit.ly/1wtXwNP">beagleboneblack-save-emmc.zip</a> and uncompress and copy the contents onto your microSD card.</p>
</li>
<li>
<p>Eject the microSD card from your computer, insert it into the powered-off <span class="keep-together">BeagleBone</span> Black, and apply power to your board.</p>
</li>
<li>
<p>You&#8217;ll notice USER0 (the LED closest to the S1 button in the corner) will (after about 20 seconds) begin to blink steadily, rather than the double-pulse "heartbeat" pattern that is typical when your BeagleBone Black is running the standard Linux kernel configuration.</p>
</li>
<li>
<p>It will run for a bit under 10 minutes and then USER0 will stay on steady. That&#8217;s your cue to remove power, remove the microSD card, and put it back into your computer.</p>
</li>
<li>
<p>You will see a file called <em>BeagleBoneBlack-eMMC-image-XXXXX.img</em>, where <em>XXXXX</em> is a set of random numbers. Save this file to use for restoring your image later.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Because the date won&#8217;t be set on your board, you might want to adjust the date on the file to remember when you made it. For storage on your computer, these images will typically compress very well, so use your favorite compression tool.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="http://elinux.org/Beagleboard">eLinux wiki</a> is the definitive place for the BeagleBoard.org community to share information about the Beagles. Spend some time looking around for other helpful information.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_12">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="basics_onboard_flash">Updating the Onboard Flash</h3>
<div class="sect3">
<h4 id="_problem_13">Problem</h4>
<div class="paragraph">
<p>You want to update the onboard flash rather than boot from the microSD card.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_13">Solution</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>At the time of this writing, these instructions were up-to-date. Go to <a href="http://beagleboard.org/latest-images" class="bare">http://beagleboard.org/latest-images</a> for the latest instructions.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to use the onboard flash, you need to repeat the steps in <a href="#basics_install_os">Running the Latest Version of the OS on Your Bone</a>, substituting BBB-eMMC-flasher-debian-7.7-lxde-4gb-armhf-2014-11-11-4gb.img.xz for lxde-4gb/bone-debian-7.7-lxde-4gb-armhf-2014-11-11-4gb.img.xz.</p>
</div>
<div class="paragraph">
<p>That is, download, uncompress, and copy to a microSD card by using the following commands:</p>
</div>
<pre data-type="programlisting">
host$ <strong>wget http://rcn-ee.net/deb/testing/2014-11-11/\
BBB-eMMC-flasher-debian-7.7-lxde-4gb-armhf-2014-11-11-4gb.img.xz</strong>
host$ <strong>unxz BBB-eMMC-flasher-debian-7.7-lxde-4gb-armhf-2014-11-11-4gb.img.xz</strong>
host$ <strong>sudo dd if=BBB-eMMC-flasher-debian-7.7-lxde-4gb-armhf-2014-11-11-4gb.img \
      of=/dev/sdb bs=8M</strong>
</pre>
<div class="paragraph">
<p>Again, you&#8217;ll put the microSD card in the Bone and boot. However, there is one important difference: <em>you must be powered from an external 5 V source</em>. The flashing process requires more current than what typically can be pulled from USB.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you write the onboard flash, <em>be sure to power the Bone from an external 5 V source</em>. The USB might not supply enough current.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you boot from the microSD card, it will copy the image to the onboard flash. When all four USER LEDs turn off (in some versions, they all turn on), you can power down the Bone and remove the microSD card. The next time you power up, the Bone will boot from the onboard flash.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sensors">Sensors</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_2">Introduction</h3>
<div class="paragraph">
<p>In this chapter, you will learn how to sense the physical world with BeagleBone Black. Various types of electronic sensors, such as cameras and microphones, can be connected to the Bone using one or more interfaces provided by the standard USB 2.0 host port, as shown in <a href="#sensors_host_port">The USB 2.0 host port</a>.</p>
</div>
<div id="sensors_host_port" class="imageblock">
<div class="content">
<img src="./02sensors/figures/black_hardware_details.png" alt="USB Host Port">
</div>
<div class="title">Figure 18. The USB 2.0 host port</div>
</div>
<div class="paragraph">
<p>The two 46-pin cape headers (called P8 and P9) along the long edges of the board (<a href="#sensors_P8P9_fig">The P8 and P9 cape headers</a>) provide connections for cape add-on boards, digital and analog sensors, and more.</p>
</div>
<div id="sensors_P8P9_fig" class="imageblock">
<div class="content">
<img src="./02sensors/figures/P8P9_bb.png" alt="Cape Headers P8 and P9">
</div>
<div class="title">Figure 19. The P8 and P9 cape headers</div>
</div>
<div class="paragraph">
<p>The simplest kind of sensor provides a single digital status, such as off or on,
and can be handled by an <em>input mode</em> of one of the Bone&#8217;s 65 general-purpose input/output (GPIO) pins. More complex sensors can be connected by using one of the Bone&#8217;s seven analog-to-digital converter (ADC) inputs or several I<sup>2</sup>C buses.</p>
</div>
<div class="paragraph">
<p><a href="#displays">Displays and Other Outputs</a> discusses some of the <em>output mode</em> usages of the GPIO pins.</p>
</div>
<div class="paragraph">
<p>All these examples assume that you know how to edit a file (<a href="#basics_cloud9">Editing Code Using the Cloud9 IDE</a>) and run it, either within the Cloud9 integrated development environment (IDE) or from the command line (<a href="#tips_shell">Getting to the Command Shell via SSH</a>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_choosing_a_method_to_connect_your_sensor">Choosing a Method to Connect Your Sensor</h3>
<div class="sect3">
<h4 id="_problem_14">Problem</h4>
<div class="paragraph">
<p>You want to acquire and attach a sensor and need to understand your basic options.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_14">Solution</h4>
<div class="paragraph">
<p><a href="#sensors_cape_headers">Some of the many sensor connection options on the Bone</a> shows many of the possibilities for connecting a sensor.</p>
</div>
<div id="sensors_cape_headers" class="imageblock">
<div class="content">
<img src="./02sensors/figures/cape-headers.png" alt="Sensor Connection Modes">
</div>
<div class="title">Figure 20. Some of the many sensor connection options on the Bone</div>
</div>
<div class="paragraph">
<p>Choosing the simplest solution available enables you to move on quickly to addressing other system aspects. By exploring each connection type, you can make more informed decisions as you seek to optimize and troubleshoot your design.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_13">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="sensors_getting_started">Input and Run a JavaScript Application for Talking to Sensors</h3>
<div class="sect3">
<h4 id="_problem_15">Problem</h4>
<div class="paragraph">
<p>You have your sensors all wired up and your Bone booted up, and you need to know how to enter and run your code.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_15">Solution</h4>
<div class="paragraph">
<p>You are just a few simple steps from running any of the recipes in this book.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Plug your Bone into a host computer via the USB cable (<a href="#basics_out_of_the_box">Getting Started, Out of the Box</a>).</p>
</li>
<li>
<p>Start Cloud9 (<a href="#basics_cloud9">Editing Code Using the Cloud9 IDE</a>).</p>
</li>
<li>
<p>In the bash tab (as shown in <a href="#sensors_cloud9_bash">Entering commands in the Cloud9 bash tab</a>), run the following commands:</p>
</li>
</ol>
</div>
<pre data-type="programlisting">
root@beaglebone:/var/lib/cloud9# <strong>cd</strong>
root@beaglebone:~#
</pre>
<div id="sensors_cloud9_bash" class="imageblock">
<div class="content">
<img src="./02sensors/figures/cloud9-bash-tab.png" alt="Cloud9 bash tab">
</div>
<div class="title">Figure 21. Entering commands in the Cloud9 bash tab</div>
</div>
<div class="paragraph">
<p>Here, we issued the <em>change directory</em> (cd) command without specifying a target directory. By default, it takes you to your home directory. Notice that the prompt has changed to reflect the change. The path changed from /var/lib/cloud9 to &amp;#x7E;. The &amp;#x7E; is a shorthand for your home directory.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you log in as root, your home directory is <em>/root</em>.  That is, anyone can cd /root to get into your home directory (though directories are initially locked).  If you log in as debian, your home is <em>/home/debian</em>. If you were to create a new user called newuser, that user&#8217;s home would be <em>/home/newuser</em>. By default, all non-root (non-superuser) users have their home directories in <em>/home</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following commands create a new directory for the sensor recipes, change to it, and use touch to create an empty file called <em>pushbutton.js</em>:</p>
</div>
<pre data-type="programlisting">
root@beaglebone:/var/lib/cloud9# <strong>cd /root</strong>
root@beaglebone:~# <strong>mkdir boneSensors</strong>
root@beaglebone:~# <strong>cd boneSensors</strong>
root@beaglebone:~/boneSensors# <strong>touch pushbutton.js</strong>
</pre>
<div class="paragraph">
<p>Now, add recipe code to the newly created <em>pushbutton.js</em> file to enable it to run:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In Cloud9, in the Workspace browser on the left, go to the Preferences wheel and select Add Home to Favorites (<a href="#basics_addHome_fig">Making your home folder appear in Cloud9</a>). Now, your home directory will show up in the Workspace file tree.</p>
</li>
<li>
<p>In the Workspace browser, expand root.</p>
</li>
<li>
<p>You will see your newly created <em>boneSensors</em> directory; expand it. You will see your empty <em>pushbutton.js</em></p>
</li>
<li>
<p>Double-click the <em>pushbutton.js</em> file to open it.</p>
</li>
<li>
<p>Paste the code for the recipe you want to run. This example uses <a href="#js_pushbutton_code">Monitoring a pushbutton using a callback function (pushbutton.js)</a>.</p>
</li>
<li>
<p>Press ^S (Ctrl-S) to save the file. (You can also go to the File menu in Cloud9 and select Save to save the file, but Ctrl-S is easier.)</p>
</li>
<li>
<p>In the bash tab, enter the following commands:</p>
</li>
</ol>
</div>
<pre data-type="programlisting">
root@beaglebone:~/boneSensors# <strong>chmod +x pushbutton.js</strong>
root@beaglebone:~/boneSensors# <strong>./pushbutton.js</strong>
Interrupt handler attached
x.value = 1
x.err   = undefined
x.value = 0
x.err   = undefined
x.value = 1
x.err   = undefined
^C
</pre>
<div class="paragraph">
<p>This process will work for any script in this book.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>In this example, I&#8217;ve called b.pinMode() asynchronously and performed the b.attachInterrupt() call within the callback function. There are cases where BoneScript version 0.2.4 might not completely finish setting up a pin&#8217;s mode when called synchronously. That might result in needing to run a program twice to overcome the error. Using asynchronous calls is the preferred strategy to avoid this issue.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_14">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="sensors_pushbutton">Reading the Status of a Pushbutton or Magnetic Switch (Passive On/Off Sensor)</h3>
<div class="sect3">
<h4 id="_problem_16">Problem</h4>
<div class="paragraph">
<p>You want to read a pushbutton, a magnetic switch, or other sensor that is electrically open or closed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_16">Solution</h4>
<div class="paragraph">
<p>Connect the switch to a GPIO pin and use BoneScript pinMode() and <span class="keep-together">attachInterrupt()</span> functions.</p>
</div>
<div class="paragraph">
<p>To make this recipe, you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Breadboard and jumper wires (see <a href="#app_proto">Prototyping Equipment</a>)</p>
</li>
<li>
<p>Pushbutton switch (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
<li>
<p>Magnetic reed switch (optional, see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can wire up either a pushbutton, a magnetic reed switch, or both on the Bone, as shown in <a href="#js_pushbutton_fig">Diagram for wiring a pushbutton and magnetic reed switch input</a>.</p>
</div>
<div id="js_pushbutton_fig" class="imageblock">
<div class="content">
<img src="./02sensors/figures/pushbutton_bb.png" alt="Bone with pushbutton">
</div>
<div class="title">Figure 22. Diagram for wiring a pushbutton and magnetic reed switch input</div>
</div>
<div class="paragraph">
<p>The code in <a href="#js_pushbutton_code">Monitoring a pushbutton using a callback function (pushbutton.js)</a> reads GPIO port P9_42, which is attached to the <span class="keep-together">pushbutton</span>.</p>
</div>
<div id="js_pushbutton_code" class="exampleblock">
<div class="title">Example 1. Monitoring a pushbutton using a callback function (pushbutton.js)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node
var b = require('bonescript');
var button = 'P9_42';

b.pinMode(button, b.INPUT, 7, 'pulldown', 'fast', doAttach);

function doAttach(x) {
    if(x.err) {
        console.log('x.err = ' + x.err);
        return;
    }
    b.attachInterrupt(button, true, b.CHANGE, printStatus);
}

function printStatus(x) {
    if(x.attached) {
        console.log("Interrupt handler attached");
        return;
    }
    console.log('x.value = ' + x.value);
    console.log('x.err   = ' + x.err);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Put this code in a file called <em>pushbutton.js</em> following the steps in <a href="#sensors_getting_started">Input and Run a JavaScript Application for Talking to Sensors</a>. In the Cloud9 bash tab, run it by using the following commands:</p>
</div>
<pre data-type="programlisting">
bone# <strong>chmod +x ./pushbutton.js</strong>
bone# <strong>./pushbutton.js</strong>
Interrupt handler attached
x.value = 1
x.err   = undefined
x.value = 0
x.err   = undefined
</pre>
<div class="paragraph">
<p>The chmod command makes it executable (you have to do this only once), and the second command runs it. Try pushing the button. The code waits for the value of the input to change; when it changes, the new value is printed out.</p>
</div>
<div class="paragraph">
<p>You will have to press ^C (Ctrl-C) to stop the code.</p>
</div>
<div class="paragraph">
<p>If you want to use the magnetic reed switch wired as shown in <a href="#js_pushbutton_fig">Diagram for wiring a pushbutton and magnetic reed switch input</a>, change P9_42 to P9_26.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_15">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="_reading_a_position_light_or_force_sensor_variable_resistance_sensor">Reading a Position, Light, or Force Sensor (Variable Resistance Sensor)</h3>
<div class="sect3">
<h4 id="_problem_17">Problem</h4>
<div class="paragraph">
<p>You have a variable resistor, force-sensitive resistor, flex sensor, or any of a number of other sensors that output their value as a variable resistance, and you want to read their value with the Bone.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_17">Solution</h4>
<div class="paragraph">
<p>Use the Bone&#8217;s analog-to-digital converters (ADCs) and a resistor divider circuit to detect the resistance in the sensor.</p>
</div>
<div class="paragraph">
<p>The Bone has seven built-in analog inputs that can easily read a resistive value. <a href="#sensors_cape_headers_analog">Seven analog inputs on the P9 header</a> shows them on the lower part of the P9 header.</p>
</div>
<div id="sensors_cape_headers_analog" class="imageblock">
<div class="content">
<img src="./02sensors/figures/cape-headers-analog.png" alt="Seven analog inputs on P9 header">
</div>
<div class="title">Figure 23. Seven analog inputs on the P9 header</div>
</div>
<div class="paragraph">
<p>To make this recipe, you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Breadboard and jumper wires (see <a href="#app_proto">Prototyping Equipment</a>)</p>
</li>
<li>
<p>10 k&#8486; trimpot (see <a href="#app_resistor">Resistors</a>)
or</p>
</li>
<li>
<p>Flex resistor (optional, see <a href="#app_resistor">Resistors</a>)</p>
</li>
<li>
<p>22 k&#8486; resistor (see <a href="#app_resistor">Resistors</a>)</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_a_variable_resistor_with_three_terminals">A variable resistor with three terminals</h5>
<div class="paragraph">
<p><a href="#sensors_analogIn_fig">Wiring a 10k&#8486; variable resistor (trimpot) to an ADC port</a> shows a simple variable resistor (trimpot) wired to the Bone. One end terminal is wired to the ADC 1.8 V power supply on pin P9_32, and the other end terminal is attached to the ADC ground (P9_34). The middle terminal is wired to one of the seven analog-in ports (P9_36).</p>
</div>
<div id="sensors_analogIn_fig" class="imageblock">
<div class="content">
<img src="./02sensors/figures/analogIn_bb.png" alt="Analog">
</div>
<div class="title">Figure 24. Wiring a 10k&#8486; variable resistor (trimpot) to an ADC port</div>
</div>
<div class="paragraph">
<p><a href="#sensors_analogIn_code">Reading an analog voltage (analogIn.js)</a> shows the BoneScript code used to read the variable resistor.
Add the code to a file called <em>analogIn.js</em> and run it; then change the resistor and run it again. The voltage read will change.</p>
</div>
<div id="sensors_analogIn_code" class="exampleblock">
<div class="title">Example 2. Reading an analog voltage (analogIn.js)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">#!/usr/bin/env node
var b = require('bonescript');

b.analogRead('P9_36', printStatus);

function printStatus(x) {
    console.log('x.value = ' + x.value.toFixed(3));
    console.log('x.err   = ' + x.err);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This code in <a href="#sensors_analogIn_code">Reading an analog voltage (analogIn.js)</a> uses .toFixed(3) to print only three digits past the decimal. Otherwise, the output could have many extra digits. Try removing .toFixed(3) and see what happens.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_a_variable_resistor_with_two_terminals">A variable resistor with two terminals</h5>
<div class="paragraph">
<p>Some resistive sensors have only two terminals, such as the flex sensor in <a href="#sensors_flexResistor_fig">Reading a two-terminal flex resistor</a>.
The resistance between its two terminals changes when it is flexed.
In this case, we need to add a fixed resistor in series with the flex sensor.
<a href="#sensors_flexResistor_fig">Reading a two-terminal flex resistor</a> shows how to wire in a 22 k&#8486; resistor to give a voltage to measure
across the flex sensor.</p>
</div>
<div id="sensors_flexResistor_fig" class="imageblock">
<div class="content">
<img src="./02sensors/figures/flexResistor_bb.png" alt="Flex Resistor">
</div>
<div class="title">Figure 25. Reading a two-terminal flex resistor</div>
</div>
<div class="paragraph">
<p>The code in <a href="#sensors_analogIn_code">Reading an analog voltage (analogIn.js)</a> also works for this setup.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_16">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="_reading_a_distance_sensor_analog_or_variable_voltage_sensor">Reading a Distance Sensor (Analog or Variable Voltage Sensor)</h3>
<div class="sect3">
<h4 id="_problem_18">Problem</h4>
<div class="paragraph">
<p>You want to measure distance with a <a href="http://bit.ly/1Mt5Elr">LV-MaxSonar-EZ1 Sonar Range Finder</a>, which outputs a voltage in proportion to the distance.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_18">Solution</h4>
<div class="paragraph">
<p>To make this recipe, you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Breadboard and jumper wires (see <a href="#app_proto">Prototyping Equipment</a>)</p>
</li>
<li>
<p>LV-MaxSonar-EZ1 Sonar Range Finder (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All you have to do is wire the EZ1 to one of the Bone&#8217;s <em>analog-in</em> pins, as shown in <a href="#sensors_ultrasonic_fig">Wiring the LV-MaxSonar-EZ1 Sonar Range Finder to the P9_33 analog-in port</a>. The device outputs ~6.4 mV/in when powered from 3.3 V.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Make sure not to apply more than 1.8 V to the Bone&#8217;s <em>analog-in</em> pins, or you will likely damage them. In practice, this circuit should follow that rule.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="sensors_ultrasonic_fig" class="imageblock">
<div class="content">
<img src="./02sensors/figures/ultrasonicRange_bb.png" alt="Analog">
</div>
<div class="title">Figure 26. Wiring the LV-MaxSonar-EZ1 Sonar Range Finder to the P9_33 analog-in port</div>
</div>
<div class="paragraph">
<p><a href="#sensors_ultrasonicRange_code">Reading an analog voltage (ultrasonicRange.js)</a> shows the code that reads the sensor at a fixed interval.</p>
</div>
<div id="sensors_ultrasonicRange_code" class="exampleblock">
<div class="title">Example 3. Reading an analog voltage (ultrasonicRange.js)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">#!/usr/bin/env node
var b = require('bonescript');
var ms = 250;  // Time in milliseconds

setInterval(readRange, ms);

function readRange() {
    b.analogRead('P9_33', printStatus);
}
function printStatus(x) {
    console.log('x.value = ' + x.value);
    console.log('Distance= ' + x.value * 1.8/0.0064);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_17">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="sensors_hc-sr04">Reading a Distance Sensor (Variable Pulse Width Sensor)</h3>
<div class="sect3">
<h4 id="_problem_19">Problem</h4>
<div class="paragraph">
<p>You want to use a HC-SR04 Ultrasonic Range Sensor with BeagleBone Black.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_19">Solution</h4>
<div class="paragraph">
<p>The HC-SR04 Ultrasonic Range Sensor (shown in <a href="#sensors_hc_sr04_image_fig">HC-SR04 Ultrasonic range sensor</a>) works by sending a trigger pulse to the <em>Trigger</em> input and then measuring the pulse width on the <em>Echo</em> output. The width of the pulse tells you the distance.</p>
</div>
<div id="sensors_hc_sr04_image_fig" class="imageblock">
<div class="content">
<img src="./02sensors/figures/hc-sr04.jpg" alt="HC-SR04 Ultrasonic Sensor">
</div>
<div class="title">Figure 27. HC-SR04 Ultrasonic range sensor</div>
</div>
<div class="paragraph">
<p>To make this recipe, you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Breadboard and jumper wires (see <a href="#app_proto">Prototyping Equipment</a>)</p>
</li>
<li>
<p>10 k&#8486; and 20 k&#8486; resistors (see <a href="#app_resistor">Resistors</a>)</p>
</li>
<li>
<p>HC-SR04 Ultrsonic Range Sensor (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Wire the sensor as shown in <a href="#sensors_hc-sr04_fig">Wiring an HC-SR04 ultrasonic sensor</a>. Note that the HC-SR04 is a 5 V
device, so the <em>banded</em> wire (running from P9_7 on the Bone to VCC on the range finder) attaches the HC-SR04 to the Bone&#8217;s 5 V power supply.</p>
</div>
<div id="sensors_hc-sr04_fig" class="imageblock">
<div class="content">
<img src="./02sensors/figures/hc-sr04-ultraSonic_bb.png" alt="Wiring an HC-SR04 Ultrasonic Sensor">
</div>
<div class="title">Figure 28. Wiring an HC-SR04 ultrasonic sensor</div>
</div>
<div class="paragraph">
<p><a href="#sensors_hc-sr04_code">Driving a HC-SR04 ultrasound sensor (hc-sr04-ultraSonic.js)</a> shows BoneScript code used to drive the HC-SR04.</p>
</div>
<div id="sensors_hc-sr04_code" class="exampleblock">
<div class="title">Example 4. Driving a HC-SR04 ultrasound sensor (hc-sr04-ultraSonic.js)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">#!/usr/bin/env node

// This is an example of reading HC-SR04 Ultrasonic Range Finder
// This version measures from the fall of the Trigger pulse 
//   to the end of the Echo pulse

var b = require('bonescript');

var trigger = 'P9_16',  // Pin to trigger the ultrasonic pulse
    echo    = 'P9_41',  // Pin to measure to pulse width related to the distance
    ms = 250;           // Trigger period in ms
    
var startTime, pulseTime;
    
b.pinMode(echo,   b.INPUT, 7, 'pulldown', 'fast', doAttach);
function doAttach(x) {
    if(x.err) {
        console.log('x.err = ' + x.err);
        return;
    }
    // Call pingEnd when the pulse ends
    b.attachInterrupt(echo, true, b.FALLING, pingEnd);
}

b.pinMode(trigger, b.OUTPUT);

b.digitalWrite(trigger, 1);     // Unit triggers on a falling edge.
                                // Set trigger to high so we call pull it low later

// Pull the trigger low at a regular interval.
setInterval(ping, ms);

// Pull trigger low and start timing.
function ping() {
    // console.log('ping');
    b.digitalWrite(trigger, 0);
    startTime = process.hrtime();
}

// Compute the total time and get ready to trigger again.
function pingEnd(x) {
    if(x.attached) {
        console.log("Interrupt handler attached");
        return;
    }
    if(startTime) {
        pulseTime = process.hrtime(startTime);
        b.digitalWrite(trigger, 1);
        console.log('pulseTime = ' + (pulseTime[1]/1000000-0.8).toFixed(3));
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This code is more complex than others in this chapter, because we have to tell the device when to start measuring and time the return pulse.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_18">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="_accurately_reading_the_position_of_a_motor_or_dial">Accurately Reading the Position of a Motor or Dial</h3>
<div class="sect3">
<h4 id="_problem_20">Problem</h4>
<div class="paragraph">
<p>You have a motor or dial and want to detect rotation using a rotary encoder.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_20">Solution</h4>
<div class="paragraph">
<p>Use a rotary encoder (also called a <em>quadrature encoder</em>) connected to one of the Bone&#8217;s eQEP ports, as shown in <a href="#digital_rotaryEncoder_fig">Wiring a rotary encoder using eQEP2</a>.</p>
</div>
<div id="digital_rotaryEncoder_fig" class="imageblock">
<div class="content">
<img src="./02sensors/figures/rotaryEncoder_bb.png" alt="rotaryEncoder">
</div>
<div class="title">Figure 29. Wiring a rotary encoder using eQEP2</div>
</div>
<div class="paragraph">
<p>To make this recipe, you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Breadboard and jumper wires (see <a href="#app_proto">Prototyping Equipment</a>)</p>
</li>
<li>
<p>Rotary encoder (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We are using a quadrature rotary encoder, which has two switches inside that open and close in such a manner that you can tell which way the shaft is turning. In this particular encoder, the two switches have a common lead, which is wired to ground. It also has a pushbutton switch wired to the other side of the device, which we aren&#8217;t using.</p>
</div>
<div class="paragraph">
<p>Wire the encoder to P8_11 and P8_12, as shown in <a href="#digital_rotaryEncoder_fig">Wiring a rotary encoder using eQEP2</a>.</p>
</div>
<div class="paragraph">
<p>BeagleBone Black has built-in hardware for reading up to three encoders.
Here, we&#8217;ll use the <em>eQEP2</em> encoder. To enable it, put the code from <a href="#digital_bone_eqep2b">Configuring a rotary encoder (bone_eqep2b.dts) <sup class="footnote">[1]</sup></a> in a file called <em>bone_eqep2b.dts</em>. You can do this using Cloud9 to edit files (as shown in <a href="#basics_cloud9">Editing Code Using the Cloud9 IDE</a>) or use a more traditional editor (as shown in <a href="#tips_editing_files">Editing a Text File from the GNU/Linux Command Shell</a>).</p>
</div>
<div id="digital_bone_eqep2b" class="exampleblock">
<div class="title">Example 5. Configuring a rotary encoder (bone_eqep2b.dts) <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">/*
 * Copyright (C) 2013 Nathaniel R. Lewis - http://nathanielrlewis.com/
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 as
 * published by the Free Software Foundation.
 * 
 * Enable eQEP2 on the Beaglebone White and Black
 * These pins don't conflict with the HDMI
 */
/dts-v1/;
/plugin/;

/ {
    compatible = "ti,beaglebone", "ti,beaglebone-black";

    /* identification */
    part-number = "bone_eqep2";
    version     = "00A0";

    fragment@0 {
        target = &lt;&amp;am33xx_pinmux&gt;;
        __overlay__ {
            pinctrl_eqep2: pinctrl_eqep2_pins {
                pinctrl-single,pins = &lt;					 				   
		          0x038 0x24  /* P8_16 = GPIO2_12 = EQEP2_index, MODE4 */
		          0x03C 0x24  /* P8_15 = GPIO2_13 = EQEP2_strobe, MODE4 */
		          0x030 0x34  /* P8_12 = GPIO2_10 = EQEP2A_in, MODE4 */
		          0x034 0x34  /* P8_11 = GPIO2_11 = EQEP2B_in, MODE4 */
                &gt;;
            };
        };
    };
    
    fragment@1 {
        target = &lt;&amp;epwmss2&gt;;
        __overlay__ {
            status = "okay";
        };
    };
    
    fragment@2 {
    	target = &lt;&amp;eqep2&gt;;
    	__overlay__ {
        pinctrl-names = "default";
        pinctrl-0 = &lt;&amp;pinctrl_eqep2&gt;;
        count_mode = &lt; 0 &gt;;  
        /* 0 - Quadrature mode, normal 90 phase offset cha &amp; chb.  
           1 - Direction mode.  cha input = clock, chb input = direction  */
        swap_inputs = &lt; 0 &gt;; /* Are chan A &amp; chan B swapped? (0-no,1-yes) */
          invert_qa = &lt; 1 &gt;;   /* Should we invert the channel A input?  */
          invert_qb = &lt; 1 &gt;;   /* Should we invert the channel B input? 
                These are inverted because my encoder outputs drive transistors 
                that pull down the pins */
          invert_qi = &lt; 0 &gt;;   /* Should we invert the index input? */
          invert_qs = &lt; 0 &gt;;   /* Should we invert the strobe input? */
        
        status = "okay";
    	};
    };
};</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Then run the following commands:</p>
</div>
<pre data-type="programlisting">
bone# <strong>dtc -O dtb -o bone_eqep2b-00A0.dtbo -b 0 -@ bone_eqep2b.dts</strong>
bone# <strong>cp bone_eqep2b-00A0.dtbo /lib/firmware</strong>
bone# <strong>echo bone_eqep2b > /sys/devices/bone_capemgr.*/slots</strong>
</pre>
<div class="paragraph">
<p>This will enable <em>eQEP2</em> on pins P8_11 and P8_12.</p>
</div>
<div class="paragraph">
<p>Finally, add the code in <a href="#digital_rotaryEncoder_js">Reading a rotary encoder (rotaryEncoder.js)</a> to a file named <em>rotaryEncoder.js</em> and run it.</p>
</div>
<div id="digital_rotaryEncoder_js" class="exampleblock">
<div class="title">Example 6. Reading a rotary encoder (rotaryEncoder.js)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">#!/usr/bin/env node
// This uses the eQEP hardware to read a rotary encoder
// echo bone_eqep2b &gt; $SLOTS 

var b = require('bonescript'),
    fs = require('fs');
    
var eQEP0 = "/sys/devices/ocp.3/48300000.epwmss/48300180.eqep/",
    eQEP1 = "/sys/devices/ocp.3/48302000.epwmss/48302180.eqep/",
    eQEP2 = "/sys/devices/ocp.3/48304000.epwmss/48304180.eqep/",
    eQEP = eQEP2;
	
var oldData,			// pervious data read
    period = 100;	// in ms

// Set the eEQP period, convert to ns.
fs.writeFile(eQEP+'period', period*1000000, function(err) {
	if (err) throw err;
	console.log('Period updated to ' + period*1000000);
})

// Enable
fs.writeFile(eQEP+'enabled', 1, function(err) {
	if (err) throw err;
	console.log('Enabled');
})

setInterval(readEncoder, period);    // Check state every 250 ms

function readEncoder(x) {
	fs.readFile(eQEP + 'position', {encoding: 'utf8'}, printValue);
}

function printValue(err, data) {
	if (err) throw err;
	if (oldData !== data) {
		console.log('position: '+data+' speed: '+(oldData-data));
		oldData = data;
	}
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Try rotating the encoder clockwise and counter-clockwise. You&#8217;ll see an output like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">Period updated to 100000000
Enabled
position: 0
 speed: NaN
position: 4
 speed: -4
position: 6
 speed: -2
position: 8
 speed: -2
position: 12
 speed: -4
position: 16
 speed: -4
position: 19
 speed: -3
position: 20
 speed: -1</code></pre>
</div>
</div>
<div class="paragraph">
<p>The values you get for speed and position will depend on which way you are turning the device and how quickly. You will need to press ^C (Ctrl-C) to end the <span class="keep-together">program</span>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_19">Discussion</h4>

</div>
<div class="sect3">
<h4 id="_see_also">See Also</h4>
<div class="paragraph">
<p>You can also measure rotation by using a variable resistor (see <a href="#sensors_analogIn_fig">Wiring a 10k&#8486; variable resistor (trimpot) to an ADC port</a>).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sensors_GPS">Acquiring Data by Using a Smart Sensor over a Serial Connection</h3>
<div class="sect3">
<h4 id="_problem_21">Problem</h4>
<div class="paragraph">
<p>You want to connect a smart sensor that uses a built-in microcontroller to stream data, such as a global positioning system (GPS), to the Bone and read the data from it.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_21">Solution</h4>
<div class="paragraph">
<p>The Bone has several serial ports (UARTs) that you can use to read data from an external microcontroller included in smart sensors, such as a GPS. Just wire one up, and you&#8217;ll soon be gathering useful data, such as your own location.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s what you&#8217;ll need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Breadboard and jumper wires (see <a href="#app_proto">Prototyping Equipment</a>)</p>
</li>
<li>
<p>GPS receiver (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Wire your GPS, as shown in <a href="#digital_GPS_fig">Wiring a GPS to UART 4</a>.</p>
</div>
<div id="digital_GPS_fig" class="imageblock">
<div class="content">
<img src="./02sensors/figures/GPS_bb.png" alt="GPS">
</div>
<div class="title">Figure 30. Wiring a GPS to UART 4</div>
</div>
<div class="paragraph">
<p>The GPS will produce raw National Marine Electronics Association (NMEA) data that&#8217;s easy for a computer to read, but not for a human.
There are many utilities to help convert such sensor data into a human-readable form. For this GPS, run the following command to load a NMEA parser:</p>
</div>
<pre data-type="programlisting">
bone# <strong>npm install -g nmea</strong>
</pre>
<div class="paragraph">
<p>Running the code in <a href="#digital_GPS_code">Talking to a GPS with UART 4 (GPS.js)</a> will print the current location every time the GPS outputs it.</p>
</div>
<div id="digital_GPS_code" class="exampleblock">
<div class="title">Example 7. Talking to a GPS with UART 4 (GPS.js)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node
// Install with: npm install nmea

// Need to add exports.serialParsers = m.module.parsers;
// to the end of /usr/local/lib/node_modules/bonescript/serial.js

var b = require('bonescript');
var nmea = require('nmea');

var port = '/dev/ttyO4';
var options = {
    baudrate: 9600,
    parser: b.serialParsers.readline("\n")
};

b.serialOpen(port, options, onSerial);

function onSerial(x) {
    if (x.err) {
        console.log('***ERROR*** ' + JSON.stringify(x));
    }
    if (x.event == 'open') {
       console.log('***OPENED***');
    }
    if (x.event == 'data') {
        console.log(String(x.data));
        console.log(nmea.parse(x.data));
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t need the NMEA formatting, you can skip the npm part and remove the lines in the code that refer to it.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you get an error like this</p>
</div>
<div class="paragraph">
<p>TypeError: Cannot call method 'readline' of undefined</p>
</div>
<div class="paragraph">
<p>add this line to the end of file <em>/usr/local/lib/node_modules/bonescript/serial.js</em>:</p>
</div>
<div class="paragraph">
<p>exports.serialParsers = m.module.parsers;</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_20">Discussion</h4>
<div id="cape-headers-serial_fig" class="imageblock">
<div class="content">
<img src="./02sensors/figures/cape-headers-serial.png" alt="UART outputs">
</div>
<div class="title">Figure 31. Table of UART outputs</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sensors_i2c_temp">Measuring a Temperature</h3>
<div class="sect3">
<h4 id="_problem_22">Problem</h4>
<div class="paragraph">
<p>You want to measure a temperature using a digital temperature sensor.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_22">Solution</h4>
<div class="paragraph">
<p>The TMP102 sensor is a common digital temperature sensor that uses a standard I<sup>2</sup>C-based serial protocol.</p>
</div>
<div class="paragraph">
<p>To make this recipe, you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Breadboard and jumper wires (see <a href="#app_proto">Prototyping Equipment</a>)</p>
</li>
<li>
<p>Two 4.7 k&#8486; resistors (see <a href="#app_resistor">Resistors</a>)</p>
</li>
<li>
<p>TMP102 temperature sensor (see <a href="#app_ic">Integrated Circuits</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Wire the TMP102, as shown in <a href="#sensors_i2cTemp_fig">Wiring an I<sup>2</sup>C TMP102 temperature sensor</a>.</p>
</div>
<div id="sensors_i2cTemp_fig" class="imageblock">
<div class="content">
<img src="./02sensors/figures/i2cTemp_bb.png" alt="I^2^C  Temp">
</div>
<div class="title">Figure 32. Wiring an I<sup>2</sup>C TMP102 temperature sensor</div>
</div>
<div class="paragraph">
<p>There are two I<sup>2</sup>C buses brought out to the headers. <a href="#sensors_cape_headers_i2c">Table of I<sup>2</sup>C outputs</a> shows that you have wired your device to I<sup>2</sup>C bus 2, but watch out: the buses aren&#8217;t always numbered the same. When you work with BoneScript, they are numbered 1 and 2, but if you work from the Linux command line, they are numbered 0 and 1. Confusing, huh?</p>
</div>
<div id="sensors_cape_headers_i2c" class="imageblock">
<div class="content">
<img src="./02sensors/figures/cape-headers-i2c.png" alt="I^2^C  Temp">
</div>
<div class="title">Figure 33. Table of I<sup>2</sup>C outputs</div>
</div>
<div class="paragraph">
<p>Once the I<sup>2</sup>C  device is wired up, you can use a couple handy I<sup>2</sup>C tools to test the device. Because these are Linux command-line tools, you have to use 1 as the bus number. i2cdetect, shown in <a href="#js_i2cTools">I<sup>2</sup>C tools</a>, shows which I<sup>2</sup>C  devices are on the bus. The -r flag indicates which bus to use. Our TMP102 is appearing at address 0x49. You can use the i2cget command to read the value. It returns the temperature in hexidecimal and degrees C. In this example, 0x18 = 24&#176;C, which is 75.2&#176;F. (Hmmm, the office is a bit warm today.) Try warming up the TMP102 with your finger and running i2cget again.</p>
</div>
<div id="js_i2cTools" class="exampleblock">
<div class="title">Example 8. I<sup>2</sup>C tools</div>
<div class="content">
<pre data-type="programlisting">
bone# <strong>i2cdetect -y -r 1</strong>
     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f
00:          -- -- -- -- -- -- -- -- -- -- -- -- --
10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
40: -- -- -- -- -- -- -- -- -- 49 -- -- -- -- -- --
50: -- -- -- -- UU UU UU UU -- -- -- -- -- -- -- --
60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
70: -- -- -- -- -- -- -- --

bone# <strong>i2cget -y 1 0x49</strong>
0x18
</pre>
</div>
</div>
<div class="paragraph">
<p><a href="#js_i2cTemp_code">Reading an I<sup>2</sup>C  device (i2cTemp.js)</a> shows how to read the TMP102 from BoneScript.</p>
</div>
<div id="js_i2cTemp_code" class="exampleblock">
<div class="title">Example 9. Reading an I<sup>2</sup>C  device (i2cTemp.js)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">#!/usr/bin/env node

var b = require('bonescript');
var bus = '/dev/i2c-2'              // <b class="conum">(1)</b>
var TMP102 = 0x49;                  // <b class="conum">(2)</b>

b.i2cOpen(bus, TMP102);             // <b class="conum">(3)</b>
b.i2cReadByte(bus, onReadByte);     // <b class="conum">(4)</b>

function onReadByte(x) {            // <b class="conum">(5)</b>
    if (x.event == 'callback') {
        console.log('onReadByte: ' + JSON.stringify(x)); // <b class="conum">(6)</b>
        console.log(x.res*9/5+32 + 'F'); // <b class="conum">(7)</b>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This line states which bus to use. The last digit gives the BoneScript bus number.</p>
</li>
<li>
<p>This gives the address of the device on the bus.</p>
</li>
<li>
<p>This line opens the device. All I<sup>2</sup>C commands that follow will apply to this bus and device.</p>
</li>
<li>
<p>This line reads a byte from the device. The default is to read from address 0 of the selected device. Address 0 for the TMP102 is the current temperature. As soon as the register is read, the onReadByte() function is called.</p>
</li>
<li>
<p>The value, x, passed to onReadByte() is an object. The .event field of the object informs us if we have a callback.</p>
</li>
<li>
<p>If this is a callback, use console.log to display the contents of object x.</p>
</li>
<li>
<p>Finally, print the result field, x.res, after converting it to degrees F.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Run the code by using the following command:</p>
</div>
<pre data-type="programlisting">
bone# <strong>./i2cTemp.js</strong>
onReadByte: {"err":null,"res":24,"event":"callback"}
75.2F
</pre>
</div>
<div class="sect3">
<h4 id="_discussion_21">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="_reading_temperature_via_a_dallas_1_wire_device">Reading Temperature via a Dallas 1-Wire Device</h3>
<div class="sect3">
<h4 id="_problem_23">Problem</h4>
<div class="paragraph">
<p>You want to measure a temperature using a Dallas Semiconductor DS18B20 temperature sensor.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_23">Solution</h4>
<div class="paragraph">
<p>The DS18B20 is an interesting temperature sensor that uses Dallas Semiconductor&#8217;s 1-wire interface. The data communication requires only one wire! (However, you still need wires from ground and 3.3 V.) You can wire it to any GPIO port.</p>
</div>
<div class="paragraph">
<p>To make this recipe, you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Breadboard and jumper wires (see <a href="#app_proto">Prototyping Equipment</a>)</p>
</li>
<li>
<p>4.7 k&#8486; resistor (see <a href="#app_resistor">Resistors</a>)</p>
</li>
<li>
<p>DS18B20 1-wire temperature sensor (see <a href="#app_ic">Integrated Circuits</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Wire up as shown in <a href="#sensors_1-wire_fig">Wiring a Dallas 1-Wire temperature sensor <sup class="footnote">[2]</sup></a>.</p>
</div>
<div id="sensors_1-wire_fig" class="imageblock">
<div class="content">
<img src="./02sensors/figures/onewire_bb.png" alt="1-wire">
</div>
<div class="title">Figure 34. Wiring a Dallas 1-Wire temperature sensor <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></div>
</div>
<div class="paragraph">
<p>Add the code in <a href="#sensors_onewire_dts_code">Reading a temperature with a DS18B20 (BB-W1-00A0.dts)</a> to a file called <em>BB-W1-00A0.dts</em>.</p>
</div>
<div id="sensors_onewire_dts_code" class="exampleblock">
<div class="title">Example 10. Reading a temperature with a DS18B20 (BB-W1-00A0.dts)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">/dts-v1/;
/plugin/;

/ {
    compatible = "ti,beaglebone", "ti,beaglebone-black";

    part-number = "BB-W1";
    version = "00A0";

    /* state the resources this cape uses */
    exclusive-use =
	/* the pin header uses */
	"P9.20",
	/* the hardware IP uses */
	"gpio0_12";

    fragment@0 {
	target = &lt;&amp;am33xx_pinmux&gt;;
	__overlay__ {
	    dallas_w1_pins: pinmux_dallas_w1_pins {
		pinctrl-single,pins = &lt;	0x150 0x37 &gt;;
	    };
	};
    };

    fragment@1 {
	target = &lt;&amp;ocp&gt;;
	__overlay__ {
	    onewire@0 {
		compatible      = "w1-gpio";
		pinctrl-names   = "default";
		pinctrl-0       = &lt;&amp;dallas_w1_pins&gt;;
		status          = "okay";

		gpios = &lt;&amp;gpio1 2 0&gt;;
	   };
	};
    };
};</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Then run the following commands:</p>
</div>
<pre data-type="programlisting">
bone# <strong>dtc -O dtb -o BB-W1-00A0.dtbo -b 0 -@ BB-W1-00A0.dts</strong>
bone# <strong>cp BB-W1-00A0.dtbo /lib/firmware/</strong>
bone# <strong>echo BB-W1 > /sys/devices/bone_capemgr.*/slots</strong>
</pre>
<div class="paragraph">
<p>Now run the following command to discover the serial number on your device:</p>
</div>
<pre data-type="programlisting">
bone# <strong>ls /sys/bus/w1/devices/</strong>
28-00000114ef1b  28-00000128197d  w1_bus_master1
</pre>
<div class="paragraph">
<p>This shows the serial numbers for all the devices.</p>
</div>
<div class="paragraph">
<p>Finally, add the code in <a href="#sensors_onewire__code">Reading a temperature with a DS18B20 (onewire.js)</a> in to a file named <em>onewire.js</em>, edit the path assigned to w1 so that the path points to your device, and then run it.</p>
</div>
<div id="sensors_onewire__code" class="exampleblock">
<div class="title">Example 11. Reading a temperature with a DS18B20 (onewire.js)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">#!/usr/bin/env node
var b = require('bonescript');

var w1="/sys/bus/w1/devices/28-00000114ef1b/w1_slave"

setInterval(getTemp, 1000);	// read temperatue every 1000ms

function getTemp() {
    b.readTextFile(w1, printStatus);
}

function printStatus(x) {
    console.log('x.data = ' + x.data);
    console.log('x.err  = ' + x.err);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_22">Discussion</h4>
<div class="paragraph">
<p>Each temperature sensor has a unique serial number, so you can have several all sharing the same data line.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sensors_sensortag">Sensing All Sorts of Things with SensorTag via Bluetooth v4.0</h3>
<div class="sect3">
<h4 id="_problem_24">Problem</h4>
<div class="paragraph">
<p>You have a TI SensorTag, and you want to interface it to BeagleBone Black via Bluetooth Low Energy (BLE).</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_24">Solution</h4>
<div class="paragraph">
<p>TI&#8217;s <a href="http://bit.ly/1C58WIN">SensorTag</a> (shown in <a href="#sensors_sensortag_fig">SensorTag</a>) combines six sensors (temperature, humidity, accelerometer, pressure, magnetometer, and gyroscope) in one package that interfaces via <a href="http://bit.ly/1EzMo4x">Bluetooth Low Energy</a>.</p>
</div>
<div id="sensors_sensortag_fig" class="imageblock">
<div class="content">
<img src="./02sensors/figures/sensorTag.jpg" alt="SensorTag">
</div>
<div class="title">Figure 35. SensorTag</div>
</div>
<div class="paragraph">
<p>To make this recipe, you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>BLE USB dongle (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
<li>
<p>SensorTag (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
<li>
<p>5 V adapter for the Bone</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Power up your Bone using the 5 V adapter. You need the adapter because the BLE dongle needs extra power for the radios it contains. After it is booted up, log in (<a href="#tips_shell">Getting to the Command Shell via SSH</a>) and run the following commands:</p>
</div>
<pre data-type="programlisting">
bone# <strong>apt-get install libbluetooth-dev</strong>
bone# <strong>npm install -g sensortag</strong>
</pre>
<div class="paragraph">
<p>This installs the Bluetooth tools and the JavaScript library to talk to it.</p>
</div>
<div class="paragraph">
<p>Add the code in <a href="#sensors_sensorTag_code">Code for reading the temperature from a SensorTag (sensorTag.js)</a> to a file called <em>sensorTag.js</em> and run it.</p>
</div>
<div id="sensors_sensorTag_code" class="exampleblock">
<div class="title">Example 12. Code for reading the temperature from a SensorTag (sensorTag.js)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">#!/usr/bin/env node
// From: https://github.com/sandeepmistry/node-sensortag

// Reads temperature

var util = require('util');             // <b class="conum">(1)</b>
var async = require('async');
var SensorTag = require('sensortag');
var fs = require('fs');

console.log("Be sure sensorTag is on");

SensorTag.discover(function(sensorTag) {  // <b class="conum">(2)</b>
  console.log('sensorTag = ' + sensorTag);
  sensorTag.on('disconnect', function() {   // <b class="conum">(3)</b>
    console.log('disconnected!');
    process.exit(0);
  });

  async.series([                            // <b class="conum">(4)</b>
      function(callback) {
        console.log('connect');             // <b class="conum">(5)</b>
        sensorTag.connect(callback);
      },
      function(callback) {                  // <b class="conum">(6)</b>
        console.log('discoverServicesAndCharacteristics');
        sensorTag.discoverServicesAndCharacteristics(callback);
      },
      function(callback) {
        console.log('enableIrTemperature'); // <b class="conum">(7)</b>
        sensorTag.enableIrTemperature(callback);
      },
      function(callback) {
        setTimeout(callback, 100);          // <b class="conum">(8)</b>
      },
      function(callback) {
        console.log('readIrTemperature');   // <b class="conum">(9)</b>
        sensorTag.readIrTemperature(
          function(objectTemperature, ambientTemperature) {
            console.log('\tobject  temperature = %d °C', 
                objectTemperature.toFixed(1));
            console.log('\tambient temperature = %d °C', 
                ambientTemperature.toFixed(1));
            callback();
        });

        sensorTag.on('irTemperatureChange', // <b class="conum">(10)</b>
          function(objectTemperature, ambientTemperature) {
            console.log('\tobject  temperature = %d °C', 
                objectTemperature.toFixed(1));
            console.log('\tambient temperature = %d °C\n', 
                ambientTemperature.toFixed(1));
          });

        sensorTag.notifyIrTemperature(function() {
          console.log('notifyIrTemperature');
        });
      },
      // function(callback) {
      //   console.log('disableIrTemperature'); // <b class="conum">(11)</b>
      //   sensorTag.disableIrTemperature(callback);
      // },
      
      function(callback) {
        console.log('readSimpleRead');          // &lt;12&gt; 
        sensorTag.on('simpleKeyChange', function(left, right) {
          console.log('left: ' + left + ' right: ' + right);
          if (left &amp;&amp; right) {
            sensorTag.notifySimpleKey(callback); // <b class="conum">(13)</b>
          }
        });

        sensorTag.notifySimpleKey(function() {  // <b class="conum">(14)</b>
        });
      },
      function(callback) {
        console.log('disconnect');
        sensorTag.disconnect(callback);         // <b class="conum">(15)</b>
      }
    ]
  );
});

// The MIT License (MIT)

// Copyright (c) 2013 Sandeep Mistry

// Permission is hereby granted, free of charge, to any person obtaining a copy of
// this software and associated documentation files (the "Software"), to deal in
// the Software without restriction, including without limitation the rights to
// use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
// the Software, and to permit persons to whom the Software is furnished to do so,
// subject to the following conditions:

// The above copyright notice and this permission notice shall be included in all
// copies or substantial portions of the Software.

// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
// FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
// COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
// IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
// CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Read in the various packages that are needed.</p>
</li>
<li>
<p>SensorTag.discover checks what SensorTags are out there. When found, it calls the inline function that follows.</p>
</li>
<li>
<p><span id="callout_list_item_3">This</span> function is called when the SensorTag is disconnected.</p>
</li>
<li>
<p>Normally JavaScript does everything synchronously. Here, we want to do the following asynchronously&#8212;&#8203;that is, step-by-step, one after the other. We are passing an array to async.series(), which contains the functions to run in the order in which they appear in the array.</p>
</li>
<li>
<p>Connect to the SensorTag.</p>
</li>
<li>
<p>Discover what the SensorTag can do. This is necessary before we can give it any commands.</p>
</li>
<li>
<p>Enable temperatures. We don&#8217;t get a temperature reading yet. Rather, we&#8217;re instructing it to begin reading and report back when they are ready.</p>
</li>
<li>
<p>Wait a bit for the first temperatures to be read.</p>
</li>
<li>
<p>This specifies the function to call every time a temperature is ready. The callback is passed objectTemperature (what&#8217;s read by the touchless IR sensors) and ambientTemperature (the temperature inside the SensorTag). Try putting your hand in front of the device; the objectTemperature should go up.</p>
</li>
<li>
<p>Define the callback for when the temperature changes.</p>
</li>
<li>
<p>This commented-out code is used when you want to turn off the temperature readings.</p>
</li>
<li>
<p>Assign a callback to respond to the left and right button pushes.</p>
</li>
<li>
<p>If both buttons are pushed, pass the callback function to sensorTag.notifySimpleKey().</p>
</li>
<li>
<p>sensorTag.notifySimpleKey() doesn&#8217;t do anything in this case, but it does evaluate callback, allowing it to progress to the next and final state.</p>
</li>
<li>
<p>When we get to here, we disconnect from the SensorTag, which causes the code to exit (see <a href="#callout_list_item_3"><img src="callouts/3.png" alt="3"/></a>).</p>
</li>
</ol>
</div>
<div class="paragraph pagebreak-before">
<p>Here&#8217;s some output from the code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">Be sure sensorTag is on
sensorTag = {"uuid":"9059af0b8457"}
connect
discoverServicesAndCharacteristics
enableIrTemperature
readIrTemperature
    object  temperature = 2.8 °C
	ambient temperature = 0 °C
readSimpleRead
notifyIrTemperature
	object  temperature = 31.8 °C
	ambient temperature = 24.8 °C

	object  temperature = 25.9 °C
	ambient temperature = 24.8 °C

	object  temperature = 27.4 °C
	ambient temperature = 24.8 °C

	object  temperature = 32.2 °C
	ambient temperature = 24.8 °C

left: false right: true
left: true right: true
left: false right: false
disconnect
disconnected!</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_23">Discussion</h4>
<div class="paragraph">
<p>Here, you see examples of how to read all the sensors. Look in <em>index.js</em> (in the same directory) to see all the methods that are defined.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sensors_audio">Playing and Recording Audio</h3>
<div class="sect3">
<h4 id="_problem_25">Problem</h4>
<div class="paragraph">
<p>BeagleBone doesn&#8217;t have audio built in, but you want to play and record files.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_25">Solution</h4>
<div class="paragraph">
<p>One approach is to buy an audio cape (<a href="#app_capes">Capes</a>), but another, possibly cheaper approach is to buy a USB audio adapter,
such as the one shown in <a href="#usb_audio_dongle">A USB audio dongle</a>. Some adapters that I&#8217;ve tested are provided in <a href="#app_misc">Miscellaneous</a>.</p>
</div>
<div id="usb_audio_dongle" class="imageblock">
<div class="content">
<img src="./02sensors/figures/audioDongle.jpg" alt="Audio Dongle">
</div>
<div class="title">Figure 36. A USB audio dongle</div>
</div>
<div class="paragraph">
<p>Drivers for the <a href="http://bit.ly/1MrAJUR">Advanced Linux Sound Architecture</a> (ALSA) are already installed on the Bone. You can list the recording and playing devices on your Bone by using aplay and arecord, as shown in <a href="#sensors_alsa">Listing the ALSA audio output and input devices on the Bone</a>. BeagleBone Black has audio-out on the HDMI interface. It&#8217;s listed as card 0 in <a href="#sensors_alsa">Listing the ALSA audio output and input devices on the Bone</a>. card 1 is my USB audio adapter&#8217;s audio out.</p>
</div>
<div id="sensors_alsa" class="exampleblock">
<div class="title">Example 13. Listing the ALSA audio output and input devices on the Bone</div>
<div class="content">
<pre data-type="programlisting">
bone# <strong>aplay -l</strong>
**** List of PLAYBACK Hardware Devices ****
card 0: Black [TI BeagleBone Black], device 0: HDMI nxp-hdmi-hifi-0 []
  Subdevices: 1/1
  Subdevice #0: subdevice #0
card 1: Device [C-Media USB Audio Device], device 0: USB Audio [USB Audio]
  Subdevices: 1/1
  Subdevice #0: subdevice #0

bone# <strong>arecord -l</strong>
**** List of CAPTURE Hardware Devices ****
card 1: Device [C-Media USB Audio Device], device 0: USB Audio [USB Audio]
  Subdevices: 1/1
  Subdevice #0: subdevice #0
</pre>
</div>
</div>
<div class="paragraph">
<p>In the aplay output shown in <a href="#sensors_alsa">Listing the ALSA audio output and input devices on the Bone</a>, you can see the USB adapter&#8217;s audio out. By default, the Bone will send audio to the HDMI. You can change that default by creating a file in your home directory called <em>~/.asoundrc</em> and adding the code in <a href="#sensors_asoundrc">Change the default audio out by putting this in ~/.asoundrc (audio.asoundrc)</a> to it.</p>
</div>
<div id="sensors_asoundrc" class="exampleblock">
<div class="title">Example 14. Change the default audio out by putting this in ~/.asoundrc (audio.asoundrc)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">pcm.!default {
  type plug
  slave {
    pcm "hw:1,0"
  }
}
ctl.!default {
  type hw
  card 1
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can easily play <em>.wav</em> files with aplay:</p>
</div>
<pre data-type="programlisting">
bone# <strong>aplay test.wav</strong>
</pre>
<div class="paragraph">
<p>You can play other files in other formats by installing mplayer:</p>
</div>
<pre data-type="programlisting">
bone# <strong>apt-get update</strong>
bone# <strong>apt-get install mplayer</strong>
bone# <strong>mplayer test.mp3</strong>
</pre>
</div>
<div class="sect3">
<h4 id="_discussion_24">Discussion</h4>
<div class="paragraph">
<p>Adding the simple USB audio adapter opens up a world of audio I/O on the Bone.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="displays">Displays and Other Outputs</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_3">Introduction</h3>
<div class="paragraph">
<p>In this chapter, you will learn how to control physical hardware via
BeagleBone Black&#8217;s general-purpose input/output (GPIO) pins. The Bone has 65 GPIO pins that are brought out on two 46-pin headers, called P8 and P9, as shown in <a href="#js_P8P9_fig">The P8 and P9 GPIO headers</a>.</p>
</div>
<div id="js_P8P9_fig" class="imageblock">
<div class="content">
<img src="./03displays/figures/P8P9_bb.png" alt="Headers P8 and P9">
</div>
<div class="title">Figure 37. The P8 and P9 GPIO headers</div>
</div>
<div class="paragraph">
<p>The purpose of this chapter is to give simple examples that show how to use various methods of output. Most solutions require a breadboard and some jumper wires.</p>
</div>
<div class="paragraph">
<p>All these examples assume that you know how to edit a file (<a href="#basics_cloud9">Editing Code Using the Cloud9 IDE</a>) and run it, either within Cloud9 integrated development environment (IDE) or from the command line (<a href="#tips_shell">Getting to the Command Shell via SSH</a>).</p>
</div>
</div>
<div class="sect2">
<h3 id="displays_onboardLED">Toggling an Onboard LED</h3>
<div class="sect3">
<h4 id="_problem_26">Problem</h4>
<div class="paragraph">
<p>You want to know how to flash the four LEDs that are next to the Ethernet port on the Bone.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_26">Solution</h4>
<div class="paragraph">
<p>Locate the four onboard LEDs shown in <a href="#js_internLED_fig">The four USER LEDs</a>. They are labeled USR0 through USR3, but we&#8217;ll refer to them as the USER LEDs.</p>
</div>
<div id="js_internLED_fig" class="imageblock">
<div class="content">
<img src="./03displays/figures/internLED.png" alt="USER LEDs">
</div>
<div class="title">Figure 38. The four USER LEDs</div>
</div>
<div class="paragraph">
<p>Place the code shown in <a href="#js_internLED_code">Using an internal LED (internLED.js)</a> in a file called <em>internLED.js</em>. You can do this using Cloud9 to edit files (as shown in <a href="#basics_cloud9">Editing Code Using the Cloud9 IDE</a>) or with a more traditional editor (as shown in <a href="#tips_editing_files">Editing a Text File from the GNU/Linux Command Shell</a>).</p>
</div>
<div id="js_internLED_code" class="exampleblock">
<div class="title">Example 15. Using an internal LED (internLED.js)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node
var b = require('bonescript');
var LED = 'USR0';
var state = b.HIGH;     // Initial state
b.pinMode(LED, b.OUTPUT);

setInterval(flash, 250);    // Change state every 250 ms

function flash() {
    b.digitalWrite(LED, state);
    if(state === b.HIGH) {
        state = b.LOW;
    } else {
        state = b.HIGH;
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the bash command window, enter the following commands:</p>
</div>
<pre data-type="programlisting">
bone# <strong>chmod +x internLED.js</strong>
bone# <strong>./internLED.js</strong>
</pre>
<div class="paragraph">
<p>The USER0 LED should now be flashing.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_25">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="displays_externalLED">Toggling an External LED</h3>
<div class="sect3">
<h4 id="_problem_27">Problem</h4>
<div class="paragraph">
<p>You want to connect your own external LED to the Bone.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_27">Solution</h4>
<div class="paragraph">
<p>Connect an LED to one of the GPIO pins using a series resistor to limit the current.  To make this recipe, you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Breadboard and jumper wires (see <a href="#app_proto">Prototyping Equipment</a>)</p>
</li>
<li>
<p>220 &#8486; to 470 &#8486; resistor (see <a href="#app_resistor">Resistors</a>)</p>
</li>
<li>
<p>LED (see <a href="#app_opto">Opto-Electronics</a>)</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>The value of the current limiting resistor depends on the LED you are using. The Bone can drive only 4 to 6 mA, so you might need a larger resistor to keep from pulling too much current. A 330 &#8486; or 470 &#8486; resistor might be better.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="#displays_externLED_fig">Diagram for using an external LED</a> shows how you can wire the LED to pin 14 of the P9 header (P9_14). Every circuit in this book (<a href="#basics_wire_breadboard">Wiring a Breadboard</a>) assumes you have already wired the rightmost bus to ground (P9_1) and the next bus to the left to the 3.3 V (P9_3) pins on the header. Be sure to get the polarity right on the LED. The <em>short</em> lead always goes to ground.</p>
</div>
<div id="displays_externLED_fig" class="imageblock">
<div class="content">
<img src="./03displays/figures/externLED_bb.png" alt="External LED">
</div>
<div class="title">Figure 39. Diagram for using an external LED</div>
</div>
<div class="paragraph">
<p>After you&#8217;ve wired it, start Cloud9 (see <a href="#basics_cloud9">Editing Code Using the Cloud9 IDE</a>) and enter the code shown in <a href="#js_externLED_code">Code for using an external LED (externLED.js)</a> in a file called <em>externLED.js</em>.</p>
</div>
<div id="js_externLED_code" class="exampleblock">
<div class="title">Example 16. Code for using an external LED (externLED.js)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node
var b = require('bonescript');
var LED = 'P9_14';
var state = b.HIGH;     // Initial state
b.pinMode(LED, b.OUTPUT);

setInterval(flash, 250);    // Change state every 250 ms

function flash() {
    b.digitalWrite(LED, state);
    if(state === b.HIGH) {
        state = b.LOW;
    } else {
        state = b.HIGH;
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Save your file and run the code as before (<a href="#displays_onboardLED">Toggling an Onboard LED</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_26">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="displays_powerSwitch">Toggling a High-Voltage External Device</h3>
<div class="sect3">
<h4 id="_problem_28">Problem</h4>
<div class="paragraph">
<p>You want to control a device that runs at 120 V.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_28">Solution</h4>
<div class="paragraph">
<p>Working with 120 V can be tricky&#8212;&#8203;even dangerous&#8212;&#8203;if you aren&#8217;t careful.  Here&#8217;s a safe way to do it.</p>
</div>
<div class="paragraph">
<p>To make this recipe, you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>PowerSwitch Tail II (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#displays_powerSwitch_fig">Diagram for wiring PowerSwitch Tail II</a> shows how you can wire the PowerSwitch Tail II to pin P9_14.</p>
</div>
<div id="displays_powerSwitch_fig" class="imageblock">
<div class="content">
<img src="./03displays/figures/powerSwitch_bb.png" alt="Power Switch Tail II">
</div>
<div class="title">Figure 40. Diagram for wiring PowerSwitch Tail II</div>
</div>
<div class="paragraph">
<p>After you&#8217;ve wired it, because this uses the same output pin as <a href="#displays_externalLED">Toggling an External LED</a>, you can run the same code (<a href="#js_externLED_code">Code for using an external LED (externLED.js)</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_27">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="displays_PWMdiscussion">Fading an External LED</h3>
<div class="sect3">
<h4 id="_problem_29">Problem</h4>
<div class="paragraph">
<p>You want to change the brightness of an LED from the Bone.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_29">Solution</h4>
<div class="paragraph">
<p>BoneScript has an analogWrite() function that uses the Bone&#8217;s pulse width modulation (PWM) hardware to produce an analog out signal. We&#8217;ll use the same circuit as before (<a href="#displays_externLED_fig">Diagram for using an external LED</a>) and declare the pin mode to be ANALOG_OUTPUT. Add the code in <a href="#js_fadeLED_code">Code for using an external LED (fadeLED.js)</a> to a file called <em>fadeLED.js</em> and then run it as before.</p>
</div>
<div id="js_fadeLED_code" class="exampleblock pagebreak-before">
<div class="title">Example 17. Code for using an external LED (fadeLED.js)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node
var b = require('bonescript');
var LED = 'P9_14';  // Pin to use
var step = 0.02,    // Step size
    min = 0.02,     // dimmest value
    max = 1,        // brightest value
    brightness = min; // Current brightness;

b.pinMode(LED, b.ANALOG_OUTPUT, 6, 0, 0, doInterval);

function doInterval(x) {
    if(x.err) {
        console.log('x.err = ' + x.err);
        return;
    }
    setInterval(fade, 20);      // Step every 20 ms
}

function fade() {
    b.analogWrite(LED, brightness);
    brightness += step;
    if(brightness &gt;= max || brightness &lt;= min) {
        step = -1 * step;
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_28">Discussion</h4>
<div id="cape-headers-pwm_fig" class="imageblock">
<div class="content">
<img src="./03displays/figures/cape-headers-pwm.png" alt="PWM outputs">
</div>
<div class="title">Figure 41. Table of PWM outputs</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_writing_to_an_led_matrix">Writing to an LED Matrix</h3>
<div class="sect3">
<h4 id="_problem_30">Problem</h4>
<div class="paragraph">
<p>You have an I<sup>2</sup>C-based LED matrix to interface.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_30">Solution</h4>
<div class="paragraph">
<p>There are a number of nice LED matrices that allow you to control several LEDs via one interface. This solution uses an <a href="http://www.adafruit.com/products/902">Adafruit Bicolor 8x8 LED Square Pixel Matrix w/I<sup>2</sup>C Backpack</a>.</p>
</div>
<div class="paragraph">
<p>To make this recipe, you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Breadboard and jumper wires (see <a href="#app_proto">Prototyping Equipment</a>)</p>
</li>
<li>
<p>Two 4.7 k&#8486; resistors (see <a href="#app_resistor">Resistors</a>)</p>
</li>
<li>
<p>I<sup>2</sup>C LED matrix (see <a href="#app_opto">Opto-Electronics</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The LED matrix is a 5 V device, but you can drive it from 3.3 V. Wire, as shown in <a href="#displays_i2cMatrix_fig">Wiring an i2c LED matrix</a>.</p>
</div>
<div id="displays_i2cMatrix_fig" class="imageblock">
<div class="content">
<img src="./03displays/figures/i2cMatrix_bb.png" alt="i2c LED matrix">
</div>
<div class="title">Figure 42. Wiring an i2c LED matrix</div>
</div>
<div class="paragraph">
<p><a href="#sensors_i2c_temp">Measuring a Temperature</a> shows how to use i2cdetect to discover the address of an I<sup>2</sup>C device. It also describes the difference between how Linux numbers the I<sup>2</sup>C buses (0 and 1) versus how BoneScript numbers them (1 and 2). Let&#8217;s see how your display shows up.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The BoneScript library convention is to use the index numbers provided in the hardware documentation. The version of the Linux kernel we use, however, begins index numbers at 0 for the first one registered and increases by 1, so these numbers might not always match. The BoneScript library attempts to hide this complication from you.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Run the i2cdetect -y -r 1 command to discover the address of the display, as shown in <a href="#displays_i2cdetect">Using I<sup>2</sup>C command-line tools to discover the address of the display</a>.</p>
</div>
<div id="displays_i2cdetect" class="exampleblock pagebreak-before">
<div class="title">Example 18. Using I<sup>2</sup>C command-line tools to discover the address of the display</div>
<div class="content">
<pre data-type="programlisting">
bone# <strong>i2cdetect -y -r 1</strong>
     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f
00:          -- -- -- -- -- -- -- -- -- -- -- -- --
10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
40: -- -- -- -- -- -- -- -- -- 49 -- -- -- -- -- --
50: -- -- -- -- UU UU UU UU -- -- -- -- -- -- -- --
60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
70: 70 -- -- -- -- -- -- --
</pre>
</div>
</div>
<div class="paragraph">
<p>Here, you can see a device at 0x49 and 0x70. I know I have a temperature sensor at 0x49, so the LED matrix must be at 0.70.</p>
</div>
<div class="paragraph">
<p>Add the code in <a href="#displays_matrix_i2c">LED matrix display (matrixLEDi2c.js)</a> to a file called <em>matrixLEDi2c.js</em> and run it by using the following command:</p>
</div>
<pre data-type="programlisting">
bone# <strong>npm install -g sleep</strong>
bone# <strong>./matrixLEDi2c.js</strong>
</pre>
<div id="displays_matrix_i2c" class="exampleblock">
<div class="title">Example 19. LED matrix display (matrixLEDi2c.js)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">#!/usr/bin/env node
// npm install -g sleep

var b = require('bonescript');
var sleep = require('sleep');
var port = '/dev/i2c-2'				// <b class="conum">(1)</b>
var matrix = 0x70;					// <b class="conum">(2)</b>
var time = 1000000; // Delay between images in us

// The first btye is GREEN, the second is RED.		<b class="conum">(3)</b>
var smile =
	[0x00, 0x3c, 0x00, 0x42, 0x28, 0x89, 0x04, 0x85, 
	 0x04, 0x85, 0x28, 0x89, 0x00, 0x42, 0x00, 0x3c];
var frown =
	[0x3c, 0x00, 0x42, 0x00, 0x85, 0x20, 0x89, 0x00, 
	 0x89, 0x00, 0x85, 0x20, 0x42, 0x00, 0x3c, 0x00];
var neutral =
	[0x3c, 0x3c, 0x42, 0x42, 0xa9, 0xa9, 0x89, 0x89,
	 0x89, 0x89, 0xa9, 0xa9, 0x42, 0x42, 0x3c, 0x3c];
var blank = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];

b.i2cOpen(port, matrix);			// <b class="conum">(4)</b>

b.i2cWriteByte(port,  0x21); // Start oscillator (p10)		<b class="conum">(5)</b>
b.i2cWriteByte(port,  0x81); // Disp on, blink off (p11)
b.i2cWriteByte(port,  0xe7); // Full brightness (page 15)

b.i2cWriteBytes(port, 0x00, frown);			// <b class="conum">(6)</b>
sleep.usleep(time);

b.i2cWriteBytes(port, 0x00, neutral);
sleep.usleep(time);

b.i2cWriteBytes(port, 0x00, smile);
// Fade the display
var fade;
for(fade = 0xef; fade &gt;= 0xe0; fade--) {		// <b class="conum">(7)</b>
    b.i2cWriteByte(port,  fade);
    sleep.usleep(time/10);
}
for(fade = 0xe1; fade &lt;= 0xef; fade++) {
    b.i2cWriteByte(port,  fade);
    sleep.usleep(time/10);
}
b.i2cWriteBytes(port, 0x04, [0xff]);</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This line states which bus to use. The last digit gives the BoneScript bus number.</p>
</li>
<li>
<p>This specifies the address of the LED matrix, 0x70 in our case.</p>
</li>
<li>
<p>This indicates which LEDs to turn on. The first byte is for the first column of <em>green</em> LEDs. In this case, all are turned off. The next byte is for the first column of <em>red</em> LEDs. The hex 0x3c number is 0b00111100 in binary. This means the first two red LEDs are off, the next four are on, and the last two are off. The next byte (0x00) says the second column of <em>green</em> LEDs are all off, the fourth byte (0x42 = 0b01000010) says just two red LEDs are on, and so on. Declarations define four different patterns to display on the LED matrix, the last being all turned off.</p>
</li>
<li>
<p>Open the I<sup>2</sup>C port.</p>
</li>
<li>
<p>Send three commands to the matrix to get it ready to display.</p>
</li>
<li>
<p>Now, we are ready to display the various patterns. After each pattern is displayed, we sleep a certain amount of time so that the pattern can be seen.</p>
</li>
<li>
<p>Finally, send commands to the LED matrix to set the brightness. This makes the disply fade out and back in again.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_29">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="displays_drive5V">Driving a 5 V Device</h3>
<div class="sect3">
<h4 id="_problem_31">Problem</h4>
<div class="paragraph">
<p>You have a 5 V device to drive, and the Bone has 3.3 V outputs.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_31">Solution</h4>
<div class="paragraph">
<p>If you are lucky, you might be able to drive a 5 V device from the Bone&#8217;s 3.3 V output. Try it and see if it works. If not, you need a level translator.</p>
</div>
<div class="paragraph">
<p>What you will need for this recipe:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A PCA9306 level translator (see <a href="#app_ic">Integrated Circuits</a>)</p>
</li>
<li>
<p>A 5 V power supply (if the Bone&#8217;s 5 V power supply isn&#8217;t enough)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The PCA9306  translates signals at 3.3 V to 5 V in both directions. It&#8217;s meant to work with I<sup>2</sup>C devices that have a pull-up resistor, but it can work with anything needing translation.</p>
</div>
<div class="paragraph">
<p><a href="#displays_i2cMatrixLevelTrans_fig">Wiring a PCA9306 level translator to an LED matrix</a> shows how to wire a PCA9306 to an LED matrix. The left is the 3.3 V side and the right is the 5 V side. Notice that we are using the Bone&#8217;s built-in 5 V power supply.</p>
</div>
<div id="displays_i2cMatrixLevelTrans_fig" class="imageblock">
<div class="content">
<img src="./03displays/figures/i2cMatrixLevelTrans_bb.png" alt="PCA9306 level translator">
</div>
<div class="title">Figure 43. Wiring a PCA9306 level translator to an LED matrix</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If your device needs more current than the Bone&#8217;s 5 V power supply provides, you can wire in an external power supply.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_30">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="_writing_to_a_neopixel_led_string">Writing to a NeoPixel LED String</h3>
<div class="sect3">
<h4 id="_problem_32">Problem</h4>
<div class="paragraph">
<p>You have an <a href="http://www.adafruit.com/products/1138">Adafruit NeoPixel LED string</a> or <a href="http://www.adafruit.com/products/1487">Adafruit NeoPixel LED matrix</a> and want to light it up.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_32">Solution</h4>
<div class="paragraph">
<p>Wire up an Adafruit NeoPixel LED 8-by-8 matrix as shown in <a href="#js_neoPixelMatrix_fig">Wiring an Adafruit NeoPixel LED matrix to P8_30</a>.</p>
</div>
<div id="js_neoPixelMatrix_fig" class="imageblock">
<div class="content">
<img src="./03displays/figures/neoPixelMatrix_bb.png" alt="NeoPixel Matrix">
</div>
<div class="title">Figure 44. Wiring an Adafruit NeoPixel LED matrix to P8_30</div>
</div>
<div class="paragraph">
<p><a href="#js_neoPixel_code">Installing and running LEDscape and OpenPixelControl (neoPixel.sh)</a> shows how to install LEDscape and run the LEDs.</p>
</div>
<div id="js_neoPixel_code" class="exampleblock">
<div class="title">Example 20. Installing and running LEDscape and OpenPixelControl (neoPixel.sh)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">#!/bin/sh
# Here's what you do to install the neoPixel driver
# Disable the HDMI to gain access to the PRU pins
sed -i '/cape_disable=capemgr.disable_partno=BB-BONELT-HDMI,BB-BONELT-HDMIN$/ \
            s/^#//' /boot/uEnv.txt
reboot
# Clone and build the code
cd
git clone -b opc-server https://github.com/jadonk/LEDscape.git
cd LEDscape
make
cd
git clone https://github.com/jadonk/openpixelcontrol.git
# Load and configure the kernel module, pins and LEDscape daemon
config-pin overlay BB-OPC-EX
modprobe uio_pruss
./LEDscape/run-ledscape &amp;
# Run an example Python script
./openpixelcontrol/python_clients/example.py</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_31">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="_using_a_nokia_5510_lcd_display">Using a Nokia 5510 LCD Display</h3>
<div class="sect3">
<h4 id="_problem_33">Problem</h4>
<div class="paragraph">
<p>You want to display some text and graphics on a Nokia 5510 black-and-white LCD display.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_33">Solution</h4>
<div class="paragraph">
<p>What you will need for this recipe:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Breadboard and jumper wires (see <a href="#app_proto">Prototyping Equipment</a>)</p>
</li>
<li>
<p>Nokia 5110 LCD (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
<li>
<p>220 &#8486; resistor (see <a href="#app_resistor">Resistors</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Nokia 5110 LCD runs off of 3.3 V, so you can wire it directly to the Bone (<a href="#displays_nokia_fig">Wiring a Nokia 5110 LCD display</a>).</p>
</div>
<div id="displays_nokia_fig" class="imageblock">
<div class="content">
<img src="./03displays/figures/nokia5110_bb.png" alt="Nokia 5110">
</div>
<div class="title">Figure 45. Wiring a Nokia 5110 LCD display</div>
</div>
<div class="paragraph">
<p>The drivers for the 5110 are in the Node Packaged Modules repository. Get and install them by running the following commands:</p>
</div>
<pre data-type="programlisting">
bone# <strong>npm install -g nokia5110</strong>
bone# <strong>cd /usr/local/lib/node_modules/nokia5110</strong>
bone# <strong>ln -s LCD_5110.js nokia5110.js</strong>
bone# <strong>cp lcdTest.js /tmp</strong>
bone# <strong>cd -</strong>
bone# <strong>mv /tmp/lcdTest.js nokia5110Test.js</strong>
</pre>
<div class="paragraph">
<p>Edit <em>nokia5110Test.js</em> so that the first few lines specify how it&#8217;s wired (as shown in <a href="#displays_nokia5110_code">Defining the Nokia 5110 pins (nokia5110.js)</a>) and then run the code.</p>
</div>
<div id="displays_nokia5110_code" class="exampleblock pagebreak-before">
<div class="title">Example 21. Defining the Nokia 5110 pins (nokia5110.js)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node
//
// Copyright (C) 2012 - Cabin Programs, Ken Keller 
//

var lcd = require('nokia5110');
var b = require('bonescript');
var timeout = 0;
var inverseIndex;

//
//  Must define the following outputs
//
lcd.PIN_SDIN = "P9_17";
lcd.PIN_SCLK = "P9_21";
lcd.PIN_SCE  = "P9_11";
lcd.PIN_DC   = "P9_15";
lcd.PIN_RESET= "P9_13";</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_32">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="_making_your_bone_speak">Making Your Bone Speak</h3>
<div class="sect3">
<h4 id="_problem_34">Problem</h4>
<div class="paragraph">
<p>Your Bone wants to talk.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_34">Solution</h4>
<div class="paragraph">
<p>Just install the <em>flite</em> text-to-speech program:</p>
</div>
<pre data-type="programlisting">
bone# <strong>apt-get install flite</strong>
</pre>
<div class="paragraph">
<p>Then add the code from <a href="#speak_code">A program that talks (speak.js)</a> in a file called <em>speak.js</em> and run.</p>
</div>
<div id="speak_code" class="exampleblock">
<div class="title">Example 22. A program that talks (speak.js)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node

var exec = require('child_process').exec;

function speakForSelf(phrase) {
{
	exec('flite -t "' + phrase + '"', function (error, stdout, stderr) {
        console.log(stdout);
        if(error) { 
            console.log('error: ' + error); 
        }
        if(stderr) {
            console.log('stderr: ' + stderr); 
        }
        });
}

speakForSelf("Hello, My name is Borris. " +
    "I am a BeagleBone Black, " +
    "a true open hardware, " +
    "community-supported embedded computer for developers and hobbyists. " +
    "I am powered by a 1 Giga Hertz Sitara™ ARM® Cortex-A8 processor. " +
    "I boot Linux in under 10 seconds. " +
    "You can get started on development in " +
    "less than 5 minutes with just a single USB cable." +
    "Bark, bark!"
    );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See <a href="#sensors_audio">Playing and Recording Audio</a> to see how to use a USB audio dongle and set your default audio out.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_33">Discussion</h4>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="motors">Motors</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_4">Introduction</h3>
<div class="paragraph">
<p>One of the many fun things about embedded computers is that you can move physical things with motors.
But there are so many different kinds of motors (<em>servo</em>, <em>stepper</em>, <em>DC</em>), so how do you select the right one?</p>
</div>
<div class="paragraph">
<p>The type of motor you use depends on the type of motion you want:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">R/C or hobby servo motor</dt>
<dd>
<p>Can be quickly positioned at various absolute angles, but some don&#8217;t spin. In fact, many can turn only about 180&#176;.</p>
</dd>
<dt class="hdlist1">Stepper motor</dt>
<dd>
<p>Spins and can also rotate in precise relative angles, such as turning 45&#176;. Stepper motors come in two types: <em>bipolar</em> (which has four wires) and <em>unipolar</em> (which has five or six wires).</p>
</dd>
<dt class="hdlist1">DC motor</dt>
<dd>
<p>Spins either clockwise or counter-clockwise and can have the greatest speed of the three. But a DC motor can&#8217;t easily be made to turn to a given angle.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>When you know which type of motor to use, interfacing is easy. This chapter shows how to interface with each of these motors.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Motors come in many sizes and types. This chapter presents some of the more popular types and shows how they can interface easily to the Bone. If you need to turn on and off a 120 V motor, consider using something like the PowerSwitch presented in <a href="#displays_powerSwitch">Toggling a High-Voltage External Device</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The Bone has built-in 3.3 V and 5 V supplies, which can supply enough current to drive some small motors. Many motors, however, draw enough current that an external power supply is needed. Therefore, an external 5 V power supply is listed as optional in many of the recipes.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="motors_servo">Controlling a Servo Motor</h3>
<div class="sect3">
<h4 id="_problem_35">Problem</h4>
<div class="paragraph">
<p>You want to use BeagleBone to control the absolute position of a servo motor.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_35">Solution</h4>
<div class="paragraph">
<p>We&#8217;ll use the pulse width modulation (PWM) hardware of the Bone and control a
servo motor with the analogWrite() function.</p>
</div>
<div class="paragraph">
<p>To make the recipe, you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Servo motor (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
<li>
<p>Breadboard and jumper wires (see <a href="#app_proto">Prototyping Equipment</a>)</p>
</li>
<li>
<p>1 k&#8486; resistor (optional, see <a href="#app_resistor">Resistors</a>)</p>
</li>
<li>
<p>5 V power supply (optional, see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The 1 k&#8486; resistor isn&#8217;t required, but it provides some protection to the general-purpose input/output (GPIO) pin in case the servo fails and draws a large current.</p>
</div>
<div class="paragraph">
<p>Wire up your servo, as shown in <a href="#motors_servoMotor">Driving a servo motor with the 3.3 V power supply</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>There is no standard for how servo motor wires are colored. One of my servos is wired like <a href="#motors_servoMotor">Driving a servo motor with the 3.3 V power supply</a>: red is 3.3 V, black is ground, and yellow is the control line. I have another servo that has red as 3.3 V and ground is brown, with the control line being orange. Generally, though, the 3.3 V is in the middle. Check the datasheet for your servo before wiring.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="motors_servoMotor" class="paragraph">
<div class="title">Driving a servo motor with the 3.3 V power supply</div>
<p><span class="image"><img src="./04motors/figures/servoMotor_bb.png" alt="Servo Motor"></span></p>
</div>
<div class="paragraph">
<p>The code for controlling the servo motor is in <em>servoMotor.js</em>, shown in <a href="#motors_servoMotor_code">Code for driving a servo motor (servoMotor.js)</a>.</p>
</div>
<div id="motors_servoMotor_code" class="exampleblock pagebreak-before">
<div class="title">Example 23. Code for driving a servo motor (servoMotor.js)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node

// Drive a simple servo motor back and forth

var b = require('bonescript');

var motor = 'P9_21', // Pin to control servo
    freq = 50,  // Servo frequency (20 ms)
    min  = 0.8, // Smallest angle (in ms)
    max  = 2.5, // Largest angle (in ms)
    ms  = 250,  // How often to change position, in ms
    pos = 1.5,  // Current position, about middle
    step = 0.1; // Step size to next position

console.log('Hit ^C to stop');
b.pinMode(motor, b.ANALOG_OUTPUT, 6, 0, 0, doInterval);

function doInterval(x) {
    if(x.err) {
        console.log('x.err = ' + x.err);
        return;
    }
    timer = setInterval(sweep, ms);
}

move(pos);      // Start in the middle

// Sweep from min to max position and back again
function sweep() {
    pos += step;    // Take a step
    if(pos &gt; max || pos &lt; min) {
        step *= -1;
    }
    move(pos);
}

function move(pos) {
    var dutyCycle = pos/1000*freq;
    b.analogWrite(motor, dutyCycle, freq);
    console.log('pos = ' + pos + ' duty cycle = ' + dutyCycle);
}

process.on('SIGINT', function() {
    console.log('Got SIGINT, turning motor off');
    clearInterval(timer);             // Stop the timer
    b.analogWrite(motor, 0, freq);    // Turn motor off
});</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Running the code causes the motor to move back and forth, progressing to successive  positions between the two extremes.  You will need to press ^C (Ctrl-C) to stop the script.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_34">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="motors_dcSpeed">Controlling the Speed of a DC Motor</h3>
<div class="sect3">
<h4 id="_problem_36">Problem</h4>
<div class="paragraph">
<p>You have a DC motor (or a solenoid) and want a simple way to control its speed, but not the direction.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_36">Solution</h4>
<div class="paragraph">
<p>It would be nice if you could just wire the DC motor to BeagleBone Black and have it work, but it won&#8217;t.  Most motors require more current than the GPIO ports on the Bone can supply. Our solution is to use a transistor to control the current to the bone.</p>
</div>
<div class="paragraph pagebreak-before">
<p>Here&#8217;s what you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>3 V to 5 V DC motor</p>
</li>
<li>
<p>Breadboard and jumper wires (see <a href="#app_proto">Prototyping Equipment</a>)</p>
</li>
<li>
<p>1 k&#8486; resistor (see <a href="#app_resistor">Resistors</a>)</p>
</li>
<li>
<p>Transistor 2N3904 (see <a href="#app_transistor">Transistors and Diodes</a>)</p>
</li>
<li>
<p>Diode 1N4001 (see <a href="#app_transistor">Transistors and Diodes</a>)</p>
</li>
<li>
<p>Power supply for the motor (optional)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you are using a larger motor (more current), you will need to use a larger transistor.</p>
</div>
<div class="paragraph">
<p>Wire your breadboard as shown in <a href="#motors_dcMotor_fig">Wiring a DC motor to spin one direction</a>.</p>
</div>
<div id="motors_dcMotor_fig" class="paragraph">
<div class="title">Wiring a DC motor to spin one direction</div>
<p><span class="image"><img src="./04motors/figures/dcMotor_bb.png" alt="DC Motor"></span></p>
</div>
<div class="paragraph">
<p>Use the code in <a href="#motors_dcMotor_code">Driving a DC motor in one direction (dcMotor.js)</a> (<em>dcMotor.js</em>) to run the motor.</p>
</div>
<div id="motors_dcMotor_code" class="exampleblock pagebreak-before">
<div class="title">Example 24. Driving a DC motor in one direction (dcMotor.js)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node

// This is an example of driving a DC motor

var b = require('bonescript');

var motor = 'P9_16',// Pin to drive transistor
    min = 0.05,     // Slowest speed (duty cycle)
    max = 1,        // Fastest (always on)
    ms = 100,       // How often to change speed, in ms
    speed = 0.5,    // Current speed;
    step = 0.05;    // Change in speed

b.pinMode(motor, b.ANALOG_OUTPUT, 6, 0, 0, doInterval);

function doInterval(x) {
    if(x.err) {
        console.log('x.err = ' + x.err);
        return;
    }
    var timer = setInterval(sweep, ms);
}

function sweep() {
    speed += step;
    if(speed &gt; max || speed &lt; min) {
        step *= -1;
    }
    b.analogWrite(motor, speed);
    console.log('speed = ' + speed);
}

process.on('SIGINT', function() {
    console.log('Got SIGINT, turning motor off');
    clearInterval(timer);       // Stop the timer
    b.analogWrite(motor, 0);    // Turn motor off
});</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_35">Discussion</h4>

</div>
<div class="sect3">
<h4 id="_see_also_2">See Also</h4>
<div class="paragraph">
<p>How do you change the direction of the motor? See <a href="#motors_dcDirection">Controlling the Speed and Direction of a DC Motor</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="motors_dcDirection">Controlling the Speed and Direction of a DC Motor</h3>
<div class="sect3">
<h4 id="_problem_37">Problem</h4>
<div class="paragraph">
<p>You would like your DC motor to go forward and backward.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_37">Solution</h4>
<div class="paragraph">
<p>Use an H-bridge to switch the terminals on the motor so that it will run both backward and forward. We&#8217;ll use the <em>L293D</em>: a common, single-chip H-bridge.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s what you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>3 V to 5 V motor (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
<li>
<p>Breadboard and jumper wires (see <a href="#app_proto">Prototyping Equipment</a>)</p>
</li>
<li>
<p>L293D H-Bridge IC (see <a href="#app_ic">Integrated Circuits</a>)</p>
</li>
<li>
<p>Power supply for the motor (optional)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Lay out your breadboard as shown in <a href="#motors_h-bridge_fig">Driving a DC motor with an H-bridge</a>. Ensure that the L293D is positioned correctly.  There is a notch on one end that should be pointed up.</p>
</div>
<div id="motors_h-bridge_fig" class="paragraph">
<div class="title">Driving a DC motor with an H-bridge</div>
<p><span class="image"><img src="./04motors/figures/h-bridgeMotor_bb.png" alt="H-bridge Motor"></span></p>
</div>
<div class="paragraph">
<p>The code in <a href="#motors_h-bridge_code">Code for driving a DC motor with an H-bridge (h-bridgeMotor.js)</a> (<em>h-bridgeMotor.js</em>) looks much like the code for driving the DC motor with a transistor (<a href="#motors_dcMotor_code">Driving a DC motor in one direction (dcMotor.js)</a>).
The additional code specifies which direction to spin the motor.</p>
</div>
<div id="motors_h-bridge_code" class="exampleblock">
<div class="title">Example 25. Code for driving a DC motor with an H-bridge (h-bridgeMotor.js)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node

// This example uses an H-bridge to drive a DC motor in two directions

var b = require('bonescript');

var enable = 'P9_21';    // Pin to use for PWM speed control
    in1    = 'P9_15',
    in2    = 'P9_16',
    step = 0.05,    // Change in speed
    min  = 0.05,    // Min duty cycle
    max  = 1.0,     // Max duty cycle
    ms   = 100,     // Update time, in ms
    speed = min;    // Current speed;

b.pinMode(enable, b.ANALOG_OUTPUT, 6, 0, 0, doInterval);
b.pinMode(in1, b.OUTPUT);
b.pinMode(in2, b.OUTPUT);

function doInterval(x) {
    if(x.err) {
        console.log('x.err = ' + x.err);
        return;
    }
    timer = setInterval(sweep, ms);
}

clockwise();        // Start by going clockwise

function sweep() {
    speed += step;
    if(speed &gt; max || speed &lt; min) {
        step *= -1;
        step&gt;0 ? clockwise() : counterClockwise();
    }
    b.analogWrite(enable, speed);
    console.log('speed = ' + speed);
}

function clockwise() {
    b.digitalWrite(in1, b.HIGH);
    b.digitalWrite(in2, b.LOW);
}

function counterClockwise() {
    b.digitalWrite(in1, b.LOW);
    b.digitalWrite(in2, b.HIGH);
}

process.on('SIGINT', function() {
    console.log('Got SIGINT, turning motor off');
    clearInterval(timer);         // Stop the timer
    b.analogWrite(enable, 0);     // Turn motor off
});</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_36">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="_driving_a_bipolar_stepper_motor">Driving a Bipolar Stepper Motor</h3>
<div class="sect3">
<h4 id="_problem_38">Problem</h4>
<div class="paragraph">
<p>You want to drive a stepper motor that has four wires.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_38">Solution</h4>
<div class="paragraph">
<p>Use an L293D H-bridge. The bipolar stepper motor requires us to reverse the coils, so we need to use an H-bridge.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s what you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Breadboard and jumper wires (see <a href="#app_proto">Prototyping Equipment</a>)</p>
</li>
<li>
<p>3 V to 5 V bipolar stepper motor (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
<li>
<p>L293D H-Bridge IC (see <a href="#app_ic">Integrated Circuits</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Wire as shown in <a href="#motors_bipolar_fig">Bipolar stepper motor wiring</a>.</p>
</div>
<div id="motors_bipolar_fig" class="paragraph">
<div class="title">Bipolar stepper motor wiring</div>
<p><span class="image"><img src="./04motors/figures/bipolarStepperMotor_bb.png" alt="Bipolar Stepper Motor"></span></p>
</div>
<div class="paragraph">
<p>Use the code in <a href="#motors_stepperMotor_code">Driving a bipolar stepper motor (bipolarStepperMotor.js)</a> (<em>bipolarStepperMotor.js</em>) to drive the motor.</p>
</div>
<div id="motors_stepperMotor_code" class="exampleblock">
<div class="title">Example 26. Driving a bipolar stepper motor (bipolarStepperMotor.js)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">#!/usr/bin/env node
var b = require('bonescript');

// Motor is attached here
var controller = ["P9_11", "P9_13", "P9_15", "P9_17"]; 
var states = [[1,0,0,0], [0,1,0,0], [0,0,1,0], [0,0,0,1]];
var statesHiTorque = [[1,1,0,0], [0,1,1,0], [0,0,1,1], [1,0,0,1]];
var statesHalfStep = [[1,0,0,0], [1,1,0,0], [0,1,0,0], [0,1,1,0],
                      [0,0,1,0], [0,0,1,1], [0,0,0,1], [1,0,0,1]];

var curState = 0;   // Current state
var ms = 100,       // Time between steps, in ms
    max = 22,       // Number of steps to turn before turning around
    min = 0;        // Minimum step to turn back around on

var CW  =  1,       // Clockwise
    CCW = -1,
    pos = 0,        // current position and direction
    direction = CW;

// Initialize motor control pins to be OUTPUTs
var i;
for(i=0; i&lt;controller.length; i++) {
    b.pinMode(controller[i], b.OUTPUT);
}

// Put the motor into a known state
updateState(states[0]);
rotate(direction);

var timer = setInterval(move, ms);

// Rotate back and forth once
function move() {
    pos += direction;
    console.log("pos: " + pos);
    // Switch directions if at end.
    if (pos &gt;= max || pos &lt;= min) {
        direction *= -1;
    }
    rotate(direction);
}

// This is the general rotate
function rotate(direction) {
	// console.log("rotate(%d)", direction);
    // Rotate the state acording to the direction of rotation
	curState +=  direction;
	if(curState &gt;= states.length) {
	    curState = 0;
	} else if(curState&lt;0) {
		    curState = states.length-1;
	}
	updateState(states[curState]);
}

// Write the current input state to the controller
function updateState(state) {
    console.log("state: " + state);
	for (i=0; i&lt;controller.length; i++) {
		b.digitalWrite(controller[i], state[i]);
	}
}

process.on('exit', function() {
    updateState([0,0,0,0]);    // Turn motor off
});</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When you run the code, the stepper motor will rotate back and forth.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_37">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="_driving_a_unipolar_stepper_motor">Driving a Unipolar Stepper Motor</h3>
<div class="sect3">
<h4 id="_problem_39">Problem</h4>
<div class="paragraph">
<p>You want to drive a stepper motor that has five or six wires.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_39">Solution</h4>
<div class="paragraph">
<p>If your stepper motor has five or six wires, it&#8217;s a <em>unipolar</em> stepper and is wired differently than the bipolar. Here, we&#8217;ll use a <em>ULN2003 Darlington Transistor Array IC</em> to drive the motor.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s what you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Breadboard and jumper wires (see <a href="#app_proto">Prototyping Equipment</a>)</p>
</li>
<li>
<p>3 V to 5 V unipolar stepper motor (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
<li>
<p>ULN2003 Darlington Transistor Array IC (see <a href="#app_ic">Integrated Circuits</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Wire, as shown in <a href="#motors_unipolar_fig">Unipolar stepper motor wiring</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The IC in <a href="#motors_unipolar_fig">Unipolar stepper motor wiring</a> is illustrated upside down from the way it is usually displayed.
That is, the notch for pin 1 is on the bottom. This made drawing the diagram much cleaner.</p>
</div>
<div class="paragraph">
<p>Also, notice the <em>banded</em> wire running the P9_7 (5 V) to the UL2003A.
The stepper motor I&#8217;m using runs better at 5 V, so I&#8217;m using the Bone&#8217;s 5 V power supply. The signal coming from the GPIO pins is 3.3 V, but the U2003A will step them up to 5 V to drive the motor.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="motors_unipolar_fig" class="paragraph">
<div class="title">Unipolar stepper motor wiring</div>
<p><span class="image"><img src="./04motors/figures/unipolarStepperMotor_bb.png" alt="Unipolar Stepper Motor"></span></p>
</div>
<div class="paragraph">
<p>The code for driving the motor is in <em>unipolarStepperMotor.js</em>; however, it is almost identical to the bipolar stepper code (<a href="#motors_stepperMotor_code">Driving a bipolar stepper motor (bipolarStepperMotor.js)</a>), so <a href="#motors_unistepperMotor_code">Changes to bipolar code to drive a unipolar stepper motor (unipolarStepperMotor.diff)</a> shows only the lines that you need to change.</p>
</div>
<div id="motors_unistepperMotor_code" class="exampleblock">
<div class="title">Example 27. Changes to bipolar code to drive a unipolar stepper motor (unipolarStepperMotor.diff)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">var controller = ["P9_11", "P9_13", "P9_15", "P9_17"];
var states = [[1,1,0,0], [0,1,1,0], [0,0,1,1], [1,0,0,1]];
var curState = 0;   // Current state
var ms = 100,       // Time between steps, in ms
    max = 22,       // Number of steps to turn before turning around</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph pagebreak-before">
<p>The code in this example makes the following changes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>controller is attached to the <em>even</em>-numbered pins on the P9 header rather than the <em>odd</em> that the bipolar stepper used. (Doing this allows you to run both types of stepper motors at the same time!)</p>
</li>
<li>
<p>The states are different. Here, we have two pins high at a time.</p>
</li>
<li>
<p>The time between steps (ms) is shorter, and the number of steps per direction (max) is bigger. The unipolar stepper I&#8217;m using has many more steps per rotation, so I need more steps to make it go around.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_38">Discussion</h4>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tips">Beyond the Basics</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_5">Introduction</h3>
<div class="paragraph">
<p>In <a href="#basics">Basics</a>, you learned how to set up BeagleBone Black, and <a href="#sensors">Sensors</a>, <a href="#displays">Displays and Other Outputs</a>, and <a href="#motors">Motors</a> showed how to interface to the physical world. <a href="#networking">Internet of Things</a> through the remainder of the book moves into some more exciting advanced topics, and this chapter gets you ready for them.</p>
</div>
<div class="paragraph">
<p>The recipes in this chapter assume that you are running Linux on your host computer (<a href="#tips_pick_os">Selecting an OS for Your Development Host Computer</a>) and are comfortable with using Linux. We continue to assume that you are logged in as root on your Bone.</p>
</div>
</div>
<div class="sect2">
<h3 id="tips_hdmi">Running Your Bone Standalone</h3>
<div class="sect3">
<h4 id="_problem_40">Problem</h4>
<div class="paragraph">
<p>You want to use BeagleBone Black as a desktop computer with keyboard, mouse, and an HDMI display.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_40">Solution</h4>
<div class="paragraph">
<p>The Bone comes with USB and a microHDMI output. All you need to do is connect your keyboard, mouse, and HDMI display to it.</p>
</div>
<div class="paragraph">
<p>To make this recipe, you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Standard HDMI cable and female HDMI-to-male microHDMI adapter (see <a href="#app_misc">Miscellaneous</a>), or</p>
</li>
<li>
<p>MicroHDMI-to-HDMI adapter cable (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
<li>
<p>HDMI monitor (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
<li>
<p>USB keyboard and mouse</p>
</li>
<li>
<p>Powered USB hub (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The microHDMI adapter is nice because it allows you to use a regular HDMI cable with the Bone. However, it will block other ports and can damage the Bone if you aren&#8217;t careful. The microHDMI-to-HDMI cable won&#8217;t have these problems.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can also use an HDMI-to-DVI cable (<a href="#app_misc">Miscellaneous</a>) and use your Bone with a DVI-D display.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The adapter looks something like <a href="#tips_HDMI_adaptor_fig">Female HDMI-to-male microHDMI adapter</a>.</p>
</div>
<div id="tips_HDMI_adaptor_fig" class="imageblock">
<div class="content">
<img src="./05tips/figures/hdmiConverter.jpg" alt="HDMI Adaptor">
</div>
<div class="title">Figure 46. Female HDMI-to-male microHDMI adapter</div>
</div>
<div class="paragraph">
<p>Plug the small end into the microHDMI input on the Bone and plug your HDMI cable into the other end of the adapter and your monitor. If nothing displays on your Bone, reboot.</p>
</div>
<div class="paragraph">
<p>If nothing appears after the reboot, edit the <em>/boot/uEnv.txt</em> file. Search for the line containing ##Disable HDMI and add the following lines after it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">##Disable HDMI
#cape_disable=capemgr.disable_partno=BB-BONELT-HDMI,BB-BONELT-HDMIN
cape_disable=capemgr.disable_partno=BB-BONELT-HDMI</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then reboot.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <em>/boot/uEnv.txt</em> file contains a number of configuration commands that are executed at boot time. The &amp;#35; character is used to add comments; that is, everything to the right of a &amp;#35; is ignored by the Bone and is assumed to be for humans to read. In the previous example, &amp;#35;&amp;#35;Disable HDMI is a comment that informs us the next line(s) are for disabling the HDMI. Two cape.disable commands follow. The first one is commented-out and won&#8217;t be executed by the Bone.</p>
</div>
<div class="paragraph">
<p>Why not just remove the first cape.disable?  Later, you might decide you need more general-purpose input/output (GPIO) pins and don&#8217;t need the HDMI display. If so, just remove the # from for first cape.disble. If you had completely removed the line earlier, you would have to look up the details somewhere to re-create it.</p>
</div>
<div class="paragraph">
<p>When in doubt, comment-out; don&#8217;t delete.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you want to re-enable the HDMI audio, just comment-out the line you added.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Bone has only one USB port, so you will need to get either a keyboard with a USB hub (see <a href="#app_misc">Miscellaneous</a>) or a powered USB hub. Plug the USB hub into the Bone and then plug your keyboard and mouse in to the hub. You now have a Beagle workstation; no host computer is needed.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>The powered hub is recommended because USB can supply only 500 mA, and you&#8217;ll want to plug many things into the Bone.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_39">Discussion</h4>
<div class="paragraph">
<p>This recipe disables the HDMI audio, which allows the Bone to try other resolutions. If this fails, see <a href="http://bit.ly/1GEPcOH">BeagleBoneBlack HDMI</a> for how to force the Bone&#8217;s resolution to match your monitor.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tips_pick_os">Selecting an OS for Your Development Host Computer</h3>
<div class="sect3">
<h4 id="_problem_41">Problem</h4>
<div class="paragraph">
<p>Your project needs a host computer, and you need to select an operating system (OS) for it.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_41">Solution</h4>
<div class="paragraph">
<p>For projects that require a host computer, we assume that you are running <a href="http://bit.ly/1wXOwkw">Linux Ubuntu 14.04 LTS</a>. You can be running either a native installation, via a virtual machine such as <a href="https://www.virtualbox.org/">VirtualBox</a>, or in the cloud (<a href="http://bit.ly/1wu04LI">Microsoft Azure</a> or <a href="http://aws.amazon.com/ec2/">Amazon Elastic Compute Cloud</a> [EC2], for example).</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_40">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="tips_shell">Getting to the Command Shell via SSH</h3>
<div class="sect3">
<h4 id="_problem_42">Problem</h4>
<div class="paragraph">
<p>You want to connect to the command shell of a remote Bone from your host <span class="keep-together">computer</span>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_42">Solution</h4>
<div class="paragraph">
<p><a href="#basics_cloud9_IDE">Running JavaScript Applications from the Cloud9 IDE</a> shows how to run shell commands in the Cloud9 bash tab. However, the Bone has Secure Shell (SSH) enabled right out of the box, so you can easily connect by using the following command to log in as superuser root, (note the # at the end of the prompt):</p>
</div>
<pre data-type="programlisting">
host$ <strong>ssh root@192.168.7.2</strong>
Warning: Permanently added 'bone,192.168.7.2' (ECDSA) to the list of known hosts.
Last login: Mon Dec 22 07:53:06 2014 from yoder-linux.local
bone#
</pre>
<div class="paragraph">
<p>Or you could log in as a normal user, debian (note the $ at the end of the prompt):</p>
</div>
<pre data-type="programlisting">
host$ <strong>ssh debian@192.168.7.2</strong>
Warning: Permanently added 'bone,192.168.7.2' (ECDSA) to the list of known hosts.
debian@bone's password:
Last login: Fri Dec  5 07:57:06 2014 from 192.168.7.1
bone$
</pre>
<div class="paragraph">
<p>root has no password. It&#8217;s best to change both passwords:</p>
</div>
<pre data-type="programlisting">
bone$ <strong>passwd</strong>
Changing password for debian.
(current) UNIX password:
Enter new UNIX password:
Retype new UNIX password:
passwd: password updated successfully
</pre>
</div>
<div class="sect3">
<h4 id="_discussion_41">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="tips_serial">Getting to the Command Shell via the Virtual Serial Port</h3>
<div class="sect3">
<h4 id="_problem_43">Problem</h4>
<div class="paragraph">
<p>You want to connect to the command shell of a remote Bone from your host computer without using SSH.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_43">Solution</h4>
<div class="paragraph">
<p>Sometimes, you can&#8217;t connect to the Bone via SSH, but you have a network working over USB to the Bone. There is a way to access the command line to fix things without requiring extra hardware. (<a href="#tips_FTDI">Viewing and Debugging the Kernel and u-boot Messages at Boot Time</a> shows a way that works even if you don&#8217;t have a network working over USB, but it requires a special serial-to-USB cable.)</p>
</div>
<div class="paragraph">
<p>First, check to ensure that the serial port is there. On the host computer, run the following command:</p>
</div>
<pre data-type="programlisting">
host$ <strong>ls -ls /dev/ttyACM0</strong>
0 crw-rw---- 1 root dialout 166, 0 Jun 19 11:47 /dev/ttyACM0
</pre>
<div class="paragraph">
<p><em>/dev/ttyACM0</em> is a serial port on your host computer that the Bone creates when it boots up.
The letters crw-rw---- show that you can&#8217;t access it as a normal user. However, you <em>can</em> access it if you are part of dialout group. Just add yourself to the group:</p>
</div>
<pre data-type="programlisting">
host$ sudo adduser $USER dialout
</pre>
<div class="paragraph">
<p>You have to run adduser only once. Your host computer will remember the next time you boot up. Now, install and run the screen command:</p>
</div>
<pre data-type="programlisting">
host$ <strong>sudo apt-get install screen</strong>
host$ <strong>screen /dev/ttyACM0 115200</strong>
Debian GNU/Linux 7 beaglebone ttyGS0

default username:password is [debian:temppwd]

Support/FAQ: http://elinux.org/Beagleboard:BeagleBoneBlack_Debian

The IP Address for usb0 is: 192.168.7.2
beaglebone login:
</pre>
<div class="paragraph">
<p>The /dev/ttyACM0 parameter specifies which serial port to connect to, and 115200
tells the speed of the connection. In this case, it&#8217;s 115,200 bits per second.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_42">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="tips_FTDI">Viewing and Debugging the Kernel and u-boot Messages at Boot Time</h3>
<div class="sect3">
<h4 id="_problem_44">Problem</h4>
<div class="paragraph">
<p>You want to see the messages that are logged by BeagleBone Black come to life.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_44">Solution</h4>
<div class="paragraph">
<p>There is no network in place when the Bone first boots up, so <a href="#tips_shell">Getting to the Command Shell via SSH</a> and <a href="#tips_serial">Getting to the Command Shell via the Virtual Serial Port</a> won&#8217;t work. This recipe uses some extra hardware (FTDI cable) to attach to the Bone&#8217;s console serial port.</p>
</div>
<div class="paragraph">
<p>To make this recipe, you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>3.3 V FTDI cable (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Be sure to get a 3.3 V FTDI cable (shown in <a href="#tips_FTDIcable_fig">FTDI cable</a>), because the 5 V cables won&#8217;t work.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>The Bone&#8217;s Serial Debug J1 connector has Pin 1 connected to ground, Pin 4 to receive, and Pin 5 to transmit. The other pins are not attached.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="tips_FTDIcable_fig" class="imageblock">
<div class="content">
<img src="./05tips/figures/FTDIcable.jpg" alt="FTDI Cable">
</div>
<div class="title">Figure 47. FTDI cable</div>
</div>
<div class="paragraph">
<p>Look for a small triangle at the end of the FTDI cable (<a href="#tips_FTDIconnector_fig">FTDI connector</a>).  It&#8217;s often connected to the black wire.</p>
</div>
<div id="tips_FTDIconnector_fig" class="imageblock">
<div class="content">
<img src="./05tips/figures/FTDIconnector.jpg" alt="FTDI Connector">
</div>
<div class="title">Figure 48. FTDI connector</div>
</div>
<div class="paragraph">
<p>Next, look for the FTDI pins of the Bone (labeled J1 on the Bone), shown in <a href="#tips_black_hardware_details_fig">FTDI pins for the FTDI connector <sup class="footnote">[3]</sup></a>.
They are next to the P9 header and begin near pin 20. There is a white dot near P9_20.</p>
</div>
<div id="tips_black_hardware_details_fig" class="imageblock">
<div class="content">
<img src="./05tips/figures/FTDIPins.png" alt="Serial Debug Pins">
</div>
<div class="title">Figure 49. FTDI pins for the FTDI connector <sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup></div>
</div>
<div class="paragraph">
<p>Plug the FTDI connector into the FTDI pins, being sure to connect the <em>triangle</em> pin on the connector to the <em>white dot</em> pin of the FTDI connector.</p>
</div>
<div class="paragraph">
<p>Now, run the following commands on your host computer:</p>
</div>
<pre data-type="programlisting">
host$ <strong>ls -ls /dev/ttyUSB0 </strong>
0 crw-rw---- 1 root dialout 188, 0 Jun 19 12:43 /dev/ttyUSB0
host$ <strong>sudo adduser $USER dialout</strong>
host$ <strong>screen /dev/ttyUSB0 115200</strong>
Debian GNU/Linux 7 beaglebone ttyO0

default username:password is [debian:temppwd]

Support/FAQ: http://elinux.org/Beagleboard:BeagleBoneBlack_Debian

The IP Address for usb0 is: 192.168.7.2
beaglebone login:
</pre>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Your screen might initially be black. Press Enter a couple times to see the login prompt.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_43">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="_verifying_you_have_the_latest_version_of_the_os_on_your_bone_from_the_shell">Verifying You Have the Latest Version of the OS on Your Bone from the Shell</h3>
<div class="sect3">
<h4 id="_problem_45">Problem</h4>
<div class="paragraph">
<p>You are logged in to your Bone with a command prompt and want to know what version of the OS you are running.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_45">Solution</h4>
<div class="paragraph">
<p>Log in to your Bone and enter the following command:</p>
</div>
<pre data-type="programlisting">
bone# <strong>cat /etc/dogtag</strong>
BeagleBoard.org BeagleBone Debian Image 2014-11-11
</pre>
</div>
<div class="sect3">
<h4 id="_discussion_44">Discussion</h4>
<div class="paragraph">
<p><a href="#basics_latest_os">Verifying You Have the Latest Version of the OS on Your Bone</a> shows how to open the <em>ID.txt</em> file to see the OS version. The <em>/etc/dogtag</em> file has the same contents and is easier to find if you already have a command prompt. See <a href="#basics_install_os">Running the Latest Version of the OS on Your Bone</a> if you need to update your OS.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_controlling_the_bone_remotely_with_vnc">Controlling the Bone Remotely with VNC</h3>
<div class="sect3">
<h4 id="_problem_46">Problem</h4>
<div class="paragraph">
<p>You want to access the BeagleBone&#8217;s graphical desktop from your host computer.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_46">Solution</h4>
<div class="paragraph">
<p>Run the installed Virtual Network Computing (VNC) server:</p>
</div>
<pre data-type="programlisting">
bone# <strong>sudo -u debian tightvncserver</strong>

You will require a password to access your desktops.

Password:
Verify:
Would you like to enter a view-only password (y/n)? n
xauth: (argv):1:  bad display name "beaglebone:1" in "add" command

New 'X' desktop is beaglebone:1

Creating default startup script /root/.vnc/xstartup
Starting applications specified in /root/.vnc/xstartup
Log file is /root/.vnc/beaglebone:1.log
</pre>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This solution assumes that you are logged in to the Bone as root. If you just started tightvncserver without sudo, the VNC would be running as root, which could cause some problems, because some programs (such as the Chrome web browser) won&#8217;t run as root. This example uses sudo to run tightvncserver as debian.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To connect to the Bone, you will need to run a VNC client. There are many to choose from. Remmina Remote Desktop Client is already installed on Ubuntu. Start and select the new remote desktop file button (<a href="#tips_vnc1_fig">Creating a new remote desktop file in Remmina Remote Desktop Client</a>).</p>
</div>
<div id="tips_vnc1_fig" class="imageblock">
<div class="content">
<img src="./05tips/figures/vnc1.png" alt="Create a new remote desktop">
</div>
<div class="title">Figure 50. Creating a new remote desktop file in Remmina Remote Desktop Client</div>
</div>
<div class="paragraph">
<p>Give your connection a name, being sure to select "VNC - Virtual Network Computing." Also, be sure to add :1 after the server address, as shown in <a href="#tips_vnc2_fig">Configuring the Remmina Remote Desktop Client</a>. This should match the :1 that was displayed when you started vncserver.</p>
</div>
<div id="tips_vnc2_fig" class="imageblock">
<div class="content">
<img src="./05tips/figures/vnc2.png" alt="Configuring">
</div>
<div class="title">Figure 51. Configuring the Remmina Remote Desktop Client</div>
</div>
<div class="paragraph">
<p>Click Connect to start graphical access to your Bone, as shown in <a href="#tips_vnc3_fig">The Remmina Remote Desktop Client showing the BeagleBone desktop</a>.</p>
</div>
<div id="tips_vnc3_fig" class="imageblock">
<div class="content">
<img src="./05tips/figures/vnc3.png" alt="Desktop">
</div>
<div class="title">Figure 52. The Remmina Remote Desktop Client showing the BeagleBone desktop</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You might need to resize the VNC screen on your host to see the bottom menu bar on your Bone.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_45">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="_learning_typical_gnulinux_commands">Learning Typical GNU/Linux Commands</h3>
<div class="sect3">
<h4 id="_problem_47">Problem</h4>
<div class="paragraph">
<p>There are many powerful commands to use in Linux. How do you learn about them?</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_47">Solution</h4>
<div class="paragraph">
<p><a href="#tips_linux_commands">Common Linux commands</a> lists many common Linux commands.</p>
</div>
<table id="tips_linux_commands" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Common Linux commands</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pwd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">show current directory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">change current directory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ls</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">list directory contents</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">chmod</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">change file permissions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">chown</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">change file ownership</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">copy files</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mv</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">move files</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">remove files</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mkdir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">make directory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rmdir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">remove directory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dump file contents</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">less</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">progressively dump file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">vi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">edit file (complex)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nano</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">edit file (simple)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">head</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trim dump to top</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trim dump to bottom</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">echo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">print/dump value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">env</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dump environment variables</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">export</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set environment variable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">history</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dump command history</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">grep</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">search dump for strings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">man</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get help on command</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apropos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">show list of man pages</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">find</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">search for files</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">create/extract file archives</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gzip</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">compress a file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gunzip</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">decompress a file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">du</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">show disk usage</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">df</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">show disk free space</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mount</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mount disks</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tee</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write dump to file in parallel</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hexdump</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">readable binary dumps</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">whereis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">locates binary and source files</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_discussion_46">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="tips_editing_files">Editing a Text File from the GNU/Linux Command Shell</h3>
<div class="sect3">
<h4 id="_problem_48">Problem</h4>
<div class="paragraph">
<p>You want to run an editor to change a file.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_48">Solution</h4>
<div class="paragraph">
<p>The Bone comes with a number of editors. The simplest to learn is nano. Just enter the following command:</p>
</div>
<pre data-type="programlisting">
bone# <strong>nano file</strong>
</pre>
<div class="paragraph">
<p>You are now in nano (<a href="#tips_nano_fig">Editing a file with nano</a>). You can&#8217;t move around the screen using the mouse, so use the arrow keys. The bottom two lines of the screen list some useful commands. Pressing &#708;G (Ctrl-G) will display more useful commands. &#708;X (Ctrl-X) exits nano and gives you the option of saving the file.</p>
</div>
<div id="tips_nano_fig" class="imageblock">
<div class="content">
<img src="./05tips/figures/nano.png" alt="nano">
</div>
<div class="title">Figure 53. Editing a file with nano</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>By default, the file you create will be saved in the directory from which you opened nano.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_47">Discussion</h4>
<div class="paragraph">
<p>Many other text editors will run on the Bone. vi, vim, emacs, and  even eclipse are all supported. See <a href="#tips_apt-get">Installing Additional Packages from the Debian Package Feed</a> to learn if your favorite is one of them.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_a_graphical_editor">Using a Graphical Editor</h3>
<div class="sect3">
<h4 id="_problem_49">Problem</h4>
<div class="paragraph">
<p>You want to use a graphical (rather than text-based) editor to edit a text file.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_49">Solution</h4>
<div class="paragraph">
<p>leafpad is a simple graphics-based editor that&#8217;s already installed on your Bone. You can use it if your host computer supports X-Windows (Mac and Linux). Just run the following commands to open a new file to begin editing in leafpad (<a href="#tips_leafpad_fig">Editing a file with leafpad</a>):</p>
</div>
<pre data-type="programlisting">
host$ <strong>ssh -X root@192.168.7.2</strong>
bone# <strong>leafpad file.txt</strong>
</pre>
<div class="paragraph">
<p>Notice the -X on the ssh command. This instructs SSH to pass the graphics from the Bone to the host computer.</p>
</div>
<div id="tips_leafpad_fig" class="imageblock">
<div class="content">
<img src="./05tips/figures/leafpad.png" alt="leafpad">
</div>
<div class="title">Figure 54. Editing a file with leafpad</div>
</div>
<div class="paragraph">
<p>Now, you can use your mouse to move around and copy and paste as usual.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="networking_wired">Establishing an Ethernet-Based Internet Connection</h3>
<div class="sect3">
<h4 id="_problem_50">Problem</h4>
<div class="paragraph">
<p>You want to connect your Bone to the Internet using the wired network connection.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_50">Solution</h4>
<div class="paragraph">
<p>Plug one end of an Ethernet patch cable into the RJ45 connector on the Bone (see <a href="#networking_rj45">The RJ45 port on the Bone</a>) and the other end into your home hub/router. The yellow and green link lights on both ends should begin to flash.</p>
</div>
<div id="networking_rj45" class="imageblock">
<div class="content">
<img src="./05tips/figures/internLED.png" alt="RJ45">
</div>
<div class="title">Figure 55. The RJ45 port on the Bone</div>
</div>
<div class="paragraph">
<p>If your router is already configured to run DHCP (Dynamical Host Configuration Protocol), it will automatically assign an IP address to the Bone.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>It might take a minute or two for your router to detect the Bone and assign the IP address.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To find the IP address, open a terminal window and run the ifconfig command:</p>
</div>
<pre data-type="programlisting">
bone# ifconfig
eth0      Link encap:Ethernet  HWaddr c8:a0:30:b7:f9:6f
          inet addr:137.112.41.36  Bcast:137.112.41.255  Mask:255.255.255.0
          inet6 addr: fe80::caa0:30ff:feb7:f96f/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:238 errors:0 dropped:53 overruns:0 frame:0
          TX packets:20 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:25341 (24.7 KiB)  TX bytes:4339 (4.2 KiB)
          Interrupt:40

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:1517 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1517 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:2542320 (2.4 MiB)  TX bytes:2542320 (2.4 MiB)

usb0      Link encap:Ethernet  HWaddr aa:26:91:0e:a6:17
          inet addr:192.168.7.2  Bcast:192.168.7.3  Mask:255.255.255.252
          inet6 addr: fe80::a826:91ff:fe0e:a617/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:8672 errors:0 dropped:0 overruns:0 frame:0
          TX packets:5069 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:7474185 (7.1 MiB)  TX bytes:3262782 (3.1 MiB)
</pre>
<div class="paragraph">
<p>My Bone is connected to the Internet in two ways: via the RJ45 connection (eth0) and via the USB cable (usb0). The inet addr field shows that my Internet address is 137.112.41.36 for the RJ45 connector.</p>
</div>
<div class="paragraph">
<p>On my university campus, you must register your MAC address before any device will work on the network. The HWaddr field gives the MAC address. For eth0, it&#8217;s c8:a0:30:b7:f9:6f.</p>
</div>
<div class="paragraph">
<p>The IP address of your Bone can change. If it&#8217;s been assigned by DHCP, it can change at any time. The MAC address, however, never changes;  it is assigned to your ethernet device when it&#8217;s manufactured.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>When a Bone is connected to some networks (in my case, the campus network),
it becomes visible to the <em>world</em>. If you don&#8217;t secure your Bone, the world will soon find it. See <a href="#tips_passwords">[tips_passwords]</a> and <a href="#tips_firewall">Setting Up a Firewall</a>.</p>
</div>
<div class="paragraph">
<p>On many home networks, you will be behind a firewall and won&#8217;t be as visible.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_48">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="networking_wireless">Establishing a WiFi-Based Internet Connection</h3>
<div class="sect3">
<h4 id="_problem_51">Problem</h4>
<div class="paragraph">
<p>You want BeagleBone Black to talk to the Internet using a USB wireless adapter.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_51">Solution</h4>
<div class="paragraph">
<p>Several WiFi adapters work with the Bone. Check <a href="http://bit.ly/1EbEwUo">WiFi Adapters</a> for the latest list.</p>
</div>
<div class="paragraph">
<p>To make this recipe, you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>USB Wifi adapter (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
<li>
<p>5 V external power supply (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Most adapters need at least 1 A of current to run, and USB supplies only 0.5 A, so be sure to use an external power supply. Otherwise, you will experience erratic behavior and random crashes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>First, plug in the WiFi adapter and the 5 V external power supply and reboot.</p>
</div>
<div class="paragraph">
<p>Then run lsusb to ensure that your Bone found the adapter:</p>
</div>
<pre data-type="programlisting">
bone# <strong>lsusb</strong>
Bus 001 Device 002: ID 0bda:8176 Realtek Semiconductor Corp. RTL8188CUS 802.11n
WLAN Adapter
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
</pre>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>There is a well-known bug in the Bone&#8217;s 3.8 kernel series that prevents USB devices from being discovered when hot-plugged, which is why you should reboot. Newer kernels should address this issue.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next, run iwconfig to find your adapter&#8217;s name.  Mine is called wlan0, but you might see other other names, such as ra0.</p>
</div>
<pre data-type="programlisting">
bone# <strong>iwconfig</strong>
wlan0     unassociated  Nickname:"WIFI@REALTEK"
          Mode:Auto  Frequency=2.412 GHz  Access Point: Not-Associated
          Sensitivity:0/0
          Retry:off   RTS thr:off   Fragment thr:off
          Encryption key:off
          Power Management:off
          Link Quality=0/100  Signal level=0 dBm  Noise level=0 dBm
          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0
          Tx excessive retries:0  Invalid misc:0   Missed beacon:0

lo        no wireless extensions.

eth0      no wireless extensions.

usb0      no wireless extensions.

</pre>
<div class="paragraph">
<p>If no name appears, try ifconfig -a:</p>
</div>
<pre data-type="programlisting">
bone# <strong>ifconfig -a</strong>
...
usb0      Link encap:Ethernet  HWaddr 92:84:3f:a2:12:0f
          inet addr:192.168.7.2  Bcast:192.168.7.3  Mask:255.255.255.252
          inet6 addr: fe80::9084:3fff:fea2:120f/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:5789 errors:0 dropped:0 overruns:0 frame:0
          TX packets:5158 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:6401357 (6.1 MiB)  TX bytes:842982 (823.2 KiB)

wlan0     Link encap:Ethernet  HWaddr 00:13:ef:d0:27:04
          UP BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

</pre>
<div class="paragraph">
<p>When you find the WiFi device name (mine is wlan0), remember it for later.</p>
</div>
<div class="paragraph">
<p>Run wicd-curses to display the wireless networks your WiFi device is seeing:</p>
</div>
<pre data-type="programlisting">
bone# <strong>wicd-curses</strong>
</pre>
<div class="paragraph">
<p>In <a href="#tips_wicd_opening_view_fig">Using wicd to display available wireless networks</a>, you see one wireless network, my home wireless.</p>
</div>
<div id="tips_wicd_opening_view_fig" class="imageblock">
<div class="content">
<img src="./05tips/figures/wicd.png" alt="wicd opening view">
</div>
<div class="title">Figure 56. Using wicd to display available wireless networks</div>
</div>
<div class="paragraph">
<p>If nothing appears, press P and make sure the Wireless Interface matches the device name you noted from ifconfig. If it doesn&#8217;t match, press the down arrow and enter the device name, as shown in <a href="#tips_wicd_prefs_fig">Setting preferences in wicd</a>.</p>
</div>
<div id="tips_wicd_prefs_fig" class="imageblock">
<div class="content">
<img src="./05tips/figures/wicdPrefs.png" alt="Setting preferences in wicd">
</div>
<div class="title">Figure 57. Setting preferences in wicd</div>
</div>
<div class="paragraph">
<p>After you enter a name, press F10 to save and then press R to refresh the list. You&#8217;ll now see the available access points.</p>
</div>
<div class="paragraph">
<p>Use the down arrow to select which network to use and then press the right arrow  to configure it, as shown in <a href="#tips_wicd_config_fig">Configuring a network in wicd</a>.</p>
</div>
<div id="tips_wicd_config_fig" class="imageblock">
<div class="content">
<img src="./05tips/figures/wicdConfig.png" alt="Configuring a network in wicd">
</div>
<div class="title">Figure 58. Configuring a network in wicd</div>
</div>
<div class="paragraph">
<p>Press the down arrow until you are near the bottom of the screen and then press Enter. Use the up/down arrows to select the type of authentication (as shown in <a href="#tips_wicd_auth_fig">Configuring authentication in wicd</a>) and then press Enter. My home system uses WPA 1/2 (Passphrase) (<a href="#tips_wicd_password_fig">Entering password in wicd</a>).</p>
</div>
<div id="tips_wicd_auth_fig" class="imageblock">
<div class="content">
<img src="./05tips/figures/wicdSecure.png" alt="Configuring authentication in wicd">
</div>
<div class="title">Figure 59. Configuring authentication in wicd</div>
</div>
<div id="tips_wicd_password_fig" class="imageblock">
<div class="content">
<img src="./05tips/figures/wicdPassword.png" alt="Entering password in wicd">
</div>
<div class="title">Figure 60. Entering password in wicd</div>
</div>
<div class="paragraph">
<p>Press F10 and select the network again; then press C to connect. You&#8217;ll be connected in a moment, as shown in <a href="#tips_wicd_connected_fig">Connected to a network via wicd</a>.</p>
</div>
<div id="tips_wicd_connected_fig" class="imageblock">
<div class="content">
<img src="./05tips/figures/wicdConnected.png" alt="Connected to a network via wicd">
</div>
<div class="title">Figure 61. Connected to a network via wicd</div>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_49">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="networking_usb">Sharing the Host&#8217;s Internet Connection over USB</h3>
<div class="sect3">
<h4 id="_problem_52">Problem</h4>
<div class="paragraph">
<p>Your host computer is connected to the Bone via the USB cable, and you want to run the network between the two.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_52">Solution</h4>
<div class="paragraph">
<p><a href="#networking_wired">Establishing an Ethernet-Based Internet Connection</a> shows how to connect BeagleBone Black to the Internet via the RJ45 Ethernet connector.  This recipe shows a way to connect without using the RJ45 <span class="keep-together">connector</span>.</p>
</div>
<div class="paragraph">
<p>A network is automatically running between the Bone and the host computer at boot time using the USB. The host&#8217;s IP address is 192.168.7.1 and the Bone&#8217;s is 192.168.7.2.  Although your Bone is talking to your host, it can&#8217;t reach the Internet in general, nor can the Internet reach it. On one hand, this is good, because those who are up to no good can&#8217;t access your Bone. On the other hand, your Bone can&#8217;t reach the rest of the world.</p>
</div>
<div class="sect4">
<h5 id="_letting_your_bone_see_the_world_setting_up_ip_masquerading">Letting your bone see the world: setting up IP masquerading</h5>
<div class="paragraph">
<p>You need to set up IP masquerading on your host and configure your Bone to use it. Here is a solution that works with a host computer running Linux. Add the code in <a href="#tips_ipmasq_code">Code for IP Masquerading (ipMasquerade.sh)</a> to a file called <em>ipMasquerade.sh</em> on your host computer.</p>
</div>
<div id="tips_ipmasq_code" class="exampleblock">
<div class="title">Example 28. Code for IP Masquerading (ipMasquerade.sh)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/bin/bash
# These are the commands to run on the host to set up IP 
#  masquerading so the Bone can access the Internet through 
#  the USB connection.
# This configures the host, run ./setDNS.sh to configure the Bone.
# Inspired by http://thoughtshubham.blogspot.com/2010/03/
#  internet-over-usb-otg-on-beagleboard.html

if [ $# -eq 0 ] ; then
echo "Usage: $0 interface (such as eth0 or wlan0)"
exit 1
fi

interface=$1
hostAddr=192.168.7.1
beagleAddr=192.168.7.2
ip_forward=/proc/sys/net/ipv4/ip_forward

if [ `cat $ip_forward` == 0 ]
  then
    echo "You need to set IP forwarding. Edit /etc/sysctl.conf using:"
    echo "$ sudo nano /etc/sysctl.conf"
    echo "and uncomment the line   \"net.ipv4.ip_forward=1\""
    echo "to enable forwarding of packets. Then run the following:"
    echo "$ sudo sysctl -p"
    exit 1
  else
    echo "IP forwarding is set on host."
fi
# Set up IP masquerading on the host so the bone can reach the outside world
sudo iptables -t nat -A POSTROUTING -s $beagleAddr -o $interface -j MASQUERADE</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Then, on your host, run the following commands:</p>
</div>
<pre data-type="programlisting">
host$ <strong>chmod +x ipMasquerade.sh</strong>
host$ <strong>./ipMasquerade.sh eth0</strong>
</pre>
<div class="paragraph">
<p>This will direct your host to take requests from the Bone and send them to eth0. If your host is using a wireless connection, change eth0 to wlan0.</p>
</div>
<div class="paragraph">
<p>Now let&#8217;s set up your host to instruct the Bone what to do. Add the code in <a href="#tips_setDNS">Code for setting the DNS on the Bone (setDNS.sh)</a> to <em>setDNS.sh</em> on your host computer.</p>
</div>
<div id="tips_setDNS" class="exampleblock">
<div class="title">Example 29. Code for setting the DNS on the Bone (setDNS.sh)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/bin/bash
# These are the commands to run on the host so the Bone
#  can access the Internet through the USB connection.
# Run ./ipMasquerade.sh the first time. It will set up the host.
# Run this script if the host is already set up.

hostAddr=192.168.7.1
beagleAddr=192.168.7.2

# Save the /etc/resolv.conf on the Bone in case we mess things up.
ssh root@$beagleAddr "mv -n /etc/resolv.conf /etc/resolv.conf.orig"
# Create our own resolv.conf
cat - &lt;&lt; EOF &gt; /tmp/resolv.conf
# This is installed by host.setDNS.sh on the host

EOF

# Look up the nameserver of the host and add it to our resolv.conf
nmcli dev list | grep IP4.DNS | sed 's/IP4.DNS\[.\]:/nameserver/' &gt;&gt; /tmp/resolv.conf
scp /tmp/resolv.conf root@$beagleAddr:/etc

# Tell the beagle to use the host as the gateway.
ssh root@$beagleAddr "/sbin/route add default gw $hostAddr" || true</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Then, on your host, run the following commands:</p>
</div>
<pre data-type="programlisting">
host$ <strong>chmod +x setDNS.sh</strong>
host$ <strong>./setDNS.sh</strong>
host$ <strong>ssh -X root@192.168.7.2</strong>
bone# <strong>ping -c2 google.com</strong>
PING google.com (216.58.216.96) 56(84) bytes of data.
64 bytes from ord30s22....net (216.58.216.96): icmp_req=1 ttl=55 time=7.49 ms
64 bytes from ord30s22....net (216.58.216.96): icmp_req=2 ttl=55 time=7.62 ms

--- google.com ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1002ms
rtt min/avg/max/mdev = 7.496/7.559/7.623/0.107 ms
</pre>
<div class="paragraph">
<p>This will look up what Domain Name System (DNS) servers your host is using and copy them to the right place on the Bone.  The ping command is a quick way to verify your connection.</p>
</div>
</div>
<div class="sect4">
<h5 id="_letting_the_world_see_your_bone_setting_up_port_forwarding">Letting the world see your bone: setting up port forwarding</h5>
<div class="paragraph">
<p>Now your Bone can access the world via the USB port and your host computer, but
what if you have a web server on your Bone that you want to access from the world?
The solution is to use <em>port forwarding</em> from your host.
Web servers typically listen to port 80. First, look up the IP address of your host:</p>
</div>
<pre data-type="programlisting">
host$ <strong>ifconfig</strong>
eth0      Link encap:Ethernet  HWaddr 00:e0:4e:00:22:51
          inet addr:<strong>137.112.41.35</strong>  Bcast:137.112.41.255  Mask:255.255.255.0
          inet6 addr: fe80::2e0:4eff:fe00:2251/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:5371019 errors:0 dropped:0 overruns:0 frame:0
          TX packets:4720856 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:1667916614 (1.6 GB)  TX bytes:597909671 (597.9 MB)

eth1      Link encap:Ethernet  HWaddr 00:1d:60:40:58:e6
...
</pre>
<div class="paragraph">
<p>It&#8217;s the number following inet addr:, which in my case is 137.112.41.35.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you are on a wireless network, find the IP address associated with wlan0.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then run the following, using your host&#8217;s IP address:</p>
</div>
<pre data-type="programlisting">
host$ <strong>sudo iptables -t nat -A PREROUTING -p tcp -s 0/0 \
     -d 137.112.41.35 --dport 1080 -j DNAT --to 192.168.7.2:80</strong>
</pre>
<div class="paragraph">
<p>Now browse to your host computer at port 1080. That is, if your host&#8217;s IP address is 123.456.789.0, enter 123.456.789.0:1080. The :1080 specifies what port number to use. The request will be forwarded to the server on your Bone listening to port 80. (I used 1080 here, in case your host is running a web server of its own on port 80.)</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_50">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="tips_firewall">Setting Up a Firewall</h3>
<div class="sect3">
<h4 id="_problem_53">Problem</h4>
<div class="paragraph">
<p>You have put your Bone on the network and want to limit which IP addresses can access it.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_53">Solution</h4>
<div class="paragraph">
<p>The Bone already has a firewall installed. Just run the following command:</p>
</div>
<pre data-type="programlisting">
bone# <strong>iptables --policy INPUT DROP</strong>
bone# <strong>iptables -A INPUT -s 137.112.0.0/16 -j ACCEPT</strong>
</pre>
<div class="paragraph">
<p>In this case, only users from my campus (IP addresses beginning with 137.112) will be able to access (or even see) your Bone.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_51">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="tips_apt-get">Installing Additional Packages from the Debian Package Feed</h3>
<div class="sect3">
<h4 id="_problem_54">Problem</h4>
<div class="paragraph">
<p>You want to do more cool things with your BeagleBone by installing more programs.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_54">Solution</h4>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Your Bone needs to be on the network for this to work. See <a href="#networking_wired">Establishing an Ethernet-Based Internet Connection</a>, <a href="#networking_wireless">Establishing a WiFi-Based Internet Connection</a>, or <a href="#networking_usb">Sharing the Host&#8217;s Internet Connection over USB</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The easiest way to install more software is to use apt-get:</p>
</div>
<pre data-type="programlisting">
bone# <strong>apt-get update</strong>
bone# <strong>apt-get install "name of software"</strong>
</pre>
<div class="paragraph">
<p>A sudo is necessary if you aren&#8217;t running as root. The first command downloads package lists from various repositories and updates them to get information on the newest versions of packages and their dependencies. (You need to run it only once a week or so.) The second command fetches the software and installs it and all packages it depends on.</p>
</div>
<div class="paragraph">
<p>How do you find out what software you can install?  Try running this:</p>
</div>
<pre data-type="programlisting">
bone# <strong>apt-cache pkgnames | sort > /tmp/list</strong>
bone# <strong>wc /tmp/list</strong>
 32121  32121 502707 /tmp/list
bone# <strong>less /tmp/list</strong>
</pre>
<div class="paragraph">
<p>The first command lists all the packages that apt-get knows about and sorts them and stores them in <em>/tmp/list</em>. The second command shows why you want to put the list in a file. The wc command counts the number of lines, words, and characters in a file. In our case, there are over 32,000 packages from which we can choose! The less command displays the sorted list, one page at a time. Press the space bar to go to the next page. Press Q to quit.</p>
</div>
<div class="paragraph">
<p>Suppose that you would like to install an online dictionary (dict). Just run the following command:</p>
</div>
<pre data-type="programlisting">
bone# <strong>apt-get install dict</strong>
</pre>
<div class="paragraph">
<p>Now you can run dict.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_52">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="tips_apt-get_remove">Removing Packages Installed with apt-get</h3>
<div class="sect3">
<h4 id="_problem_55">Problem</h4>
<div class="paragraph">
<p>You&#8217;ve been playing around and installing all sorts of things with apt-get and now you want to clean things up a bit.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_55">Solution</h4>
<div class="paragraph">
<p>apt-get has a remove option, so you can run the following command:</p>
</div>
<pre data-type="programlisting">
bone# <strong>apt-get remove dict</strong>
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following packages were automatically installed and are no longer required:
  libmaa3 librecode0 recode
Use 'apt-get autoremove' to remove them.
The following packages will be REMOVED:
  dict
0 upgraded, 0 newly installed, 1 to remove and 27 not upgraded.
After this operation, 164 kB disk space will be freed.
Do you want to continue [Y/n]? <strong>y</strong>
</pre>
</div>
<div class="sect3">
<h4 id="_discussion_53">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="_copying_files_between_the_onboard_flash_and_the_microsd_card">Copying Files Between the Onboard Flash and the MicroSD Card</h3>
<div class="sect3">
<h4 id="_problem_56">Problem</h4>
<div class="paragraph">
<p>You want to move files between the onboard flash and the microSD card.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_56">Solution</h4>
<div class="paragraph">
<p>If you booted from the microSD card, run the following command:</p>
</div>
<pre data-type="programlisting">
bone# <strong>df -h</strong>
Filesystem      Size  Used Avail Use% Mounted on
rootfs          7.2G  2.0G  4.9G  29% /
udev             10M     0   10M   0% /dev
tmpfs           100M  1.9M   98M   2% /run
/dev/mmcblk0p2  7.2G  2.0G  4.9G  29% /
tmpfs           249M     0  249M   0% /dev/shm
tmpfs           249M     0  249M   0% /sys/fs/cgroup
tmpfs           5.0M     0  5.0M   0% /run/lock
tmpfs           100M     0  100M   0% /run/user
bone# <strong>ls /dev/mmcblk*</strong>
/dev/mmcblk0    /dev/mmcblk0p2  /dev/mmcblk1boot0  /dev/mmcblk1p1
/dev/mmcblk0p1  /dev/mmcblk1    /dev/mmcblk1boot1
</pre>
<div class="paragraph">
<p>The df command shows what partitions are already mounted. The line /dev/mmcblk0p2  7.2G  2.0G  4.9G  29% / shows that mmcblk0 partition p2 is mounted as /, the root file system. The general rule is that the media you&#8217;re booted from (either the onboard flash or the microSD card) will appear as mmcblk0. The second partition (p2) is the root of the file system.</p>
</div>
<div class="paragraph">
<p>The ls command shows what devices are available to mount. Because mmcblk0 is already mounted, /dev/mmcblk1p1 must be the other media that we need to mount. Run the following commands to mount it:</p>
</div>
<pre data-type="programlisting">
bone# <strong>cd /mnt</strong>
bone# <strong>mkdir onboard</strong>
bone# <strong>ls onboard</strong>
bone# <strong>mount /dev/mmcblk1p1 onboard/</strong>
bone# <strong>ls onboard</strong>
bin   etc     lib         mnt           proc  sbin     sys  var
boot  home    lost+found  nfs-uEnv.txt  root  selinux  tmp
dev   ID.txt  media       opt           run   srv      usr
</pre>
<div class="paragraph">
<p>The cd command takes us to a place in the file system where files are commonly mounted. The mkdir command creates a new directory (<em>onboard</em>) to be a mount point. The ls command shows there is nothing in <em>onboard</em>. The mount command makes the contents of the onboard flash accessible. The next ls shows there now are files in <em>onboard</em>. These are the contents of the onboard flash, which can be copied to and from like any other file.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_54">Discussion</h4>
<div class="paragraph">
<p>This same process should also work if you have booted from the onboard flash. When you are done with the onboard flash, you can unmount it by using this command:</p>
</div>
<pre data-type="programlisting">
bone# <strong>umount /mnt/onboard</strong>
</pre>
</div>
</div>
<div class="sect2">
<h3 id="_freeing_space_on_the_onboard_flash_or_microsd_card">Freeing Space on the Onboard Flash or MicroSD Card</h3>
<div class="sect3">
<h4 id="_problem_57">Problem</h4>
<div class="paragraph">
<p>You are starting to run out of room on your microSD card (or onboard flash) and have removed several packages you had previously installed (<a href="#tips_apt-get_remove">Removing Packages Installed with apt-get</a>), but you still need to free up more space.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_57">Solution</h4>
<div class="paragraph">
<p>To free up space, you can remove preinstalled packages or discover big files to remove.</p>
</div>
<div class="sect4">
<h5 id="_removing_preinstalled_packages">Removing preinstalled packages</h5>
<div class="paragraph">
<p>You might not need a few things that come preinstalled in the Debian image, including such things as OpenCV, the Chromium web browser, and some documentation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The Chromium web browser is the open source version of Google&#8217;s Chrome web browser. Unless you are using the Bone as a desktop computer, you can probably remove it.</p>
</div>
<div class="paragraph">
<p><a href="http://opencv.org/">OpencCV</a> is an open source computer vision package. If you aren&#8217;t doing computer vision, you can remove it.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here&#8217;s how you can remove these:</p>
</div>
<pre data-type="programlisting">
bone# <strong>apt-get autoremove opencv*</strong>          (83M)
bone# <strong>apt-get remove libopencv-* --purge</strong>  (41M)
bone# <strong>apt-get autoremove</strong>                  (42M)
bone# <strong>rm -rf /usr/lib/chromium</strong>            (95M)
bone# <strong>rm -f  /usr/bin/chromium</strong>
bone# <strong>rm -rf /usr/share/doc</strong>               (101M)
bone# <strong>rm -rf /usr/share/man</strong>               (27M)
</pre>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>These packages and sizes to remove were found in a <a href="http://bit.ly/1HC96aI">BeagleBoard Google Groups thread</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_discovering_big_files">Discovering big files</h5>
<div class="paragraph">
<p>The du (disk usage) command offers a quick way to discover big files:</p>
</div>
<pre data-type="programlisting">
bone# <strong>du -shx /*</strong>
5.6M	/bin
11M	/boot
0	/dev
5.4M	/etc
232K	/home
66M	/lib
16K	/lost+found
388M	/media
4.0K	/mnt
63M	/opt
du: cannot access `/proc/20551/task/20551/fd/3': No such file or directory
du: cannot access `/proc/20551/task/20551/fdinfo/3': No such file or directory
du: cannot access `/proc/20551/fd/3': No such file or directory
du: cannot access `/proc/20551/fdinfo/3': No such file or directory
0	/proc
227M	/root
1.1M	/run
5.0M	/sbin
4.0K	/selinux
4.0K	/srv
0	/sys
36K	/tmp
1.2G	/usr
143M	/var
</pre>
<div class="paragraph">
<p>If you booted from the microSD card, du lists the usage of the microSD. If you booted from the onboard flash, it lists the onboard flash usage.</p>
</div>
<div class="paragraph">
<p>The -s option summarizes the results rather than displaying every file. -h prints it in <em>human</em> form&#8212;&#8203;that is, using M and K postfixes rather than showing lots of digits. The /* specifies to run it on everything in the top-level directory. It looks like a couple of things disappeared while the command was running and thus produced some error messages.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>For more help, try du --help.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <em>/usr</em> directory appears to be the biggest user of space at 1.2 GB. You can then run the following command to see what&#8217;s taking up the space in <em>/usr</em>:</p>
</div>
<pre data-type="programlisting">
bone# <strong>du -sh /usr/*</strong>
46M	/usr/bin
4.0K	/usr/games
36M	/usr/include
424M	/usr/lib
16M	/usr/local
4.0M	/usr/sbin
694M	/usr/share
4.0K	/usr/src
</pre>
<div class="paragraph">
<p>A more interactive way to explore your disk usage is by installing ncdu (ncurses disk usage):</p>
</div>
<pre data-type="programlisting">
bone# <strong>apt-get install ncdu</strong>
bone# <strong>ncdu /</strong>
</pre>
<div class="paragraph">
<p>After a moment, you&#8217;ll see the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">ncdu 1.8 ~ Use the arrow keys to navigate, press ? for help
--- / --------------------------------------------------------------------------
    1.2GiB [##########] /usr
  387.6MiB [###       ] /media
  226.0MiB [#         ] /root
  142.9MiB [#         ] /var
   65.9MiB [          ] /lib
   62.4MiB [          ] /opt
   10.8MiB [          ] /boot
    5.6MiB [          ] /bin
    5.4MiB [          ] /etc
    5.0MiB [          ] /sbin
    1.0MiB [          ] /run
  232.0KiB [          ] /home
   36.0KiB [          ] /tmp
e  16.0KiB [          ] /lost+found
e   4.0KiB [          ] /srv
e   4.0KiB [          ] /selinux
e   4.0KiB [          ] /mnt
    0.0  B [          ] /sys
    0.0  B [          ] /proc
    0.0  B [          ] /dev

 Total disk usage:   2.1GiB  Apparent size:   1.9GiB  Items: 156583</code></pre>
</div>
</div>
<div class="paragraph">
<p>ncdu is a character-based graphics interface to du.  You can now use your arrow keys to navigate the file structure to discover where the big unused files are. Press ? for help.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Be careful not to press the D key, because it&#8217;s used to delete a file or directory.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_55">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="_installing_additional_node_js_packages">Installing Additional Node.js Packages</h3>
<div class="sect3">
<h4 id="_problem_58">Problem</h4>
<div class="paragraph">
<p>You are working with JavaScript and want to build on what others have done.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_58">Solution</h4>
<div class="paragraph">
<p>Node Package Manager (npm [<a href="https://www.npmjs.org/" class="bare">https://www.npmjs.org/</a>]) is used to install new packages. For example, suppose that you are wiring up a GPS (<a href="#sensors_GPS">Acquiring Data by Using a Smart Sensor over a Serial Connection</a>) and want to use the nmea JavaScript package to decode the National Marine Electronics Association (NMEA) data from the GPS. Install the nmea package with the following command:</p>
</div>
<pre data-type="programlisting">
bone# <strong>npm install -g nmea</strong>
npm http GET https://registry.npmjs.org/nmea
npm http 200 https://registry.npmjs.org/nmea
npm http GET https://registry.npmjs.org/nmea/-/nmea-0.0.7.tgz
npm http 200 https://registry.npmjs.org/nmea/-/nmea-0.0.7.tgz
nmea@0.0.7 /usr/local/lib/node_modules/nmea
</pre>
<div class="paragraph">
<p>The -g instructs to install globally. That way, you can use nmea from any directory. If -g is not given, you can use nmea only in the directory in which you installed it.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_56">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="using_python">Using Python to Interact with the Physical World</h3>
<div class="sect3">
<h4 id="_problem_59">Problem</h4>
<div class="paragraph">
<p>You want to use Python on the Bone to talk to the world.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_59">Solution</h4>
<div class="paragraph">
<p>So far, we&#8217;ve focused on using JavaScript and the BoneScript API for interfacing BeagleBone Black to the physical world.  BoneScript provides an easy way to interface the Bone to the world, but there are other programming languages out there.  This recipe provides the steps needed to work with Python, and <a href="#misc_libsoc">Using C to Interact with the Physical World</a> does the same for C.</p>
</div>
<div class="paragraph">
<p><a href="http://www.adafruit.com/">Adafruit</a> has produced an excellent <a href="http://bit.ly/1Mt9kDS">library for the Bone</a>, and it&#8217;s already installed. Ensure that the BBIO library is up-to-date:</p>
</div>
<pre data-type="programlisting">
bone# <strong>pip install Adafruit_BBIO</strong>
Requirement already satisfied (use --upgrade to upgrade):
    Adafruit-BBIO in /usr/local/lib/python2.7/dist-packages
Cleaning up...
</pre>
<div class="paragraph">
<p>Now that you&#8217;re ready to go, add the code in <a href="#misc_python_blink">Use Python to blink an LED (blinkLED.py)</a> to a file called <em>blinkLED.py</em>.</p>
</div>
<div id="misc_python_blink" class="exampleblock pagebreak-before">
<div class="title">Example 30. Use Python to blink an LED (blinkLED.py)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">#!/usr/bin/env python
import Adafruit_BBIO.GPIO as GPIO
import time

pin = "P9_14"

GPIO.setup(pin, GPIO.OUT)

while True:
    GPIO.output(pin, GPIO.HIGH)
    time.sleep(0.5)
    GPIO.output(pin, GPIO.LOW)
    time.sleep(0.5)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Wire your LED as shown in <a href="#displays_externalLED">Toggling an External LED</a> and run it with the following command:</p>
</div>
<pre data-type="programlisting">
bone# <strong>chmod +x blinkLED.py</strong>.
bone# <strong>./blinkLED.py</strong>.
</pre>
<div class="paragraph">
<p>Adafruit&#8217;s <a href="http://bit.ly/1C5dkaK">Setting up IO Python Library on BeagleBone Black</a> does a nice job showing how to use the BBIO library.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_57">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="misc_libsoc">Using C to Interact with the Physical World</h3>
<div class="sect3">
<h4 id="_problem_60">Problem</h4>
<div class="paragraph">
<p>You want to use C on the Bone to talk to the world.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_60">Solution</h4>
<div class="paragraph">
<p>The C solution isn&#8217;t as simple as the BoneScript or Python solution (<a href="#using_python">Using Python to Interact with the Physical World</a>), but it does work and is much faster. <a href="https://github.com/jackmitch/libsoc">libsoc</a> is a "C library for interfacing with common SoC {system on chip} peripherals through generic kernel interfaces" by <a href="http://www.embed.me.uk/">Jack Mitchell</a>. Here&#8217;s how to get and install it:</p>
</div>
<pre data-type="programlisting">
bone# <strong>git clone https://github.com/jackmitch/libsoc.git</strong>
bone# <strong>cd libsoc</strong>
bone# <strong>./autogen.sh</strong>       # Takes about a minute
bone# <strong>./configure</strong>        # Another  minute
bone# <strong>make</strong>               # 30 seconds
bone# <strong>make install</strong>
</pre>
<div class="paragraph">
<p>This installs the libsoc library in <em>/usr/local/lib</em>. Add the code in <a href="#misc_c_blink">Use C to blink an LED (blinkLED.c)</a> to a file called <em>blinkLED.c</em>.</p>
</div>
<div id="misc_c_blink" class="exampleblock">
<div class="title">Example 31. Use C to blink an LED (blinkLED.c)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/wait.h&gt;

#include "libsoc_gpio.h"
#include "libsoc_debug.h"

// Blinks an LED attached to P9_14 (gpio1_18, 32+18=50)
#define GPIO_OUTPUT  50

int main(void) {
  gpio *gpio_output;    // Create gpio pointer
  libsoc_set_debug(1);  // Enable debug output
  // Request gpio
  gpio_output = libsoc_gpio_request(GPIO_OUTPUT, LS_SHARED);
  // Set direction to OUTPUT
  libsoc_gpio_set_direction(gpio_output, OUTPUT);

  libsoc_set_debug(0);   // Turn off debug printing for fast toggle

  int i;
  for (i=0; i&lt;1000000; i++) {     // Toggle the GPIO 100 times
    libsoc_gpio_set_level(gpio_output, HIGH);
    // usleep(100000);           // sleep 100,000 uS
    libsoc_gpio_set_level(gpio_output, LOW);
    // usleep(100000);
  }

  if (gpio_output) {
    libsoc_gpio_free(gpio_output);  // Free gpio request memory
  }

  return EXIT_SUCCESS;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>In BoneScript and Python, we refer to the GPIO pins by the header position (P9_14, for example). In libsoc, we refer to them by an internal GPIO number. <a href="#tips_cape_headers_digital">Mapping from header pin to internal GPIO number</a> shows how to map from header position to GPIO pin. For example, P9_14 has GPIO_50 next to it. That means libsoc needs to use GPIO 50 to interface with P9_14.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="tips_cape_headers_digital" class="imageblock">
<div class="content">
<img src="./05tips/figures/cape-headers-digital.png" alt="cape headers digital">
</div>
<div class="title">Figure 62. Mapping from header pin to internal GPIO number</div>
</div>
<div class="paragraph">
<p>Compile and run the code:</p>
</div>
<pre data-type="programlisting">
bone# <strong>gcc -o blinkLED blinkLED.c -lsoc</strong>
bone# <strong>./blinkLED</strong>
libsoc-debug: debug enabled (libsoc_set_debug)
libsoc-gpio-debug: requested gpio (50, libsoc_gpio_request)
libsoc-gpio-debug: GPIO already exported (50, libsoc_gpio_request)
libsoc-gpio-debug: setting direction to out (50, libsoc_gpio_set_direction)
libsoc-debug: debug disabled (libsoc_set_debug)
</pre>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you have an older image, you might need to install the libsoc library. You can do that with apt-get if you have network access and the right feeds on your Bone. Install libsoc2 for the library and libsoc-dev for the header files.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_58">Discussion</h4>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="networking">Internet of Things</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_6">Introduction</h3>
<div class="paragraph">
<p>You can easily connect BeagleBone Black to the Internet via a wire (<a href="#networking_wired">Establishing an Ethernet-Based Internet Connection</a>), wirelessly (<a href="#networking_wireless">Establishing a WiFi-Based Internet Connection</a>), or through the USB to a host and then to the Internet (<a href="#networking_usb">Sharing the Host&#8217;s Internet Connection over USB</a>). Either way, it opens up a world of possibilities for the "Internet of Things" (IoT).</p>
</div>
<div class="paragraph">
<p>Now that you&#8217;re online, this chapter offers various things to do with your connection.</p>
</div>
</div>
<div class="sect2">
<h3 id="_accessing_your_host_computers_files_on_the_bone">Accessing Your Host Computer&#8217;s Files on the Bone</h3>
<div class="sect3">
<h4 id="_problem_61">Problem</h4>
<div class="paragraph">
<p>You want to access a file on a Linux host computer that&#8217;s attached to the Bone.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_61">Solution</h4>
<div class="paragraph">
<p>If you are running Linux on a host computer attached to BeagleBone Black, it&#8217;s not hard to mount the Bone&#8217;s files on the host or the host&#8217;s files on the Bone by using sshfs. Suppose that you want to access files on the host from the Bone. First, install sshfs:</p>
</div>
<pre data-type="programlisting">
bone# <strong>apt-get install sshfs</strong>
</pre>
<div class="paragraph">
<p>Now, mount the files to an empty directory (substitute your username on the host computer for username and the IP address of the host for 192.168.7.1):</p>
</div>
<pre data-type="programlisting">
bone# <strong>mkdir host</strong>
bone# <strong>sshfs username@$192.168.7.1:. host</strong>
bone# <strong>cd host</strong>
bone# <strong>ls</strong>
</pre>
<div class="paragraph">
<p>The ls command will now list the files in your home directory on your host computer.  You can edit them as if they were local to the Bone.  You can access all the files by substituting :/ for the :. following the IP address.</p>
</div>
<div class="paragraph">
<p>You can go the other way, too. Suppose that you are on your Linux host computer and want to access files on your Bone. Install sshfs:</p>
</div>
<pre data-type="programlisting">
host$ <strong>sudo apt-get install sshfs</strong>
</pre>
<div class="paragraph">
<p>and then access:</p>
</div>
<pre data-type="programlisting">
host$ <strong>mkdir /mnt/bone</strong>
host$ <strong>sshfs root@$192.168.7.2:/ /mnt/bone</strong>
host$ <strong>cd /mnt/bone</strong>
host$ <strong>ls</strong>
</pre>
<div class="paragraph">
<p>Here, we are accessing the files on the Bone as root. We’ve mounted the entire file system, starting with /, so you can access any file. Of course, with great power comes great responsibility, so be careful.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_59">Discussion</h4>
<div class="paragraph">
<p>The sshfs command gives you easy access from one computer to another. When you are done, you can unmount the files by using the following commands:</p>
</div>
<pre data-type="programlisting">
host$ <strong>umount /mnt/bone</strong>
bone# <strong>umount home</strong>
</pre>
</div>
</div>
<div class="sect2">
<h3 id="networking_builtin_server">Serving Web Pages from the Bone</h3>
<div class="sect3">
<h4 id="_problem_62">Problem</h4>
<div class="paragraph">
<p>You want to use BeagleBone Black as a web server.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_62">Solution</h4>
<div class="paragraph">
<p>BeagleBone Black already has a couple of web servers running. This recipe shows how to use the Node.js-based server. <a href="#networking_apache">Serving Web Pages from the Bone by Using Apache</a> shows how to use <em>Apache</em>.</p>
</div>
<div class="paragraph">
<p>When you point your browser to <em>192.168.7.2</em>, you are using the Node.js web server The web pages are served from <em>/var/lib/cloud9</em>. Add the HTML in <a href="#networking_index_html">A sample web page (test.html)</a> to a file called <em>/var/lib/cloud9/test.html</em>, and then point your browser to <em>192.168.7.2:test.html</em>.</p>
</div>
<div id="networking_index_html" class="exampleblock pagebreak-before">
<div class="title">Example 32. A sample web page (test.html)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;body&gt;

&lt;h1&gt;My First Heading&lt;/h1&gt;

&lt;p&gt;My first paragraph.&lt;/p&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You will see the web page shown in <a href="#networking_node_page">test.html as served by Node.js</a>.</p>
</div>
<div id="networking_node_page" class="imageblock">
<div class="content">
<img src="./0iot/figures/apacheIndex.png" alt="test.html served by Node.js">
</div>
<div class="title">Figure 63. test.html as served by Node.js</div>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_60">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="networking_nodejs">Interacting with the Bone via a Web Browser</h3>
<div class="sect3">
<h4 id="_problem_63">Problem</h4>
<div class="paragraph">
<p>BeagleBone Black is interacting with the physical world nicely via BoneScript, and you want to display that information on a web browser.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_63">Solution</h4>
<div class="paragraph">
<p><a href="http://nodejs.org/">Node.js</a> is a platform built on <a href="http://code.google.com/p/v8/">Chrome&#8217;s JavaScript runtime</a> for easily building fast, scalable network applications. <a href="#networking_builtin_server">Serving Web Pages from the Bone</a> shows how to use the node server that&#8217;s already running. This recipe shows how easy it is to build your own server.</p>
</div>
<div class="paragraph">
<p>First, create a directory for this recipe:</p>
</div>
<pre data-type="programlisting">
bone# <strong>mkdir serverExample</strong>
bone# <strong>cd serverExample</strong>
</pre>
<div class="paragraph">
<p>Add the code in <a href="#networking_nodeServer_code">Javascript code for a simple Node.js-based web server (server.js)</a> to a file called <em>server.js</em> in the <em>serverExample</em> directory.</p>
</div>
<div id="networking_nodeServer_code" class="exampleblock">
<div class="title">Example 33. Javascript code for a simple Node.js-based web server (server.js)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">#!/usr/bin/env node
// Initial idea from Getting Started With node.js and socket.io
// by Constantine Aaron Cois, Ph.D. (www.codehenge.net)
// http://codehenge.net/blog/2011/12/getting-started-with-node-js-and-socket-io-
//   v0-7-part-2/
// This is a simple server for the various web frontends
"use strict";

var port = 9090,            // Port on which to listen
    http = require('http'),
    url = require('url'),
    fs = require('fs'),
    b = require('bonescript');

var server = http.createServer(servePage);  // <b class="conum">(1)</b>

server.listen(port);                        // <b class="conum">(2)</b>
console.log("Listening on " + port);

function servePage(req, res) {
    var path = url.parse(req.url).pathname;             // <b class="conum">(3)</b>
    console.log("path: " + path);

    fs.readFile(__dirname + path, function (err, data) {// <b class="conum">(4)</b>
        if (err) {                                      // <b class="conum">(5)</b>
            return send404(res); 
        }
        res.write(data, 'utf8');                        // <b class="conum">(6)</b>
        res.end();
    });   
}

function send404(res) {
    res.writeHead(404);
    res.write('404 - page not found');
    res.end();
}</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Creates the server. Whenever a browser requests a page from port 9090, the function servepage is called.</p>
</li>
<li>
<p>Instructs the server to begin listening on port 9090.</p>
</li>
<li>
<p>When servepage is called, req contains the path to the page being requested. This code extracts the path to the page.</p>
</li>
<li>
<p>readFile reads the entire page being requested.</p>
</li>
<li>
<p>Be sure the page is there; if not, send the famous 404 error.</p>
</li>
<li>
<p>Write the page to the web browser.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Add the HTML in <a href="#networking_index_html">A sample web page (test.html)</a> to a file called <em>test.html</em> in the <em>serverExample</em> directory, and then run this:</p>
</div>
<pre data-type="programlisting">
bone# <strong>cd serverExample</strong>
bone# <strong>chmod +x server.js</strong>
bone# <strong>./server.js</strong>
Listening on 9090
</pre>
<div class="paragraph">
<p>Now, navigate to <em>192.168.7.2:9090/test.html</em> on your host computer (or the Bone) browser, and you will see something like <a href="#networking_nodeServer">Test page served by our custom node-based server</a>.</p>
</div>
<div id="networking_nodeServer" class="imageblock">
<div class="content">
<img src="./0iot/figures/nodeServer.png" alt="Test page">
</div>
<div class="title">Figure 64. Test page served by our custom node-based server</div>
</div>
<div class="paragraph">
<p>Note that the only difference between <a href="#networking_nodeServer">Test page served by our custom node-based server</a> and <a href="#networking_node_page">test.html as served by Node.js</a> is that the first uses port 9090.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_61">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="_displaying_gpio_status_in_a_web_browser">Displaying GPIO Status in a Web Browser</h3>
<div class="sect3">
<h4 id="_problem_64">Problem</h4>
<div class="paragraph">
<p>You want a web page to display the status of a GPIO pin.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_64">Solution</h4>
<div class="paragraph">
<p>This solution builds on the Node.js-based web server solution in <a href="#networking_nodejs">Interacting with the Bone via a Web Browser</a>.</p>
</div>
<div class="paragraph">
<p>To make this recipe, you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Breadboard and jumper wires (see <a href="#app_proto">Prototyping Equipment</a>)</p>
</li>
<li>
<p>Pushbutton switch (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Wire your pushbutton as shown in <a href="#js_pushbutton_fig">Diagram for wiring a pushbutton and magnetic reed switch input</a>. Add the code in <a href="#networking_gpioServer_code">A simple Node.js-based web server to read a GPIO (GPIOserver.js)</a> to a file called <em>GPIOserver.js</em> in the <em>serverExample</em> directory.</p>
</div>
<div id="networking_gpioServer_code" class="exampleblock">
<div class="title">Example 34. A simple Node.js-based web server to read a GPIO (GPIOserver.js)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">#!/usr/bin/env node
// Initial idea from Getting Started With node.js and socket.io 
// http://codehenge.net/blog/2011/12/getting-started-with-node-js-and-socket-io-
//   v0-7-part-2/
// This is a simple server for the various web frontends
// Display status of P9_42
"use strict";

var port = 9090,            // Port on which to listen
    http = require('http'),
    url = require('url'),
    fs = require('fs'),
    b = require('bonescript'),
    gpio = 'P9_42';         // gpio port to read

            // <b class="conum">(1)</b>
var htmlStart = "\
&lt;!DOCTYPE html&gt;\
&lt;html&gt;\
&lt;body&gt;\
\
&lt;h1&gt;" + gpio + "&lt;/h1&gt;\
data = ";

            // <b class="conum">(2)</b>
var htmlEnd = "\
&lt;/body&gt;\
&lt;/html&gt;";

var server = http.createServer(servePage);

b.pinMode(gpio, b.INPUT, 7, 'pulldown');

server.listen(port);
console.log("Listening on " + port);

function servePage(req, res) {
    var path = url.parse(req.url).pathname;
    console.log("path: " + path);
    if (path === '/gpio') {                             // <b class="conum">(3)</b>
        var data = b.digitalRead(gpio);                 // <b class="conum">(4)</b>
        res.write(htmlStart + data + htmlEnd, 'utf8');  // <b class="conum">(5)</b>
        res.end();
    } else {
        fs.readFile(__dirname + path, function (err, data) {
            if (err) {
                return send404(res); 
            }
            res.write(data, 'utf8');
            res.end();
        });   
    }
}

function send404(res) {
    res.writeHead(404);
    res.write('404 - page not found');
    res.end();
}</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This the the HTML to send to the server before the data value.</p>
</li>
<li>
<p>This is the HTML for after the data.</p>
</li>
<li>
<p>Normally, we&#8217;d send a file, but if /gpio is requested, we&#8217;ll build our own page and include the value of the GPIO pin.</p>
</li>
<li>
<p>Read the value of the GPIO pin.</p>
</li>
<li>
<p>Concatenate the HTML code with the data and send it to the browser.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now, run the following command:</p>
</div>
<pre data-type="programlisting">
bone# <strong>./GPIOserver.js</strong>
Listening on 9090
</pre>
<div class="paragraph">
<p>Point your browser to <em><a href="http://192.168.7.2:9090/gpio" class="bare">http://192.168.7.2:9090/gpio</a></em>, and the page will look like <a href="#networking_GPIOserver_fig">Status of a GPIO pin on a web page</a>.</p>
</div>
<div id="networking_GPIOserver_fig" class="imageblock">
<div class="content">
<img src="./0iot/figures/GPIOWebPage.png" alt="GPIO status">
</div>
<div class="title">Figure 65. Status of a GPIO pin on a web page</div>
</div>
<div class="paragraph">
<p>Currently, the 0 shows that the button isn&#8217;t pressed. Try refreshing the page while pushing the button, and you will see 1 displayed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_62">Discussion</h4>
<div class="paragraph">
<p>It&#8217;s not hard to assemble your own HTML with the GPIO data. It&#8217;s an easy extension to write a program to display the status of all the GPIO pins.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="networking_jsfiddle">Continuously Displaying the GPIO Value via jsfiddle</h3>
<div class="sect3">
<h4 id="_problem_65">Problem</h4>
<div class="paragraph">
<p>The value of your GPIO port keeps changing, and you want your web page to always show the current value.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_65">Solution</h4>
<div class="paragraph">
<p>We&#8217;ll attack this problem in two steps. This recipe will show how to use an external website (jsfiddle [<a href="http://jsfiddle.net/" class="bare">http://jsfiddle.net/</a>]) to read a GPIO pin on the Bone (yup, an external site can read the GPIO pins on the Bone). <a href="#networking_jQuery_local">Continuously Displaying the GPIO Value</a> will show how to move the code to run locally on the Bone.</p>
</div>
<div class="paragraph">
<p>To make this recipe, you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Breadboard and jumper wires (see <a href="#app_proto">Prototyping Equipment</a>)</p>
</li>
<li>
<p>Pushbutton switch (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
<li>
<p>10 k&#8486; trimpot (variable resistor) (see <a href="#app_resistor">Resistors</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="http://jsfiddle.net/">jsfiddle</a> is a website that lets you fiddle with JavaScript. It&#8217;s best introduced by an example. Point your browser to <a href="http://bit.ly/19c75ql">jQuery example</a>, and you will see the screen shown in <a href="#networking_jQuery_jsfiddle">jsfiddle example of GPIO</a>.</p>
</div>
<div id="networking_jQuery_jsfiddle" class="imageblock">
<div class="content">
<img src="./0iot/figures/jQueryFiddle.png" alt="jsfiddle example of GPIO">
</div>
<div class="title">Figure 66. jsfiddle example of GPIO</div>
</div>
<div class="paragraph">
<p>The page has four panels. The upper-left panel shows your HTML code. The lower-left panel shows the JavaScript that animates the HTML. The upper-right panel shows the CSS code that formats your HTML (not used here), and the lower-right panel shows what your rendered page looks like.</p>
</div>
<div class="paragraph">
<p>Wire your pushbutton switch to P8_19 (use <a href="#js_pushbutton_fig">Diagram for wiring a pushbutton and magnetic reed switch input</a> as an example, but note that the pushbutton in that figure is wired to P9_42, instead) and the variable resistor to P9_36, as shown in <a href="#sensors_analogIn_fig">Wiring a 10k&#8486; variable resistor (trimpot) to an ADC port</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can use any GPIO pin and any analog-in pin; just edit the code to match your setup.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Press the Run button on the jsfiddle page. The values in the lower-right panel will track your button and variable resistor in real time.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_63">Discussion</h4>

</div>
<div class="sect3">
<h4 id="_see_also_3">See Also</h4>
<div class="paragraph">
<p>jsfiddle is great for experimenting with your code, but what if want everything to be served from your Bone and not use an external site? Check out <a href="#networking_jQuery_local">Continuously Displaying the GPIO Value</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="networking_jQuery_local">Continuously Displaying the GPIO Value</h3>
<div class="sect3">
<h4 id="_problem_66">Problem</h4>
<div class="paragraph">
<p>The value of your GPIO port keeps changing, and you want your web page to always show the current value, but you don&#8217;t want to use an external site.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_66">Solution</h4>
<div class="paragraph">
<p><a href="#networking_jsfiddle">Continuously Displaying the GPIO Value via jsfiddle</a> shows how to use BoneScript in a browser to read GPIO pins on the Bone, but it requires the use of an external website. This recipe shows how to move from jsfiddle to the Bone, with a few simple steps.</p>
</div>
<div class="paragraph">
<p>Go to a working jsfiddle page (such as the one shown in <a href="#networking_jQuery_jsfiddle">jsfiddle example of GPIO</a>) and do the <span class="keep-together">following</span>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the lower-left panel, select all the BoneScript code and copy it to a file. In this case, call it <em>jQueryDemo.js</em>. Save it in the <em>serverExample</em> directory.</p>
</li>
<li>
<p>From the upper-left panel, select all the HTML code and copy it to <em>jQueryDemo.html</em> in the <em>serverExample</em> directory.</p>
</li>
<li>
<p>We need to add code to inform the browser where to find the external libraries we are using. Edit <em>jQueryDemo.html</em> and <em>before</em> your HTML, add the following lines:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;BoneScript jQuery Demo&lt;/title&gt;
        &lt;script src="static/jquery.js"&gt;&lt;/script&gt;
        &lt;script src="static/bonescript.js"&gt;&lt;/script&gt;
        &lt;script src="jQueryDemo.js"&gt;&lt;/script&gt;
    &lt;/head&gt;
&lt;body&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Add the following lines <em>after</em> your HTML:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Open <em><a href="http://192.168.7.2/serverExample/jQueryDemo.html" class="bare">http://192.168.7.2/serverExample/jQueryDemo.html</a></em>, and you&#8217;ll now see your values in your own web page.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>There are several useful JavaScript libraries already located in <em>/var/lib/cloud9/static</em>, and this recipe makes use of a couple of them here.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_64">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="_plotting_data">Plotting Data</h3>
<div class="sect3">
<h4 id="_problem_67">Problem</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You have live data coming into your Bone, and you want to plot it.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_solution_67">Solution</h4>
<div class="paragraph">
<p>There are a number of <a href="http://bit.ly/1MrHm9L">JavaScript-based plotting packages</a> out there. This recipe uses <a href="http://www.flotcharts.org/">flot</a> because it strikes a nice balance between ease-of-use and power.</p>
</div>
<div class="paragraph">
<p>To make this recipe, you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Breadboard and jumper wires (see <a href="#app_proto">Prototyping Equipment</a>)</p>
</li>
<li>
<p>10 k&#8486; trimpot (variable resistor) (see <a href="#app_resistor">Resistors</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Wire your variable resistor to P9_36, as shown in <a href="#sensors_analogIn_fig">Wiring a 10k&#8486; variable resistor (trimpot) to an ADC port</a>.
Go to <a href="http://bit.ly/1E5DW85">jsfiddle Flot Demo</a> for a nice quick demo. You will the screen shown in <a href="#networking_flot_demo">jsfiddle Flot Demo</a>. Try changing the variable resistor, and watch the plot respond in real time.</p>
</div>
<div id="networking_flot_demo" class="imageblock">
<div class="content">
<img src="./0iot/figures/flotDemo.png" alt="Flot Demo">
</div>
<div class="title">Figure 67. jsfiddle Flot Demo</div>
</div>
<div class="paragraph">
<p>See <a href="#networking_jsfiddle">Continuously Displaying the GPIO Value via jsfiddle</a> for a description of the jsfiddle panels. In <a href="#networking_flot_demo">jsfiddle Flot Demo</a>, the lower-right panel displays a live scrolling chart of the values being read from the variable resistor.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_65">Discussion</h4>
<div class="paragraph">
<p>You can perform plotting externally, via the <a href="http://jsfiddle.net/">jsfiddle</a> site, or locally.</p>
</div>
<div class="sect4">
<h5 id="_plotting_with_jsfiddle">Plotting with jsfiddle</h5>
<div class="paragraph">
<p>The HTML panel in <a href="#networking_flot_demo">jsfiddle Flot Demo</a> simply creates an area called myplot in which to draw the plot. The JavaScript code in <a href="#networking_flot_js">Code for plotting data with Flot (flotDemo.js)</a> then reads the analog in and creates the plot to display.</p>
</div>
<div id="networking_flot_js" class="exampleblock">
<div class="title">Example 35. Code for plotting data with Flot (flotDemo.js)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">setTargetAddress('192.168.7.2', {                           // <b class="conum">(1)</b>
    initialized: run
});

function run() {
    var b = require('bonescript');                          // <b class="conum">(2)</b>
    var POT = 'P9_36';                                      // <b class="conum">(3)</b>

    var container = $("#myplot");                           // <b class="conum">(4)</b>
    var totalPoints = container.outerWidth() / 2 || 250;    // <b class="conum">(5)</b>
    var data = [];
    var plotOptions = {                                     // <b class="conum">(6)</b>
        series: {
            shadowSize: 0
        },
        yaxis: {
            min: 0,
            max: 1
        },
        xaxis: {
            min: 0,
            max: totalPoints,
            show: false
        }
    };
    var plot = $.plot(container, getData(), plotOptions);   // <b class="conum">(7)</b>

    drawGraph();                                            // <b class="conum">(8)</b>

    function drawGraph() {                                  // <b class="conum">(9)</b>
        plot.setData(getData());
        plot.draw();
        b.analogRead(POT, onAnalogRead);
    }

    // Handle data back from potentiometer
    function onAnalogRead(x) {                              
        if (!x.err &amp;&amp; typeof x.value == 'number') {
            pushData(x.value);                              // <b class="conum">(10)</b>
        }
        setTimeout(drawGraph, 20);                          // <b class="conum">(11)</b>
    }

    function pushData(y) {
        if (data.length &amp;&amp; (data.length + 1) &gt; totalPoints) {
            data = data.slice(1);
        }
        if (data.length &lt; totalPoints) {
            data.push(y);
        }
    }

    function getData() {
        var res = [];
        for (var i = 0; i &lt; data.length; ++i) {
            res.push([i, data[i]]);
        }
        var series = [{
            data: res,
            lines: {
                fill: true
            }
        }];
        return series;
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Direct the browser where to find the Bone.  After it is initialized, it calls run to get things going.</p>
</li>
<li>
<p>Read in the BoneScript library.</p>
</li>
<li>
<p>Pick which analog-in to use.</p>
</li>
<li>
<p>Pick where on the web page to draw the plot.  In this case, the code defines only one place, myplot.</p>
</li>
<li>
<p>Decide how many points can be plotted.</p>
</li>
<li>
<p>Set various plotting options.</p>
</li>
<li>
<p>Initialize the plot.</p>
</li>
<li>
<p>Draw the graph on the web page.</p>
</li>
<li>
<p>Set the data and draw. Then read the next value and call onAnalogRead when it&#8217;s ready.</p>
</li>
<li>
<p>If no error, add newest value to the data array.</p>
</li>
<li>
<p>Do it all over again in 20 ms.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_plotting_locally">Plotting locally</h5>
<div class="paragraph">
<p>You can do plotting locally by following the process in <a href="#networking_jQuery_local">Continuously Displaying the GPIO Value</a>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Copy the JavaScript code in the lower-left panel and save it in a file called <em><span class="keep-together">flotDemo.js</span></em>.</p>
</li>
<li>
<p>Copy the HTML in the upper-left panel and add the header material. <a href="#networking_flotDemo">flotDemo.html (flotDemo.html)</a> loads the flot library in addition to jquery and our own code.</p>
</li>
</ol>
</div>
<div id="networking_flotDemo" class="exampleblock">
<div class="title">Example 36. flotDemo.html (flotDemo.html)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;BoneScript Flot Demo&lt;/title&gt;
        &lt;script src="/static/flot/jquery.min.js"&gt;&lt;/script&gt;
        &lt;script src="/static/flot/jquery.flot.min.js"&gt;&lt;/script&gt;
        &lt;script src="/static/bonescript.js"&gt;&lt;/script&gt;
        &lt;script src="flotDemo.js"&gt;&lt;/script&gt;
    &lt;/head&gt;
&lt;body&gt;

&lt;h1&gt;BoneScript Flot Demo&lt;/h1&gt; 
&lt;div id="myplot" style="width:500px;height:300px;"&gt;&lt;/div&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Put both files in the <em>serverExample</em> subdirectory under the Cloud9 IDE (<em>/var/lib/cloud9</em>).</p>
</li>
<li>
<p>Browse to <em><a href="http://192.168.7.2/serverExample/flotDemo.html" class="bare">http://192.168.7.2/serverExample/flotDemo.html</a></em>, and you&#8217;ll have a local version of your demo running.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Go explore the <a href="http://www.flotcharts.org/">Flot site</a> and see what other plots you <span class="keep-together">can do</span>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sending_an_email">Sending an Email</h3>
<div class="sect3">
<h4 id="_problem_68">Problem</h4>
<div class="paragraph">
<p>You want to send an email via Gmail from the Bone.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_68">Solution</h4>
<div class="paragraph">
<p>First, you need to <a href="https://mail.google.com">set up a Gmail account</a>, if you don&#8217;t already have one. Next, install nodemailer:</p>
</div>
<pre data-type="programlisting">
bone# <strong>npm install -g nodemailer</strong>
</pre>
<div class="paragraph">
<p>Then add the code in <a href="#networking_nodemailer_code">Sending email using nodemailer (nodemailer-test.js)</a> to a file named <em>nodemailer-test.js</em> in the <em>serverExample</em> directory. Be sure to substitute your own Gmail username and password for user and pass.</p>
</div>
<div id="networking_nodemailer_code" class="exampleblock">
<div class="title">Example 37. Sending email using nodemailer (nodemailer-test.js)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">#!/usr/bin/env node
// From: https://github.com/andris9/Nodemailer

var nodemailer = require('nodemailer');

// create reusable transporter object using SMTP transport
var transporter = nodemailer.createTransport({
    service: 'gmail',
    auth: {
        user: 'yourUser@gmail.com',
        pass: 'yourPass'
    }
});

// NB! No need to re-create the transporter object. You can use
// the same transporter object for all e-mails

// set up e-mail data with unicode symbols
var mailOptions = {
    from: 'Your User &lt;yourUser@gmail.edu&gt;', // sender address
    to: 'anotherUser@gmail.edu', // list of receivers
    subject: 'Test of nodemail', // Subject line
    text: 'Hello world from modemailer', // plaintext body
    html: '&lt;b&gt;Hello world&lt;/b&gt;&lt;p&gt;Way to go!&lt;/p&gt;' // html body
};

// send mail with defined transport object
transporter.sendMail(mailOptions, function(error, info){
    if(error){
        console.log(error);
    }else{
        console.log('Message sent: ' + info.response);
    }
});

// Nodemailer is licensed under MIT license 
// (https://github.com/andris9/Nodemailer/blob/master/LICENSE). 
// Basically you can do whatever you want to with it</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Then run the script to send the email:</p>
</div>
<pre data-type="programlisting">
bone# <strong>chmod +x nodemailer-test.js</strong>
bone# <strong>.\nodemailer-test.js</strong>
</pre>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>This solution requires your Gmail password to be in plain text in a file, which is a security problem. Make sure you know who has access to your Bone. Also, if you remove the microSD card, make sure you know who has access to it. Anyone with your microSD card can read your Gmail password.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_66">Discussion</h4>
<div class="paragraph">
<p>Be careful about putting this into a loop.  Gmail presently limits you to <a href="http://group-mail.com/email-marketing/how-to-send-bulk-emails-using-gmail/">500 emails per day and 10 MB per message</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sending_an_sms_message">Sending an SMS Message</h3>
<div class="sect3">
<h4 id="_problem_69">Problem</h4>
<div class="paragraph">
<p>You want to send a text message from BeagleBone Black.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_69">Solution</h4>
<div class="paragraph">
<p>There are a number of SMS services out there. This recipe uses Twilio because you can use it for free, but you will need to <a href="http://bit.ly/1MrHBBF">verify the number</a> to which you are texting. First, go to <a href="https://www.twilio.com/">Twilio&#8217;s home page</a> and set up an account. Note your account SID and authorization token. If you are using the free version, be sure to <a href="http://bit.ly/19c7GZ7">verify your numbers</a>.</p>
</div>
<div class="paragraph">
<p>Next, install Trilio by using the following command:</p>
</div>
<pre data-type="programlisting">
bone# <strong>npm install -g twilio</strong>
</pre>
<div class="paragraph">
<p>Finally, add the code in <a href="#networking_twilio_code">Sending SMS messages using Twilio (<em>twilio-test.js</em>)</a> to a file named <em>twilio-test.js</em> and run it. Your text will be sent.</p>
</div>
<div id="networking_twilio_code" class="exampleblock">
<div class="title">Example 38. Sending SMS messages using Twilio (<em>twilio-test.js</em>)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">#!/usr/bin/env node
// From: http://twilio.github.io/twilio-node/
// Twilio Credentials 
var accountSid = ''; 
var authToken = ''; 
 
//require the Twilio module and create a REST client 
var client = require('twilio')(accountSid, authToken); 
 
client.messages.create({ 
	to: "812555121", 
	from: "+2605551212", 
	body: "This is a test",   
}, function(err, message) { 
	console.log(message.sid); 
});

// https://github.com/twilio/twilio-node/blob/master/LICENSE
// The MIT License (MIT)
// Copyright (c) 2010 Stephen Walters
// Copyright (c) 2012 Twilio Inc.

// Permission is hereby granted, free of charge, to any person obtaining a copy of 
// this software and associated documentation files (the "Software"), to deal in 
// the Software without restriction, including without limitation the rights to 
// use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies 
// of the Software, and to permit persons to whom the Software is furnished to do 
// so, subject to the following conditions:

// The above copyright notice and this permission notice shall be included in 
// all copies or substantial portions of the Software.

// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR 
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, 
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL 
// THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER 
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING 
// FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER 
// DEALINGS IN THE SOFTWARE.</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_67">Discussion</h4>
<div class="paragraph">
<p>Twilio allows a small number of free text messages, enough to test your code and to play around some.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_displaying_the_current_weather_conditions">Displaying the Current Weather Conditions</h3>
<div class="sect3">
<h4 id="_problem_70">Problem</h4>
<div class="paragraph">
<p>You want to display the current weather conditions.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_70">Solution</h4>
<div class="paragraph">
<p>Because your Bone is on the network, it&#8217;s not hard to access the current weather conditions from a weather API. First, install a JavaScript module:</p>
</div>
<pre data-type="programlisting">
bone# <strong>npm install -g weather-js</strong>  (Took about 4 minutes on a slow connection)
</pre>
<div class="paragraph">
<p>Then add the code in <a href="#networking_weather_code">Code for getting current weather conditions (<em>weather.js</em>)</a> to a file named <em>weather.js</em>.</p>
</div>
<div id="networking_weather_code" class="exampleblock">
<div class="title">Example 39. Code for getting current weather conditions (<em>weather.js</em>)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">#!/usr/bin/env node
// Install with npm install weather-js
var weather = require('weather-js');

// Options:
// search:     location name or zipcode
// degreeType: F or C

weather.find({search: 'Terre Haute, IN', degreeType: 'F'}, 
  function(err, result) {
    if (err) {
      console.log(err);
    }
    console.log(JSON.stringify(result, null, 2));             // <b class="conum">(1)</b>
    console.log(JSON.stringify(result[0].current, null, 2));  // <b class="conum">(2)</b>
    console.log(JSON.stringify(result[0].forecast[0], null, 2));  // <b class="conum">(3)</b>
  });</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Prints everything returned by the weather site.</p>
</li>
<li>
<p>Prints only the current weather conditions.</p>
</li>
<li>
<p>Prints the forecast for the next day.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Run this by using the following commands:</p>
</div>
<pre data-type="programlisting">
bone# <strong>chmod +x weather.js</strong>
bone# <strong>./weather.js</strong>
...
{
  "temperature": "74",
  "skycode": "28",
  "skytext": "Mostly Cloudy",
  "date": "2014-07-28",
  "observationtime": "14:53:00",
  "observationpoint": "Terre Haute, Terre Haute International Airport -
      Hulman Field",
  "feelslike": "74",
  "humidity": "53",
  "winddisplay": "15 mph NW",
  "day": "Monday",
  "shortday": "Mon",
  "windspeed": "15",
  "imageUrl": "http://wst.s-msn.com/i/en-us/law/28.gif"
}
</pre>
</div>
<div class="sect3">
<h4 id="_discussion_68">Discussion</h4>
<div class="paragraph">
<p>The weather API returns lots of information. Use JavaScript to extract the information you want.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sending_and_receiving_tweets">Sending and Receiving Tweets</h3>
<div class="sect3">
<h4 id="_problem_71">Problem</h4>
<div class="paragraph">
<p>You want to send and receive tweets (Twitter posts) with your Bone.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_71">Solution</h4>
<div class="paragraph">
<p>First, install the Twitter node package:</p>
</div>
<pre data-type="programlisting">
bone# <strong>npm install node-twitter</strong>
</pre>
<div class="paragraph">
<p>Before creating a Twitter app, you need to authenticate with Twitter:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to <a href="https://apps.twitter.com/">the Twitter Application Management page</a> and click Create New App.</p>
</li>
<li>
<p>Fill in the requested information and click "Create your Twitter application." You can leave the Callback URL blank.</p>
</li>
<li>
<p>Click the API Keys tab. If you plan to have the Bone send tweets, click "modify app permissions" to the right of "Access level."</p>
</li>
<li>
<p>Select "Read and Write" and click "Update settings."</p>
</li>
<li>
<p>Click the API Keys tab.</p>
</li>
<li>
<p>Near the bottom of the page, click "Create my access token."</p>
</li>
<li>
<p>Create a file called <em>twitterKeys.js</em> and add the following code to it, substituting your keys for <em>xxx</em>:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">exports.API_KEY      = 'xxx';
exports.API_SECRET   = 'xxx';
exports.TOKEN        = 'xxx';
exports.TOKEN_SECRET = 'xxx';</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the code in <a href="#networking_timeline_code">Code to display your Twitter timeline (twitterTimeLine.js)</a> to a file called <em>twitterTimeLine.js</em> and run it to see your timeline.</p>
</div>
<div id="networking_timeline_code" class="exampleblock">
<div class="title">Example 40. Code to display your Twitter timeline (twitterTimeLine.js)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">#!/usr/bin/env node
// From: https://www.npmjs.org/package/node-twitter
// The Twitter REST API can be accessed using Twitter.RestClient. The following 
// code example shows how to retrieve tweets from the authenticated user's timeline.
var Twitter = require('node-twitter');
var key = require('./twitterKeys');

var twitterRestClient = new Twitter.RestClient(
    key.API_KEY, key.API_SECRET,
    key.TOKEN,   key.TOKEN_SECRET
);

twitterRestClient.statusesHomeTimeline({}, function(error, result) {
    if (error) {
        console.log('Error: ' + 
            (error.code ? error.code + ' ' + error.message : error.message));
    }

    if (result) {
        console.log(result);
    }
});

// node-twitter is made available under terms of the BSD 3-Clause License.
// http://www.opensource.org/licenses/BSD-3-Clause</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Use the code in <a href="#networking_send_code">Code to send a tweet with a picture (twitterUpload.js)</a> to send a tweet with a picture.</p>
</div>
<div id="networking_send_code" class="exampleblock">
<div class="title">Example 41. Code to send a tweet with a picture (twitterUpload.js)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">#!/usr/bin/env node
// From: https://www.npmjs.org/package/node-twitter
// Tweets with attached image media (JPG, PNG or GIF) can be posted 
// using the upload API endpoint.
var Twitter = require('node-twitter');
var b = require('bonescript');
var key = require('./twitterKeys');

var twitterRestClient = new Twitter.RestClient(
    key.API_KEY, key.API_SECRET,
    key.TOKEN,   key.TOKEN_SECRET
);

twitterRestClient.statusesUpdateWithMedia(
    {
        'status': 'Posting a tweet w/ attached media.',
        'media[]': '/root/cookbook-atlas/images/cover.png'
    },
    function(error, result) {
        if (error)  {
            console.log('Error: ' + 
                (error.code ? error.code + ' ' + error.message : error.message));
        }

        if (result)  {
            console.log(result);
        }
    }
);

// node-twitter is made available under terms of the BSD 3-Clause License.
// http://www.opensource.org/licenses/BSD-3-Clause</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The code in <a href="#networking_pushbutton_code">Tweet when a button is pushed (twitterPushbutton.js)</a> sends a tweet whenever a button is pushed.</p>
</div>
<div id="networking_pushbutton_code" class="exampleblock">
<div class="title">Example 42. Tweet when a button is pushed (twitterPushbutton.js)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">#!/usr/bin/env node
// From: https://www.npmjs.org/package/node-twitter
// Tweets with attached image media (JPG, PNG or GIF) can be posted 
// using the upload API endpoint.
var Twitter = require('node-twitter');
var b = require('bonescript');
var key = require('./twitterKeys');
var gpio = "P9_42";
var count = 0;

b.pinMode(gpio, b.INPUT);
b.attachInterrupt(gpio, sendTweet, b.FALLING);

var twitterRestClient = new Twitter.RestClient(
    key.API_KEY, key.API_SECRET,
    key.TOKEN,   key.TOKEN_SECRET
);

function sendTweet() {
    console.log("Sending...");
    count++;

    twitterRestClient.statusesUpdate(
        {'status': 'Posting tweet ' + count + ' via my BeagleBone Black', },
        function(error, result) {
            if (error) {
                console.log('Error: ' + 
                    (error.code ? error.code + ' ' + error.message : error.message));
            }
    
            if (result) {
                console.log(result);
            }
        }
    );
}

// node-twitter is made available under terms of the BSD 3-Clause License.
// http://www.opensource.org/licenses/BSD-3-Clause</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To see many other examples, go to <a href="http://bit.ly/18AvSTW">iStrategyLabs' node-twitter GitHub page</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_69">Discussion</h4>
<div class="paragraph">
<p>This opens up many new possibilities. You can read a temperature sensor and tweet its value whenever it changes, or you can turn on an LED whenever a certain hashtag is used. What are you going to tweet?</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="networking_node_red">Wiring the IoT with Node-RED</h3>
<div class="sect3">
<h4 id="_problem_72">Problem</h4>
<div class="paragraph">
<p>You want BeagleBone to interact with the Internet, but you want to program it graphically.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_72">Solution</h4>
<div class="paragraph">
<p><a href="http://nodered.org/">Node-RED</a> is a visual tool for wiring the IoT. It makes it easy to turn on a light when a certain hashtag is tweeted, or spin a motor if the forecast is for hot weather.</p>
</div>
<div class="sect4">
<h5 id="_installing_node_red">Installing Node-RED</h5>
<div class="paragraph">
<p>To install Node-RED, run the following commands:</p>
</div>
<pre data-type="programlisting">
bone# <strong>cd</strong>          # Change to home directory
bone# <strong>git clone https://github.com/node-red/node-red.git</strong>
bone# <strong>cd node-red/</strong>
bone# <strong>npm install --production</strong>    # almost 6 minutes
bone# <strong>cd nodes</strong>
bone# <strong>git clone https://github.com/node-red/node-red-nodes.git</strong> # 2 seconds
bone# <strong>cd ~/node-red</strong>
</pre>
<div class="paragraph">
<p>To run Node-RED, use the following commands:</p>
</div>
<pre data-type="programlisting">
bone# <strong>cd ~/node-red</strong>
bone# <strong>node red.js</strong>
Welcome to Node-RED
===================

18 Aug 16:31:43 - [red] Version: 0.8.1.git
18 Aug 16:31:43 - [red] Loading palette nodes
18 Aug 16:31:49 - [26-rawserial.js] Info : only really needed for
                  Windows boxes without serialport npm module installed.
18 Aug 16:31:56 - ------------------------------------------
18 Aug 16:31:56 - [red] Failed to register 44 node types
18 Aug 16:31:56 - [red] Run with -v for details
18 Aug 16:31:56 - ------------------------------------------
18 Aug 16:31:56 - [red] Server now running at http://127.0.0.1:1880/
18 Aug 16:31:56 - [red] Loading flows : flows_yoder-debian-bone.json
</pre>
<div class="paragraph">
<p>The second-to-last line informs you that Node-RED is listening on part 1880. Point your browser to <a href="http://192.168.7.2:1880" class="bare">http://192.168.7.2:1880</a>, and you will see the screen shown in <a href="#networking_node_red_fig">The Node-RED web page</a>.</p>
</div>
<div id="networking_node_red_fig" class="imageblock">
<div class="content">
<img src="./0iot/figures/node-red.png" alt="node-red">
</div>
<div class="title">Figure 68. The Node-RED web page</div>
</div>
</div>
<div class="sect4">
<h5 id="_building_a_node_red_flow">Building a Node-RED Flow</h5>
<div class="paragraph">
<p>The example in this recipe builds a Node-RED flow that will toggle an LED whenever a certain hashtag is tweeted. But first, you need to set up the Node-RED flow with the twitter node:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the Node-RED web page, scroll down until you see the social nodes on the left side of the page.</p>
</li>
<li>
<p>Drag the twitter node to the canvas, as shown in <a href="#networking_node_twitter_fig">Node-RED twitter node</a>.</p>
</li>
</ol>
</div>
<div id="networking_node_twitter_fig" class="imageblock">
<div class="content">
<img src="./0iot/figures/node-twitter.png" alt="node-red">
</div>
<div class="title">Figure 69. Node-RED twitter node</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Authorize Twitter by double-clicking the twitter node. You&#8217;ll see the screen shown in <a href="#networking_node_twitter_auth_fig">Node-RED Twitter authorization, step 1</a>.</p>
</li>
</ol>
</div>
<div id="networking_node_twitter_auth_fig" class="imageblock">
<div class="content">
<img src="./0iot/figures/node-twitter-auth.png" alt="node-red authentication">
</div>
<div class="title">Figure 70. Node-RED Twitter authorization, step 1</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Click the pencil button to bring up the dialog box shown in <a href="#networking_node_twitter_auth2_fig">Node-RED twitter authorization, step 2</a>.</p>
</li>
</ol>
</div>
<div id="networking_node_twitter_auth2_fig" class="imageblock">
<div class="content">
<img src="./0iot/figures/node-twitter-auth2.png" alt="node-red authentication2">
</div>
<div class="title">Figure 71. Node-RED twitter authorization, step 2</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Click the "here" link, as shown in <a href="#networking_node_twitter_auth2_fig">Node-RED twitter authorization, step 2</a>, and you&#8217;ll be taken to Twitter to authorize Node-RED.</p>
</li>
<li>
<p>Log in to Twitter and click the "Authorize app" button (<a href="#networking_node_twitter_auth3_fig">Node-RED Twitter site authorization</a>).</p>
</li>
</ol>
</div>
<div id="networking_node_twitter_auth3_fig" class="imageblock">
<div class="content">
<img src="./0iot/figures/node-twitter-auth3.png" alt="node-red authentication3">
</div>
<div class="title">Figure 72. Node-RED Twitter site authorization</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>When you&#8217;re back to Node-RED, click the Add button, add your Twitter credentials, enter the hashtags to respond to (<a href="#networking_node_twitter_beagle_fig">Node-RED adding the #BeagleBone hashtag</a>), and then click the Ok <span class="keep-together">button</span>.</p>
</li>
</ol>
</div>
<div id="networking_node_twitter_beagle_fig" class="imageblock">
<div class="content">
<img src="./0iot/figures/node-twitter-beagle.png" alt="node-red beagle hash">
</div>
<div class="title">Figure 73. Node-RED adding the #BeagleBone hashtag</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Go back to the left panel, scroll up to the top, and then drag the debug node to the canvas. (debug is in the output section.)</p>
</li>
<li>
<p>Connect the two nodes by clicking and dragging (<a href="#networking_node_twitter_debug_fig">Node-RED Twitter adding debug node and connecting</a>).</p>
</li>
</ol>
</div>
<div id="networking_node_twitter_debug_fig" class="imageblock">
<div class="content">
<img src="./0iot/figures/node-twitter-debug.png" alt="node-red debug">
</div>
<div class="title">Figure 74. Node-RED Twitter adding debug node and connecting</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>In the right panel, in the upper-right corner, click the "debug" tab.</p>
</li>
<li>
<p>Finally, click the Deploy button above the "debug" tab.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Your Node-RED flow is now running on the Bone. Test it by going to Twitter and tweeting something with the hashtag #BeagleBone. Your Bone is now responding to events happening out in the world.</p>
</div>
</div>
<div class="sect4">
<h5 id="_adding_an_led_toggle">Adding an LED Toggle</h5>
<div class="paragraph">
<p>Now, we&#8217;re ready to add the LED toggle:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Wire up an LED as shown in <a href="#displays_externalLED">Toggling an External LED</a>. Mine is wired to P9_14.</p>
</li>
<li>
<p>Scroll to the bottom of the left panel and drag the bbb-discrete-out node (second from the bottom of the bbb nodes) to the canvas and wire it (<a href="#networking_node_bbb_out_fig">Node-RED adding bbb-discrete-out node</a>).</p>
</li>
</ol>
</div>
<div id="networking_node_bbb_out_fig" class="imageblock">
<div class="content">
<img src="./0iot/figures/node-disc-out.png" alt="node-red discrete out node">
</div>
<div class="title">Figure 75. Node-RED adding bbb-discrete-out node</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Double-click the node, select your GPIO pin and "Toggle state," and then set "Startup as" to 1 (<a href="#networking_node_bbb_out_setup_fig">Node-RED adding bbb-discrete-out configuration</a>).</p>
</li>
</ol>
</div>
<div id="networking_node_bbb_out_setup_fig" class="imageblock">
<div class="content">
<img src="./0iot/figures/node-disc-out-setup.png" alt="node-red discrete out setup">
</div>
<div class="title">Figure 76. Node-RED adding bbb-discrete-out configuration</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Click Ok and then Deploy.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Test again. The LED will toggle every time the hashtag #BeagleBone is tweeted. With a little more exploring, you should be able to have your Bone ringing a bell or spinning a motor in response to tweets.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_70">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="networking_apache">Serving Web Pages from the Bone by Using Apache</h3>
<div class="sect3">
<h4 id="_problem_73">Problem</h4>
<div class="paragraph">
<p>You want to use BeagleBone Black as an Apache web server.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_73">Solution</h4>
<div class="paragraph">
<p><a href="https://httpd.apache.org/">Apache</a> (the most popular web server on the Internet since 1996) is already running on the Bone. Point your browser to <em><a href="http://192.168.7.2:8080/" class="bare">http://192.168.7.2:8080/</a></em>, and you&#8217;ll see a screen that looks like <a href="#networking_apacheNoFiles">Apache running on the Bone with no files to view</a>.</p>
</div>
<div id="networking_apacheNoFiles" class="imageblock">
<div class="content">
<img src="./0iot/figures/apacheNoFiles.png" alt="Apache with no files">
</div>
<div class="title">Figure 77. Apache running on the Bone with no files to view</div>
</div>
<div class="paragraph">
<p>What you are seeing is a listing of the files in Apache&#8217;s root directory (<em>/var/www/</em>).  In this case, there are no files to show. Add the HTML in <a href="#networking_index_html">A sample web page (test.html)</a> to a file called <em>/var/www/test.html</em> and refresh your browser. You will see the screen shown in <a href="#networking_apacheTest_html">The test.html file appears</a>.</p>
</div>
<div id="networking_apacheTest_html" class="imageblock">
<div class="content">
<img src="./0iot/figures/apacheTest.png" alt="Apache with test.html">
</div>
<div class="title">Figure 78. The test.html file appears</div>
</div>
<div class="paragraph">
<p>Click the <em>test.html</em> link to display the screen in <a href="#networking_apacheIndex">Apache running on the Bone showing test.html</a>.</p>
</div>
<div id="networking_apacheIndex" class="imageblock">
<div class="content">
<img src="./0iot/figures/apacheIndex.png" alt="Apache with index.html">
</div>
<div class="title">Figure 79. Apache running on the Bone showing test.html</div>
</div>
<div class="paragraph">
<p>You can place any number of files in <em>/var/www/</em> and access them with Apache.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_71">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="_communicating_over_a_serial_connection_to_an_arduino_or_launchpad">Communicating over a Serial Connection to an Arduino or LaunchPad</h3>
<div class="sect3">
<h4 id="_problem_74">Problem</h4>
<div class="paragraph">
<p>You would like your Bone to talk to an Arduino or LaunchPad.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_74">Solution</h4>
<div class="paragraph">
<p>The common serial port (also know as a UART) is the simplest way to talk between the two.  Wire it up as shown in <a href="#networking_launchPad_fig">Wiring a LaunchPad to a Bone via the common serial port</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>BeagleBone Black runs at 3.3 V. When wiring other devices to it, ensure that they are also 3.3 V. The LaunchPad I&#8217;m using is 3.3 V, but many Arduinos are 5.0 V and thus won&#8217;t work. Or worse, they might damage your Bone.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="networking_launchPad_fig" class="imageblock">
<div class="content">
<img src="./0iot/figures/launchPad_bb.png" alt="MSP430 LaunchPad">
</div>
<div class="title">Figure 80. Wiring a LaunchPad to a Bone via the common serial port</div>
</div>
<div class="paragraph">
<p>Add the code (or <em>sketch</em>, as it&#8217;s called in Arduino-speak) in <a href="#js_launchPad_code">LaunchPad code for communicating via the UART (launchPad.ino)</a> to a file called <em>launchPad.ino</em> and run it on your LaunchPad.</p>
</div>
<div id="js_launchPad_code" class="exampleblock">
<div class="title">Example 43. LaunchPad code for communicating via the UART (launchPad.ino)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">/*
  Tests connection to a BeagleBone
  Mark A. Yoder
  Waits for input on Serial Port
  g - Green toggle
  r - Red toggle
*/
char inChar = 0; // incoming serial byte
int red = 0;
int green = 0;

void setup()
{
  // initialize the digital pin as an output.
  pinMode(RED_LED, OUTPUT);           // <b class="conum">(1)</b>
  pinMode(GREEN_LED, OUTPUT);  
  // start serial port at 9600 bps:
  Serial.begin(9600);                 // <b class="conum">(2)</b>
  Serial.print("Command (r, g): ");   // <b class="conum">(3)</b>
  
  digitalWrite(GREEN_LED, green);     // <b class="conum">(4)</b>
  digitalWrite(  RED_LED, red);
}

void loop()
{
  if(Serial.available() &gt; 0 ) {       // <b class="conum">(5)</b>
    inChar = Serial.read();
    switch(inChar) {                  // <b class="conum">(6)</b>
      case 'g':
        green = ~green;
        digitalWrite(GREEN_LED, green);
        Serial.println("Green");
        break;
      case 'r':
        red = ~red;
        digitalWrite(RED_LED, red);
        Serial.println("Red");
        break;
    }
    Serial.print("Command (r, g): ");
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Set the mode for the built-in red and green LEDs.</p>
</li>
<li>
<p>Start the serial port at 9600 baud.</p>
</li>
<li>
<p>Prompt the user, which in this case is the Bone.</p>
</li>
<li>
<p>Set the LEDs to the current values of the red and green variables.</p>
</li>
<li>
<p>Wait for characters to arrive on the serial port.</p>
</li>
<li>
<p>After the characters are received, read it and respond to it.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>On the Bone, add the script in <a href="#js_launchPadBeagle_code">Code for communicating via the UART (launchPad.js)</a> to a file called <em>launchPad.js</em> and run it.</p>
</div>
<div id="js_launchPadBeagle_code" class="exampleblock">
<div class="title">Example 44. Code for communicating via the UART (launchPad.js)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">#!/usr/bin/env node
// Need to add exports.serialParsers = m.module.parsers;
// to /usr/local/lib/node_modules/bonescript/serial.js
var b = require('bonescript');

var port = '/dev/ttyO1';                    // <b class="conum">(1)</b>
var options = {
    baudrate: 9600,                         // <b class="conum">(2)</b>
    parser: b.serialParsers.readline("\n")  // <b class="conum">(3)</b>
};

b.serialOpen(port, options, onSerial);      // <b class="conum">(4)</b>

function onSerial(x) {                      // <b class="conum">(5)</b>
    console.log(x.event);
    if (x.err) {
        console.log('***ERROR*** ' + JSON.stringify(x));
    }
    if (x.event == 'open') {
        console.log('***OPENED***');
        setInterval(sendCommand, 1000);     // <b class="conum">(6)</b>
    }
    if (x.event == 'data') {
        console.log(String(x.data));
    }
}

var command = ['r', 'g'];                   // <b class="conum">(7)</b>
var commIdx = 1;

function sendCommand() {
    // console.log('Command: ' + command[commIdx]);
    b.serialWrite(port, command[commIdx++]); // <b class="conum">(8)</b>
    if(commIdx &gt;= command.length) {         // <b class="conum">(9)</b>
        commIdx = 0;
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Select which serial port to use. <a href="#networking_cape-headers-serial_fig">Table of UART outputs</a> shows what&#8217;s available. We&#8217;ve wired P9_24 and P9_26, so we are using serial port /dev/ttyO1. (Note that&#8217;s the letter <em>O</em> and not the number <em>zero</em>.)</p>
</li>
<li>
<p>Set the baudrate to 9600, which matches the setting on the LaunchPad.</p>
</li>
<li>
<p>Read one line at a time up to the newline character (\n).</p>
</li>
<li>
<p>Open the serial port and call onSerial() whenever there is data available.</p>
</li>
<li>
<p>Determine what event has happened on the serial port and respond to it.</p>
</li>
<li>
<p>If the serial port has been opened, start calling sendCommand() every 1000 ms.</p>
</li>
<li>
<p>These are the two commands to send.</p>
</li>
<li>
<p>Write the character out to the serial port and to the LaunchPad.</p>
</li>
<li>
<p>Move to the next command.</p>
</li>
</ol>
</div>
<div id="networking_cape-headers-serial_fig" class="imageblock">
<div class="content">
<img src="./0iot/figures/cape-headers-serial.png" alt="UART outputs">
</div>
<div class="title">Figure 81. Table of UART outputs</div>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_72">Discussion</h4>
<div class="paragraph">
<p>When you run the script in <a href="#js_launchPadBeagle_code">Code for communicating via the UART (launchPad.js)</a>, the Bone opens up the serial port and every second sends a new command, either r or g. The LaunchPad waits for the command and, when it arrives, responds by toggling the corresponding LED.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kernel">The Kernel</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_7">Introduction</h3>
<div class="paragraph">
<p>The kernel is the heart of the Linux operating system. It&#8217;s the software that takes the low-level requests, such as reading or writing files, or reading and writing general-purpose input/output (GPIO) pins, and maps them to the hardware. When you install a new version of the OS (<a href="#basics_latest_os">Verifying You Have the Latest Version of the OS on Your Bone</a>), you get a certain version of the kernel.</p>
</div>
<div class="paragraph">
<p>You usually won&#8217;t need to mess with the kernel, but sometimes you might want to try something new that requires a different kernel. This chapter shows how to switch kernels. The nice thing is you can have multiple kernels on your system at the same time and select from among them which to boot up.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>We assume here that you are logged on to your Bone as root and superuser privileges. You also need to be logged in to your Linux host computer as a nonsuperuser.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_updating_the_kernel">Updating the Kernel</h3>
<div class="sect3">
<h4 id="_problem_75">Problem</h4>
<div class="paragraph">
<p>You have an out-of-date kernel and want to want to make it current.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_75">Solution</h4>
<div class="paragraph">
<p>Use the following command to determine which kernel you are running:</p>
</div>
<pre data-type="programlisting">
bone# <strong>uname -a</strong>
Linux beaglebone <strong>3.8.13-bone67</strong> #1 SMP Wed Sep 24 21:30:03 UTC 2014 armv7l
 GNU/Linux
</pre>
<div class="paragraph">
<p>The 3.8.13-bone67 string is the kernel version.</p>
</div>
<div class="paragraph">
<p>To update to the current kernel, ensure that your Bone is on the Internet (<a href="#networking_usb">Sharing the Host&#8217;s Internet Connection over USB</a> or <a href="#networking_wired">Establishing an Ethernet-Based Internet Connection</a>) and then run the following commands:</p>
</div>
<pre data-type="programlisting">
bone# <strong>apt-cache pkgnames | grep linux-image | sort | less</strong>
...
linux-image-3.15.8-armv7-x5
linux-image-3.15.8-bone5
linux-image-3.15.8-bone6
...
linux-image-3.16.0-rc7-bone1
...
linux-image-3.8.13-bone60
linux-image-3.8.13-bone61
linux-image-3.8.13-bone62
bone# <strong>apt-get install linux-image-3.14.23-ti-r35</strong>
bone# <strong>reboot</strong>
bone# <strong>uname -a</strong>
Linux beaglebone 3.14.23-ti-r35 #1 SMP PREEMPT Wed Nov 19 21:11:08 UTC 2014 armv7l
 GNU/Linux
</pre>
<div class="paragraph">
<p>The first command lists the versions of the kernel that are available. The second command installs one. After you have rebooted, the new kernel will be running.</p>
</div>
<div class="paragraph">
<p>If the current kernel is doing its job adequately, you probably don&#8217;t need to update, but sometimes a new software package requires a more up-to-date kernel. Fortunately, precompiled kernels are available and ready to download.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_73">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="kernel_building_modules">Building and Installing Kernel Modules</h3>
<div class="sect3">
<h4 id="_problem_76">Problem</h4>
<div class="paragraph">
<p>You need to use a peripheral for which there currently is no driver, or you need to improve the performance of an interface previously handled in user space.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_76">Solution</h4>
<div class="paragraph">
<p>The solution is to run in kernel space by building a kernel module. There are entire <a href="http://bit.ly/1Fb0usf">books on writing Linux Device Drivers</a>. This recipe assumes that the driver has already been written and shows how to compile and install it. After you&#8217;ve followed the steps for this simple module, you will be able to apply them to any other module.</p>
</div>
<div class="paragraph">
<p>For our example module, add the code in <a href="#kernel_simple_module">Simple Kernel Module (hello.c)</a> to a file called <em>hello.c</em>.</p>
</div>
<div id="kernel_simple_module" class="exampleblock">
<div class="title">Example 45. Simple Kernel Module (hello.c)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">#include &lt;linux/module.h&gt;       /* Needed by all modules */
#include &lt;linux/kernel.h&gt;       /* Needed for KERN_INFO */
#include &lt;linux/init.h&gt;         /* Needed for the macros */

static int __init hello_start(void)
{
    printk(KERN_INFO "Loading hello module...\n");
    printk(KERN_INFO "Hello, World!\n");
    return 0;
}

static void __exit hello_end(void)
{
    printk(KERN_INFO "Goodbye Boris\n");
}

module_init(hello_start);
module_exit(hello_end);

MODULE_AUTHOR("Boris Houndleroy");
MODULE_DESCRIPTION("Hello World Example");
MODULE_LICENSE("GPL");</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When compiling on the Bone, all you need to do is load the Kernel Headers for the version of the kernel you&#8217;re running:</p>
</div>
<pre data-type="programlisting">
bone# <strong>apt-get install linux-headers-`uname -r`</strong>
</pre>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The quotes around `uname -r` are backtick characters. On a United States keyboard, the backtick key is to the left of the 1 key.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This took a little more than three minutes on my Bone. The `uname -r` part of the command looks up what version of the kernel you are running and loads the headers for it.</p>
</div>
<div class="paragraph">
<p>Next, add the code in <a href="#kernel_Makefle">Simple Kernel Module (<em>Makefile</em>)</a> to a file called <em>Makefile</em>.</p>
</div>
<div id="kernel_Makefle" class="exampleblock">
<div class="title">Example 46. Simple Kernel Module (<em>Makefile</em>)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">obj-m := hello.o
KDIR  := /lib/modules/$(shell uname -r)/build

all:
&lt;TAB&gt;make -C $(KDIR) M=$$PWD
	
clean:
&lt;TAB&gt;rm hello.mod.c hello.o modules.order hello.mod.o Module.symvers</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Replace the two instances of &lt;TAB&gt; with a tab character (the key left of the Q key on a United States keyboard). The tab characters are very important to makefiles and must appear as shown.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now, compile the kernel module by using the make command:</p>
</div>
<pre data-type="programlisting">
bone# <strong>make</strong>
make -C /lib/modules/3.8.13-bone67/build \
      SUBDIRS=/root/cookbook-atlas/code/hello modules
make[1]: Entering directory `/usr/src/linux-headers-3.8.13-bone67'
  CC [M]  /root/cookbook-atlas/code/hello/hello.o
  Building modules, stage 2.
  MODPOST 1 modules
  CC      /root/cookbook-atlas/code/hello/hello.mod.o
  LD [M]  /root/cookbook-atlas/code/hello/hello.ko
make[1]: Leaving directory `/usr/src/linux-headers-3.8.13-bone67'
bone# <strong>ls</strong>
Makefile        hello.c   hello.mod.c  hello.o
Module.symvers  hello.ko  hello.mod.o  modules.order
</pre>
<div class="paragraph">
<p>Notice that several files have been created. <em>hello.ko</em> is the one you want. Try a couple of commands with it:</p>
</div>
<pre data-type="programlisting">
bone# <strong>modinfo hello.ko</strong>
filename:       /root/hello/hello.ko
srcversion:     87C6AEED7791B4B90C3B50C
depends:
vermagic:       3.8.13-bone67 SMP mod_unload modversions ARMv7 thumb2 p2v8
bone# <strong>insmod hello.ko</strong>
bone# <strong>dmesg | tail -4</strong>
[419313.320052] bone-iio-helper helper.15: ready
[419313.322776] bone-capemgr bone_capemgr.9: slot #8: Applied #1 overlays.
[491540.999431] Loading hello module...
[491540.999476] Hello world
</pre>
<div class="paragraph">
<p>The first command displays information about the module. The insmod command inserts the module into the running kernel. If all goes well, nothing is displayed, but the module does print something in the kernel log. The dmesg command displays the messages in the log, and the tail -4 command shows the last four messages. The last two messages are from the module. It worked!</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_74">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="kernel_LEDs">Controlling LEDs by Using SYSFS Entries</h3>
<div class="sect3">
<h4 id="_problem_77">Problem</h4>
<div class="paragraph">
<p>You want to control the onboard LEDs from the command line.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_77">Solution</h4>
<div class="paragraph">
<p>On Linux, <a href="http://bit.ly/1AjhWUW">everything is a file</a>; that is, you can access all the inputs and outputs, the LEDs, and so on by opening the right <em>file</em> and reading or writing to it. For example, try the following:</p>
</div>
<pre data-type="programlisting">
bone# <strong>cd /sys/class/leds/</strong>
bone# <strong>ls</strong>
beaglebone:green:usr0  beaglebone:green:usr2
beaglebone:green:usr1  beaglebone:green:usr3
</pre>
<div class="paragraph">
<p>What you are seeing are four directories, one for each onboard LED. Now try this:</p>
</div>
<pre data-type="programlisting">
bone# <strong>cd beaglebone\:green\:usr0</strong>
bone# <strong>ls</strong>
brightness  device  max_brightness  power  subsystem  trigger  uevent
bone# <strong>cat trigger</strong>
none nand-disk mmc0 mmc1 timer oneshot [heartbeat]
     backlight gpio cpu0 default-on transient
</pre>
<div class="paragraph">
<p>The first command changes into the directory for LED usr0, which is the LED closest to the edge of the board. The [heartbeat] indicates that the default trigger (behavior) for the LED is to blink in the heartbeat pattern. Look at your LED.  Is it blinking in a heartbeat pattern?</p>
</div>
<div class="paragraph">
<p>Then try the following:</p>
</div>
<pre data-type="programlisting">
bone# <strong>echo none > trigger</strong>
bone# <strong>cat trigger</strong>
[none] nand-disk mmc0 mmc1 timer oneshot heartbeat
       backlight gpio cpu0 default-on transient
</pre>
<div class="paragraph">
<p>This instructs the LED to use none for a trigger. Look again. It should be no longer blinking.</p>
</div>
<div class="paragraph">
<p>Now, try turning it on and off:</p>
</div>
<pre data-type="programlisting">
bone# <strong>echo 1 > brightness</strong>
bone# <strong>echo 0 > brightness</strong>
</pre>
<div class="paragraph">
<p>The LED should be turning on and off with the commands.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_75">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="kernel_gpio_sysfs">Controlling GPIOs by Using SYSFS Entries</h3>
<div class="sect3">
<h4 id="_problem_78">Problem</h4>
<div class="paragraph">
<p>You want to control a GPIO pin from the command line.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_78">Solution</h4>
<div class="paragraph">
<p><a href="#kernel_LEDs">Controlling LEDs by Using SYSFS Entries</a> introduces the sysfs. This recipe shows how to read and write a GPIO pin.</p>
</div>
<div class="sect4">
<h5 id="_reading_a_gpio_pin_via_sysfs">Reading a GPIO Pin via sysfs</h5>
<div class="paragraph">
<p>Suppose that you want to read the state of the P9_42 GPIO pin. (<a href="#sensors_pushbutton">Reading the Status of a Pushbutton or Magnetic Switch (Passive On/Off Sensor)</a> shows how to wire a switch to P9_42.)  First, you need to map the P9 header location to GPIO number using <a href="#kernel_gpio_map_fig">Mapping P9_42 header position to GPIO 7</a>, which shows that P9_42 maps to GPIO 7.</p>
</div>
<div id="kernel_gpio_map_fig" class="imageblock">
<div class="content">
<img src="./07kernel/figures/cape-headers-digitalGPIO7.png" alt="Mapping Header Position to GPIO Numbers">
</div>
<div class="title">Figure 82. Mapping P9_42 header position to GPIO 7</div>
</div>
<div class="paragraph">
<p>Next, change to the GPIO sysfs directory:</p>
</div>
<pre data-type="programlisting">
bone# <strong>cd /sys/class/gpio/</strong>
bone# <strong>ls</strong>
export  gpiochip0  gpiochip32  gpiochip64  gpiochip96  unexport
</pre>
<div class="paragraph">
<p>The ls command shows all the GPIO pins that have be exported. In this case, none have, so you see only the four GPIO controllers. Export using the export command:</p>
</div>
<pre data-type="programlisting">
bone# <strong>echo 7 > export</strong>
bone# <strong>ls</strong>
export  gpio7  gpiochip0  gpiochip32  gpiochip64  gpiochip96  unexport
</pre>
<div class="paragraph">
<p>Now you can see the <em>gpio7</em> directory. Change into the <em>gpio7</em> directory and look around:</p>
</div>
<pre data-type="programlisting">
bone# <strong>cd gpio7</strong>
bone# <strong>ls</strong>
active_low  direction  edge  power  subsystem  uevent  value
bone# <strong>cat direction</strong>
in
bone# <strong>cat value</strong>
0
</pre>
<div class="paragraph">
<p>Notice that the pin is already configured to be an input pin. (If it wasn&#8217;t already configured that way, use echo in &gt; direction to configure it.) You can also see that its current value is 0—that is, it isn&#8217;t pressed. Try pressing and holding it and running again:</p>
</div>
<pre data-type="programlisting">
bone# <strong>cat value</strong>
1
</pre>
<div class="paragraph">
<p>The 1 informs you that the switch is pressed. When you are done with GPIO 7, you can always unexport it:</p>
</div>
<pre data-type="programlisting">
bone# <strong>cd ..</strong>
bone# <strong>echo 7 > unexport</strong>
bone# <strong>ls</strong>
export  gpiochip0  gpiochip32  gpiochip64  gpiochip96  unexport
</pre>
</div>
<div class="sect4">
<h5 id="_writing_a_gpio_pin_via_sysfs">Writing a GPIO Pin via sysfs</h5>
<div class="paragraph">
<p>Now, suppose that you want to control an external LED. <a href="#displays_externalLED">Toggling an External LED</a> shows how to wire an LED to P9_14. <a href="#kernel_gpio_map_fig">Mapping P9_42 header position to GPIO 7</a> shows P9_14 is GPIO 50. Following the approach in <a href="#kernel_gpio_sysfs">Controlling GPIOs by Using SYSFS Entries</a>, enable GPIO 50 and make it an output:</p>
</div>
<pre data-type="programlisting">
bone# <strong>cd /sys/class/gpio/</strong>
bone# <strong>echo 50 > export</strong>
bone# <strong>ls</strong>
gpio50  gpiochip0  gpiochip32  gpiochip64  gpiochip96
bone# <strong>cd gpio50</strong>
bone# <strong>ls</strong>
active_low  direction  edge  power  subsystem  uevent  value
bone# <strong>cat direction</strong>
in
</pre>
<div class="paragraph">
<p>By default, P9_14 is set as an input. Switch it to an output and turn it on:</p>
</div>
<pre data-type="programlisting">
bone# <strong>echo out > direction</strong>
bone# <strong>echo 1 > value</strong>
bone# <strong>echo 0 > value</strong>
</pre>
<div class="paragraph">
<p>The LED turns on when a 1 is written to value and turns off when a 0 is written.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_76">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="kernel_compiling">Compiling the Kernel</h3>
<div class="sect3">
<h4 id="_problem_79">Problem</h4>
<div class="paragraph">
<p>You need to download, patch, and compile the kernel from its source code.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_79">Solution</h4>
<div class="paragraph">
<p>This is easier than it sounds, thanks to some very powerful scripts.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Be sure to run this recipe on your host computer. The Bone has enough computational power to compile a module or two, but compiling the entire kernel takes lots of time and resourses.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_downloading_and_compiling_the_kernel">Downloading and Compiling the Kernel</h5>
<div class="paragraph">
<p>To download and compile the kernel, follow these steps:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">host$ git clone https://github.com/RobertCNelson/bb-kernel.git # <b class="conum">(1)</b>
host$ cd bb-kernel
host$ git tag # <b class="conum">(2)</b>
host$ git checkout 3.8.13-bone60 -b v3.8.13-bone60 # <b class="conum">(3)</b>
host$ ./build_kernel.sh # <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The first command clones a repository with the tools to build the kernel for the Bone.</p>
</li>
<li>
<p>This command lists all the different versions of the kernel that you can build. You&#8217;ll need to pick one of these. How do you know which one to pick? A good first step is to choose the one you are currently running.  uname -a will reveal which one that is. When you are able to reproduce the current kernel, go to <a href="http://kernelnewbies.org/">Linux Kernel Newbies</a> to see what features are available in other kernels. <a href="http://bit.ly/1AjiL00">LinuxChanges</a> shows the features in the newest kernel and <a href="http://bit.ly/1MrIHx3">LinuxVersions</a> links to features of pervious kernels.</p>
</li>
<li>
<p>When you know which kernel to try, use git checkout to check it out. This command checks out at tag 3.8.13-bone60 and creates a new branch, v3.8.13-bone60.</p>
</li>
<li>
<p>build_kernel is the master builder. If needed, it will download the cross compilers needed to compile the kernel (linaro [<a href="http://www.linaro.org/" class="bare">http://www.linaro.org/</a>] is the current cross compiler). If there is a kernel at <em>~/linux-dev</em>, it will use it; otherwise, it will download a copy to <em>bb-kernel/ignore/linux-src</em>. It will then patch the kernel so that it will run on the Bone.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>After the kernel is patched, you&#8217;ll see a screen similar to <a href="#kernel_config_fig">Kernel configuration menu</a>, on which you can configure the kernel.</p>
</div>
<div id="kernel_config_fig" class="imageblock">
<div class="content">
<img src="./07kernel/figures/KernelConfig3.16.png" alt="Kernel configuration menu">
</div>
<div class="title">Figure 83. Kernel configuration menu</div>
</div>
<div class="paragraph">
<p>You can use the arrow keys to navigate. No changes need to be made, so you can just press the right arrow and Enter to start the kernel compiling. The entire process took about 25 minutes on my 8-core host.</p>
</div>
<div class="paragraph">
<p>The <em>bb-kernel/KERNEL</em> directory contains the source code for the kernel. The <em>bb-kernel/deploy</em> directory contains the compiled kernel and the files needed to run it.</p>
</div>
</div>
<div class="sect4">
<h5 id="kernel_install">Installing the Kernel on the Bone</h5>
<div class="paragraph">
<p>To copy the new kernel and all its files to the microSD card, you need to halt the Bone, and then pull the microSD card out and put it in an microSD card reader on your host computer. Run Disk (see <a href="#basics_latest_os">Verifying You Have the Latest Version of the OS on Your Bone</a>) to learn where the microSD card appears on your host (mine appears in <em>/dev/sdb</em>). Then open the <em>bb-kernel/system.sh</em> file and find this line near the end:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">#MMC=/dev/sde</code></pre>
</div>
</div>
<div class="paragraph">
<p>Change that line to look like this (where /dev/sdb is the path to your device):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">MMC=/dev/sdb</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, while in the <em>bb-kernel</em> directory, run the following command:</p>
</div>
<pre data-type="programlisting">
host$ <strong>tools/install_kernel.sh</strong>
[sudo] password for yoder:

I see...
fdisk -l:
Disk /dev/sda: 160.0 GB, 160041885696 bytes
Disk /dev/sdb: 3951 MB, 3951034368 bytes
Disk /dev/sdc: 100 MB, 100663296 bytes

lsblk:
NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
sda      8:0    0 149.1G  0 disk
├─sda1   8:1    0 141.1G  0 part /
├─sda2   8:2    0     1K  0 part
└─sda5   8:5    0     8G  0 part [SWAP]
sdb      8:16   1   3.7G  0 disk
├─sdb1   8:17   1    16M  0 part
└─sdb2   8:18   1   3.7G  0 part
sdc      8:32   1    96M  0 disk
-----------------------------
Are you 100% sure, on selecting [/dev/sdb] (y/n)? y
</pre>
<div class="paragraph">
<p>The script lists the partitions it sees and asks if you have the correct one. If you are sure, press Y, and the script will uncompress and copy the files to the correct locations on your card. When this is finished, eject your card, plug it into the Bone, and boot it up. Run uname -a, and you will see that you are running your compiled kernel.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_77">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="kernel_using_cross_compiler">Using the Installed Cross Compiler</h3>
<div class="sect3">
<h4 id="_problem_80">Problem</h4>
<div class="paragraph">
<p>You have followed the instructions in <a href="#kernel_compiling">Compiling the Kernel</a> and want to use the cross compiler it has downloaded.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can cross-compile without installing the entire kernel source by running the following:</p>
</div>
<pre data-type="programlisting">
host$ <strong>sudo apt-get install gcc-arm-linux-gnueabihf</strong>
</pre>
<div class="paragraph">
<p>Then skip down to <a href="#kernel_skip_to_here">Setting Up Variables</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_solution_80">Solution</h4>
<div class="paragraph">
<p><a href="#kernel_compiling">Compiling the Kernel</a> installs a cross compiler, but you need to set up a couple of things so that it can be found. <a href="#kernel_compiling">Compiling the Kernel</a> installed the kernel and other tools in a directory called <em>bb-kernel</em>. Run the following commands to find the path to the cross compiler:</p>
</div>
<pre data-type="programlisting">
host$ <strong>cd bb-kernel/dl</strong>
host$ <strong>ls</strong>
gcc-linaro-arm-linux-gnueabihf-4.7-2013.04-20130415_linux
gcc-linaro-arm-linux-gnueabihf-4.7-2013.04-20130415_linux.tar.xz
</pre>
<div class="paragraph">
<p>Here, the path to the cross compiler contains the version number of the compiler. Yours might be different from mine. cd into it:</p>
</div>
<pre data-type="programlisting">
host$ <strong>cd gcc-linaro-arm-linux-gnueabihf-4.7-2013.04-20130415_linux</strong>
host$ <strong>ls</strong>
20130415-gcc-linaro-arm-linux-gnueabihf  bin  libexec
arm-linux-gnueabihf                      lib  share
</pre>
<div class="paragraph">
<p>At this point, we are interested in what&#8217;s in <em>bin</em>:</p>
</div>
<pre data-type="programlisting">
host$ <strong>cd bin</strong>
host$ <strong>ls</strong>
arm-linux-gnueabihf-addr2line     arm-linux-gnueabihf-gfortran
arm-linux-gnueabihf-ar            arm-linux-gnueabihf-gprof
arm-linux-gnueabihf-as            arm-linux-gnueabihf-ld
arm-linux-gnueabihf-c++           arm-linux-gnueabihf-ld.bfd
arm-linux-gnueabihf-c++filt       arm-linux-gnueabihf-ldd
arm-linux-gnueabihf-cpp           arm-linux-gnueabihf-ld.gold
arm-linux-gnueabihf-ct-ng.config  arm-linux-gnueabihf-nm
arm-linux-gnueabihf-elfedit       arm-linux-gnueabihf-objcopy
arm-linux-gnueabihf-g++           arm-linux-gnueabihf-objdump
arm-linux-gnueabihf-gcc           arm-linux-gnueabihf-pkg-config
arm-linux-gnueabihf-gcc-4.7.3     arm-linux-gnueabihf-pkg-config-real
arm-linux-gnueabihf-gcc-ar        arm-linux-gnueabihf-ranlib
arm-linux-gnueabihf-gcc-nm        arm-linux-gnueabihf-readelf
arm-linux-gnueabihf-gcc-ranlib    arm-linux-gnueabihf-size
arm-linux-gnueabihf-gcov          arm-linux-gnueabihf-strings
arm-linux-gnueabihf-gdb           arm-linux-gnueabihf-strip
</pre>
<div class="paragraph">
<p>What you see are all the cross-development tools. You need to add this directory to the $PATH the shell uses to find the commands it runs:</p>
</div>
<pre data-type="programlisting">
host$ <strong>pwd</strong>
/home/yoder/BeagleBoard/bb-kernel/dl/\
    gcc-linaro-arm-linux-gnueabihf-4.7-2013.04-20130415_linux/bin

host$ <strong>echo $PATH</strong>
    /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:\
    /usr/games:/usr/local/games
</pre>
<div class="paragraph">
<p>The first command displays the path to the directory where the cross-development tools are located. The second shows which directories are searched to find commands to be run. Currently, the cross-development tools are not in the $PATH. Let&#8217;s add it:</p>
</div>
<pre data-type="programlisting">
host$ <strong>export PATH=`pwd`:$PATH</strong>
host$ <strong>echo $PATH</strong>
/home/yoder/BeagleBoard/bb-kernel/dl/\
    gcc-linaro-arm-linux-gnueabihf-4.7-2013.04-20130415_linux/bin:\
    /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:\
    /usr/games:/usr/local/games
</pre>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Those are backtick characters (left of the "1" key on your keyboard) around pwd.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The second line shows the $PATH now contains the directory with the cross-development tools.</p>
</div>
</div>
<div class="sect3">
<h4 id="kernel_skip_to_here">Setting Up Variables</h4>
<div class="paragraph">
<p>Now, set up a couple of variables to know which compiler you are using:</p>
</div>
<pre data-type="programlisting">
host$ <strong>export ARCH=arm</strong>
host$ <strong>export CROSS_COMPILE=arm-linux-gnueabihf-</strong>
</pre>
<div class="paragraph">
<p>These lines set up the standard environmental variables so that you can determine which cross-development tools to use. Test the cross compiler by adding <a href="#kernel_helloWorld">Simple helloWorld.c to test cross compiling (helloWorld.c)</a> to a file named <em>helloWorld.c</em>.</p>
</div>
<div id="kernel_helloWorld" class="exampleblock">
<div class="title">Example 47. Simple helloWorld.c to test cross compiling (helloWorld.c)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">#include &lt;stdio.h&gt;

int main(int argc, char **argv) {
  printf("Hello, World! \n");
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can then cross-compile by using the following commands:</p>
</div>
<pre data-type="programlisting">
host$ <strong>${CROSS_COMPILE}gcc helloWorld.c</strong>
host$ <strong>file a.out</strong>
a.out: ELF 32-bit LSB executable, ARM, version 1 (SYSV),
 dynamically linked (uses shared libs), for GNU/Linux 2.6.31,
 BuildID[sha1]=0x10182364352b9f3cb15d1aa61395aeede11a52ad, not stripped
</pre>
<div class="paragraph">
<p>The file command shows that a.out was compiled for an ARM processor.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_78">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="kernel_patches">Applying Patches</h3>
<div class="sect3">
<h4 id="_problem_81">Problem</h4>
<div class="paragraph">
<p>You have a patch file that you need to apply to the kernel.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_81">Solution</h4>
<div class="paragraph">
<p><a href="#kernel_hello_patch">Simple kernel patch file (hello.patch)</a> shows a patch file that you can use on the kernel.</p>
</div>
<div id="kernel_hello_patch" class="exampleblock">
<div class="title">Example 48. Simple kernel patch file (hello.patch)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">From eaf4f7ea7d540bc8bb57283a8f68321ddb4401f4 Mon Sep 17 00:00:00 2001
From: Jason Kridner &lt;jdk@ti.com&gt;
Date: Tue, 12 Feb 2013 02:18:03 +0000
Subject: [PATCH] hello: example kernel modules

---
 hello/Makefile   |    7 +++++++
 hello/hello.c    |   18 ++++++++++++++++++
 2 files changed, 25 insertions(+), 0 deletions(-)
 create mode 100644 hello/Makefile
 create mode 100644 hello/hello.c

diff --git a/hello/Makefile b/hello/Makefile
new file mode 100644
index 0000000..4b23da7
--- /dev/null
+++ b/hello/Makefile
@@ -0,0 +1,7 @@
+obj-m := hello.o
+
+PWD   := $(shell pwd)
+KDIR  := ${PWD}/..
+
+default:
+	make -C $(KDIR) SUBDIRS=$(PWD) modules
diff --git a/hello/hello.c b/hello/hello.c
new file mode 100644
index 0000000..157d490
--- /dev/null
+++ b/hello/hello.c
@@ -0,0 +1,22 @@
+#include &lt;linux/module.h&gt;       /* Needed by all modules */
+#include &lt;linux/kernel.h&gt;       /* Needed for KERN_INFO */
+#include &lt;linux/init.h&gt;         /* Needed for the macros */
+
+static int __init hello_start(void)
+{
+    printk(KERN_INFO "Loading hello module...\n");
+    printk(KERN_INFO "Hello, World!\n");
+    return 0;
+}
+
+static void __exit hello_end(void)
+{
+    printk(KERN_INFO "Goodbye Boris\n");
+}
+
+module_init(hello_start);
+module_exit(hello_end);
+
+MODULE_AUTHOR("Boris Houndleroy");
+MODULE_DESCRIPTION("Hello World Example");
+MODULE_LICENSE("GPL");</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s how to use it:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the kernel sources (<a href="#kernel_compiling">Compiling the Kernel</a>).</p>
</li>
<li>
<p>Change to the kernel directory (cd bb-kernel/KERNEL).</p>
</li>
<li>
<p>Add <a href="#kernel_hello_patch">Simple kernel patch file (hello.patch)</a> to a file named <em>hello.patch</em> in the <em>bb-kernel/KERNEL</em> directory.</p>
</li>
<li>
<p>Run the following commands:</p>
</li>
</ol>
</div>
<pre data-type="programlisting">
host$ <strong>cd bb-kernel/KERNEL</strong>
host$ <strong>patch -p1 &lt; hello.patch</strong>
patching file hello/Makefile
patching file hello/hello.c
</pre>
<div class="paragraph">
<p>The output of the patch command apprises you of what it&#8217;s doing. Look in the <em>hello</em> directory to see what was created:</p>
</div>
<pre data-type="programlisting">
host$ <strong>cd hello</strong>
host$ <strong>ls</strong>
hello.c  Makefile
</pre>
</div>
<div class="sect3">
<h4 id="_discussion_79">Discussion</h4>
<div class="paragraph">
<p><a href="#kernel_building_modules">Building and Installing Kernel Modules</a> shows how to build and install a module, and <a href="#kernel_create_patch">Creating Your Own Patch File</a> shows how to create your own patch file.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kernel_create_patch">Creating Your Own Patch File</h3>
<div class="sect3">
<h4 id="_problem_82">Problem</h4>
<div class="paragraph">
<p>You made a few changes to the kernel, and you want to share them with your friends.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_82">Solution</h4>
<div class="paragraph">
<p>Create a patch file that contains just the changes you have made. Before making your changes, check out a new branch:</p>
</div>
<pre data-type="programlisting">
host$ <strong>cd bb-kernel/KERNEL</strong>
host$ <strong>git status</strong>
# On branch master
nothing to commit (working directory clean)
</pre>
<div class="paragraph">
<p>Good, so far no changes have been made. Now, create a new branch:</p>
</div>
<pre data-type="programlisting">
host$ <strong>git checkout -b hello1</strong>
host$ <strong>git status</strong>
# On branch hello1
nothing to commit (working directory clean)
</pre>
<div class="paragraph">
<p>You&#8217;ve created a new branch called <em>hello1</em> and checked it out. Now, make whatever changes to the kernel you want. I did some work with a simple character driver that we can use as an example:</p>
</div>
<pre data-type="programlisting">
host$ <strong>cd bb-kernel/KERNEL/drivers/char/</strong>
host$ <strong>git status</strong>
# On branch hello1
# Changes not staged for commit:
#   (use "git add file..." to update what will be committed)
#   (use "git checkout -- file..." to discard changes in working directory)
#
#	modified:   Kconfig
#	modified:   Makefile
#
# Untracked files:
#   (use "git add file..." to include in what will be committed)
#
#	examples/
no changes added to commit (use "git add" and/or "git commit -a")
</pre>
<div class="paragraph">
<p>Add the files that were created and commit them:</p>
</div>
<pre data-type="programlisting">
host$ <strong>git add Kconfig Makefile examples</strong>
host$ <strong>git status</strong>
# On branch hello1
# Changes to be committed:
#   (use "git reset HEAD file..." to unstage)
#
#	modified:   Kconfig
#	modified:   Makefile
#	new file:   examples/Makefile
#	new file:   examples/hello1.c
#
host$ <strong>git commit -m "Files for hello1 kernel module"</strong>
[hello1 99346d5] Files for hello1 kernel module
 4 files changed, 33 insertions(+)
 create mode 100644 drivers/char/examples/Makefile
 create mode 100644 drivers/char/examples/hello1.c
 </pre>
<div class="paragraph">
<p>Finally, create the patch file:</p>
</div>
<pre data-type="programlisting">
host$ <strong>git format-patch master --stdout &gt; hello1.patch</strong>
 </pre>
</div>
<div class="sect3">
<h4 id="_discussion_80">Discussion</h4>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="realtime">Real-Time I/O</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_8">Introduction</h3>
<div class="paragraph">
<p>Sometimes, when BeagleBone Black interacts with the physical world, it needs to respond in a timely manner. For example, your robot has just detected that one of the driving motors needs to turn a bit faster. Systems that can respond quickly to a real event are known as <em>real-time</em> systems. There are two broad categories of real-time systems: soft and hard.</p>
</div>
<div class="paragraph">
<p>In a <em>soft real-time</em> system, the real-time requirements should be met <em>most</em> of the time, where <em>most</em> depends on the system. A video playback system is a good example. The goal might be to display 60 frames per second, but it doesn&#8217;t matter much if you miss a frame now and then. In a 100 percent <em>hard real-time</em> system, you can never fail to respond in time. Think of an airbag deployment system on a car. You can&#8217;t even be <span class="keep-together">50 ms late</span>.</p>
</div>
<div class="paragraph">
<p>Systems running Linux generally can&#8217;t do 100 percent hard real-time processing, because Linux gets in the way. However, the Bone has an ARM processor running Linux and two additional 32-bit programmable real-time units (PRUs [<a href="http://bit.ly/1EzTPZv" class="bare">http://bit.ly/1EzTPZv</a>]) available to do real-time processing. Although the PRUs can achieve 100 percent hard real-time, they take some effort to use.</p>
</div>
<div class="paragraph">
<p>This chapter shows several ways to do real-time input/output (I/O), starting with the effortless, yet slower BoneScript and moving up with increasing speed (and effort) to using the PRUs.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>In this chapter, as in the others, we assume that you are logged in as root (as indicated by the bone# prompt). This gives you quick access to the general-purpose input/output (GPIO) ports without having to use sudo each time.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="realtime_BoneScript">I/O with BoneScript</h3>
<div class="sect3">
<h4 id="_problem_83">Problem</h4>
<div class="paragraph">
<p>You want to read an input pin and write it to the output as quickly as possible with BoneScript.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_83">Solution</h4>
<div class="paragraph">
<p><a href="#sensors_pushbutton">Reading the Status of a Pushbutton or Magnetic Switch (Passive On/Off Sensor)</a> shows how to read a pushbutton switch and <a href="#displays_externalLED">Toggling an External LED</a> controls an external LED. This recipe combines the two to read the switch and turn on the LED in response to it. To make this recipe, you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Breadboard and jumper wires (see <a href="#app_proto">Prototyping Equipment</a>)</p>
</li>
<li>
<p>Pushbutton switch (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
<li>
<p>220 &#8486; resistor (see <a href="#app_resistor">Resistors</a>)</p>
</li>
<li>
<p>LED (see <a href="#app_opto">Opto-Electronics</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Wire up the pushbutton and LED as shown in <a href="#realtime_pushLED_fig">Diagram for wiring a pushbutton and LED with the LED attached to P9_12</a>.</p>
</div>
<div id="realtime_pushLED_fig" class="imageblock">
<div class="content">
<img src="./08realtime/figures/pushLED_bb.png" alt="Bone with pushbutton and LED">
</div>
<div class="title">Figure 84. Diagram for wiring a pushbutton and LED with the LED attached to P9_12</div>
</div>
<div class="paragraph">
<p>The code in <a href="#realtime_pushLED_code">Monitoring a pushbutton using a callback function (pushLED.js)</a> reads GPIO port P9_42, which is attached to the <span class="keep-together">pushbutton</span>, and turns on the LED attached to P9_12 when the button is pushed.</p>
</div>
<div id="realtime_pushLED_code" class="exampleblock">
<div class="title">Example 49. Monitoring a pushbutton using a callback function (pushLED.js)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node
var b = require('bonescript');
var button = 'P9_42';
var LED    = 'P9_14';

b.pinMode(button, b.INPUT, 7, 'pulldown', 'fast', doAttach);
function doAttach(x) {
    if(x.err) {
        console.log('x.err = ' + x.err);
        return;
    }
    b.attachInterrupt(button, true, b.CHANGE, flashLED);
}

b.pinMode(LED,    b.OUTPUT);

function flashLED(x) {
    if(x.attached) {
        console.log("Interrupt handler attached");
        return;
    }
    console.log('x.value = ' + x.value);
    console.log('x.err   = ' + x.err);
    b.digitalWrite(LED, x.value);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Add the code to a file named <em>pushLED.js</em> and run it by using the following commands:</p>
</div>
<pre data-type="programlisting">
bone# <strong>chmod +x pushLED.js</strong>
bone# <strong>./pushLED.js</strong>
</pre>
<div class="paragraph">
<p>Press ^C (Ctrl-C) to stop the code.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_81">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="realtime_libsoc">I/O with C and libsoc</h3>
<div class="sect3">
<h4 id="_problem_84">Problem</h4>
<div class="paragraph">
<p>You want to use the C language to process inputs in real time, or BoneScript isn&#8217;t fast enough.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_84">Solution</h4>
<div class="paragraph">
<p><a href="#realtime_BoneScript">I/O with BoneScript</a> shows how to control an LED with a pushbutton using BoneScript. This recipe accomplishes the same thing using C and libsoc. <a href="#misc_libsoc">Using C to Interact with the Physical World</a> shows how to use C and libsoc to access the GPIO pins.</p>
</div>
<div class="paragraph">
<p>Wire up the pushbutton and LED as shown in <a href="#realtime_pushLED_fig">Diagram for wiring a pushbutton and LED with the LED attached to P9_12</a>. Follow the instructions in <a href="#misc_libsoc">Using C to Interact with the Physical World</a> to install libsoc. Then add the code in <a href="#realtime_pushLED_c_code">Code for reading a switch and blinking an LED using libsoc (pushLED.c)</a> to a file named <em>pushLED.c</em>.</p>
</div>
<div id="realtime_pushLED_c_code" class="exampleblock">
<div class="title">Example 50. Code for reading a switch and blinking an LED using libsoc (pushLED.c)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/wait.h&gt;

#include "libsoc_gpio.h"
#include "libsoc_debug.h"

/**
 * 
 * This gpio_test is intended to be run on BeagleBone
 * and reads pin P9_42 (gpio7) and write the value to P9_12 (gpio60).
 *
 * The GPIO_OUTPUT and INPUT defines can be changed to support any two pins.
 * 
 */
 
#define GPIO_OUTPUT  60
#define GPIO_INPUT   7

// Create both gpio pointers
 gpio *gpio_output, *gpio_input;

static int interrupt_count = 0;

int callback_test(void* arg) {
  int* tmp_count = (int*) arg;
  int value;
  
  *tmp_count = *tmp_count + 1;
  value = libsoc_gpio_get_level (gpio_input);
  libsoc_gpio_set_level(gpio_output, value);
  // Comment out the following line to make the code respond faster
  printf("Got it (%d), button = %d\n", *tmp_count, value);
  
  return EXIT_SUCCESS;
}

int main(void) {
  // Enable debug output
  libsoc_set_debug(1);

  // Request gpios
  gpio_output = libsoc_gpio_request(GPIO_OUTPUT, LS_SHARED);
  gpio_input = libsoc_gpio_request(GPIO_INPUT, LS_SHARED);

  // Set direction to OUTPUT
  libsoc_gpio_set_direction(gpio_output, OUTPUT);
  
  // Set direction to INPUT
  libsoc_gpio_set_direction(gpio_input, INPUT);

  // Set edge to BOTH
  libsoc_gpio_set_edge(gpio_input, BOTH);

  // Set up callback
  libsoc_gpio_callback_interrupt(gpio_input, &amp;callback_test, 
                      (void*) &amp;interrupt_count);
  
  printf("Push the button...\n"); 
  // Disaple debug output so the code will respond faster
  libsoc_set_debug(0);

  sleep(10);
  
  libsoc_set_debug(1);
 
  // Cancel the callback on interrupt
  libsoc_gpio_callback_interrupt_cancel(gpio_input);
  
  //If gpio_request was successful
  if (gpio_input) { // Free gpio request memory
    libsoc_gpio_free(gpio_input);
  }
  
  if (gpio_output) { // Free gpio request memory
    libsoc_gpio_free(gpio_output);
  }
  
  return EXIT_SUCCESS;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Compile and run the code:</p>
</div>
<pre data-type="programlisting">
bone# <strong>gcc -o pushLED pushLED.c /usr/local/lib/libsoc.so</strong>
bone# <strong>./pushLED</strong>
libsoc-debug: debug enabled (libsoc_set_debug)
libsoc-gpio-debug: requested gpio (60, libsoc_gpio_request)
libsoc-gpio-debug: GPIO already exported (60, libsoc_gpio_request)
libsoc-gpio-debug: requested gpio (7, libsoc_gpio_request)
libsoc-gpio-debug: GPIO already exported (7, libsoc_gpio_request)
libsoc-gpio-debug: setting direction to out (60, libsoc_gpio_set_direction)
libsoc-gpio-debug: setting direction to in (7, libsoc_gpio_set_direction)
BOTH: 3
libsoc-gpio-debug: setting edge to both (7, libsoc_gpio_set_edge)
BOTH: 3
libsoc-gpio-debug: creating new callback (7, libsoc_gpio_callback_interrupt)
Push the button...
libsoc-debug: debug disabled (libsoc_set_debug)
Got it (1), button = 1
Got it (2), button = 0
Got it (3), button = 1
Got it (4), button = 1
Got it (5), button = 0
libsoc-debug: debug enabled (libsoc_set_debug)
libsoc-gpio-debug: callback thread was stopped
           (7, libsoc_gpio_callback_interrupt_cancel)
libsoc-gpio-debug: freeing gpio (7, libsoc_gpio_free)
libsoc-gpio-debug: freeing gpio (60, libsoc_gpio_free)
</pre>
<div class="paragraph">
<p>The code responds quickly to the pushbutton. If you need more speed, comment-out the printf command in the interrupt service routine.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_82">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="realtime_devmem2">I/O with devmem2</h3>
<div class="sect3">
<h4 id="_problem_85">Problem</h4>
<div class="paragraph">
<p>Your C code using libsoc isn&#8217;t responding fast enough to the input signal. You want to read the GPIO registers directly.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_85">Solution</h4>
<div class="paragraph">
<p>The solution is to use a simple utility called devmem2, with which you can read and write registers from the command line.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>This solution is much more involved than the previous ones. You need to understand binary and hex numbers and be able to read the <a href="http://bit.ly/1B4Cm45">AM335x Technical Reference Manual</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>First, download and install devmem2:</p>
</div>
<pre data-type="programlisting">
bone# <strong>wget http://free-electrons.com/pub/mirror/devmem2.c</strong>
bone# <strong>gcc -o devmem2 devmem2.c</strong>
bone# <strong>mv devmem2 /usr/bin</strong>
</pre>
<div class="paragraph">
<p>This solution will read a pushbutton attached to P9_42 and flash an LED attached to P9_13. Note that this is a change from the previous solutions that makes the code used here much simpler. Wire up your Bone as shown in <a href="#realtime_pushLEDmmap_fig">Diagram for wiring a pushbutton and LED with the LED attached to P9_13</a>.</p>
</div>
<div id="realtime_pushLEDmmap_fig" class="imageblock">
<div class="content">
<img src="./08realtime/figures/pushLEDmmap_bb.png" alt="Bone with pushbutton and LED wired to P9_13">
</div>
<div class="title">Figure 85. Diagram for wiring a pushbutton and LED with the LED attached to P9_13</div>
</div>
<div class="paragraph">
<p>Now, flash the LED attached to P9_13 using the Linux sysfs interface (<a href="#kernel_gpio_sysfs">Controlling GPIOs by Using SYSFS Entries</a>). To do this, first look up which GPIO number P9_13 is attached to by referring to <a href="#tips_cape_headers_digital">Mapping from header pin to internal GPIO number</a>. Finding P9_13 at GPIO 31, export GPIO 31 and make it an output:</p>
</div>
<pre data-type="programlisting">
bone# <strong>cd cd /sys/class/gpio/</strong>
bone# <strong>echo 31 > export</strong>
bone# <strong>cd gpio31</strong>
bone# <strong>echo out > direction</strong>
bone# <strong>echo 1 > value</strong>
bone# <strong>echo 0 > value</strong>
</pre>
<div class="paragraph">
<p>The LED will turn on when 1 is echoed into value and off when 0 is echoed.</p>
</div>
<div class="paragraph">
<p>Now that you know the LED is working, look up its memory address. This is where things get very detailed. First, download the <a href="http://bit.ly/1B4Cm45">AM335x Technical Reference Manual</a>. Look up GPIO0 in the Memory Map chapter (sensors). Table 2-2 indicates that GPIO0 starts at address 0x44E0_7000. Then go to Section 25.4.1, "GPIO Registers." This shows that GPIO_DATAIN has an offset of 0x138, GPIO_CLEARDATAOUT has an offset of 0x190, and GPIO_SETDATAOUT has an offset of 0x194.</p>
</div>
<div class="paragraph">
<p>This means you read from address 0x44E0_7000 + 0x138 = 0x44E0_7138 to see the status of the LED:</p>
</div>
<pre data-type="programlisting">
bone# <strong>devmem2 0x44E07138</strong>
/dev/mem opened.
Memory mapped at address 0xb6f8e000.
Value at address 0x44E07138 (0xb6f8e138): 0xC000C404

</pre>
<div class="paragraph">
<p>The returned value 0xC000C404 (1100 0000 0000 0000 1100 0100 0000 0100 in binary) has bit 31 set to 1, which means the LED is on. Turn the LED off by writing 0x80000000 (1000 0000 0000 0000 0000 0000 0000 0000 binary) to the GPIO_CLEARDATA register at 0x44E0_7000 + 0x190 = 0x44E0_7190:</p>
</div>
<pre data-type="programlisting">
bone# <strong>devmem2 0x44E07190 w 0x80000000</strong>
/dev/mem opened.
Memory mapped at address 0xb6fd7000.
Value at address 0x44E07190 (0xb6fd7190): 0x80000000
Written 0x80000000; readback 0x0
</pre>
<div class="paragraph">
<p>The LED is now off.</p>
</div>
<div class="paragraph">
<p>You read the pushbutton switch in a similar way. <a href="#tips_cape_headers_digital">Mapping from header pin to internal GPIO number</a> says P9_42 is GPIO 7, which means bit 7 is the state of P9_42. The devmem2 in this example reads 0x0, which means all bits are 0, including GPIO 7. Section 25.4.1 of the Technical Reference Manual instructs you to use offset 0x13C to read GPIO_DATAOUT. Push the pushbutton and run devmem2:</p>
</div>
<pre data-type="programlisting">
bone# <strong>devmem2 0x44e07138</strong>
/dev/mem opened.
Memory mapped at address 0xb6fe2000.
Value at address 0x44E07138 (0xb6fe2138): 0x4000C484
</pre>
<div class="paragraph">
<p>Here, bit 7 is set in 0x4000C484, showing the button is pushed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_83">Discussion</h4>
<div class="paragraph">
<p>This is much more tedious than the previous methods, but it&#8217;s what&#8217;s necessary if you need to minimize the time to read an input. <a href="#realtime_mmap">I/O with C and mmap()</a> shows how to read and write these addresses from C.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="realtime_mmap">I/O with C and mmap()</h3>
<div class="sect3">
<h4 id="_problem_86">Problem</h4>
<div class="paragraph">
<p>Your C code using libsoc isn&#8217;t responding fast enough to the input signal.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_86">Solution</h4>
<div class="paragraph">
<p>In smaller processors that aren&#8217;t running an operating system, you can read and write a given memory address directly from C. With Linux running on Bone, many of the memory locations are hardware protected, so you can&#8217;t accidentally access them directly.</p>
</div>
<div class="paragraph">
<p>This recipe shows how to use mmap() (memory map) to map the GPIO registers to an array in C. Then all you need to do is access the array to read and write the registers.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>This solution is much more involved than the previous ones. You need to understand binary and hex numbers and be able to read the AM335x Technical Reference Manual.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This solution will read a pushbutton attached to P9_42 and flash an LED attached to P9_13. Note that this is a change from the previous solutions that makes the code used here much simpler.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>See <a href="#realtime_devmem2">I/O with devmem2</a> for details on mapping the GPIO numbers to memory addresses.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Add the code in <a href="#realtime_pushLEDmmap_h">Memory address definitions (pushLEDmmap.h)</a> to a file named <em>pushLEDmmap.h</em>.</p>
</div>
<div id="realtime_pushLEDmmap_h" class="exampleblock">
<div class="title">Example 51. Memory address definitions (pushLEDmmap.h)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">// From: http://stackoverflow.com/questions/13124271/driving-beaglebone-gpio
// -through-dev-mem
// user contributions licensed under cc by-sa 3.0 with attribution required
// http://creativecommons.org/licenses/by-sa/3.0/
// http://blog.stackoverflow.com/2009/06/attribution-required/
// Author: madscientist159 (http://stackoverflow.com/users/3000377/madscientist159)

#ifndef _BEAGLEBONE_GPIO_H_
#define _BEAGLEBONE_GPIO_H_

#define GPIO0_START_ADDR 0x44e07000
#define GPIO0_END_ADDR   0x44e08000
#define GPIO0_SIZE (GPIO0_END_ADDR - GPIO0_START_ADDR)

#define GPIO1_START_ADDR 0x4804C000
#define GPIO1_END_ADDR   0x4804D000
#define GPIO1_SIZE (GPIO1_END_ADDR - GPIO1_START_ADDR)

#define GPIO2_START_ADDR 0x41A4C000
#define GPIO2_END_ADDR   0x41A4D000
#define GPIO2_SIZE (GPIO2_END_ADDR - GPIO2_START_ADDR)

#define GPIO3_START_ADDR 0x41A4E000
#define GPIO3_END_ADDR   0x41A4F000
#define GPIO3_SIZE (GPIO3_END_ADDR - GPIO3_START_ADDR)

#define GPIO_DATAIN 0x138
#define GPIO_SETDATAOUT 0x194
#define GPIO_CLEARDATAOUT 0x190

#define GPIO_03  (1&lt;&lt;3)
#define GPIO_07  (1&lt;&lt;7)
#define GPIO_31  (1&lt;&lt;31)
#define GPIO_60  (1&lt;&lt;28)
#endif</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Add the code in <a href="#realtime_pushLEDmmap_c">Code for directly reading memory addresses (pushLEDmmap.c)</a> to a file named <em>pushLEDmmap.c</em>.</p>
</div>
<div id="realtime_pushLEDmmap_c" class="exampleblock">
<div class="title">Example 52. Code for directly reading memory addresses (pushLEDmmap.c)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">// From: http://stackoverflow.com/questions/13124271/driving-beaglebone-gpio
// -through-dev-mem
// user contributions licensed under cc by-sa 3.0 with attribution required
// http://creativecommons.org/licenses/by-sa/3.0/
// http://blog.stackoverflow.com/2009/06/attribution-required/
// Author: madscientist159 (http://stackoverflow.com/users/3000377/madscientist159)
//
// Read one gpio pin and write it out to another using mmap.
// Be sure to set -O3 when compiling.
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;sys/mman.h&gt;
#include &lt;fcntl.h&gt; 
#include &lt;signal.h&gt;    // Defines signal-handling functions (i.e. trap Ctrl-C)
#include "pushLEDmmap.h"

// Global variables
int keepgoing = 1;    // Set to 0 when Ctrl-c is pressed

// Callback called when SIGINT is sent to the process (Ctrl-C)
void signal_handler(int sig) {
    printf( "\nCtrl-C pressed, cleaning up and exiting...\n" );
	keepgoing = 0;
}

int main(int argc, char *argv[]) {
    volatile void *gpio_addr;
    volatile unsigned int *gpio_datain;
    volatile unsigned int *gpio_setdataout_addr;
    volatile unsigned int *gpio_cleardataout_addr;

    // Set the signal callback for Ctrl-C
    signal(SIGINT, signal_handler);

    int fd = open("/dev/mem", O_RDWR);

    printf("Mapping %X - %X (size: %X)\n", GPIO0_START_ADDR, GPIO0_END_ADDR, 
                                           GPIO0_SIZE);

    gpio_addr = mmap(0, GPIO0_SIZE, PROT_READ | PROT_WRITE, MAP_SHARED, fd, 
                        GPIO0_START_ADDR);

    gpio_datain            = gpio_addr + GPIO_DATAIN;
    gpio_setdataout_addr   = gpio_addr + GPIO_SETDATAOUT;
    gpio_cleardataout_addr = gpio_addr + GPIO_CLEARDATAOUT;

    if(gpio_addr == MAP_FAILED) {
        printf("Unable to map GPIO\n");
        exit(1);
    }
    printf("GPIO mapped to %p\n", gpio_addr);
    printf("GPIO SETDATAOUTADDR mapped to %p\n", gpio_setdataout_addr);
    printf("GPIO CLEARDATAOUT mapped to %p\n", gpio_cleardataout_addr);

    printf("Start copying GPIO_07 to GPIO_31\n");
    while(keepgoing) {
    	if(*gpio_datain &amp; GPIO_07) {
            *gpio_setdataout_addr= GPIO_31;
    	} else {
            *gpio_cleardataout_addr = GPIO_31;
    	}
        //usleep(1);
    }

    munmap((void *)gpio_addr, GPIO0_SIZE);
    close(fd);
    return 0;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, compile and run the code:</p>
</div>
<pre data-type="programlisting">
bone# <strong>gcc -O3 pushLEDmmap.c -o pushLEDmmap</strong>
bone# <strong>./pushLEDmmap</strong>
Mapping 44E07000 - 44E08000 (size: 1000)
GPIO mapped to 0xb6fac000
GPIO SETDATAOUTADDR mapped to 0xb6fac194
GPIO CLEARDATAOUT mapped to 0xb6fac190
Start copying GPIO_07 to GPIO_31
^C
Ctrl-C pressed, cleaning up and exiting...
</pre>
<div class="paragraph">
<p>The code is in a tight while loop that checks the status of GPIO 7 and copies it to GPIO 31.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_84">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="realtime_xenomai">Modifying the Linux Kernel to Use Xenomai</h3>
<div class="sect3">
<h4 id="_problem_87">Problem</h4>
<div class="paragraph">
<p>Your program can&#8217;t get control of the processor quickly enough to do your real-time processing.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_87">Solution</h4>
<div class="paragraph">
<p><a href="http://xenomai.org/">Xenomai</a> is a set of kernel patches that allow the Bone to respond to real-time events in a predicable way. These instructions are based on Bruno Martins' <a href="http://bit.ly/1EXIEZu">Xenomai on the BeagleBone Black in 14 easy steps</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>The Xenomai kernel is used to provide real-time motion control within the Machinekit distribution for the Bone. You might get a quick start by checking out the images provided on <a href="http://bit.ly/1NK71xS">the Machinekit blog</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The Xenomai kernel is now available in the BeagleBoard.org Debian package feeds, and you can install it by using apt-get install xenomai-runtime. Nevertheless, we find it useful to include the details of building the Xenomai kernel.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>This recipe requires downloading and patching the kernel. This is advanced work.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>First, download, compile, and install the kernel, following the instructions in <a href="#kernel_compiling">Compiling the Kernel</a>. This will ensure that everything is in place and working before you start changing things.</p>
</div>
<div class="paragraph">
<p>Next, visit <a href="http://bit.ly/1C6QxwN">Xenomai&#8217;s download page</a> to find the latest version of Xenomai (at the time of this writing, it&#8217;s 2.6.4). Download it with the following command (substituting the URL for the latest version you find on Xenomai&#8217;s download page):</p>
</div>
<pre data-type="programlisting">
host$ <strong>wget http://download.gna.org/xenomai/stable/latest/xenomai-2.6.4.tar.bz2</strong>
</pre>
<div class="paragraph">
<p>Check out the latest kernel:</p>
</div>
<pre data-type="programlisting">
host$ <strong>cd bb-kernel/KERNEL</strong>
host$ <strong>uname -a</strong>
host$ <strong>git tags | sort | less</strong>
</pre>
<div class="paragraph">
<p>Pick the tag that is close to your current version of the kernel. This command checks out the 3.8.13-bone67 version of the kernel and creates a branch named xenomai:</p>
</div>
<pre data-type="programlisting">
host$ <strong>git checkout 3.8.13-bone67 -b xenomai</strong>
</pre>
<div class="sect4">
<h5 id="_patching_the_kernel">Patching the kernel</h5>
<div class="paragraph">
<p>Patch the kernel by using the following commands:</p>
</div>
<pre data-type="programlisting">
host$ <strong>cd bb-kernel/KERNEL</strong>
host$ <strong>patch -p1 &lt; ../../xenomai-2.6.4/ksrc/arch/arm/patches/\
       beaglebone/ipipe-core-3.8.13-beaglebone-pre.patch</strong>
host$ <strong>patch -p1 &lt; ../../xenomai-2.6.4/ksrc/arch/arm/patches/\
       ipipe-core-3.8.13-arm-4.patch</strong>
host$ <strong>patch -p1 &lt; ../../xenomai-2.6.4/ksrc/arch/arm/patches/\
       beaglebone/ipipe-core-3.8.13-beaglebone-post.patch</strong>
</pre>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>These commands assume bb-kernel and xenomai-2.6.4 are at the same directory level.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then get one more patch from <a href="http://bit.ly/1Mti9gQ">Xenomai&#8217;s website</a>. Add the code in <a href="#realtime_thumb">One last patch (<em>thumb.patch</em>)</a> to a file named <em>thumb.patch</em>.</p>
</div>
<div id="realtime_thumb" class="exampleblock">
<div class="title">Example 53. One last patch (<em>thumb.patch</em>)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">diff --git a/arch/arm/kernel/entry-armv.S b/arch/arm/kernel/entry-armv.S
index e2bc263..6f4d9f0 100644
--- a/arch/arm/kernel/entry-armv.S
+++ b/arch/arm/kernel/entry-armv.S
@@ -469,6 +469,7 @@ __irq_usr:
 	kuser_cmpxchg_check
 	irq_handler
 #ifdef CONFIG_IPIPE
+THUMB(	it	ne )
 	bne	__ipipe_ret_to_user_irqs_disabled
 #endif	/* CONFIG_IPIPE */
 	get_thread_info tsk
@@ -767,6 +768,7 @@ ENTRY(ret_from_exception)
 	disable_irq
 	bl	__ipipe_check_root
 	cmp     r0, #1
+THUMB(	it	ne )
 	bne	__ipipe_ret_to_user_irqs_disabled  @ Fast exit path over non-root domains
 #endif /* CONFIG_IPIPE */
 	get_thread_info tsk</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Run the following command to apply the patch:</p>
</div>
<pre data-type="programlisting">
host$ <strong>patch -p1 &lt; thumb.patch</strong>
</pre>
<div class="paragraph">
<p>Prepare the kernel:</p>
</div>
<pre data-type="programlisting">
host$ <strong>cd ../../xenomai-2.6.4/scripts</strong>
host$ <strong>./prepare-kernel.sh --arch=arm --linux=../../bb-kernel/KERNEL/</strong>
</pre>
<div class="paragraph">
<p>Now you&#8217;re ready to compile the kernel with these new patches:</p>
</div>
<pre data-type="programlisting">
host$ <strong>cd ../../bb-kernel</strong>
host$ <strong>tools/rebuild.sh</strong>
</pre>
<div class="paragraph">
<p>When the configuration menu displays (as shown in <a href="#realtime_xenomai_config">Configuing Xenomai</a>), make the following changes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select "CPU Power Management" &#8594; "CPU Frequency scaling, disable [ ] CPU Frequency scaling."</p>
</li>
<li>
<p>Select "Real-time sub-system" &#8594;" Drivers" &#8594; "Testing drivers, enable everything."</p>
</li>
</ol>
</div>
<div id="realtime_xenomai_config" class="imageblock">
<div class="content">
<img src="./08realtime/figures/xenomaiConfig.png" alt="Configuring Xenomai">
</div>
<div class="title">Figure 86. Configuing Xenomai</div>
</div>
<div class="paragraph">
<p>Then sit back and wait awhile. After the new kernel is built, install it following the instructions in <a href="#kernel_install">Installing the Kernel on the Bone</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_setting_up_the_bone">Setting up the Bone</h5>
<div class="paragraph">
<p>You are now ready to test the new Xenomai kernel. Copy Xenomai to the Bone:</p>
</div>
<pre data-type="programlisting">
host$ <strong>scp -r xenomai-2.6.4 192.168.7.2:.</strong>
</pre>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This command assumes that the Bone is at 192.168.7.2.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Run the following commands on the Bone:</p>
</div>
<pre data-type="programlisting">
bone# <strong>cd ~/xenomai-2.6.4</strong>
bone# <strong>./configure CFLAGS="-march=armv7-a -mfpu=vfp3" LDFLAGS="-march=armv7-a \
        -mfpu=vfp3"</strong>
bone# <strong>make</strong>
bone# <strong>make install</strong>
</pre>
<div class="paragraph">
<p>./configure takes about a minute, make six more minutes, and install another minute.</p>
</div>
<div class="paragraph">
<p>Next, copy the drivers:</p>
</div>
<pre data-type="programlisting">
bone# <strong>cd; mkdir xenomai_drivers; cd xenomai_drivers</strong>

host$ <strong>cd bb-kernel/KERNEL/drivers/xenomai/testing</strong>
host$ <strong>scp *.ko 192.168.7.2:xenomai_drivers</strong>

bone# <strong>insmode xeno_klat.ko</strong>
</pre>
</div>
<div class="sect4">
<h5 id="_testing">Testing</h5>
<div class="paragraph">
<p>Go ahead and run some tests:</p>
</div>
<pre data-type="programlisting">
bone# <strong>usr/xenomai/bin/latency</strong>
== Sampling period: 1000 us
== Test mode: periodic user-mode task
== All results in microseconds
warming up...
RTT|  00:00:01  (periodic user-mode task, 1000 us period, priority 99)
RTH|----lat min|----lat avg|----lat max|-overrun|---msw|---lat best|--lat worst
RTD|      3.624|      3.833|     20.458|       0|     0|      3.624|     20.458
RTD|      2.749|      3.749|     22.583|       0|     0|      2.749|     22.583
RTD|      2.749|      4.583|     25.499|       0|     0|      2.749|     25.499
RTD|      2.749|      3.708|     20.541|       0|     0|      2.749|     25.499
RTD|      2.749|      3.749|     21.916|       0|     0|      2.749|     25.499
---|-----------|-----------|-----------|--------|------|-------------------------
RTS|      2.749|      3.916|     25.499|       0|     0| 00:00:05/00:00:05
</pre>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_85">Discussion</h4>
<div class="paragraph">
<p>The details of how to use Xenomai are beyond the scope of this book, but you can browse over to <a href="http://xenomai.org/">Xenomai&#8217;s website</a> for examples and help on what to do next.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="realtime_PRUSpeak">I/O with PRU Speak</h3>
<div class="sect3">
<h4 id="_problem_88">Problem</h4>
<div class="paragraph">
<p>You require better timing than running C on the ARM can give you.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_88">Solution</h4>
<div class="paragraph">
<p>The AM335x processor on the Bone has an ARM processor that is running Linux, but it also has two 32-bit PRUs that are available for processing I/O. It takes a fair amount of understanding to program the PRU. Fortunately, a <a href="http://bit.ly/1AjlarF">2014 Google Summer of Code</a> project produced <a href="http://bit.ly/1wXT1eO">PRU Speak</a>, an adaptation of the <a href="http://botspeak.org/">BotSpeak</a> language for the PRU. This solution shows how to use it.</p>
</div>
<div class="sect4">
<h5 id="_background">Background</h5>
<div class="paragraph">
<p>PRU Speak comprises three main parts:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Kernel</dt>
<dd>
<p>The pru_speak.ko Linux kernel driver module loads PRU code and provides communication between the kernel and the firmware running on the PRU. An associated device tree overlay called BB_PRUSPEAK-00A0.dtbo configures the pin access and firmware loaded on to the PRUs.</p>
</dd>
<dt class="hdlist1">Firmware</dt>
<dd>
<p>pru0_firmware and pru1_firmware are the firmware files for each of the two PRUs.</p>
</dd>
<dt class="hdlist1">Userspace</dt>
<dd>
<p>A Python user space component includes bs_tcp_server.py; a TCP socket listener that provides an interface to the PRU Speak interpreter; and pru_speak.py, a library for invoking PRU Speak commands from within a Python script.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_prerequisites">Prerequisites</h5>
<div class="paragraph">
<p>Many of the pins easily accessible by the PRU are taken up by the HDMI interface discussed in <a href="#tips_hdmi">Running Your Bone Standalone</a>. If you haven&#8217;t already edited <em>uEnv.txt</em>, you can run these commands to disable the HDMI interface and reboot:</p>
</div>
<pre data-type="programlisting">
bone# <strong>sed -i \
 '/cape_disable=capemgr.disable_partno=BB-BONELT-HDMI,BB-BONELT-HDMIN$/ \
      \s/^#//' /boot/uEnv.txt</strong>
bone# <strong>shutdown -r now</strong>
</pre>
<div class="paragraph">
<p>To build the firmware files, you first need to install the TI PRU C compiler:</p>
</div>
<pre data-type="programlisting">
bone# <strong>apt-get update</strong>
bone# <strong>apt-get install ti-pru-cgt-installer</strong>
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following NEW packages will be installed:
  ti-pru-cgt-installer
0 upgraded, 1 newly installed, 0 to remove and 30 not upgraded.
Need to get 13.1 kB of archives.
After this operation, 67.6 kB of additional disk space will be used.
Get:1 http://repos.rcn-ee.net/debian/ wheezy/main ti-pru-cgt-installer \
              all 2.1.0-1~bpo70+20141201+1 [13.1 kB]
Fetched 13.1 kB in 0s (38.1 kB/s)
Selecting previously unselected package ti-pru-cgt-installer.
(Reading database ... 59608 files and directories currently installed.)
Unpacking ti-pru-cgt-installer \
              (from .../ti-pru-cgt-installer_2.1.0-1~bpo70+20141201+1_all.deb) ...
Setting up ti-pru-cgt-installer (2.1.0-1~bpo70+20141201+1) ...
--2015-01-19 18:59:14--  http://downloads.ti.com/codegen/esd/cgt_public_sw/\
PRU/2.1.0/ti_cgt_pru_2.1.0_armlinuxa8hf_busybox_installer.sh
Resolving downloads.ti.com (downloads.ti.com)... 23.62.97.64, 23.62.97.66
Connecting to downloads.ti.com (downloads.ti.com)|23.62.97.64|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 39666613 (38M) [application/x-sh]
Saving to: `ti_cgt_pru_2.1.0_armlinuxa8hf_busybox_installer.sh'

100%[====================================>] 39,666,613  75.3K/s   in 7m 39s

2015-01-19 19:06:54 (84.5 KB/s)-`ti_cgt_pru_2.1.0_arm..hf_busybox_installer.sh'\
         saved [39666613/39666613]

Installing PRU Code Generation tools version 2.1.0 into /
  please wait, or press CTRL-C to abort

Extracting archive
Installing files
[####################] 100%
Installed successfully into /
</pre>
</div>
<div class="sect4">
<h5 id="_installation">Installation</h5>
<div class="paragraph">
<p>Clone the PRU Speak repository and run the <em>install.sh</em> shell script:</p>
</div>
<pre data-type="programlisting">
bone# <strong>git clone git://github.com/jadonk/pruspeak.git</strong>
bone# <strong>cd pruspeak</strong>
bone# <strong>./install.sh</strong>
if [ ! -d "/lib/modules/3.8.13-bone68/build" ]; then apt-get install \
        linux-headers-3.8.13-bone68; fi
make -C /lib/modules/3.8.13-bone68/build M=/root/pruspeak/src/driver modules
make[1]: Entering directory `/usr/src/linux-headers-3.8.13-bone68'
  CC [M]  /root/pruspeak/src/driver/pru_speak.o
  Building modules, stage 2.
  MODPOST 1 modules
  CC      /root/pruspeak/src/driver/pru_speak.mod.o
  LD [M]  /root/pruspeak/src/driver/pru_speak.ko
make[1]: Leaving directory `/usr/src/linux-headers-3.8.13-bone68'
make -C /lib/modules/3.8.13-bone68/build M=/root/pruspeak/src/driver
modules_install
make[1]: Entering directory `/usr/src/linux-headers-3.8.13-bone68'
  INSTALL /root/pruspeak/src/driver/pru_speak.ko
  DEPMOD  3.8.13-bone68
make[1]: Leaving directory `/usr/src/linux-headers-3.8.13-bone68'
lnkpru -i/usr/share/ti/cgt-pru/lib pru0_firmware.obj pru0_syscall.obj \
         AM3359_PRU.cmd -o=pru0_firmware
lnkpru -i/usr/share/ti/cgt-pru/lib pru1_firmware.obj  AM3359_PRU.cmd
-o=pru1_firmware
install -m 444 pru0_firmware /lib/firmware
install -m 444 pru1_firmware /lib/firmware
dtc -O dtb -o BB-PRUSPEAK-00A0.dtbo -b 0 -@ BB-PRUSPEAK-00A0.dts
install -m 644 BB-PRUSPEAK-00A0.dtbo /lib/firmware
python setup.py build
running build
running build_py
python setup.py build
running build
running build_py
python setup.py install
running install
.
.
.
Processing pru_speak-0.0-py2.7.egg
Removing /usr/local/lib/python2.7/dist-packages/pru_speak-0.0-py2.7.egg
Copying pru_speak-0.0-py2.7.egg to /usr/local/lib/python2.7/dist-packages
pru-speak 0.0 is already the active version in easy-install.pth

Installed /usr/local/lib/python2.7/dist-packages/pru_speak-0.0-py2.7.egg
Processing dependencies for pru-speak==0.0
Searching for ply==3.4
Best match: ply 3.4
Processing ply-3.4-py2.7.egg
ply 3.4 is already the active version in easy-install.pth

Using /usr/local/lib/python2.7/dist-packages/ply-3.4-py2.7.egg
Finished processing dependencies for pru-speak==0.0
install -m 755 bs_tcp_server.py /usr/bin
install -m 755 bs_shell.py /usr/bin
</pre>
</div>
<div class="sect4">
<h5 id="_runing_the_kernel_module">Runing the Kernel Module</h5>
<div class="paragraph">
<p>Use the modprobe command to load the kernel module and config-pin to load the device tree overlay:</p>
</div>
<pre data-type="programlisting">
bone# <strong>modprobe pru_speak</strong>
bone# <strong>config-pin overlay BB-PRUSPEAK</strong>
</pre>
<div class="paragraph">
<p>The kernel module will need to be reloaded after rebooting, unless it&#8217;s been added to <em>/etc/modules-load.d/modules.conf</em> and <em>/boot/uEnv.txt</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_running_the_script">Running the Script</h5>
<div class="paragraph">
<p>The PRU is now ready to run code. Add the code in <a href="#realtime_pruSpeak_code">Code for copying P8_16 to P9_31 using the PRU (pruSpeak.py)</a> to a file named <em>pruSpeak.py</em>. This code copies the input on P8_16 to the output on P9_31.</p>
</div>
<div id="realtime_pruSpeak_code" class="exampleblock pagebreak-before">
<div class="title">Example 54. Code for copying P8_16 to P9_31 using the PRU (pruSpeak.py)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">#!/usr/bin/env python
from pru_speak import pru_speak

# Copy the signal on pin P8_16 to P9_31
code = '''\
SCRIPT
SET var1, DIO[14]
SET DIO[0], var1
GOTO 0
ENDSCRIPT
RUN
'''

halt = '''\
HALT
'''

ret = pru_speak.execute_instruction(code)
print ret</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Then run the code by using the following command:</p>
</div>
<pre data-type="programlisting">
bone# <strong>./pruSpeak.py</strong>
Generating LALR tables
Initializing PRU Speak
0       0x110000FF      SET var1, DIO[14]
1       0x01400000      SET DIO[0], var1
2       0x15000000      GOTO 0
3       0x7F000000      ENDSCRIPT

[285212927, 20971520, 352321536, 2130706432]
[]
PRU Speak object deleted
</pre>
<div class="paragraph">
<p>The code will return immediately, but the PRU will continue to run.</p>
</div>
<div class="paragraph">
<p>The PRU has quick access to only a subset of GPIO pins. This example reads GPIO P8_16 and writes to P9_31, so you have to wire up the pushbutton and LED as shown in <a href="#realtime_pushLEDpru_fig">Diagram for wiring a pushbutton and LED for the PRU</a>.</p>
</div>
<div id="realtime_pushLEDpru_fig" class="imageblock">
<div class="content">
<img src="./08realtime/figures/pushLEDpru_bb.png" alt="Bone with pushbutton and LED for PRU">
</div>
<div class="title">Figure 87. Diagram for wiring a pushbutton and LED for the PRU</div>
</div>
<div class="paragraph">
<p>Now, when you push the button, the LED should respond.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_86">Discussion</h4>
<div class="paragraph">
<p>In addition to invoking PRU Speak scripts via Python, it is also possible to open a shell or TCP socket to the interpreter. When running a script, it is also possible to modify variables to communicate with the running script.</p>
</div>
<div class="sect4">
<h5 id="_running_pru_speak_via_shell">Running PRU Speak via Shell</h5>
<div class="paragraph">
<p>To invoke a shell interface to PRU Speak, run <em>bs_shell.py</em>:</p>
</div>
<pre data-type="programlisting">
bone# <strong>bs_shell.py</strong>
Generating LALR tables
Initializing PRU Speak
ps&gt;<strong>SCRIPT</strong>
...<strong>SET DIO[0],var1</strong>
...<strong>GOTO 0</strong>
...<strong>ENDSCRIPT</strong>
...
0       0x01400001      SET DIO[0],var1
1       0x15000000      GOTO 0
2       0x7F000000      ENDSCRIPT

[]
ps&gt;<strong>RUN</strong>
...
[20971521, 352321536, 2130706432]
[]
ps&gt;<strong>SET var1,1</strong>
...
[1]
ps&gt;<strong>SET var1,0</strong>
...
[0]
ps&gt;Closing terminal
PRU Speak object deleted
</pre>
<div class="paragraph">
<p>Press Enter on a blank line to complete input to the shell. Press ^C (Ctrl-C) to exit the shell.</p>
</div>
</div>
<div class="sect4">
<h5 id="_running_pru_speak_via_tcp_socket">Running PRU Speak via TCP socket</h5>
<div class="paragraph">
<p>Running the interpreter over a TCP socket enables tools like Labview to communicate with the Bone in a platform-independent way. Use netcat (nc) to interact with the interpreter from the command line:</p>
</div>
<pre data-type="programlisting">
bone# <strong>bs_tcp_server.py 2&amp;&gt;1 &gt; /var/log/pruspeak.log &amp;</strong>
[1] 2594
bone # <strong>nc localhost 6060</strong>
<strong>SCRIPT</strong>

<strong>SET DIO[0],1</strong>

<strong>WAIT 100</strong>

<strong>SET DIO[0],0</strong>

<strong>WAIT 100</strong>

<strong>GOTO 0</strong>

<strong>ENDSCRIPT</strong>

<strong>RUN</strong>

<strong>^C</strong>
</pre>
<div class="paragraph">
<p>Press ^C (Ctrl-C) to exit nc.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Currently, pressing ^D (Ctrl-D) within nc will cause the socket listener script to close.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You should now see the LED blinking.</p>
</div>
</div>
<div class="sect4">
<h5 id="_looking_ahead">Looking Ahead</h5>
<div class="paragraph">
<p>At the time of this writing, PRU Speak is still under heavy development. Be sure to check <a href="http://bit.ly/1B4DrsC">the README file</a> for the latest installation and usage guidelines. Currently, only direct PRU GPIO access is implemented, but support for ADCs and additional GPIOs is in the works.</p>
</div>
<div class="paragraph">
<p>If you are looking to develop your own firmware for the PRUs, this example should provide a template for extending your own interface code.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="capes">Capes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_9">Introduction</h3>
<div class="paragraph">
<p>Previous chapters of this book show a variety of ways to interface BeagleBone Black to the physical world by using a breadboard and wiring to the P8 and P9 headers. This is a great approach because it&#8217;s easy to modify your circuit to debug it or try new things. At some point, though, you might want a more permanent solution, either because you need to move the Bone and you don&#8217;t want wires coming loose, or because you want to share your hardware with the masses.</p>
</div>
<div class="paragraph">
<p>You can easily expand the functionality of the Bone by adding a  <a href="http://bit.ly/1wucweC"><em>cape</em></a>. A cape is simply a board&#8212;&#8203;often a printed circuit board (PCB)&#x2014;that connects to the P8 and P9 headers and follows a few standard pin usages. You can stack up to four capes onto the Bone. Capes can range in size from Bone-sized (<a href="#capes_miniDisplay">Using a 128 x 128-Pixel LCD Cape</a>) to much larger than the Bone (<a href="#capes_7inLCD">Using a Seven-Inch LCD Cape</a>).</p>
</div>
<div class="paragraph">
<p>This chapter shows how to attach a couple of capes, move your design to a protoboard, then to a PCB, and finally on to mass production.</p>
</div>
</div>
<div class="sect2">
<h3 id="capes_7inLCD">Using a Seven-Inch LCD Cape</h3>
<div class="sect3">
<h4 id="_problem_89">Problem</h4>
<div class="paragraph">
<p>You want to display the Bone&#8217;s desktop on a portable LCD.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_89">Solution</h4>
<div class="paragraph">
<p>A number of <a href="http://bit.ly/1AjlXJ9">LCD capes</a> are built for the Bone, ranging in size from three to seven inches. This recipe attaches a seven-inch <a href="http://bit.ly/1NK8Hra">BeagleBone LCD7</a> from <a href="http://circuitco.com/">CircuitCo</a> (shown in <a href="#capes_7inLCD_fig">Seven-inch LCD from CircuitCo <sup class="footnote">[4]</sup></a>) to the Bone.</p>
</div>
<div id="capes_7inLCD_fig" class="imageblock">
<div class="content">
<img src="./09capes/figures/LCD.png" alt="7 inch LCD">
</div>
<div class="title">Figure 88. Seven-inch LCD from CircuitCo <sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup></div>
</div>
<div class="paragraph">
<p>To make this recipe, you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Seven-inch LCD cape (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
<li>
<p>A 5 V power supply (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Just attach the Bone to the back of the LCD, making sure pin 1 of P9 lines up with pin 1 of P9 on the LCD. Apply a 5 V power supply, and the desktop will appear on your LCD, as shown in <a href="#capes_LCD7Desktop">Seven-inch LCD desktop</a>.</p>
</div>
<div id="capes_LCD7Desktop" class="imageblock">
<div class="content">
<img src="./09capes/figures/LCD7Desktop.png" alt="7 inch LCD desktop">
</div>
<div class="title">Figure 89. Seven-inch LCD desktop</div>
</div>
<div class="paragraph">
<p>Attach a USB keyboard and mouse, and you have a portable Bone. <a href="https://www.adafruit.com/products/922">Wireless keyboard and mouse combinations</a> make a nice solution to avoid the need to add a USB hub.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_87">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="capes_miniDisplay">Using a 128 x 128-Pixel LCD Cape</h3>
<div class="sect3">
<h4 id="_problem_90">Problem</h4>
<div class="paragraph">
<p>You want to use a small LCD to display things other than the desktop.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_90">Solution</h4>
<div class="paragraph">
<p>The <a href="http://bit.ly/1xd0r8p">MiniDisplay</a> is a 128 x 128 full-color LCD cape that just fits on the Bone, as shown in <a href="#capes_miniDisplay_fig">MiniDisplay 128 x 128-pixel LCD from CircuitCo</a>.</p>
</div>
<div id="capes_miniDisplay_fig" class="imageblock">
<div class="content">
<img src="./09capes/figures/MiniDisplay-A1.jpg" alt="miniDisplay LCD">
</div>
<div class="title">Figure 90. MiniDisplay 128 x 128-pixel LCD from CircuitCo</div>
</div>
<div class="paragraph">
<p>To make this recipe, you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MiniDisplay LCD cape (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Attach to the Bone and apply power. Then run the following commands:</p>
</div>
<pre data-type="programlisting">
# From http://elinux.org/CircuitCo:MiniDisplay_Cape
# Datasheet:
# https://www.crystalfontz.com/products/document/3277/ST7735_V2.1_20100505.pdf
bone# <strong>wget http://elinux.org/images/e/e4/Minidisplay-example.tar.gz</strong>
bone# <strong>tar zmxvf Minidisplay-example.tar.gz</strong>
bone# <strong>cd minidisplay-example</strong>
bone# <strong>make</strong>
bone# <strong>./minidisplay-test</strong>
Unable to initialize SPI: No such file or directory
Aborted
</pre>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>You might get a compiler warning, but the code should run fine.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The MiniDisplay uses the Serial Peripheral Interface (SPI) interface, and it&#8217;s not initialized. The <a href="http://bit.ly/1xd0r8p">manufacturer&#8217;s website</a> suggests enabling SPI0 by using the following commands:</p>
</div>
<pre data-type="programlisting">
bone# <strong>export SLOTS=/sys/devices/bone_capemgr.*/slots</strong>
bone# <strong>echo BB-SPIDEV0 &gt; $SLOTS</strong>
</pre>
<div class="paragraph">
<p>Hmmm, something isn&#8217;t working here. Here&#8217;s how to see what happened:</p>
</div>
<pre data-type="programlisting">
bone# <strong>dmesg | tail</strong>
[  625.334497] bone_capemgr.9: part_number 'BB-SPIDEV0', version 'N/A'
[  625.334673] bone_capemgr.9: slot #11: generic override
[  625.334720] bone_capemgr.9: bone: Using override eeprom data at slot 11
[  625.334769] bone_capemgr.9: slot #11: 'Override Board Name,00A0,Override \
               Manuf,BB-SPIDEV0'
[  625.335026] bone_capemgr.9: slot #11: \Requesting part number/version based \
               'BB-SPIDEV0-00A0.dtbo
[  625.335076] bone_capemgr.9: slot #11: Requesting firmware \
               'BB-SPIDEV0-00A0.dtbo' \
               for board-name 'Override Board Name', version '00A0'
[  625.335144] bone_capemgr.9: slot #11: dtbo 'BB-SPIDEV0-00A0.dtbo' loaded; \
               converting to live tree
[  625.341842] bone_capemgr.9: slot #11: BB-SPIDEV0 conflict P9.21 \
               (#10:bspwm_P9_21_b) <a class="co" id="capemgr_conflict_co" href="#capemgr_conflict" ><img src="callouts/1.png" alt="1"/></a>
[  625.351296] bone_capemgr.9: slot #11: Failed verification
</pre>


<dl class="calloutlist">
 <dt><a class="co" id="capemgr_conflict" href="#capemgr_conflict_co"><img src="callouts/1.png" alt="1"/></a></dt>
  <dd>Shows there is a conflict for pin <code>P9_21</code>: it's already configured for pulse width modulation (PWM).</dd>

</dl>
<div class="paragraph">
<p>Here&#8217;s how to see what&#8217;s already configured:</p>
</div>
<pre data-type="programlisting">
bone# <strong>cat $SLOTS</strong>
 0: 54:PF---
 1: 55:PF---
 2: 56:PF---
 3: 57:PF---
 4: ff:P-O-L Bone-LT-eMMC-2G,00A0,Texas Instrument,BB-BONE-EMMC-2G
 5: ff:P-O-L Bone-Black-HDMI,00A0,Texas Instrument,BB-BONELT-HDMI
 7: ff:P-O-L Override Board Name,00A0,Override Manuf,bspm_P9_42_27
 8: ff:P-O-L Override Board Name,00A0,Override Manuf,bspm_P9_41_27
 9: ff:P-O-L Override Board Name,00A0,Override Manuf,am33xx_pwm
10: ff:P-O-L Override Board Name,00A0,Override Manuf,bspwm_P9_21_b <a class="co" id="capemgr_load_co" href="#capemgr_load"><img src="callouts/1.png" alt="1"/></a>
</pre>


<dl class="calloutlist">
 <dt><a id="capemgr_load" href="#capemgr_load_co"><img src="callouts/1.png" alt="1"/></a></dt>
  <dd>You can see the eMMC, HDMI, and three PWMs are already using some of the pins. Slot 10 shows <code>P9_21</code> is in use by a PWM.</dd>
</dl>
<div class="paragraph pagebreak-before">
<p>You can unconfigure it by using the following commands:</p>
</div>
<pre data-type="programlisting">
bone# <strong>echo -10 &gt; $SLOTS</strong>
bone# <strong>cat $SLOTS</strong>
 0: 54:PF---
 1: 55:PF---
 2: 56:PF---
 3: 57:PF---
 4: ff:P-O-L Bone-LT-eMMC-2G,00A0,Texas Instrument,BB-BONE-EMMC-2G
 5: ff:P-O-L Bone-Black-HDMI,00A0,Texas Instrument,BB-BONELT-HDMI
 7: ff:P-O-L Override Board Name,00A0,Override Manuf,bspm_P9_42_27
 8: ff:P-O-L Override Board Name,00A0,Override Manuf,bspm_P9_41_27
 9: ff:P-O-L Override Board Name,00A0,Override Manuf,am33xx_pwm
</pre>
<div class="paragraph">
<p>Now P9_21 is free for the MiniDisplay to use.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>In future Bone images, all of the pins will already be allocated as part of the main device tree using runtime pinmux helpers and configured at runtime using the <a href="http://bit.ly/1EXLeP2">config-pin utility</a>. This would eliminate the need for device tree overlays in most cases.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now, configure it for the MiniDisplay and run a test:</p>
</div>
<pre data-type="programlisting">
bone# <strong>echo BB-SPIDEV0 &gt; $SLOTS</strong>
bone# <strong>./minidisplay-test</strong>
</pre>
<div class="paragraph">
<p>You then see Boris, as shown in <a href="#capes_miniDisplayBoris">MiniDisplay showing Boris <sup class="footnote">[5]</sup></a>.</p>
</div>
<div id="capes_miniDisplayBoris" class="imageblock">
<div class="content">
<img src="./09capes/figures/miniDisplay_Boris.png" alt="miniDisplay LCD showing Boris">
</div>
<div class="title">Figure 91. MiniDisplay showing Boris <sup class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnotedef_5" title="View footnote.">5</a>]</sup></div>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_88">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="_connecting_multiple_capes">Connecting Multiple Capes</h3>
<div class="sect3">
<h4 id="_problem_91">Problem</h4>
<div class="paragraph">
<p>You want to use more than one cape at a time.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_91">Solution</h4>
<div class="paragraph">
<p>First, look at each cape that you want to stack mechanically. Are they all using stacking
headers like the ones shown in <a href="#capes_stacking_headers">Stacking headers</a>? No more than one should be using non-stacking headers.</p>
</div>
<div id="capes_stacking_headers" class="imageblock">
<div class="content">
<img src="./09capes/figures/stacking_headers.JPG" alt="stacking headers">
</div>
<div class="title">Figure 92. Stacking headers</div>
</div>
<div class="paragraph">
<p>Note that larger LCD panels might provide expansion headers, such as the ones
shown in <a href="#capes_lcd_backside">Back side of LCD7 cape <sup class="footnote">[6]</sup></a>, rather than the stacking headers, and that those can also be used for adding
additional capes.</p>
</div>
<div id="capes_lcd_backside" class="imageblock">
<div class="content">
<img src="./09capes/figures/LCD7back.png" alt="LCD7back">
</div>
<div class="title">Figure 93. Back side of LCD7 cape <sup class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnotedef_6" title="View footnote.">6</a>]</sup></div>
</div>
<div class="paragraph">
<p>Next, take a note of each pin utilized by each cape. The <a href="http://beaglebonecapes.com">BeagleBone Capes catalog</a> provides a graphical representation for the pin usage of most capes, as shown in <a href="#Audio_cape_pins_fig">Pins utilized by CircuitCo Audio Cape <sup class="footnote">[7]</sup></a> for the Circuitco Audio Cape.</p>
</div>
<div id="Audio_cape_pins_fig" class="imageblock">
<div class="content">
<img src="./09capes/figures/audioCape.png" alt="CircuitCo Audio Cape">
</div>
<div class="title">Figure 94. Pins utilized by CircuitCo Audio Cape <sup class="footnote">[<a id="_footnoteref_7" class="footnote" href="#_footnotedef_7" title="View footnote.">7</a>]</sup></div>
</div>
<div class="paragraph">
<p>In most cases, the same pin should never be used on two different capes, though in some cases, pins can be shared. Here are some exceptions:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">GND</dt>
<dd>
<p>The ground (GND) pins should be shared between the capes, and there&#8217;s no need to worry about consumed resources on those pins.</p>
</dd>
<dt class="hdlist1">VDD_3V3</dt>
<dd>
<p>The 3.3 V power supply (VDD_3V3) pins can be shared by all capes to supply power, but the total combined consumption of all the capes should be less than 500 mA (250 mA per VDD_3V3 pin).</p>
</dd>
<dt class="hdlist1">VDD_5V</dt>
<dd>
<p>The 5.0 V power supply (VDD_5V) pins can be shared by all capes to supply power, but the total combined consumption of all the capes should be less than 2 A (1 A per VDD_5V pin). It is possible for one, and only one, of the capes to <em>provide</em> power to this pin rather than consume it, and it should provide at least 3 A to ensure proper system function. Note that when no voltage is applied to the DC connector, nor from a cape, these pins will not be powered, even if power is provided via USB.</p>
</dd>
<dt class="hdlist1">SYS_5V</dt>
<dd>
<p>The regulated 5.0 V power supply (SYS_5V) pins can be shared by all capes to supply power, but the total combined consumption of all the capes should be less than 500 mA (250 mA per SYS_5V pin).</p>
</dd>
<dt class="hdlist1">VADC and AGND</dt>
<dd>
<p>The ADC reference voltage pins can be shared by all capes.</p>
</dd>
<dt class="hdlist1">I2C2_SCL and I2C2_SDA</dt>
<dd>
<p>I<sup>2</sup>C is a shared bus, and the I2C2_SCL and I2C2_SDA pins default to having this bus enabled for use by cape expansion ID EEPROMs.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_89">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="capes_soldering">Moving from a Breadboard to a Protoboard</h3>
<div class="sect3">
<h4 id="_problem_92">Problem</h4>
<div class="paragraph">
<p>You have your circuit working fine on the breadboard, but you want a more reliable solution.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_92">Solution</h4>
<div class="paragraph">
<p>Solder your components to a protoboard.</p>
</div>
<div class="paragraph">
<p>To make this recipe, you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Protoboard (see <a href="#app_proto">Prototyping Equipment</a>)</p>
</li>
<li>
<p>Soldering iron (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
<li>
<p>Your other components</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Many places make premade circuit boards that are laid out like the breadboard we have been using. <a href="#capes_beaglebread_fig">BeagleBone breadboard <sup class="footnote">[8]</sup></a> shows the <a href="http://bit.ly/1HCwtB4">BeagleBone Breadboard</a>, which is just one protoboard option.</p>
</div>
<div id="capes_beaglebread_fig" class="imageblock">
<div class="content">
<img src="./09capes/figures/breadboard.png" alt="BeagleBone Breadboard">
</div>
<div class="title">Figure 95. BeagleBone breadboard <sup class="footnote">[<a id="_footnoteref_8" class="footnote" href="#_footnotedef_8" title="View footnote.">8</a>]</sup></div>
</div>
<div class="paragraph">
<p>You just solder your parts on the protoboard as you had them on the breadboard.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_90">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="capes_creating_prototype_schematic">Creating a Prototype Schematic</h3>
<div class="sect3">
<h4 id="_problem_93">Problem</h4>
<div class="paragraph">
<p>You&#8217;ve wired up a circuit on a breadboard. How do you turn that prototype into a schematic others can read and that you can import into other design tools?</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_93">Solution</h4>
<div class="paragraph">
<p>In <a href="#tips_fritzing">[tips_fritzing]</a>, we introduced Fritzing as a useful tool for drawing block diagrams. Fritzing can also do circuit schematics and printed-circuit layout. For example, <a href="#capes_quickRobo_fig">A simple robot controller diagram (quickBot.fzz)</a> shows a block diagram for a simple robot controller (<em><span class="keep-together">quickBot.fzz</span></em> is the name of the Fritzing file used to create the diagram).</p>
</div>
<div id="capes_quickRobo_fig" class="imageblock">
<div class="content">
<img src="./09capes/figures/quickBot_bb.png" alt="Simple robot diagram">
</div>
<div class="title">Figure 96. A simple robot controller diagram (quickBot.fzz)</div>
</div>
<div class="paragraph">
<p>The controller has an H-bridge to drive two DC motors (<a href="#motors_dcDirection">Controlling the Speed and Direction of a DC Motor</a>), an IR range sensor, and two headers for attaching analog encoders for the motors. Both the IR sensor and the encoders have analog outputs that exceed 1.8 V, so each is run through a voltage divider (two resistors) to scale the voltage to the correct range (see <a href="#sensors_hc-sr04">Reading a Distance Sensor (Variable Pulse Width Sensor)</a> for a voltage divider example).</p>
</div>
<div class="paragraph">
<p><a href="#capes_quickRobo_schemRaw">Automatically generated schematic</a> shows the schematic automatically generated by Fritzing. It&#8217;s a mess. It&#8217;s up to you to fix it.</p>
</div>
<div id="capes_quickRobo_schemRaw" class="imageblock">
<div class="content">
<img src="./09capes/figures/quickBot_schemRaw.png" alt="Autogenerated schematic">
</div>
<div class="title">Figure 97. Automatically generated schematic</div>
</div>
<div class="paragraph">
<p><a href="#capes_quickRobo_schem">Cleaned-up schematic</a> shows my cleaned-up schematic. I did it by moving the parts around until it looked better.</p>
</div>
<div id="capes_quickRobo_schem" class="imageblock">
<div class="content">
<img src="./09capes/figures/quickBot_schem.png" alt="Cleaned up schematic">
</div>
<div class="title">Figure 98. Cleaned-up schematic</div>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_91">Discussion</h4>
<div id="capes_quickRobo_schemZoom" class="imageblock">
<div class="content">
<img src="./09capes/figures/quickBot_schemZoom.png" alt="Zoomed in schematic">
</div>
<div class="title">Figure 99. Zoomed-in schematic</div>
</div>
<div class="paragraph">
<p>You might find that you want to create your design in a more advanced design tool, perhaps because it has the library components you desire, it integrates better with other tools you are using, or it has some other feature (such as simulation) of which you&#8217;d like to take advantage.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="capes_verify">Verifying Your Cape Design</h3>
<div class="sect3">
<h4 id="_problem_94">Problem</h4>
<div class="paragraph">
<p>You&#8217;ve got a design. How do you quickly verify that it works?</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_94">Solution</h4>
<div class="paragraph">
<p>To make this recipe, you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An oscilloscope (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Break down your design into functional subcomponents and write tests for each. Use components you already know are working, such as the onboard LEDs, to display the test status with the code in <a href="#capes_quickBot_motor_test_code">Testing the quickBot motors interface (quickBot_motor_test.js)</a>.</p>
</div>
<div id="capes_quickBot_motor_test_code" class="exampleblock">
<div class="title">Example 55. Testing the quickBot motors interface (quickBot_motor_test.js)</div>
<div class="content">
<pre data-type="programlisting">#!/usr/bin/env node
var b = require('bonescript');
var M1_SPEED    = 'P9_16'; <a class="co" id="co_hello_CO1-1_unique" href="#callout_hello_CO1-1_unique"><img src="callouts/1.png" alt="1"/></a>
var M1_FORWARD  = 'P8_15';
var M1_BACKWARD = 'P8_13';
var M2_SPEED    = 'P9_14';
var M2_FORWARD  = 'P8_9';
var M2_BACKWARD = 'P8_11';
var freq = 50; <a class="co" id="co_hello_CO1-2_unique" href="#callout_hello_CO1-2_unique"><img src="callouts/2.png" alt="2"/></a>
var fast = 0.95;
var slow = 0.7;
var state = 0;  <a class="co" id="co_hello_CO1-3_unique" href="#callout_hello_CO1-3_unique"><img src="callouts/3.png" alt="3"/></a>

b.pinMode(M1_FORWARD, b.OUTPUT); <a class="co" id="co_hello_CO1-4_unique" href="#callout_hello_CO1-4_unique"><img src="callouts/4.png" alt="4"/></a>
b.pinMode(M1_BACKWARD, b.OUTPUT);
b.pinMode(M2_FORWARD, b.OUTPUT);
b.pinMode(M2_BACKWARD, b.OUTPUT);
b.analogWrite(M1_SPEED, 0, freq); <a class="co" id="co_hello_CO1-5_unique" href="#callout_hello_CO1-5_unique"><img src="callouts/5.png" alt="5"/></a>
b.analogWrite(M2_SPEED, 0, freq);

updateMotors(); <a class="co" id="co_hello_CO1-6_unique" href="#callout_hello_CO1-6_unique"><img src="callouts/6.png" alt="6"/></a>

function updateMotors() { <img src="callouts/6.png" alt="6"/>
    //console.log("Setting state = " + state); <a class="co" id="co_hello_CO1-7_unique" href="#callout_hello_CO1-7_unique"><img src="callouts/7.png" alt="7"/></a>
    updateLEDs(state); <img src="callouts/7.png" alt="7"/>
    switch(state) { <img src="callouts/3.png" alt="3"/>
        case 0:
        default:
            M1_set(0); <a class="co" id="co_hello_CO1-8_unique" href="#callout_hello_CO1-8_unique"><img src="callouts/8.png" alt="8"/></a>
            M2_set(0);
            state = 1; <img src="callouts/3.png" alt="3"/>
            break;
        case 1:
            M1_set(slow);
            M2_set(slow);
            state = 2;
            break;
        case 2:
            M1_set(slow);
            M2_set(-slow);
            state = 3;
            break;
        case 3:
            M1_set(-slow);
            M2_set(slow);
            state = 4;
            break;
        case 4:
            M1_set(fast);
            M2_set(fast);
            state = 0;
            break;
    }
    setTimeout(updateMotors, 2000); <img src="callouts/3.png" alt="3"/>
}

function updateLEDs(state) { <img src="callouts/7.png" alt="7"/>
    switch(state) {
    case 0:
        b.digitalWrite("USR0", b.LOW);
        b.digitalWrite("USR1", b.LOW);
        b.digitalWrite("USR2", b.LOW);
        b.digitalWrite("USR3", b.LOW);
        break;
    case 1:
        b.digitalWrite("USR0", b.HIGH);
        b.digitalWrite("USR1", b.LOW);
        b.digitalWrite("USR2", b.LOW);
        b.digitalWrite("USR3", b.LOW);
        break;
    case 2:
        b.digitalWrite("USR0", b.LOW);
        b.digitalWrite("USR1", b.HIGH);
        b.digitalWrite("USR2", b.LOW);
        b.digitalWrite("USR3", b.LOW);
        break;
    case 3:
        b.digitalWrite("USR0", b.LOW);
        b.digitalWrite("USR1", b.LOW);
        b.digitalWrite("USR2", b.HIGH);
        b.digitalWrite("USR3", b.LOW);
        break;
    case 4:
        b.digitalWrite("USR0", b.LOW);
        b.digitalWrite("USR1", b.LOW);
        b.digitalWrite("USR2", b.LOW);
        b.digitalWrite("USR3", b.HIGH);
        break;
    }
}

function M1_set(speed) { <img src="callouts/8.png" alt="8"/>
    speed = (speed &gt; 1) ? 1 : speed; <a class="co" id="co_hello_CO1-9_unique" href="#callout_hello_CO1-9_unique"><img src="callouts/9.png" alt="9"/></a>
    speed = (speed &lt; -1) ? -1 : speed;
    b.digitalWrite(M1_FORWARD, b.LOW);
    b.digitalWrite(M1_BACKWARD, b.LOW);
    if(speed &gt; 0) {
        b.digitalWrite(M1_FORWARD, b.HIGH);
    } else if(speed &lt; 0) {
        b.digitalWrite(M1_BACKWARD, b.HIGH);
    }
    b.analogWrite(M1_SPEED, Math.abs(speed), freq); <a class="co" id="co_hello_CO1-10_unique" href="#callout_hello_CO1-10_unique"><img src="callouts/10.png" alt="10"/></a>
}

function M2_set(speed) {
    speed = (speed &gt; 1) ? 1 : speed;
    speed = (speed &lt; -1) ? -1 : speed;
    b.digitalWrite(M2_FORWARD, b.LOW);
    b.digitalWrite(M2_BACKWARD, b.LOW);
    if(speed &gt; 0) {
        b.digitalWrite(M2_FORWARD, b.HIGH);
    } else if(speed &lt; 0) {
        b.digitalWrite(M2_BACKWARD, b.HIGH);
    }
    b.analogWrite(M2_SPEED, Math.abs(speed), freq);
}</pre>

<dl class="calloutlist">
<dt><a class="co" id="callout_hello_CO1-1_unique" href="#co_hello_CO1-1_unique"><img src="callouts/1.png" alt="1"/></a></dt>
<dd><p>Define each pin as a variable. This makes it easy to change to another pin if you decide that is necessary.</p></dd>
<dt><a class="co" id="callout_hello_CO1-2_unique" href="#co_hello_CO1-2_unique"><img src="callouts/2.png" alt="2"/></a></dt>
<dd><p>Make other simple parameters variables. Again, this makes it easy to update them. When creating this test, I found that the PWM frequency to drive the motors needed to be relatively low to get over the kickback shown in <a data-type="xref" href="#quickBot_motor_kickback"/>. I also found that I needed to get up to about 70 percent duty cycle for my circuit to reliably start the motors turning.</p></dd>
<dt><a class="co" id="callout_hello_CO1-3_unique" href="#co_hello_CO1-3_unique"><img src="callouts/3.png" alt="3"/></a></dt>
<dd><p>Use a simple variable such as <code>state</code> to keep track of the test phase. This is used in a <code>switch</code> statement to jump to the code to configure for that test phase and updated after configuring for the current phase in order to select the next phase. Note that the next phase isn&#8217;t entered until after a two-second delay, as specified in the call to <code>setTimeout()</code>.</p></dd>
<dt><a class="co" id="callout_hello_CO1-4_unique" href="#co_hello_CO1-4_unique"><img src="callouts/4.png" alt="4"/></a></dt>
<dd><p>Perform the initial setup of all the pins.</p></dd>
<dt><a class="co" id="callout_hello_CO1-5_unique" href="#co_hello_CO1-5_unique"><img src="callouts/5.png" alt="5"/></a></dt>
<dd><p>The first time a PWM pin is used, it is configured with the update frequency. It is important to set this just once to the right frequency, because other PWM channels might use the same PWM controller, and attempts to reset the PWM frequency might fail. The <code>pinMode()</code> function doesn&#8217;t have an argument for providing the update frequency, so use the <code>analogWrite()</code> function, instead. You can review using the PWM in <a data-type="xref" href="#motors_servo"/>.</p></dd>
<dt><a class="co" id="callout_hello_CO1-6_unique" href="#co_hello_CO1-6_unique"><img src="callouts/6.png" alt="6"/></a></dt>
<dd><p><code>updateMotors()</code> is the test function for the motors and is defined after all the setup and initialization code. The code calls this function every two seconds using the <code>setTimeout()</code> JavaScript function. The first call is used to prime the loop.</p></dd>
<dt><a class="co" id="callout_hello_CO1-7_unique" href="#co_hello_CO1-7_unique"><img src="callouts/7.png" alt="7"/></a></dt>
<dd><p>The call to <code>console.log()</code> was initially here to observe the state transitions in the debug console, but it was replaced with the <code>updateLEDs()</code> call. Using the <code>USER</code> LEDs makes it possible to note the state transitions without having visibility of the debug console. <code>updateLEDs()</code> is defined later.</p></dd>
<dt><a class="co" id="callout_hello_CO1-8_unique" href="#co_hello_CO1-8_unique"><img src="callouts/8.png" alt="8"/></a></dt>
<dd><p>The <code>M1_set()</code> and <code>M2_set()</code> functions are defined near the bottom and do the work of configuring the motor drivers into a particular state. They take a single argument of <code>speed</code>, as defined between <code>-1</code> (maximum reverse), <code>0</code> (stop), and <code>1</code> (maximum forward).</p></dd>
<dt><a class="co" id="callout_hello_CO1-9_unique" href="#co_hello_CO1-9_unique"><img src="callouts/9.png" alt="9"/></a></dt>
<dd><p>Perform simple bounds checking to ensure that speed values are between <code>-1</code> and <code>1</code>.</p></dd>
<dt><a class="co" id="callout_hello_CO1-10_unique" href="#co_hello_CO1-10_unique"><img src="callouts/10.png" alt="10"/></a></dt>
<dd><p>The <code>analogWrite()</code> call uses the absolute value of <code>speed</code>, making any negative numbers a positive magnitude.</p></dd>
</dl>
</div>
</div>
<div id="quickBot_motor_kickback" class="imageblock">
<div class="content">
<img src="./09capes/figures/quickBot_motor_kickback.JPG" alt="quickBot kicking back">
</div>
<div class="title">Figure 100. quickBot motor test showing kickback</div>
</div>
<div class="paragraph">
<p>Using the solution in <a href="#basics_autorun">Running Applications Automatically</a>, you can untether from your coding station to test your design at your lab workbench, as shown in <a href="#quickBot_scope_fig">quickBot motor test code under scope</a>.</p>
</div>
<div id="quickBot_scope_fig" class="imageblock">
<div class="content">
<img src="./09capes/figures/quickBot_motor_test_scope.JPG" alt="quickBot under scope">
</div>
<div class="title">Figure 101. quickBot motor test code under scope</div>
</div>
<div class="paragraph">
<p>SparkFun provides a <a href="http://bit.ly/18AzuoR">useful guide to using an oscilloscope</a>. You might want to check it out if you&#8217;ve never used an oscilloscope before.
Looking at the stimulus you&#8217;ll generate <em>before</em> you connect up your hardware will help you avoid surprises.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_92">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="capes_layout">Laying Out Your Cape PCB</h3>
<div class="sect3">
<h4 id="_problem_95">Problem</h4>
<div class="paragraph">
<p>You&#8217;ve generated a diagram and schematic for your circuit and verified that they are correct. How do you create a PCB?</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_95">Solution</h4>
<div class="paragraph">
<p>If you&#8217;ve been using Fritzing, all you need to do is click the PCB tab, and there&#8217;s your board. Well, almost. Much like the schematic view shown in <a href="#capes_creating_prototype_schematic">Creating a Prototype Schematic</a>, you need to do some layout work before it&#8217;s actually usable. I just moved the components around until they seemed to be grouped logically and then clicked the Autoroute button.  After a minute or two of trying various layouts, Fritzing picked the one it determined to be the best. <a href="#capes_quickRobo_pcb">Simple robot PCB</a> shows the results.</p>
</div>
<div id="capes_quickRobo_pcb" class="imageblock">
<div class="content">
<img src="./09capes/figures/quickBot_pcb.png" alt="Simple robot PCB">
</div>
<div class="title">Figure 102. Simple robot PCB</div>
</div>
<div class="paragraph">
<p>The <a href="http://bit.ly/1HCxokQ">Fritzing pre-fab web page</a> has a few helpful hints, including checking the widths of all your traces and cleaning up any questionable routing created by the autorouter.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_93">Discussion</h4>
<div class="paragraph">
<p>The PCB in <a href="#capes_quickRobo_pcb">Simple robot PCB</a> is a two-sided board. One color (or shade of gray in the printed book) represents traces on one side of the board, and the other color (or shade of gray) is the other side. Sometimes, you&#8217;ll see a trace come to a small circle and then change colors. This is where it is switching sides of the board through what&#8217;s called a <em>via</em>. One of the goals of PCB design is to minimize the number of vias.</p>
</div>
<div class="paragraph">
<p><a href="#capes_quickRobo_pcb">Simple robot PCB</a> wasn&#8217;t my first try or my last. My approach was to see what was needed to hook where and move the components around to make it easier for the autorouter to carry out its job.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>There are entire books and websites dedicated to creating PCB layouts. Look around and see what you can find. <a href="http://bit.ly/1wXTLki">SparkFun&#8217;s guide to making PCBs</a> is particularly useful.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_customizing_the_board_outline">Customizing the Board Outline</h5>
<div class="paragraph">
<p>One challenge that slipped my first pass review was the board outline. The part we installed in <a href="#tips_fritzing">[tips_fritzing]</a> is meant to represent BeagleBone Black, not a cape, so the outline doesn&#8217;t have the notch cut out of it for the Ethernet <span class="keep-together">connector</span>.</p>
</div>
<div class="paragraph">
<p>The <a href="http://bit.ly/1xd1aGV">Fritzing custom PCB outline page</a> describes how to create and use a custom board outline. Although it is possible to use a drawing tool like <a href="https://inkscape.org/en/">Inkscape</a>, I chose to use <a href="http://bit.ly/1b2aZmn">the SVG <em>path</em> command</a> directly to create <a href="#capes_boardoutline_code">Outline SVG for BeagleBone cape (beaglebone_cape_boardoutline.svg)</a>.</p>
</div>
<div id="capes_boardoutline_code" class="exampleblock">
<div class="title">Example 56. Outline SVG for BeagleBone cape (beaglebone_cape_boardoutline.svg)</div>
<div class="content">
<pre data-type="programlisting">&lt;?xml version='1.0' encoding='UTF-8' standalone='no'?&gt;
&lt;svg xmlns="http://www.w3.org/2000/svg" version="1.1"
    width="306"  height="193.5"&gt;&lt;!--<a class="co" id="co_capes_bo_1_co" href="#callout_capes_bo_1_co"><img src="callouts/1.png" alt="1"/></a>--&gt;
 &lt;g id="board"&gt;&lt;!--<a class="co" id="co_capes_bo_2_co" href="#callout_capes_bo_2_co"><img src="callouts/2.png" alt="2"/></a>--&gt;
  &lt;path fill="#338040" id="boardoutline" d="M 22.5,0 l 0,56 L 72,56
      q 5,0 5,5 l 0,53.5 q 0,5 -5,5 L 0,119.5 L 0,171 Q 0,193.5 22.5,193.5
      l 238.5,0 c 24.85281,0 45,-20.14719 45,-45 L 306,45
      C 306,20.14719 285.85281,0 261,0 z"/&gt;&lt;!--<a class="co" id="co_capes_bo_3_co" href="#callout_capes_bo_3_co"><img src="callouts/3.png" alt="3"/></a>--&gt;
 &lt;/g&gt;
&lt;/svg&gt;
</pre>
</div>
</div>
<dl class="calloutlist">
<dt><a class="co" id="callout_capes_bo_1_co" href="#co_capes_bo_1_co"><img src="callouts/1.png" alt="1"/></a></dt><dd><p>This is a standard SVG header. The width and height are set based on the BeagleBone outline provided in the Adafruit library.</p></dd>
<dt><a class="co" id="callout_capes_bo_2_co" href="#co_capes_bo_2_co"><img src="callouts/2.png" alt="2"/></a></dt><dd><p>Fritzing requires the element to be within a layer called <code>board</code>.</p></dd>
<dt><a class="co" id="callout_capes_bo_3_co" href="#co_capes_bo_3_co"><img src="callouts/3.png" alt="3"/></a></dt><dd><p>Fritzing requires the color to be <code>#338040</code> and the layer to be called <code>boardoutline</code>. The units end up being 1/90 of an inch. That is, take the numbers in the SVG code and divide by 90 to get the numbers from the System Reference Manual.</p></dd>
</dl>
<div class="paragraph">
<p>The measurements are taken from the <a href="http://bit.ly/1C5rSa8">BeagleBone Black System Reference Manual</a>, as shown in <a href="#capes_dimensions_fig">Cape dimensions</a>.</p>
</div>
<div id="capes_dimensions_fig" class="imageblock">
<div class="content">
<img src="./09capes/figures/srm_cape_dimensions.png" alt="Cape dimensions in SRM">
</div>
<div class="title">Figure 103. Cape dimensions</div>
</div>
<div class="paragraph">
<p>You can observe the rendered output of <a href="#capes_boardoutline_code">Outline SVG for BeagleBone cape (beaglebone_cape_boardoutline.svg)</a> quickly by opening the file in a web browser, as shown in <a href="#capes_boardoutline_fig">Rendered cape outline in Chrome</a>.</p>
</div>
<div id="capes_boardoutline_fig" class="imageblock">
<div class="content">
<img src="./09capes/figures/beaglebone_cape_boardoutline.png" alt="Board outline in Chrome">
</div>
<div class="title">Figure 104. Rendered cape outline in Chrome</div>
</div>
<div class="paragraph">
<p>After you have the SVG outline, you&#8217;ll need to select the PCB in Fritzing and select a custom shape in the Inspector box. Begin with the original background, as shown in <a href="#capes_fritzing1">PCB with original board, without notch for Ethernet connector</a>.</p>
</div>
<div id="capes_fritzing1" class="imageblock">
<div class="content">
<img src="./09capes/figures/fritzing1.png" alt="PCB orginal baord">
</div>
<div class="title">Figure 105. PCB with original board, without notch for Ethernet connector</div>
</div>
<div class="paragraph">
<p>Hide all but the Board Layer (<a href="#capes_fritzing2">PCB with all but the Board Layer hidden</a>).</p>
</div>
<div id="capes_fritzing2" class="imageblock">
<div class="content">
<img src="./09capes/figures/fritzing2.png" alt="PCB orginal baord hidden">
</div>
<div class="title">Figure 106. PCB with all but the Board Layer hidden</div>
</div>
<div class="paragraph">
<p>Select the PCB1 object and  then, in the Inspector pane, scroll down to the "load image file" button (<a href="#capes_fritzing3">Clicking :load image file: with PCB1 selected</a>).</p>
</div>
<div id="capes_fritzing3" class="imageblock">
<div class="content">
<img src="./09capes/figures/fritzing3.png" alt="PCB load image file">
</div>
<div class="title">Figure 107. Clicking :load image file: with PCB1 selected</div>
</div>
<div class="paragraph">
<p>Navigate to the <em>beaglebone_cape_boardoutline.svg</em> file created in <a href="#capes_boardoutline_code">Outline SVG for BeagleBone cape (beaglebone_cape_boardoutline.svg)</a>, as shown in <a href="#capes_fritzing4">Selecting the .svg file</a>.</p>
</div>
<div id="capes_fritzing4" class="imageblock">
<div class="content">
<img src="./09capes/figures/fritzing4.png" alt="PCB selecting svg file">
</div>
<div class="title">Figure 108. Selecting the .svg file</div>
</div>
<div class="paragraph">
<p>Turn on the other layers and line up the Board Layer with the rest of the PCB, as shown in <a href="#capes_fritzing_inspector_fig">PCB Inspector</a>.</p>
</div>
<div id="capes_fritzing_inspector_fig" class="imageblock">
<div class="content">
<img src="./09capes/figures/Fritzing_Inspector.png" alt="PCB Inspector">
</div>
<div class="title">Figure 109. PCB Inspector</div>
</div>
<div class="paragraph">
<p>Now, you can save your file and send it off to be made, as described in <a href="#capes_prototype">Producing a Prototype</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_pcb_design_alternatives">PCB Design Alternatives</h5>
<div class="paragraph">
<p>There are other free PCB design programs. Here are a few.</p>
</div>
<div class="paragraph">
<p><strong>EAGLE</strong></p>
</div>
<div class="paragraph">
<p><a href="http://www.cadsoftusa.com/">Eagle PCB</a> and <a href="http://bit.ly/19cbwS0">DesignSpark PCB</a> are two popular design programs. Many capes (and other PCBs) are designed with Eagle PCB, and the files are available. For example, the MiniDisplay cape (<a href="#capes_miniDisplay">Using a 128 x 128-Pixel LCD Cape</a>) has the schematic shown in <a href="#capes_miniDisplay_schem">Schematic for the MiniDisplay cape</a> and PCB shown in <a href="#capes_miniDisplay_pcb">PCB for MiniDisplay cape</a>.</p>
</div>
<div id="capes_miniDisplay_schem" class="imageblock">
<div class="content">
<img src="./09capes/figures/miniDisplay_Cape_schem.png" alt="Schematic for miniDisplay">
</div>
<div class="title">Figure 110. Schematic for the MiniDisplay cape</div>
</div>
<div id="capes_miniDisplay_pcb" class="imageblock">
<div class="content">
<img src="./09capes/figures/miniDisplay_Cape_pcb.png" alt="PCB for miniDisplay">
</div>
<div class="title">Figure 111. PCB for MiniDisplay cape</div>
</div>
<div class="paragraph">
<p>A good starting point is to take the PCB layout for the MiniDisplay and edit it for your project. The connectors for P8 and P9 are already in place and ready to go.</p>
</div>
<div class="paragraph">
<p>Eagle PCB is a powerful system with many good tutorials online. The free version runs on Windows, Mac, and Linux, but it has three <a href="http://bit.ly/1E5Kh3l">limitations</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The usable board area is limited to 100 x 80 mm (4 x 3.2 inches).</p>
</li>
<li>
<p>You can use only two signal layers (Top and Bottom).</p>
</li>
<li>
<p>The schematic editor can create only one sheet.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can install Eagle PCB on your Linux host by using the following command:</p>
</div>
<pre data-type="programlisting">
host$ <strong>sudo apt-get install eagle</strong>
Reading package lists... Done
Building dependency tree
Reading state information... Done
...
Setting up eagle (6.5.0-1) ...
Processing triggers for libc-bin (2.19-0ubuntu6.4) ...
host$ <strong>eagle</strong>
</pre>
<div class="paragraph">
<p>You&#8217;ll see the startup screen shown in <a href="#capes_Eagle_License">Eagle PCB startup screen</a>.</p>
</div>
<div id="capes_Eagle_License" class="imageblock">
<div class="content">
<img src="./09capes/figures/EagleLicense.png" alt="Eagle License">
</div>
<div class="title">Figure 112. Eagle PCB startup screen</div>
</div>
<div class="paragraph">
<p>Click "Run as Freeware." When my Eagle started, it said it needed to be updated. To update on Linux, follow the link provided by Eagle and download <em>eagle-lin-7.2.0.run</em> (or whatever version is current.). Then run the following commands:</p>
</div>
<pre data-type="programlisting">
host$ <strong>chmod +x eagle-lin-7.2.0.run</strong>
host$ <strong>./eagle-lin-7.2.0.run</strong>
</pre>
<div class="paragraph">
<p>A series of screens will appear. Click Next. When you see a screen that looks like <a href="#capes_eagle3">The Eagle installation destination directory</a>, note the Destination Directory.</p>
</div>
<div id="capes_eagle3" class="imageblock">
<div class="content">
<img src="./09capes/figures/eagle3.png" alt="Eagle install destination directory">
</div>
<div class="title">Figure 113. The Eagle installation destination directory</div>
</div>
<div class="paragraph">
<p>Continue clicking Next until it&#8217;s installed. Then run the following commands (where ~/eagle-7.2.0 is the path you noted in <a href="#capes_eagle3">The Eagle installation destination directory</a>):</p>
</div>
<pre data-type="programlisting">
host$ <strong>cd /usr/bin</strong>
host$ <strong>sudo rm eagle</strong>
host$ <strong>sudo ln -s ~/eagle-7.2.0/bin/eagle .</strong>
host$ <strong>cd</strong>
host$ <strong>eagle</strong>
</pre>
<div class="paragraph">
<p>The ls command links eagle in <em>/usr/bin</em>, so you can run eagle from any directory. After eagle starts, you&#8217;ll see the start screen shown in <a href="#capes_eagle7">The Eagle start screen</a>.</p>
</div>
<div id="capes_eagle7" class="imageblock">
<div class="content">
<img src="./09capes/figures/eagle7.png" alt="Eagle start screen">
</div>
<div class="title">Figure 114. The Eagle start screen</div>
</div>
<div class="paragraph">
<p>Ensure that the correct version number appears.</p>
</div>
<div class="paragraph">
<p>If you are moving a design from Fritzing to Eagle, see <a href="#capes_schematic_migration">Migrating a Fritzing Schematic to Another Tool</a> for tips on converting from one to the other.</p>
</div>
<div class="paragraph">
<p><strong>DesignSpark PCB</strong></p>
</div>
<div class="paragraph">
<p>The free <a href="http://bit.ly/19cbwS0">DesignSpark PCB</a> doesn&#8217;t have the same limitations as Eagle PCB, but it runs only on Windows. Also, it doesn&#8217;t seem to have the following of Eagle at this time.</p>
</div>
<div id="capes_upverter" class="paragraph">
<p><strong>Upverter</strong></p>
</div>
<div class="paragraph">
<p>In addition to free solutions you run on your desktop, you can also work with a browser-based tool called <a href="https://upverter.com/">Upverter</a>. With Upverter, you can collaborate easily, editing your designs from anywhere on the Internet. It also provides many conversion options and a PCB fabrication service.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Don&#8217;t confuse Upverter with Upconverter (<a href="#capes_schematic_migration">Migrating a Fritzing Schematic to Another Tool</a>). Though their names differ by only three letters, they differ greatly in what they do.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="capes_kicad" class="paragraph">
<p><strong>Kicad</strong></p>
</div>
<div class="paragraph">
<p>Unlike the previously mentioned free (no-cost) solutions, <a href="http://bit.ly/1b2bnBg">Kicad</a> is open source and provides some features beyond those of Fritzing. Notably, <a href="http://circuithub.com/">CircuitHub</a> (discussed in <a href="#capes_production">Putting Your Cape Design into Production</a>) provides support for uploading Kicad designs.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="capes_schematic_migration">Migrating a Fritzing Schematic to Another Tool</h3>
<div class="sect3">
<h4 id="_problem_96">Problem</h4>
<div class="paragraph">
<p>You created your schematic in Fritzing, but it doesn&#8217;t integrate with everything you need. How can you move the schematic to another tool?</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_96">Solution</h4>
<div class="paragraph">
<p>Use the <a href="http://bit.ly/1wXUkdM">Upverter schematic-file-converter</a> Python script. For example, suppose that you want to convert the Fritzing file for the diagram shown in <a href="#capes_quickRobo_fig">A simple robot controller diagram (quickBot.fzz)</a>. First, install Upverter.</p>
</div>
<div class="paragraph">
<p>I found it necessary to install libfreetype6 and freetype-py onto my system, but you might not need this first step:</p>
</div>
<pre data-type="programlisting">
host$ <strong>sudo apt-get install libfreetype6</strong>
Reading package lists... Done
Building dependency tree
Reading state information... Done
libfreetype6 is already the newest version.
0 upgraded, 0 newly installed, 0 to remove and 154 not upgraded.
host$ <strong>sudo pip install freetype-py</strong>
Downloading/unpacking freetype-py
  Running setup.py egg_info for package freetype-py

Installing collected packages: freetype-py
  Running setup.py install for freetype-py

Successfully installed freetype-py
Cleaning up...
</pre>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>All these commands are being run on the Linux-based host computer, as shown by the host$ prompt. Log in as a normal user, not root.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now, install the schematic-file-converter tool:</p>
</div>
<pre data-type="programlisting">
host$ <strong>git clone git@github.com:upverter/schematic-file-converter.git</strong>
Cloning into 'schematic-file-converter'...
remote: Counting objects: 22251, done.
remote: Total 22251 (delta 0), reused 0 (delta 0)
Receiving objects: 100% (22251/22251), 39.45 MiB | 7.28 MiB/s, done.
Resolving deltas: 100% (14761/14761), done.
Checking connectivity... done.
Checking out files: 100% (16880/16880), done.
host$ <strong>cd schematic-file-converter</strong>
host$ <strong>sudo python setup.py install</strong>
.
.
.
Extracting python_upconvert-0.8.9-py2.7.egg to \
    /usr/local/lib/python2.7/dist-packages
Adding python-upconvert 0.8.9 to easy-install.pth file

Installed /usr/local/lib/python2.7/dist-packages/python_upconvert-0.8.9-py2.7.egg
Processing dependencies for python-upconvert==0.8.9
Finished processing dependencies for python-upconvert==0.8.9
host$ <strong>cd ..</strong>
host$ <strong>python -m upconvert.upconverter -h</strong>
usage: upconverter.py [-h] [-i INPUT] [-f TYPE] [-o OUTPUT] [-t TYPE]
                      [-s SYMDIRS [SYMDIRS ...]] [--unsupported]
                      [--raise-errors] [--profile] [-v] [--formats]

optional arguments:
  -h, --help            show this help message and exit
  -i INPUT, --input INPUT
                        read INPUT file in
  -f TYPE, --from TYPE  read input file as TYPE
  -o OUTPUT, --output OUTPUT
                        write OUTPUT file out
  -t TYPE, --to TYPE    write output file as TYPE
  -s SYMDIRS [SYMDIRS ...], --sym-dirs SYMDIRS [SYMDIRS ...]
                        specify SYMDIRS to search for .sym files (for gEDA
                        only)
  --unsupported         run with an unsupported python version
  --raise-errors        show tracebacks for parsing and writing errors
  --profile             collect profiling information
  -v, --version         print version information and quit
  --formats             print supported formats and quit
</pre>
<div class="paragraph pagebreak-before">
<p>At the time of this writing, Upverter suppports the following file types:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">File type</th>
<th class="tableblock halign-left valign-top">Support</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">openjson</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">i/o</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kicad</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">i/o</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">geda</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">i/o</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eagle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">i/o</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eaglexml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">i/o</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fritzing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">in only, schematic only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gerber</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">i/o</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">specctra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">i/o</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">out only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ncdrill</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">out only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bom (csv)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">out only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">netlist (csv)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">out only</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>After Upverter is installed, run the file (<em>quickBot.fzz</em>) that generated <a href="#capes_quickRobo_fig">A simple robot controller diagram (quickBot.fzz)</a> through Upverter:</p>
</div>
<pre data-type="programlisting">
host$ <strong>python -m upconvert.upconverter -i quickBot.fzz \
-f fritzing -o quickBot-eaglexml.sch -t eaglexml --unsupported</strong>
WARNING: RUNNING UNSUPPORTED VERSION OF PYTHON (2.7 > 2.6)
DEBUG:main:parsing quickBot.fzz in format fritzing
host$ <strong>ls -l</strong>
total 188
-rw-rw-r-- 1 ubuntu ubuntu  63914 Nov 25 19:47 quickBot-eaglexml.sch
-rw-r--r-- 1 ubuntu ubuntu 122193 Nov 25 19:43 quickBot.fzz
drwxrwxr-x 9 ubuntu ubuntu   4096 Nov 25 19:42 schematic-file-converter
</pre>
<div class="paragraph">
<p><a href="#caps_eagle">Output of Upverter conversion</a> shows the output of the conversion.</p>
</div>
<div id="caps_eagle" class="imageblock">
<div class="content">
<img src="./09capes/figures/quickBot_eaglexml.png" alt="Converter Output">
</div>
<div class="title">Figure 115. Output of Upverter conversion</div>
</div>
<div class="paragraph">
<p>No one said it would be pretty!</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_94">Discussion</h4>
<div class="paragraph">
<p>I found that Eagle was more generous at reading in the eaglexml format than the eagle format. This also made it easier to hand-edit any translation issues.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="capes_prototype">Producing a Prototype</h3>
<div class="sect3">
<h4 id="_problem_97">Problem</h4>
<div class="paragraph">
<p>You have your PCB all designed. How do you get it made?</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_97">Solution</h4>
<div class="paragraph">
<p>To make this recipe, you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A completed design (see <a href="#capes_layout">Laying Out Your Cape PCB</a>)</p>
</li>
<li>
<p>Soldering iron (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
<li>
<p>Oscilloscope (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
<li>
<p>Multimeter (see <a href="#app_misc">Miscellaneous</a>)</p>
</li>
<li>
<p>Your other components</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Upload your design to <a href="http://oshpark.com">OSH Park</a> and order a few boards. <a href="#capes_oshpark_share">The OSH Park QuickBot Cape shared project page</a> shows a resulting <a href="http://bit.ly/1MtlzAp">shared project page for the quickBot cape</a> created in <a href="#capes_layout">Laying Out Your Cape PCB</a>. We&#8217;ll proceed to break down how this design was uploaded and shared to enable ordering fabricated PCBs.</p>
</div>
<div id="capes_oshpark_share" class="imageblock">
<div class="content">
<img src="./09capes/figures/quickBot_oshpark_share.png" alt="quickBot oshpark share">
</div>
<div class="title">Figure 116. The OSH Park QuickBot Cape shared project page</div>
</div>
<div class="paragraph">
<p>Within Fritzing, click the menu next to "Export for PCB" and choose "Extended Gerber," as shown in <a href="#capes_fritzing_export_fig">Choosing "Extended Gerber" in Fritzing</a>. You&#8217;ll need to choose a directory in which to save them and then compress them all into a <a href="http://bit.ly/1Br5lEh">Zip file</a>. The <a href="http://bit.ly/1B4GqRU">WikiHow article on creating Zip files</a> might be helpful if you aren&#8217;t very experienced at making these.</p>
</div>
<div id="capes_fritzing_export_fig" class="imageblock">
<div class="content">
<img src="./09capes/figures/quickBot_fritzing_export.png" alt="quickBot fritzing export">
</div>
<div class="title">Figure 117. Choosing "Extended Gerber" in Fritzing</div>
</div>
<div class="paragraph">
<p>Things on the <a href="http://oshpark.com">OSH Park website</a> are reasonably self-explanatory. You&#8217;ll need to create an account and upload the Zip file containing the <a href="http://bit.ly/1B4GzEZ">Gerber files</a> you created. If you are a cautious person, you might choose to examine the Gerber files with a Gerber file viewer first. The <a href="http://bit.ly/18bUgeA">Fritzing fabrication FAQ</a> offers several suggestions, including <a href="http://gerbv.sourceforge.net/">gerbv</a> for Windows and Linux users.</p>
</div>
<div class="paragraph">
<p>When your upload is complete, you&#8217;ll be given a quote, shown images for review, and presented with options for accepting and ordering. After you have accepted the design, your <a href="https://oshpark.com/users/current">list of accepted designs</a> will also include the option of enabling sharing of your designs so that others can order a PCB, as well. If you are looking to make some money on your design, you&#8217;ll want to go another route, like the one described in <a href="#capes_production">Putting Your Cape Design into Production</a>. <a href="#capes_quickbot_pcb">QuickBot PCB</a> shows the resulting PCB that arrives in the mail.</p>
</div>
<div id="capes_quickbot_pcb" class="imageblock">
<div class="content">
<img src="./09capes/figures/quickBot_pcb.JPG" alt="quickBot pcb">
</div>
<div class="title">Figure 118. QuickBot PCB</div>
</div>
<div class="paragraph">
<p>Now is a good time to ensure that you have all of your components and a soldering station set up as in <a href="#capes_soldering">Moving from a Breadboard to a Protoboard</a>, as well as an oscilloscope, as used in <a href="#capes_verify">Verifying Your Cape Design</a>.</p>
</div>
<div class="paragraph">
<p>When you get your board, it is often informative to "buzz out" a few connections by using a multimeter. If you&#8217;ve never used a multimeter before, the <a href="http://bit.ly/18bUgeA">SparkFun</a> or <a href="http://bit.ly/1Br5Xtv">Adafruit</a> tutorials might be helpful. Set your meter to continuity testing mode and probe between points where the headers are and where they should be connecting to your components. This would be more difficult and less accurate after you solder down your components, so it is a good idea to keep a bare board around just for this purpose.</p>
</div>
<div class="paragraph">
<p>You&#8217;ll also want to examine your board mechanically before soldering parts down. You don&#8217;t want to waste components on a PCB that might need to be altered or replaced.</p>
</div>
<div class="paragraph">
<p>When you begin assembling your board, it is advisable to assemble it in functional subsections, if possible, to help narrow down any potential issues. <a href="#capes_motors_soldered">QuickBot motors under test</a> shows the motor portion wired up and running the test in <a href="#capes_quickBot_motor_test_code">Testing the quickBot motors interface (quickBot_motor_test.js)</a>.</p>
</div>
<div id="capes_motors_soldered" class="imageblock">
<div class="content">
<img src="./09capes/figures/quickBot_motors.jpg" alt="quickBot motors">
</div>
<div class="title">Figure 119. QuickBot motors under test</div>
</div>
<div class="paragraph">
<p>Continue assembling and testing your board until you are happy. If you find issues, you might choose to cut traces and use point-to-point wiring to resolve your issues before placing an order for a new PCB. Better right the second time than the third!</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_95">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="_creating_contents_for_your_cape_configuration_eeprom">Creating Contents for Your Cape Configuration EEPROM</h3>
<div class="sect3">
<h4 id="_problem_98">Problem</h4>
<div class="paragraph">
<p>Your cape is ready to go, and you want it to automatically initialize when the Bone boots up.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_98">Solution</h4>
<div class="paragraph">
<p>Complete capes have an I<sup>2</sup>C EEPROM on board that contains configuration information that is read at boot time. <a href="http://bit.ly/1Fb64uF">Adventures in BeagleBone Cape EEPROMs</a> gives a helpful description of two methods for programming the EEPROM.  <a href="http://bit.ly/1E5M7RJ">How to Roll your own BeagleBone Capes</a> is a good four-part series on creating a cape, including how to wire and program the EEPROM.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_96">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="capes_production">Putting Your Cape Design into Production</h3>
<div class="sect3">
<h4 id="_problem_99">Problem</h4>
<div class="paragraph">
<p>You want to share your cape with others.  How do you scale up?</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_99">Solution</h4>
<div class="paragraph">
<p><a href="https://circuithub.com/">CircuitHub</a> offers a great tool to get a quick quote on assembled PCBs. To make things simple, I downloaded the <a href="http://bit.ly/1C5uvJc">CircuitCo MiniDisplay Cape Eagle design materials</a> and uploaded them to CircuitHub.</p>
</div>
<div class="paragraph">
<p>After the design is uploaded, you&#8217;ll need to review the parts to verify that CircuitHub has or can order the right ones. Find the parts in the catalog by changing the text in the search box and clicking the magnifying glass. When you&#8217;ve found a suitable match, select it to confirm its use in your design, as shown in <a href="#capes_circuithub_parts">CircuitHub part matching</a>.</p>
</div>
<div id="capes_circuithub_parts" class="imageblock">
<div class="content">
<img src="./09capes/figures/circuithub_part_matching.png" alt="circuithub part matching">
</div>
<div class="title">Figure 120. CircuitHub part matching</div>
</div>
<div class="paragraph">
<p>When you&#8217;ve selected all of your parts, a quote tool appears at the bottom of the page, as shown in <a href="#capes_circuithub_quote">CircuitHub quote generation</a>.</p>
</div>
<div id="capes_circuithub_quote" class="imageblock">
<div class="content">
<img src="./09capes/figures/circuithub_quote.png" alt="circuithub quote">
</div>
<div class="title">Figure 121. CircuitHub quote generation</div>
</div>
<div class="paragraph">
<p>Checking out the pricing on the MiniDisplay Cape (without including the LCD itself) in <a href="#capes_circuithub_pricing_table">CircuitHub price examples (all prices USD)</a>, you can get a quick idea of how increased volume can dramatically impact the per-unit costs.</p>
</div>
<table id="capes_circuithub_pricing_table" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. CircuitHub price examples (all prices USD)</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Quantity</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">100</th>
<th class="tableblock halign-left valign-top">1000</th>
<th class="tableblock halign-left valign-top">10,000</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PCB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$208.68</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$21.75</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$3.30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$0.98</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$0.90</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$11.56</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$2.55</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$1.54</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$1.01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$0.92</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assembly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$249.84</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$30.69</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$7.40</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$2.79</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$2.32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Per unit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$470.09</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$54.99</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$12.25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$4.79</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$4.16</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$470.09</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$550.00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$1,225.25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$4,796.00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$41,665.79</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Checking the <a href="http://bit.ly/1GF6xqE">Crystalfontz web page for the LCD</a>, you can find the prices for the LCDs as well, as shown in <a href="#capes_lcd_pricing_table">LCD pricing (USD)</a>.</p>
</div>
<table id="capes_lcd_pricing_table" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. LCD pricing (USD)</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Quantity</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">100</th>
<th class="tableblock halign-left valign-top">1000</th>
<th class="tableblock halign-left valign-top">10,000</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Per unit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$12.12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$7.30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$3.86</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$2.84</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$2.84</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$12.12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$73.00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$386.00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$2,840.00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$28,400.00</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To enable more cape developers to launch their designs to the market, CircuitHub has launched a <a href="http://campaign.circuithub.com">group buy campaign site</a>. You, as a cape developer, can choose how much markup you need to be paid for your work and launch the campaign to the public. Money is only collected if and when the desired target quantity is reached, so there&#8217;s no risk that the boards will cost too much to be affordable. This is a great way to cost-effectively launch your boards to market!</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_97">Discussion</h4>
<div class="paragraph">
<p>There&#8217;s no real substitute for getting to know your contract manufacturer, its capabilities, communication style, strengths, and weaknesses. Look around your town to see if anyone is doing this type of work and see if they&#8217;ll give you a tour.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Don&#8217;t confuse CircuitHub and CircuitCo. CircuitCo is the official contract manufacturer of BeagleBoard.org and not the same company as CircuitHub, the online contract manufacturing service. CircuitCo would be an excellent choice for you to consider to perform your contract manufacturing, but it doesn&#8217;t offer an online quote service at this point, so it isn&#8217;t as easy to include details on how to engage with it in this book.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="partsSuppliers">Appendix A: Parts and Suppliers</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_parts">Parts</h3>
<div class="paragraph">
<p>The following tables list where you can find the parts used in this book. We have listed only one or two sources here, but you can often find a given part in many places.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. United States suppliers</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Supplier</th>
<th class="tableblock halign-left valign-top">Website</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adafruit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.adafruit.com" class="bare">http://www.adafruit.com</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Good for modules and parts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amazon</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.amazon.com/" class="bare">http://www.amazon.com/</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Carries everything</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Digikey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.digikey.com/" class="bare">http://www.digikey.com/</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wide range of components</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MakerShed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.makershed.com/" class="bare">http://www.makershed.com/</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Good for modules, kits, and tools</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RadioShack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.radioshack.com/" class="bare">http://www.radioshack.com/</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Walk-in stores</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SeeedStudio</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.seeedstudio.com/depot/" class="bare">http://www.seeedstudio.com/depot/</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Low-cost modules</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SparkFun</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.sparkfun.com" class="bare">http://www.sparkfun.com</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Good for modules and parts</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Other suppliers</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Supplier</th>
<th class="tableblock halign-left valign-top">Website</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Element14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://element14.com/BeagleBone" class="bare">http://element14.com/BeagleBone</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">World-wide BeagleBoard.org-compliant clone of BeagleBone Black, carries many accessories</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="app_proto">Prototyping Equipment</h3>
<div class="paragraph">
<p>Many of the hardware projects in this book use jumper wires and a breadboard. We prefer the preformed wires that lie flat on the board. <a href="#parts_jumper">Jumper wires</a> lists places with jumper wires, and <a href="#parts_breadboard">Breadboards</a> shows where you can get breadboards.</p>
</div>
<table id="parts_jumper" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Jumper wires</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Supplier</th>
<th class="tableblock halign-left valign-top">Website</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amazon</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.amazon.com/Elenco-Piece-Pre-formed-Jumper-Wire/dp/B0002H7AIG" class="bare">http://www.amazon.com/Elenco-Piece-Pre-formed-Jumper-Wire/dp/B0002H7AIG</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Digikey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.digikey.com/product-detail/en/TW-E012-000/438-1049-ND/643115" class="bare">http://www.digikey.com/product-detail/en/TW-E012-000/438-1049-ND/643115</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RadioShack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.radioshack.com/solderless-breadboard-jumper-wire-kit/2760173.html#.VG5i1PnF8fA" class="bare">http://www.radioshack.com/solderless-breadboard-jumper-wire-kit/2760173.html#.VG5i1PnF8fA</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SparkFun</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.sparkfun.com/products/124" class="bare">https://www.sparkfun.com/products/124</a></p></td>
</tr>
</tbody>
</table>
<table id="parts_breadboard" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Breadboards</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Supplier</th>
<th class="tableblock halign-left valign-top">Website</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amazon</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.amazon.com/s/ref=nb_sb_noss_1?url=search-alias%3Dtoys-and-games&amp;field-keywords=breadboards&amp;sprefix=breadboards%2Ctoys-and-games" class="bare">http://www.amazon.com/s/ref=nb_sb_noss_1?url=search-alias%3Dtoys-and-games&amp;field-keywords=breadboards&amp;sprefix=breadboards%2Ctoys-and-games</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Digikey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.digikey.com/product-search/en/prototyping-products/solderless-breadboards/2359510?k=breadboard" class="bare">http://www.digikey.com/product-search/en/prototyping-products/solderless-breadboards/2359510?k=breadboard</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RadioShack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.radioshack.com/search?q=breadboard" class="bare">http://www.radioshack.com/search?q=breadboard</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SparkFun</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.sparkfun.com/search/results?term=breadboard" class="bare">https://www.sparkfun.com/search/results?term=breadboard</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CircuitCo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://elinux.org/CircuitCo:BeagleBone_Breadboard" class="bare">http://elinux.org/CircuitCo:BeagleBone_Breadboard</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If you want something more permanent, try <a href="https://www.adafruit.com/product/1609">Adafruit&#8217;s Perma-Proto Breadboard</a>, laid out like a breadboard.</p>
</div>
</div>
<div class="sect2">
<h3 id="app_resistor">Resistors</h3>
<div class="paragraph">
<p>We use 220 &#8486;, 1 k&#8486;, 4.7 k&#8486;, 10 k&#8486;, 20 k&#8486;, and 22 k&#8486; resistors in this book. All are 0.25 W.  The easiest way to get all these, and many more, is to order <a href="http://bit.ly/1EXREh8">SparkFun&#8217;s Resistor Kit</a>.  It&#8217;s a great way to be ready for future projects, because it has 500 resistors. <a href="http://shack.net/1B4Io4V">RadioShack&#8217;s 500-piece Resistor Assortment</a> is a bit more expensive, but it has a wider variety of resistors.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t need an entire kit of resistors, you can order a la carte from a number of places. <a href="http://shack.net/1E5NoIC">RadioShack has 5-packs</a>, and DigiKey has more than a quarter million <a href="http://bit.ly/1C6WQjZ">through-hole resistors</a> at good prices, but make sure you are ordering the right one.</p>
</div>
<div class="paragraph">
<p>You can find the 10 k&#8486; trimpot (or variable resistor) at <a href="http://bit.ly/18ACvpm">SparkFun</a>,  <a href="http://bit.ly/1NKg1Tv">Adafruit</a>, or <a href="http://shack.net/1Ag286e">RadioShack</a>.</p>
</div>
<div class="paragraph">
<p>Flex resistors (sometimes called <em>flex sensors</em> or <em>bend sensors</em>) are available at <a href="http://bit.ly/1Br7HD2">SparkFun</a> and <a href="http://bit.ly/1HCGoql">Adafruit</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="app_transistor">Transistors and Diodes</h3>
<div class="paragraph">
<p>The <a href="http://bit.ly/1B4J8H4">2N3904</a> is a common NPN transistor that you can get almost anywhere. Even <a href="http://amzn.to/1AjvcsD">Amazon</a> has it. <a href="http://bit.ly/1b2dgxT">Adafruit</a> has a nice 10-pack. <a href="http://bit.ly/1GrZj5P">SparkFun</a> lets you buy them one at a time.  <a href="http://bit.ly/1GF8H9K">DigiKey</a> will gladly sell you 100,000.</p>
</div>
<div class="paragraph">
<p>The <a href="http://bit.ly/1EbRzF6">1N4001</a> is a popular 1A diode. Buy one at <a href="http://bit.ly/1Ajw54G">SparkFun</a>, 10 at <a href="http://bit.ly/1Gs05zP">Adafruit</a>, 25 at <a href="http://shack.net/1E5OTXi">RadioShack</a>, or 40,000 at <a href="http://bit.ly/18ADlT2">DigiKey</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="app_ic">Integrated Circuits</h3>
<div class="paragraph">
<p>The PCA9306 is a small integrated circuit (IC) that converts voltage levels between 3.3 V and 5 V. You can get it cheaply in large quantities from <a href="http://bit.ly/1Fb8REd">DigiKey</a>, but it&#8217;s in a very small, hard-to-use, surface-mount package. Instead, you can get it from <a href="http://bit.ly/19ceTsd">SparkFun on a Breakout board</a>, which plugs into a breadboard.</p>
</div>
<div class="paragraph">
<p>The L293D is an <a href="http://bit.ly/1wujQqk">H-bridge IC</a> with which you can control large loads (such as motors) in both directions.  <a href="http://bit.ly/18bXChR">SparkFun</a>, <a href="http://bit.ly/1xd43Yh">Adafruit</a>, and <a href="http://bit.ly/18bXKOk">DigiKey</a> all have it in a DIP package that easily plugs into a breadboard.</p>
</div>
<div class="paragraph">
<p>The ULN2003 is a 7 darlington NPN transistor IC array used to drive motors one way. You can get it from  <a href="http://bit.ly/1D5UQIB">DigiKey</a>. A possible substitution is ULN2803 available from <a href="http://bit.ly/1xd4oKy">SparkFun</a> and <a href="http://bit.ly/1EXWhaU">Adafruit</a>.</p>
</div>
<div class="paragraph">
<p>The TMP102 is an I<sup>2</sup>C-based digital temperature sensor. You can buy them in bulk from <a href="http://bit.ly/1EA02Vx">DigiKey</a>, but it&#8217;s too small for a breadboard. <a href="http://bit.ly/1GFafAE">SparkFun</a> sells it on a breakout board that works well with a breadboard.</p>
</div>
<div class="paragraph">
<p>The DS18B20 is a one-wire digital temperature sensor that looks like a three-terminal transistor. Both <a href="http://bit.ly/1Fba7Hv">SparkFun</a> and <a href="http://bit.ly/1EbSYvC">Adafruit</a> carry it.</p>
</div>
</div>
<div class="sect2">
<h3 id="app_opto">Opto-Electronics</h3>
<div class="paragraph">
<p><a href="http://bit.ly/1BwZvQj">LEDs</a> are <em>light-emitting diodes</em>. LEDs come in a wide range of colors, brightnesses, and styles. You can get a basic red LED at <a href="http://bit.ly/1GFaHPi">SparkFun</a>, <a href="http://bit.ly/1GFaH1M">Adafuit</a>, <a href="http://shack.net/1KWVVGE">RadioShack</a>, and <a href="http://bit.ly/1b2f2PD">DigiKey</a>.</p>
</div>
<div class="paragraph">
<p>Many places carry bicolor LED matrices, but be sure to get one with an I<sup>2</sup>C interface.  <a href="http://bit.ly/18AENVn">Adafruit</a> is where I got mine.</p>
</div>
</div>
<div class="sect2">
<h3 id="app_capes">Capes</h3>
<div class="paragraph">
<p>There are a number of sources for capes for BeagleBone Black.  <a href="http://bit.ly/1AjlXJ9">BeagleBoard.org</a> keeps a current list.</p>
</div>
</div>
<div class="sect2">
<h3 id="app_misc">Miscellaneous</h3>
<div class="paragraph">
<p>Here are some things that don&#8217;t fit in the other categories.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Miscellaneous</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.3 V FTDI cable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/1FMeXsG">SparkFun</a>, <a href="http://bit.ly/18AF1Mm">Adafruit</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">USB WiFi adapter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.adafruit.com/products/814">Adafruit</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Female HDMI to male microHDMI adapter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://amzn.to/1C5BcLp">Amazon</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HDMI cable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.sparkfun.com/products/11572">SparkFun</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Micro HDMI to HDMI cable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.adafruit.com/products/1322">Adafruit</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HDMI to DVI Cable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.sparkfun.com/products/12612">SparkFun</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HDMI monitor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://amzn.to/1B4MABD">Amazon</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Powered USB hub</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://amzn.to/1NKm2zB">Amazon</a>, <a href="http://www.adafruit.com/products/961">Adafruit</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keyboard with USB hub</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://amzn.to/1FbblSX">Amazon</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Soldering iron</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/1FMfUkP">SparkFun</a>, <a href="http://bit.ly/1EXZ6J1">Adafruit</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Oscilloscope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.adafruit.com/products/468">Adafruit</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multimeter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/1C5BUbu">SparkFun</a>, <a href="http://bit.ly/1wXX3np">Adafruit</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PowerSwitch Tail II</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/1Ag5bLP">SparkFun</a>, <a href="http://bit.ly/1wXX8aF">Adafruit</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Servo motor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/1C72cvw">SparkFun</a>, <a href="http://bit.ly/1HCPQdl">Adafruit</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5 V power supply</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/1C72q5C">SparkFun</a>, <a href="http://bit.ly/18c0n2D">Adafruit</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 V to 5 V motor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/1b2g65Y">SparkFun</a>, <a href="http://bit.ly/1C72DWF">Adafruit</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 V to 5 V bipolar stepper motor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/1Bx2hVU">SparkFun</a>, <a href="http://bit.ly/18c0HhV">Adafruit</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 V to 5 V unipolar stepper motor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.adafruit.com/products/858">Adafruit</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pushbutton switch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/1AjDf90">SparkFun</a>, <a href="http://bit.ly/1b2glhw">Adafruit</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Magnetic reed switch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.sparkfun.com/products/8642">SparkFun</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LV-MaxSonar-EZ1 Sonar Range Finder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/1C73dDH">SparkFun</a>,  <a href="http://amzn.to/1wXXvlP">Amazon</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HC-SR04 Ultrsonic Range Sensor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://amzn.to/1FbcPNa">Amazon</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rotary encoder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/1D5ZypK">SparkFun</a>, <a href="http://bit.ly/1D5ZGp3">Adafruit</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GPS receiver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/1EA2sn0">SparkFun</a>, <a href="http://bit.ly/1MrS2VV">Adafruit</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BLE USB dongle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.adafruit.com/products/1327">Adafruit</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SensorTag</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/18AGPVt">DigiKey</a>, <a href="http://amzn.to/1EA2B9U">Amazon</a>,
<a href="https://store.ti.com/CC2541-SensorTag-Development-Kit-P3192.aspx">TI</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Syba SD-CM-UAUD USB Stereo Audio Adapter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://amzn.to/1EA2GdI">Amazon</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sabrent External Sound Box USB-SBCV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://amzn.to/1C74kTU">Amazon</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vantec USB External 7.1 Channel Audio Adapter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://amzn.to/19cinev">Amazon</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nokia 5110 LCD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://bit.ly/1Ag6LgG">Adafruit</a>, <a href="http://bit.ly/19cizdu">SparkFun</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BeagleBone LCD7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://elinux.org/CircuitCo:BeagleBone_LCD7#Distributors">eLinux</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MiniDisplay Cape</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://elinux.org/CircuitCo:MiniDisplay_Cape">eLinux</a></p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_index">Index</h2>
<div class="sectionbody">

</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. This solution first appeared on the  <a href="https://groups.google.com/forum/#!searchin/beagleboard/eQep/beagleboard/Orp3tFcNgCc/mYacP_GkCQQJ">Beagle Google Group</a>.
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. This solution, written by Elias Bakken (@AgentBrum), originally appeared on <a href="http://bit.ly/1FaRbbK">Hipstercircuits</a>.
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. <a href="#tips_black_hardware_details_fig">[tips_black_hardware_details_fig]</a> was originally posted by Jason Kridner at <a href="http://beagleboard.org/media" class="bare">http://beagleboard.org/media</a> under a <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
</div>
<div class="footnote" id="_footnotedef_4">
<a href="#_footnoteref_4">4</a>. <a href="#capes_7inLCD_fig">[capes_7inLCD_fig]</a> was originally posted by CircuitCo at <a href="http://elinux.org/File:BeagleBone-LCD7-Front.jpg" class="bare">http://elinux.org/File:BeagleBone-LCD7-Front.jpg</a> under a <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
</div>
<div class="footnote" id="_footnotedef_5">
<a href="#_footnoteref_5">5</a>. <a href="#capes_miniDisplayBoris">[capes_miniDisplayBoris]</a> was originally posted by David Anders at <a href="http://elinux.org/File:Minidisplay-boris.jpg" class="bare">http://elinux.org/File:Minidisplay-boris.jpg</a> under a <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
</div>
<div class="footnote" id="_footnotedef_6">
<a href="#_footnoteref_6">6</a>. <a href="#capes_lcd_backside">[capes_lcd_backside]</a> was originally posted by CircuitCo at <a href="http://elinux.org/File:BeagleBone-LCD-Backside.jpg" class="bare">http://elinux.org/File:BeagleBone-LCD-Backside.jpg</a> under a <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
</div>
<div class="footnote" id="_footnotedef_7">
<a href="#_footnoteref_7">7</a>. <a href="#Audio_cape_pins_fig">[Audio_cape_pins_fig]</a> was originally posted by Djackson at <a href="http://elinux.org/File:Audio_pins_revb.png" class="bare">http://elinux.org/File:Audio_pins_revb.png</a> under a <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
</div>
<div class="footnote" id="_footnotedef_8">
<a href="#_footnoteref_8">8</a>. <a href="#capes_beaglebread_fig">[capes_beaglebread_fig]</a> was originally posted by William Traynor at <a href="http://elinux.org/File:BeagleBone-Breadboard.jpg" class="bare">http://elinux.org/File:BeagleBone-Breadboard.jpg</a> under a <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 2.0 beta<br>
Last updated 2022-06-25 13:33:15 -0400
</div>
</div>
</body>
</html>