<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.12">
<title>Real-Time I/O</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:50%;border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="realtime">Real-Time I/O</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction">Introduction</h3>
<div class="paragraph">
<p>Sometimes, when BeagleBone Black interacts with the physical world, it needs to respond in a timely manner. For example, your robot has just detected that one of the driving motors needs to turn a bit faster. Systems that can respond quickly to a real event are known as <em>real-time</em> systems. There are two broad categories of real-time systems: soft and hard.</p>
</div>
<div class="paragraph">
<p>In a <em>soft real-time</em> system, the real-time requirements should be met <em>most</em> of the time, where <em>most</em> depends on the system. A video playback system is a good example. The goal might be to display 60 frames per second, but it doesn&#8217;t matter much if you miss a frame now and then. In a 100 percent <em>hard real-time</em> system, you can never fail to respond in time. Think of an airbag deployment system on a car. You can&#8217;t even be <span class="keep-together">50 ms late</span>.</p>
</div>
<div class="paragraph">
<p>Systems running Linux generally can&#8217;t do 100 percent hard real-time processing, because Linux gets in the way. However, the Bone has an ARM processor running Linux and two additional 32-bit programmable real-time units (PRUs [<a href="http://bit.ly/1EzTPZv" class="bare">http://bit.ly/1EzTPZv</a>]) available to do real-time processing. Although the PRUs can achieve 100 percent hard real-time, they take some effort to use.</p>
</div>
<div class="paragraph">
<p>This chapter shows several ways to do real-time input/output (I/O), starting with the effortless, yet slower BoneScript and moving up with increasing speed (and effort) to using the PRUs.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>In this chapter, as in the others, we assume that you are logged in as root (as indicated by the bone# prompt). This gives you quick access to the general-purpose input/output (GPIO) ports without having to use sudo each time.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="realtime_BoneScript">I/O with BoneScript</h3>
<div class="sect3">
<h4 id="_problem">Problem</h4>
<div class="paragraph">
<p>You want to read an input pin and write it to the output as quickly as possible with BoneScript.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution">Solution</h4>
<div class="paragraph">
<p><a href="#sensors_pushbutton">[sensors_pushbutton]</a> shows how to read a pushbutton switch and <a href="#displays_externalLED">[displays_externalLED]</a> controls an external LED. This recipe combines the two to read the switch and turn on the LED in response to it. To make this recipe, you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Breadboard and jumper wires (see <a href="#app_proto">[app_proto]</a>)</p>
</li>
<li>
<p>Pushbutton switch (see <a href="#app_misc">[app_misc]</a>)</p>
</li>
<li>
<p>220 &#8486; resistor (see <a href="#app_resistor">[app_resistor]</a>)</p>
</li>
<li>
<p>LED (see <a href="#app_opto">[app_opto]</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Wire up the pushbutton and LED as shown in <a href="#realtime_pushLED_fig">Diagram for wiring a pushbutton and LED with the LED attached to P9_12</a>.</p>
</div>
<div id="realtime_pushLED_fig" class="imageblock">
<div class="content">
<img src="figures/pushLED_bb.png" alt="Bone with pushbutton and LED">
</div>
<div class="title">Figure 1. Diagram for wiring a pushbutton and LED with the LED attached to P9_12</div>
</div>
<div class="paragraph">
<p>The code in <a href="#realtime_pushLED_code">Monitoring a pushbutton using a callback function (pushLED.js)</a> reads GPIO port P9_42, which is attached to the <span class="keep-together">pushbutton</span>, and turns on the LED attached to P9_12 when the button is pushed.</p>
</div>
<div id="realtime_pushLED_code" class="exampleblock">
<div class="title">Example 1. Monitoring a pushbutton using a callback function (pushLED.js)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node
var b = require('bonescript');
var button = 'P9_42';
var LED    = 'P9_14';

b.pinMode(button, b.INPUT, 7, 'pulldown', 'fast', doAttach);
function doAttach(x) {
    if(x.err) {
        console.log('x.err = ' + x.err);
        return;
    }
    b.attachInterrupt(button, true, b.CHANGE, flashLED);
}

b.pinMode(LED,    b.OUTPUT);

function flashLED(x) {
    if(x.attached) {
        console.log("Interrupt handler attached");
        return;
    }
    console.log('x.value = ' + x.value);
    console.log('x.err   = ' + x.err);
    b.digitalWrite(LED, x.value);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Add the code to a file named <em>pushLED.js</em> and run it by using the following commands:</p>
</div>
<pre data-type="programlisting">
bone# <strong>chmod +x pushLED.js</strong>
bone# <strong>./pushLED.js</strong>
</pre>
<div class="paragraph">
<p>Press ^C (Ctrl-C) to stop the code.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="realtime_libsoc">I/O with C and libsoc</h3>
<div class="sect3">
<h4 id="_problem_2">Problem</h4>
<div class="paragraph">
<p>You want to use the C language to process inputs in real time, or BoneScript isn&#8217;t fast enough.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_2">Solution</h4>
<div class="paragraph">
<p><a href="#realtime_BoneScript">I/O with BoneScript</a> shows how to control an LED with a pushbutton using BoneScript. This recipe accomplishes the same thing using C and libsoc. <a href="#misc_libsoc">[misc_libsoc]</a> shows how to use C and libsoc to access the GPIO pins.</p>
</div>
<div class="paragraph">
<p>Wire up the pushbutton and LED as shown in <a href="#realtime_pushLED_fig">Diagram for wiring a pushbutton and LED with the LED attached to P9_12</a>. Follow the instructions in <a href="#misc_libsoc">[misc_libsoc]</a> to install libsoc. Then add the code in <a href="#realtime_pushLED_c_code">Code for reading a switch and blinking an LED using libsoc (pushLED.c)</a> to a file named <em>pushLED.c</em>.</p>
</div>
<div id="realtime_pushLED_c_code" class="exampleblock">
<div class="title">Example 2. Code for reading a switch and blinking an LED using libsoc (pushLED.c)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/wait.h&gt;

#include "libsoc_gpio.h"
#include "libsoc_debug.h"

/**
 * 
 * This gpio_test is intended to be run on BeagleBone
 * and reads pin P9_42 (gpio7) and write the value to P9_12 (gpio60).
 *
 * The GPIO_OUTPUT and INPUT defines can be changed to support any two pins.
 * 
 */
 
#define GPIO_OUTPUT  60
#define GPIO_INPUT   7

// Create both gpio pointers
 gpio *gpio_output, *gpio_input;

static int interrupt_count = 0;

int callback_test(void* arg) {
  int* tmp_count = (int*) arg;
  int value;
  
  *tmp_count = *tmp_count + 1;
  value = libsoc_gpio_get_level (gpio_input);
  libsoc_gpio_set_level(gpio_output, value);
  // Comment out the following line to make the code respond faster
  printf("Got it (%d), button = %d\n", *tmp_count, value);
  
  return EXIT_SUCCESS;
}

int main(void) {
  // Enable debug output
  libsoc_set_debug(1);

  // Request gpios
  gpio_output = libsoc_gpio_request(GPIO_OUTPUT, LS_SHARED);
  gpio_input = libsoc_gpio_request(GPIO_INPUT, LS_SHARED);

  // Set direction to OUTPUT
  libsoc_gpio_set_direction(gpio_output, OUTPUT);
  
  // Set direction to INPUT
  libsoc_gpio_set_direction(gpio_input, INPUT);

  // Set edge to BOTH
  libsoc_gpio_set_edge(gpio_input, BOTH);

  // Set up callback
  libsoc_gpio_callback_interrupt(gpio_input, &amp;callback_test, 
                      (void*) &amp;interrupt_count);
  
  printf("Push the button...\n"); 
  // Disaple debug output so the code will respond faster
  libsoc_set_debug(0);

  sleep(10);
  
  libsoc_set_debug(1);
 
  // Cancel the callback on interrupt
  libsoc_gpio_callback_interrupt_cancel(gpio_input);
  
  //If gpio_request was successful
  if (gpio_input) { // Free gpio request memory
    libsoc_gpio_free(gpio_input);
  }
  
  if (gpio_output) { // Free gpio request memory
    libsoc_gpio_free(gpio_output);
  }
  
  return EXIT_SUCCESS;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Compile and run the code:</p>
</div>
<pre data-type="programlisting">
bone# <strong>gcc -o pushLED pushLED.c /usr/local/lib/libsoc.so</strong>
bone# <strong>./pushLED</strong>
libsoc-debug: debug enabled (libsoc_set_debug)
libsoc-gpio-debug: requested gpio (60, libsoc_gpio_request)
libsoc-gpio-debug: GPIO already exported (60, libsoc_gpio_request)
libsoc-gpio-debug: requested gpio (7, libsoc_gpio_request)
libsoc-gpio-debug: GPIO already exported (7, libsoc_gpio_request)
libsoc-gpio-debug: setting direction to out (60, libsoc_gpio_set_direction)
libsoc-gpio-debug: setting direction to in (7, libsoc_gpio_set_direction)
BOTH: 3
libsoc-gpio-debug: setting edge to both (7, libsoc_gpio_set_edge)
BOTH: 3
libsoc-gpio-debug: creating new callback (7, libsoc_gpio_callback_interrupt)
Push the button...
libsoc-debug: debug disabled (libsoc_set_debug)
Got it (1), button = 1
Got it (2), button = 0
Got it (3), button = 1
Got it (4), button = 1
Got it (5), button = 0
libsoc-debug: debug enabled (libsoc_set_debug)
libsoc-gpio-debug: callback thread was stopped
           (7, libsoc_gpio_callback_interrupt_cancel)
libsoc-gpio-debug: freeing gpio (7, libsoc_gpio_free)
libsoc-gpio-debug: freeing gpio (60, libsoc_gpio_free)
</pre>
<div class="paragraph">
<p>The code responds quickly to the pushbutton. If you need more speed, comment-out the printf command in the interrupt service routine.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_2">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="realtime_devmem2">I/O with devmem2</h3>
<div class="sect3">
<h4 id="_problem_3">Problem</h4>
<div class="paragraph">
<p>Your C code using libsoc isn&#8217;t responding fast enough to the input signal. You want to read the GPIO registers directly.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_3">Solution</h4>
<div class="paragraph">
<p>The solution is to use a simple utility called devmem2, with which you can read and write registers from the command line.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>This solution is much more involved than the previous ones. You need to understand binary and hex numbers and be able to read the <a href="http://bit.ly/1B4Cm45">AM335x Technical Reference Manual</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>First, download and install devmem2:</p>
</div>
<pre data-type="programlisting">
bone# <strong>wget http://free-electrons.com/pub/mirror/devmem2.c</strong>
bone# <strong>gcc -o devmem2 devmem2.c</strong>
bone# <strong>mv devmem2 /usr/bin</strong>
</pre>
<div class="paragraph">
<p>This solution will read a pushbutton attached to P9_42 and flash an LED attached to P9_13. Note that this is a change from the previous solutions that makes the code used here much simpler. Wire up your Bone as shown in <a href="#realtime_pushLEDmmap_fig">Diagram for wiring a pushbutton and LED with the LED attached to P9_13</a>.</p>
</div>
<div id="realtime_pushLEDmmap_fig" class="imageblock">
<div class="content">
<img src="figures/pushLEDmmap_bb.png" alt="Bone with pushbutton and LED wired to P9_13">
</div>
<div class="title">Figure 2. Diagram for wiring a pushbutton and LED with the LED attached to P9_13</div>
</div>
<div class="paragraph">
<p>Now, flash the LED attached to P9_13 using the Linux sysfs interface (<a href="#kernel_gpio_sysfs">[kernel_gpio_sysfs]</a>). To do this, first look up which GPIO number P9_13 is attached to by referring to <a href="#tips_cape_headers_digital">[tips_cape_headers_digital]</a>. Finding P9_13 at GPIO 31, export GPIO 31 and make it an output:</p>
</div>
<pre data-type="programlisting">
bone# <strong>cd cd /sys/class/gpio/</strong>
bone# <strong>echo 31 > export</strong>
bone# <strong>cd gpio31</strong>
bone# <strong>echo out > direction</strong>
bone# <strong>echo 1 > value</strong>
bone# <strong>echo 0 > value</strong>
</pre>
<div class="paragraph">
<p>The LED will turn on when 1 is echoed into value and off when 0 is echoed.</p>
</div>
<div class="paragraph">
<p>Now that you know the LED is working, look up its memory address. This is where things get very detailed. First, download the <a href="http://bit.ly/1B4Cm45">AM335x Technical Reference Manual</a>. Look up GPIO0 in the Memory Map chapter (sensors). Table 2-2 indicates that GPIO0 starts at address 0x44E0_7000. Then go to Section 25.4.1, "GPIO Registers." This shows that GPIO_DATAIN has an offset of 0x138, GPIO_CLEARDATAOUT has an offset of 0x190, and GPIO_SETDATAOUT has an offset of 0x194.</p>
</div>
<div class="paragraph">
<p>This means you read from address 0x44E0_7000 + 0x138 = 0x44E0_7138 to see the status of the LED:</p>
</div>
<pre data-type="programlisting">
bone# <strong>devmem2 0x44E07138</strong>
/dev/mem opened.
Memory mapped at address 0xb6f8e000.
Value at address 0x44E07138 (0xb6f8e138): 0xC000C404

</pre>
<div class="paragraph">
<p>The returned value 0xC000C404 (1100 0000 0000 0000 1100 0100 0000 0100 in binary) has bit 31 set to 1, which means the LED is on. Turn the LED off by writing 0x80000000 (1000 0000 0000 0000 0000 0000 0000 0000 binary) to the GPIO_CLEARDATA register at 0x44E0_7000 + 0x190 = 0x44E0_7190:</p>
</div>
<pre data-type="programlisting">
bone# <strong>devmem2 0x44E07190 w 0x80000000</strong>
/dev/mem opened.
Memory mapped at address 0xb6fd7000.
Value at address 0x44E07190 (0xb6fd7190): 0x80000000
Written 0x80000000; readback 0x0
</pre>
<div class="paragraph">
<p>The LED is now off.</p>
</div>
<div class="paragraph">
<p>You read the pushbutton switch in a similar way. <a href="#tips_cape_headers_digital">[tips_cape_headers_digital]</a> says P9_42 is GPIO 7, which means bit 7 is the state of P9_42. The devmem2 in this example reads 0x0, which means all bits are 0, including GPIO 7. Section 25.4.1 of the Technical Reference Manual instructs you to use offset 0x13C to read GPIO_DATAOUT. Push the pushbutton and run devmem2:</p>
</div>
<pre data-type="programlisting">
bone# <strong>devmem2 0x44e07138</strong>
/dev/mem opened.
Memory mapped at address 0xb6fe2000.
Value at address 0x44E07138 (0xb6fe2138): 0x4000C484
</pre>
<div class="paragraph">
<p>Here, bit 7 is set in 0x4000C484, showing the button is pushed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_3">Discussion</h4>
<div class="paragraph">
<p>This is much more tedious than the previous methods, but it&#8217;s what&#8217;s necessary if you need to minimize the time to read an input. <a href="#realtime_mmap">I/O with C and mmap()</a> shows how to read and write these addresses from C.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="realtime_mmap">I/O with C and mmap()</h3>
<div class="sect3">
<h4 id="_problem_4">Problem</h4>
<div class="paragraph">
<p>Your C code using libsoc isn&#8217;t responding fast enough to the input signal.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_4">Solution</h4>
<div class="paragraph">
<p>In smaller processors that aren&#8217;t running an operating system, you can read and write a given memory address directly from C. With Linux running on Bone, many of the memory locations are hardware protected, so you can&#8217;t accidentally access them directly.</p>
</div>
<div class="paragraph">
<p>This recipe shows how to use mmap() (memory map) to map the GPIO registers to an array in C. Then all you need to do is access the array to read and write the registers.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>This solution is much more involved than the previous ones. You need to understand binary and hex numbers and be able to read the AM335x Technical Reference Manual.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This solution will read a pushbutton attached to P9_42 and flash an LED attached to P9_13. Note that this is a change from the previous solutions that makes the code used here much simpler.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>See <a href="#realtime_devmem2">I/O with devmem2</a> for details on mapping the GPIO numbers to memory addresses.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Add the code in <a href="#realtime_pushLEDmmap_h">Memory address definitions (pushLEDmmap.h)</a> to a file named <em>pushLEDmmap.h</em>.</p>
</div>
<div id="realtime_pushLEDmmap_h" class="exampleblock">
<div class="title">Example 3. Memory address definitions (pushLEDmmap.h)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">// From: http://stackoverflow.com/questions/13124271/driving-beaglebone-gpio
// -through-dev-mem
// user contributions licensed under cc by-sa 3.0 with attribution required
// http://creativecommons.org/licenses/by-sa/3.0/
// http://blog.stackoverflow.com/2009/06/attribution-required/
// Author: madscientist159 (http://stackoverflow.com/users/3000377/madscientist159)

#ifndef _BEAGLEBONE_GPIO_H_
#define _BEAGLEBONE_GPIO_H_

#define GPIO0_START_ADDR 0x44e07000
#define GPIO0_END_ADDR   0x44e08000
#define GPIO0_SIZE (GPIO0_END_ADDR - GPIO0_START_ADDR)

#define GPIO1_START_ADDR 0x4804C000
#define GPIO1_END_ADDR   0x4804D000
#define GPIO1_SIZE (GPIO1_END_ADDR - GPIO1_START_ADDR)

#define GPIO2_START_ADDR 0x41A4C000
#define GPIO2_END_ADDR   0x41A4D000
#define GPIO2_SIZE (GPIO2_END_ADDR - GPIO2_START_ADDR)

#define GPIO3_START_ADDR 0x41A4E000
#define GPIO3_END_ADDR   0x41A4F000
#define GPIO3_SIZE (GPIO3_END_ADDR - GPIO3_START_ADDR)

#define GPIO_DATAIN 0x138
#define GPIO_SETDATAOUT 0x194
#define GPIO_CLEARDATAOUT 0x190

#define GPIO_03  (1&lt;&lt;3)
#define GPIO_07  (1&lt;&lt;7)
#define GPIO_31  (1&lt;&lt;31)
#define GPIO_60  (1&lt;&lt;28)
#endif</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Add the code in <a href="#realtime_pushLEDmmap_c">Code for directly reading memory addresses (pushLEDmmap.c)</a> to a file named <em>pushLEDmmap.c</em>.</p>
</div>
<div id="realtime_pushLEDmmap_c" class="exampleblock">
<div class="title">Example 4. Code for directly reading memory addresses (pushLEDmmap.c)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">// From: http://stackoverflow.com/questions/13124271/driving-beaglebone-gpio
// -through-dev-mem
// user contributions licensed under cc by-sa 3.0 with attribution required
// http://creativecommons.org/licenses/by-sa/3.0/
// http://blog.stackoverflow.com/2009/06/attribution-required/
// Author: madscientist159 (http://stackoverflow.com/users/3000377/madscientist159)
//
// Read one gpio pin and write it out to another using mmap.
// Be sure to set -O3 when compiling.
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;sys/mman.h&gt;
#include &lt;fcntl.h&gt; 
#include &lt;signal.h&gt;    // Defines signal-handling functions (i.e. trap Ctrl-C)
#include "pushLEDmmap.h"

// Global variables
int keepgoing = 1;    // Set to 0 when Ctrl-c is pressed

// Callback called when SIGINT is sent to the process (Ctrl-C)
void signal_handler(int sig) {
    printf( "\nCtrl-C pressed, cleaning up and exiting...\n" );
	keepgoing = 0;
}

int main(int argc, char *argv[]) {
    volatile void *gpio_addr;
    volatile unsigned int *gpio_datain;
    volatile unsigned int *gpio_setdataout_addr;
    volatile unsigned int *gpio_cleardataout_addr;

    // Set the signal callback for Ctrl-C
    signal(SIGINT, signal_handler);

    int fd = open("/dev/mem", O_RDWR);

    printf("Mapping %X - %X (size: %X)\n", GPIO0_START_ADDR, GPIO0_END_ADDR, 
                                           GPIO0_SIZE);

    gpio_addr = mmap(0, GPIO0_SIZE, PROT_READ | PROT_WRITE, MAP_SHARED, fd, 
                        GPIO0_START_ADDR);

    gpio_datain            = gpio_addr + GPIO_DATAIN;
    gpio_setdataout_addr   = gpio_addr + GPIO_SETDATAOUT;
    gpio_cleardataout_addr = gpio_addr + GPIO_CLEARDATAOUT;

    if(gpio_addr == MAP_FAILED) {
        printf("Unable to map GPIO\n");
        exit(1);
    }
    printf("GPIO mapped to %p\n", gpio_addr);
    printf("GPIO SETDATAOUTADDR mapped to %p\n", gpio_setdataout_addr);
    printf("GPIO CLEARDATAOUT mapped to %p\n", gpio_cleardataout_addr);

    printf("Start copying GPIO_07 to GPIO_31\n");
    while(keepgoing) {
    	if(*gpio_datain &amp; GPIO_07) {
            *gpio_setdataout_addr= GPIO_31;
    	} else {
            *gpio_cleardataout_addr = GPIO_31;
    	}
        //usleep(1);
    }

    munmap((void *)gpio_addr, GPIO0_SIZE);
    close(fd);
    return 0;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, compile and run the code:</p>
</div>
<pre data-type="programlisting">
bone# <strong>gcc -O3 pushLEDmmap.c -o pushLEDmmap</strong>
bone# <strong>./pushLEDmmap</strong>
Mapping 44E07000 - 44E08000 (size: 1000)
GPIO mapped to 0xb6fac000
GPIO SETDATAOUTADDR mapped to 0xb6fac194
GPIO CLEARDATAOUT mapped to 0xb6fac190
Start copying GPIO_07 to GPIO_31
^C
Ctrl-C pressed, cleaning up and exiting...
</pre>
<div class="paragraph">
<p>The code is in a tight while loop that checks the status of GPIO 7 and copies it to GPIO 31.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_4">Discussion</h4>

</div>
</div>
<div class="sect2">
<h3 id="realtime_xenomai">Modifying the Linux Kernel to Use Xenomai</h3>
<div class="sect3">
<h4 id="_problem_5">Problem</h4>
<div class="paragraph">
<p>Your program can&#8217;t get control of the processor quickly enough to do your real-time processing.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_5">Solution</h4>
<div class="paragraph">
<p><a href="http://xenomai.org/">Xenomai</a> is a set of kernel patches that allow the Bone to respond to real-time events in a predicable way. These instructions are based on Bruno Martins' <a href="http://bit.ly/1EXIEZu">Xenomai on the BeagleBone Black in 14 easy steps</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>The Xenomai kernel is used to provide real-time motion control within the Machinekit distribution for the Bone. You might get a quick start by checking out the images provided on <a href="http://bit.ly/1NK71xS">the Machinekit blog</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The Xenomai kernel is now available in the BeagleBoard.org Debian package feeds, and you can install it by using apt-get install xenomai-runtime. Nevertheless, we find it useful to include the details of building the Xenomai kernel.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>This recipe requires downloading and patching the kernel. This is advanced work.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>First, download, compile, and install the kernel, following the instructions in <a href="#kernel_compiling">[kernel_compiling]</a>. This will ensure that everything is in place and working before you start changing things.</p>
</div>
<div class="paragraph">
<p>Next, visit <a href="http://bit.ly/1C6QxwN">Xenomai&#8217;s download page</a> to find the latest version of Xenomai (at the time of this writing, it&#8217;s 2.6.4). Download it with the following command (substituting the URL for the latest version you find on Xenomai&#8217;s download page):</p>
</div>
<pre data-type="programlisting">
host$ <strong>wget http://download.gna.org/xenomai/stable/latest/xenomai-2.6.4.tar.bz2</strong>
</pre>
<div class="paragraph">
<p>Check out the latest kernel:</p>
</div>
<pre data-type="programlisting">
host$ <strong>cd bb-kernel/KERNEL</strong>
host$ <strong>uname -a</strong>
host$ <strong>git tags | sort | less</strong>
</pre>
<div class="paragraph">
<p>Pick the tag that is close to your current version of the kernel. This command checks out the 3.8.13-bone67 version of the kernel and creates a branch named xenomai:</p>
</div>
<pre data-type="programlisting">
host$ <strong>git checkout 3.8.13-bone67 -b xenomai</strong>
</pre>
<div class="sect4">
<h5 id="_patching_the_kernel">Patching the kernel</h5>
<div class="paragraph">
<p>Patch the kernel by using the following commands:</p>
</div>
<pre data-type="programlisting">
host$ <strong>cd bb-kernel/KERNEL</strong>
host$ <strong>patch -p1 &lt; ../../xenomai-2.6.4/ksrc/arch/arm/patches/\
       beaglebone/ipipe-core-3.8.13-beaglebone-pre.patch</strong>
host$ <strong>patch -p1 &lt; ../../xenomai-2.6.4/ksrc/arch/arm/patches/\
       ipipe-core-3.8.13-arm-4.patch</strong>
host$ <strong>patch -p1 &lt; ../../xenomai-2.6.4/ksrc/arch/arm/patches/\
       beaglebone/ipipe-core-3.8.13-beaglebone-post.patch</strong>
</pre>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>These commands assume bb-kernel and xenomai-2.6.4 are at the same directory level.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then get one more patch from <a href="http://bit.ly/1Mti9gQ">Xenomai&#8217;s website</a>. Add the code in <a href="#realtime_thumb">One last patch (<em>thumb.patch</em>)</a> to a file named <em>thumb.patch</em>.</p>
</div>
<div id="realtime_thumb" class="exampleblock">
<div class="title">Example 5. One last patch (<em>thumb.patch</em>)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">diff --git a/arch/arm/kernel/entry-armv.S b/arch/arm/kernel/entry-armv.S
index e2bc263..6f4d9f0 100644
--- a/arch/arm/kernel/entry-armv.S
+++ b/arch/arm/kernel/entry-armv.S
@@ -469,6 +469,7 @@ __irq_usr:
 	kuser_cmpxchg_check
 	irq_handler
 #ifdef CONFIG_IPIPE
+THUMB(	it	ne )
 	bne	__ipipe_ret_to_user_irqs_disabled
 #endif	/* CONFIG_IPIPE */
 	get_thread_info tsk
@@ -767,6 +768,7 @@ ENTRY(ret_from_exception)
 	disable_irq
 	bl	__ipipe_check_root
 	cmp     r0, #1
+THUMB(	it	ne )
 	bne	__ipipe_ret_to_user_irqs_disabled  @ Fast exit path over non-root domains
 #endif /* CONFIG_IPIPE */
 	get_thread_info tsk</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Run the following command to apply the patch:</p>
</div>
<pre data-type="programlisting">
host$ <strong>patch -p1 &lt; thumb.patch</strong>
</pre>
<div class="paragraph">
<p>Prepare the kernel:</p>
</div>
<pre data-type="programlisting">
host$ <strong>cd ../../xenomai-2.6.4/scripts</strong>
host$ <strong>./prepare-kernel.sh --arch=arm --linux=../../bb-kernel/KERNEL/</strong>
</pre>
<div class="paragraph">
<p>Now you&#8217;re ready to compile the kernel with these new patches:</p>
</div>
<pre data-type="programlisting">
host$ <strong>cd ../../bb-kernel</strong>
host$ <strong>tools/rebuild.sh</strong>
</pre>
<div class="paragraph">
<p>When the configuration menu displays (as shown in <a href="#realtime_xenomai_config">Configuing Xenomai</a>), make the following changes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select "CPU Power Management" &#8594; "CPU Frequency scaling, disable [ ] CPU Frequency scaling."</p>
</li>
<li>
<p>Select "Real-time sub-system" &#8594;" Drivers" &#8594; "Testing drivers, enable everything."</p>
</li>
</ol>
</div>
<div id="realtime_xenomai_config" class="imageblock">
<div class="content">
<img src="figures/xenomaiConfig.png" alt="Configuring Xenomai">
</div>
<div class="title">Figure 3. Configuing Xenomai</div>
</div>
<div class="paragraph">
<p>Then sit back and wait awhile. After the new kernel is built, install it following the instructions in <a href="#kernel_install">[kernel_install]</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_setting_up_the_bone">Setting up the Bone</h5>
<div class="paragraph">
<p>You are now ready to test the new Xenomai kernel. Copy Xenomai to the Bone:</p>
</div>
<pre data-type="programlisting">
host$ <strong>scp -r xenomai-2.6.4 192.168.7.2:.</strong>
</pre>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This command assumes that the Bone is at 192.168.7.2.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Run the following commands on the Bone:</p>
</div>
<pre data-type="programlisting">
bone# <strong>cd ~/xenomai-2.6.4</strong>
bone# <strong>./configure CFLAGS="-march=armv7-a -mfpu=vfp3" LDFLAGS="-march=armv7-a \
        -mfpu=vfp3"</strong>
bone# <strong>make</strong>
bone# <strong>make install</strong>
</pre>
<div class="paragraph">
<p>./configure takes about a minute, make six more minutes, and install another minute.</p>
</div>
<div class="paragraph">
<p>Next, copy the drivers:</p>
</div>
<pre data-type="programlisting">
bone# <strong>cd; mkdir xenomai_drivers; cd xenomai_drivers</strong>

host$ <strong>cd bb-kernel/KERNEL/drivers/xenomai/testing</strong>
host$ <strong>scp *.ko 192.168.7.2:xenomai_drivers</strong>

bone# <strong>insmode xeno_klat.ko</strong>
</pre>
</div>
<div class="sect4">
<h5 id="_testing">Testing</h5>
<div class="paragraph">
<p>Go ahead and run some tests:</p>
</div>
<pre data-type="programlisting">
bone# <strong>usr/xenomai/bin/latency</strong>
== Sampling period: 1000 us
== Test mode: periodic user-mode task
== All results in microseconds
warming up...
RTT|  00:00:01  (periodic user-mode task, 1000 us period, priority 99)
RTH|----lat min|----lat avg|----lat max|-overrun|---msw|---lat best|--lat worst
RTD|      3.624|      3.833|     20.458|       0|     0|      3.624|     20.458
RTD|      2.749|      3.749|     22.583|       0|     0|      2.749|     22.583
RTD|      2.749|      4.583|     25.499|       0|     0|      2.749|     25.499
RTD|      2.749|      3.708|     20.541|       0|     0|      2.749|     25.499
RTD|      2.749|      3.749|     21.916|       0|     0|      2.749|     25.499
---|-----------|-----------|-----------|--------|------|-------------------------
RTS|      2.749|      3.916|     25.499|       0|     0| 00:00:05/00:00:05
</pre>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_5">Discussion</h4>
<div class="paragraph">
<p>The details of how to use Xenomai are beyond the scope of this book, but you can browse over to <a href="http://xenomai.org/">Xenomai&#8217;s website</a> for examples and help on what to do next.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="realtime_PRUSpeak">I/O with PRU Speak</h3>
<div class="sect3">
<h4 id="_problem_6">Problem</h4>
<div class="paragraph">
<p>You require better timing than running C on the ARM can give you.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_6">Solution</h4>
<div class="paragraph">
<p>The AM335x processor on the Bone has an ARM processor that is running Linux, but it also has two 32-bit PRUs that are available for processing I/O. It takes a fair amount of understanding to program the PRU. Fortunately, a <a href="http://bit.ly/1AjlarF">2014 Google Summer of Code</a> project produced <a href="http://bit.ly/1wXT1eO">PRU Speak</a>, an adaptation of the <a href="http://botspeak.org/">BotSpeak</a> language for the PRU. This solution shows how to use it.</p>
</div>
<div class="sect4">
<h5 id="_background">Background</h5>
<div class="paragraph">
<p>PRU Speak comprises three main parts:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Kernel</dt>
<dd>
<p>The pru_speak.ko Linux kernel driver module loads PRU code and provides communication between the kernel and the firmware running on the PRU. An associated device tree overlay called BB_PRUSPEAK-00A0.dtbo configures the pin access and firmware loaded on to the PRUs.</p>
</dd>
<dt class="hdlist1">Firmware</dt>
<dd>
<p>pru0_firmware and pru1_firmware are the firmware files for each of the two PRUs.</p>
</dd>
<dt class="hdlist1">Userspace</dt>
<dd>
<p>A Python user space component includes bs_tcp_server.py; a TCP socket listener that provides an interface to the PRU Speak interpreter; and pru_speak.py, a library for invoking PRU Speak commands from within a Python script.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_prerequisites">Prerequisites</h5>
<div class="paragraph">
<p>Many of the pins easily accessible by the PRU are taken up by the HDMI interface discussed in <a href="#tips_hdmi">[tips_hdmi]</a>. If you haven&#8217;t already edited <em>uEnv.txt</em>, you can run these commands to disable the HDMI interface and reboot:</p>
</div>
<pre data-type="programlisting">
bone# <strong>sed -i \
 '/cape_disable=capemgr.disable_partno=BB-BONELT-HDMI,BB-BONELT-HDMIN$/ \
      \s/^#//' /boot/uEnv.txt</strong>
bone# <strong>shutdown -r now</strong>
</pre>
<div class="paragraph">
<p>To build the firmware files, you first need to install the TI PRU C compiler:</p>
</div>
<pre data-type="programlisting">
bone# <strong>apt-get update</strong>
bone# <strong>apt-get install ti-pru-cgt-installer</strong>
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following NEW packages will be installed:
  ti-pru-cgt-installer
0 upgraded, 1 newly installed, 0 to remove and 30 not upgraded.
Need to get 13.1 kB of archives.
After this operation, 67.6 kB of additional disk space will be used.
Get:1 http://repos.rcn-ee.net/debian/ wheezy/main ti-pru-cgt-installer \
              all 2.1.0-1~bpo70+20141201+1 [13.1 kB]
Fetched 13.1 kB in 0s (38.1 kB/s)
Selecting previously unselected package ti-pru-cgt-installer.
(Reading database ... 59608 files and directories currently installed.)
Unpacking ti-pru-cgt-installer \
              (from .../ti-pru-cgt-installer_2.1.0-1~bpo70+20141201+1_all.deb) ...
Setting up ti-pru-cgt-installer (2.1.0-1~bpo70+20141201+1) ...
--2015-01-19 18:59:14--  http://downloads.ti.com/codegen/esd/cgt_public_sw/\
PRU/2.1.0/ti_cgt_pru_2.1.0_armlinuxa8hf_busybox_installer.sh
Resolving downloads.ti.com (downloads.ti.com)... 23.62.97.64, 23.62.97.66
Connecting to downloads.ti.com (downloads.ti.com)|23.62.97.64|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 39666613 (38M) [application/x-sh]
Saving to: `ti_cgt_pru_2.1.0_armlinuxa8hf_busybox_installer.sh'

100%[====================================>] 39,666,613  75.3K/s   in 7m 39s

2015-01-19 19:06:54 (84.5 KB/s)-`ti_cgt_pru_2.1.0_arm..hf_busybox_installer.sh'\
         saved [39666613/39666613]

Installing PRU Code Generation tools version 2.1.0 into /
  please wait, or press CTRL-C to abort

Extracting archive
Installing files
[####################] 100%
Installed successfully into /
</pre>
</div>
<div class="sect4">
<h5 id="_installation">Installation</h5>
<div class="paragraph">
<p>Clone the PRU Speak repository and run the <em>install.sh</em> shell script:</p>
</div>
<pre data-type="programlisting">
bone# <strong>git clone git://github.com/jadonk/pruspeak.git</strong>
bone# <strong>cd pruspeak</strong>
bone# <strong>./install.sh</strong>
if [ ! -d "/lib/modules/3.8.13-bone68/build" ]; then apt-get install \
        linux-headers-3.8.13-bone68; fi
make -C /lib/modules/3.8.13-bone68/build M=/root/pruspeak/src/driver modules
make[1]: Entering directory `/usr/src/linux-headers-3.8.13-bone68'
  CC [M]  /root/pruspeak/src/driver/pru_speak.o
  Building modules, stage 2.
  MODPOST 1 modules
  CC      /root/pruspeak/src/driver/pru_speak.mod.o
  LD [M]  /root/pruspeak/src/driver/pru_speak.ko
make[1]: Leaving directory `/usr/src/linux-headers-3.8.13-bone68'
make -C /lib/modules/3.8.13-bone68/build M=/root/pruspeak/src/driver
modules_install
make[1]: Entering directory `/usr/src/linux-headers-3.8.13-bone68'
  INSTALL /root/pruspeak/src/driver/pru_speak.ko
  DEPMOD  3.8.13-bone68
make[1]: Leaving directory `/usr/src/linux-headers-3.8.13-bone68'
lnkpru -i/usr/share/ti/cgt-pru/lib pru0_firmware.obj pru0_syscall.obj \
         AM3359_PRU.cmd -o=pru0_firmware
lnkpru -i/usr/share/ti/cgt-pru/lib pru1_firmware.obj  AM3359_PRU.cmd
-o=pru1_firmware
install -m 444 pru0_firmware /lib/firmware
install -m 444 pru1_firmware /lib/firmware
dtc -O dtb -o BB-PRUSPEAK-00A0.dtbo -b 0 -@ BB-PRUSPEAK-00A0.dts
install -m 644 BB-PRUSPEAK-00A0.dtbo /lib/firmware
python setup.py build
running build
running build_py
python setup.py build
running build
running build_py
python setup.py install
running install
.
.
.
Processing pru_speak-0.0-py2.7.egg
Removing /usr/local/lib/python2.7/dist-packages/pru_speak-0.0-py2.7.egg
Copying pru_speak-0.0-py2.7.egg to /usr/local/lib/python2.7/dist-packages
pru-speak 0.0 is already the active version in easy-install.pth

Installed /usr/local/lib/python2.7/dist-packages/pru_speak-0.0-py2.7.egg
Processing dependencies for pru-speak==0.0
Searching for ply==3.4
Best match: ply 3.4
Processing ply-3.4-py2.7.egg
ply 3.4 is already the active version in easy-install.pth

Using /usr/local/lib/python2.7/dist-packages/ply-3.4-py2.7.egg
Finished processing dependencies for pru-speak==0.0
install -m 755 bs_tcp_server.py /usr/bin
install -m 755 bs_shell.py /usr/bin
</pre>
</div>
<div class="sect4">
<h5 id="_runing_the_kernel_module">Runing the Kernel Module</h5>
<div class="paragraph">
<p>Use the modprobe command to load the kernel module and config-pin to load the device tree overlay:</p>
</div>
<pre data-type="programlisting">
bone# <strong>modprobe pru_speak</strong>
bone# <strong>config-pin overlay BB-PRUSPEAK</strong>
</pre>
<div class="paragraph">
<p>The kernel module will need to be reloaded after rebooting, unless it&#8217;s been added to <em>/etc/modules-load.d/modules.conf</em> and <em>/boot/uEnv.txt</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_running_the_script">Running the Script</h5>
<div class="paragraph">
<p>The PRU is now ready to run code. Add the code in <a href="#realtime_pruSpeak_code">Code for copying P8_16 to P9_31 using the PRU (pruSpeak.py)</a> to a file named <em>pruSpeak.py</em>. This code copies the input on P8_16 to the output on P9_31.</p>
</div>
<div id="realtime_pruSpeak_code" class="exampleblock pagebreak-before">
<div class="title">Example 6. Code for copying P8_16 to P9_31 using the PRU (pruSpeak.py)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">#!/usr/bin/env python
from pru_speak import pru_speak

# Copy the signal on pin P8_16 to P9_31
code = '''\
SCRIPT
SET var1, DIO[14]
SET DIO[0], var1
GOTO 0
ENDSCRIPT
RUN
'''

halt = '''\
HALT
'''

ret = pru_speak.execute_instruction(code)
print ret</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Then run the code by using the following command:</p>
</div>
<pre data-type="programlisting">
bone# <strong>./pruSpeak.py</strong>
Generating LALR tables
Initializing PRU Speak
0       0x110000FF      SET var1, DIO[14]
1       0x01400000      SET DIO[0], var1
2       0x15000000      GOTO 0
3       0x7F000000      ENDSCRIPT

[285212927, 20971520, 352321536, 2130706432]
[]
PRU Speak object deleted
</pre>
<div class="paragraph">
<p>The code will return immediately, but the PRU will continue to run.</p>
</div>
<div class="paragraph">
<p>The PRU has quick access to only a subset of GPIO pins. This example reads GPIO P8_16 and writes to P9_31, so you have to wire up the pushbutton and LED as shown in <a href="#realtime_pushLEDpru_fig">Diagram for wiring a pushbutton and LED for the PRU</a>.</p>
</div>
<div id="realtime_pushLEDpru_fig" class="imageblock">
<div class="content">
<img src="figures/pushLEDpru_bb.png" alt="Bone with pushbutton and LED for PRU">
</div>
<div class="title">Figure 4. Diagram for wiring a pushbutton and LED for the PRU</div>
</div>
<div class="paragraph">
<p>Now, when you push the button, the LED should respond.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_discussion_6">Discussion</h4>
<div class="paragraph">
<p>In addition to invoking PRU Speak scripts via Python, it is also possible to open a shell or TCP socket to the interpreter. When running a script, it is also possible to modify variables to communicate with the running script.</p>
</div>
<div class="sect4">
<h5 id="_running_pru_speak_via_shell">Running PRU Speak via Shell</h5>
<div class="paragraph">
<p>To invoke a shell interface to PRU Speak, run <em>bs_shell.py</em>:</p>
</div>
<pre data-type="programlisting">
bone# <strong>bs_shell.py</strong>
Generating LALR tables
Initializing PRU Speak
ps&gt;<strong>SCRIPT</strong>
...<strong>SET DIO[0],var1</strong>
...<strong>GOTO 0</strong>
...<strong>ENDSCRIPT</strong>
...
0       0x01400001      SET DIO[0],var1
1       0x15000000      GOTO 0
2       0x7F000000      ENDSCRIPT

[]
ps&gt;<strong>RUN</strong>
...
[20971521, 352321536, 2130706432]
[]
ps&gt;<strong>SET var1,1</strong>
...
[1]
ps&gt;<strong>SET var1,0</strong>
...
[0]
ps&gt;Closing terminal
PRU Speak object deleted
</pre>
<div class="paragraph">
<p>Press Enter on a blank line to complete input to the shell. Press ^C (Ctrl-C) to exit the shell.</p>
</div>
</div>
<div class="sect4">
<h5 id="_running_pru_speak_via_tcp_socket">Running PRU Speak via TCP socket</h5>
<div class="paragraph">
<p>Running the interpreter over a TCP socket enables tools like Labview to communicate with the Bone in a platform-independent way. Use netcat (nc) to interact with the interpreter from the command line:</p>
</div>
<pre data-type="programlisting">
bone# <strong>bs_tcp_server.py 2&amp;&gt;1 &gt; /var/log/pruspeak.log &amp;</strong>
[1] 2594
bone # <strong>nc localhost 6060</strong>
<strong>SCRIPT</strong>

<strong>SET DIO[0],1</strong>

<strong>WAIT 100</strong>

<strong>SET DIO[0],0</strong>

<strong>WAIT 100</strong>

<strong>GOTO 0</strong>

<strong>ENDSCRIPT</strong>

<strong>RUN</strong>

<strong>^C</strong>
</pre>
<div class="paragraph">
<p>Press ^C (Ctrl-C) to exit nc.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Currently, pressing ^D (Ctrl-D) within nc will cause the socket listener script to close.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You should now see the LED blinking.</p>
</div>
</div>
<div class="sect4">
<h5 id="_looking_ahead">Looking Ahead</h5>
<div class="paragraph">
<p>At the time of this writing, PRU Speak is still under heavy development. Be sure to check <a href="http://bit.ly/1B4DrsC">the README file</a> for the latest installation and usage guidelines. Currently, only direct PRU GPIO access is implemented, but support for ADCs and additional GPIOs is in the works.</p>
</div>
<div class="paragraph">
<p>If you are looking to develop your own firmware for the PRUs, this example should provide a template for extending your own interface code.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-06-25 13:14:10 -0400
</div>
</div>
</body>
</html>